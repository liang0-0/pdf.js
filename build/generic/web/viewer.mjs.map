{"version":3,"file":"viewer.mjs","mappings":"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","sources":["webpack://pdf.js/webpack/bootstrap","webpack://pdf.js/webpack/runtime/define property getters","webpack://pdf.js/webpack/runtime/hasOwnProperty shorthand","webpack://pdf.js/./web/ui_utils.js","webpack://pdf.js/./web/app_options.js","webpack://pdf.js/./web/pdf_link_service.js","webpack://pdf.js/./web/pdfjs.js","webpack://pdf.js/./web/event_utils.js","webpack://pdf.js/./web/external_services.js","webpack://pdf.js/./web/preferences.js","webpack://pdf.js/./node_modules/@fluent/bundle/esm/types.js","webpack://pdf.js/./node_modules/@fluent/bundle/esm/resolver.js","webpack://pdf.js/./node_modules/@fluent/bundle/esm/scope.js","webpack://pdf.js/./node_modules/@fluent/bundle/esm/builtins.js","webpack://pdf.js/./node_modules/@fluent/bundle/esm/memoizer.js","webpack://pdf.js/./node_modules/@fluent/bundle/esm/bundle.js","webpack://pdf.js/./node_modules/@fluent/bundle/esm/resource.js","webpack://pdf.js/./node_modules/@fluent/dom/esm/overlay.js","webpack://pdf.js/./node_modules/cached-iterable/src/cached_iterable.mjs","webpack://pdf.js/./node_modules/cached-iterable/src/cached_sync_iterable.mjs","webpack://pdf.js/./node_modules/cached-iterable/src/cached_async_iterable.mjs","webpack://pdf.js/./node_modules/@fluent/dom/esm/localization.js","webpack://pdf.js/./node_modules/@fluent/dom/esm/dom_localization.js","webpack://pdf.js/./web/l10n.js","webpack://pdf.js/./web/genericl10n.js","webpack://pdf.js/./web/generic_scripting.js","webpack://pdf.js/./web/genericcom.js","webpack://pdf.js/./web/new_alt_text_manager.js","webpack://pdf.js/./web/alt_text_manager.js","webpack://pdf.js/./web/annotation_editor_params.js","webpack://pdf.js/./web/caret_browsing.js","webpack://pdf.js/./web/download_manager.js","webpack://pdf.js/./web/overlay_manager.js","webpack://pdf.js/./web/password_prompt.js","webpack://pdf.js/./web/base_tree_viewer.js","webpack://pdf.js/./web/pdf_attachment_viewer.js","webpack://pdf.js/./web/grab_to_pan.js","webpack://pdf.js/./web/pdf_cursor_tools.js","webpack://pdf.js/./web/pdf_document_properties.js","webpack://pdf.js/./web/pdf_find_utils.js","webpack://pdf.js/./web/pdf_find_controller.js","webpack://pdf.js/./web/pdf_find_bar.js","webpack://pdf.js/./web/pdf_history.js","webpack://pdf.js/./web/pdf_layer_viewer.js","webpack://pdf.js/./web/pdf_outline_viewer.js","webpack://pdf.js/./web/pdf_presentation_mode.js","webpack://pdf.js/./web/xfa_layer_builder.js","webpack://pdf.js/./web/pdf_print_service.js","webpack://pdf.js/./web/print_utils.js","webpack://pdf.js/./web/pdf_rendering_queue.js","webpack://pdf.js/./web/pdf_scripting_manager.js","webpack://pdf.js/./web/pdf_sidebar.js","webpack://pdf.js/./web/pdf_thumbnail_view.js","webpack://pdf.js/./web/pdf_thumbnail_viewer.js","webpack://pdf.js/./web/annotation_editor_layer_builder.js","webpack://pdf.js/./web/annotation_layer_builder.js","webpack://pdf.js/./web/draw_layer_builder.js","webpack://pdf.js/./web/struct_tree_layer_builder.js","webpack://pdf.js/./web/text_accessibility.js","webpack://pdf.js/./web/text_highlighter.js","webpack://pdf.js/./web/text_layer_builder.js","webpack://pdf.js/./web/pdf_page_view.js","webpack://pdf.js/./web/pdf_viewer.js","webpack://pdf.js/./web/secondary_toolbar.js","webpack://pdf.js/./web/toolbar.js","webpack://pdf.js/./web/view_history.js","webpack://pdf.js/./web/app.js","webpack://pdf.js/./web/viewer.js"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","/* Copyright 2012 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nconst DEFAULT_SCALE_VALUE = \"auto\";\nconst DEFAULT_SCALE = 1.0;\nconst DEFAULT_SCALE_DELTA = 1.1;\nconst MIN_SCALE = 0.1;\nconst MAX_SCALE = 10.0;\nconst UNKNOWN_SCALE = 0;\nconst MAX_AUTO_SCALE = 1.25;\nconst SCROLLBAR_PADDING = 40;\nconst VERTICAL_PADDING = 5;\n\nconst RenderingStates = {\n  INITIAL: 0,\n  RUNNING: 1,\n  PAUSED: 2,\n  FINISHED: 3,\n};\n\nconst PresentationModeState = {\n  UNKNOWN: 0,\n  NORMAL: 1,\n  CHANGING: 2,\n  FULLSCREEN: 3,\n};\n\nconst SidebarView = {\n  UNKNOWN: -1,\n  NONE: 0,\n  THUMBS: 1, // Default value.\n  OUTLINE: 2,\n  ATTACHMENTS: 3,\n  LAYERS: 4,\n};\n\nconst TextLayerMode = {\n  DISABLE: 0,\n  ENABLE: 1,\n  ENABLE_PERMISSIONS: 2,\n};\n\nconst ScrollMode = {\n  UNKNOWN: -1,\n  VERTICAL: 0, // Default value.\n  HORIZONTAL: 1,\n  WRAPPED: 2,\n  PAGE: 3,\n};\n\nconst SpreadMode = {\n  UNKNOWN: -1,\n  NONE: 0, // Default value.\n  ODD: 1,\n  EVEN: 2,\n};\n\nconst CursorTool = {\n  SELECT: 0, // The default value.\n  HAND: 1,\n  ZOOM: 2,\n};\n\n// Used by `PDFViewerApplication`, and by the API unit-tests.\nconst AutoPrintRegExp = /\\bprint\\s*\\(/;\n\n/**\n * Scrolls specified element into view of its parent.\n * @param {HTMLElement} element - The element to be visible.\n * @param {Object} [spot] - An object with optional top and left properties,\n *   specifying the offset from the top left edge.\n * @param {number} [spot.left]\n * @param {number} [spot.top]\n * @param {boolean} [scrollMatches] - When scrolling search results into view,\n *   ignore elements that either: Contains marked content identifiers,\n *   or have the CSS-rule `overflow: hidden;` set. The default value is `false`.\n */\nfunction scrollIntoView(element, spot, scrollMatches = false) {\n  // Assuming offsetParent is available (it's not available when viewer is in\n  // hidden iframe or object). We have to scroll: if the offsetParent is not set\n  // producing the error. See also animationStarted.\n  let parent = element.offsetParent;\n  if (!parent) {\n    console.error(\"offsetParent is not set -- cannot scroll\");\n    return;\n  }\n  let offsetY = element.offsetTop + element.clientTop;\n  let offsetX = element.offsetLeft + element.clientLeft;\n  while (\n    (parent.clientHeight === parent.scrollHeight &&\n      parent.clientWidth === parent.scrollWidth) ||\n    (scrollMatches &&\n      (parent.classList.contains(\"markedContent\") ||\n        getComputedStyle(parent).overflow === \"hidden\"))\n  ) {\n    offsetY += parent.offsetTop;\n    offsetX += parent.offsetLeft;\n\n    parent = parent.offsetParent;\n    if (!parent) {\n      return; // no need to scroll\n    }\n  }\n  if (spot) {\n    if (spot.top !== undefined) {\n      offsetY += spot.top;\n    }\n    if (spot.left !== undefined) {\n      offsetX += spot.left;\n      parent.scrollLeft = offsetX;\n    }\n  }\n  parent.scrollTop = offsetY;\n}\n\n/**\n * Helper function to start monitoring the scroll event and converting them into\n * PDF.js friendly one: with scroll debounce and scroll direction.\n */\nfunction watchScroll(viewAreaElement, callback, abortSignal = undefined) {\n  const debounceScroll = function (evt) {\n    if (rAF) {\n      return;\n    }\n    // schedule an invocation of scroll for next animation frame.\n    rAF = window.requestAnimationFrame(function viewAreaElementScrolled() {\n      rAF = null;\n\n      const currentX = viewAreaElement.scrollLeft;\n      const lastX = state.lastX;\n      if (currentX !== lastX) {\n        state.right = currentX > lastX;\n      }\n      state.lastX = currentX;\n      const currentY = viewAreaElement.scrollTop;\n      const lastY = state.lastY;\n      if (currentY !== lastY) {\n        state.down = currentY > lastY;\n      }\n      state.lastY = currentY;\n      callback(state);\n    });\n  };\n\n  const state = {\n    right: true,\n    down: true,\n    lastX: viewAreaElement.scrollLeft,\n    lastY: viewAreaElement.scrollTop,\n    _eventHandler: debounceScroll,\n  };\n\n  let rAF = null;\n  viewAreaElement.addEventListener(\"scroll\", debounceScroll, {\n    useCapture: true,\n    signal: abortSignal,\n  });\n  abortSignal?.addEventListener(\n    \"abort\",\n    () => window.cancelAnimationFrame(rAF),\n    { once: true }\n  );\n  return state;\n}\n\n/**\n * Helper function to parse query string (e.g. ?param1=value&param2=...).\n * @param {string} query\n * @returns {Map}\n */\nfunction parseQueryString(query) {\n  const params = new Map();\n  for (const [key, value] of new URLSearchParams(query)) {\n    params.set(key.toLowerCase(), value);\n  }\n  return params;\n}\n\nconst InvisibleCharsRegExp = /[\\x00-\\x1F]/g;\n\n/**\n * @param {string} str\n * @param {boolean} [replaceInvisible]\n */\nfunction removeNullCharacters(str, replaceInvisible = false) {\n  if (!InvisibleCharsRegExp.test(str)) {\n    return str;\n  }\n  if (replaceInvisible) {\n    return str.replaceAll(InvisibleCharsRegExp, m => (m === \"\\x00\" ? \"\" : \" \"));\n  }\n  return str.replaceAll(\"\\x00\", \"\");\n}\n\n/**\n * Use binary search to find the index of the first item in a given array which\n * passes a given condition. The items are expected to be sorted in the sense\n * that if the condition is true for one item in the array, then it is also true\n * for all following items.\n *\n * @returns {number} Index of the first array element to pass the test,\n *                   or |items.length| if no such element exists.\n */\nfunction binarySearchFirstItem(items, condition, start = 0) {\n  let minIndex = start;\n  let maxIndex = items.length - 1;\n\n  if (maxIndex < 0 || !condition(items[maxIndex])) {\n    return items.length;\n  }\n  if (condition(items[minIndex])) {\n    return minIndex;\n  }\n\n  while (minIndex < maxIndex) {\n    const currentIndex = (minIndex + maxIndex) >> 1;\n    const currentItem = items[currentIndex];\n    if (condition(currentItem)) {\n      maxIndex = currentIndex;\n    } else {\n      minIndex = currentIndex + 1;\n    }\n  }\n  return minIndex; /* === maxIndex */\n}\n\n/**\n *  Approximates float number as a fraction using Farey sequence (max order\n *  of 8).\n *  @param {number} x - Positive float number.\n *  @returns {Array} Estimated fraction: the first array item is a numerator,\n *                   the second one is a denominator.\n *                   They are both natural numbers.\n */\nfunction approximateFraction(x) {\n  // Fast paths for int numbers or their inversions.\n  if (Math.floor(x) === x) {\n    return [x, 1];\n  }\n  const xinv = 1 / x;\n  const limit = 8;\n  if (xinv > limit) {\n    return [1, limit];\n  } else if (Math.floor(xinv) === xinv) {\n    return [1, xinv];\n  }\n\n  const x_ = x > 1 ? xinv : x;\n  // a/b and c/d are neighbours in Farey sequence.\n  let a = 0,\n    b = 1,\n    c = 1,\n    d = 1;\n  // Limiting search to order 8.\n  while (true) {\n    // Generating next term in sequence (order of q).\n    const p = a + c,\n      q = b + d;\n    if (q > limit) {\n      break;\n    }\n    if (x_ <= p / q) {\n      c = p;\n      d = q;\n    } else {\n      a = p;\n      b = q;\n    }\n  }\n  let result;\n  // Select closest of the neighbours to x.\n  if (x_ - a / b < c / d - x_) {\n    result = x_ === x ? [a, b] : [b, a];\n  } else {\n    result = x_ === x ? [c, d] : [d, c];\n  }\n  return result;\n}\n\n/**\n * @param {number} x - A positive number to round to a multiple of `div`.\n * @param {number} div - A natural number.\n */\nfunction floorToDivide(x, div) {\n  return x - (x % div);\n}\n\n/**\n * @typedef {Object} GetPageSizeInchesParameters\n * @property {number[]} view\n * @property {number} userUnit\n * @property {number} rotate\n */\n\n/**\n * @typedef {Object} PageSize\n * @property {number} width - In inches.\n * @property {number} height - In inches.\n */\n\n/**\n * Gets the size of the specified page, converted from PDF units to inches.\n * @param {GetPageSizeInchesParameters} params\n * @returns {PageSize}\n */\nfunction getPageSizeInches({ view, userUnit, rotate }) {\n  const [x1, y1, x2, y2] = view;\n  // We need to take the page rotation into account as well.\n  const changeOrientation = rotate % 180 !== 0;\n\n  const width = ((x2 - x1) / 72) * userUnit;\n  const height = ((y2 - y1) / 72) * userUnit;\n\n  return {\n    width: changeOrientation ? height : width,\n    height: changeOrientation ? width : height,\n  };\n}\n\n/**\n * Helper function for getVisibleElements.\n *\n * @param {number} index - initial guess at the first visible element\n * @param {Array} views - array of pages, into which `index` is an index\n * @param {number} top - the top of the scroll pane\n * @returns {number} less than or equal to `index` that is definitely at or\n *   before the first visible element in `views`, but not by too much. (Usually,\n *   this will be the first element in the first partially visible row in\n *   `views`, although sometimes it goes back one row further.)\n */\nfunction backtrackBeforeAllVisibleElements(index, views, top) {\n  // binarySearchFirstItem's assumption is that the input is ordered, with only\n  // one index where the conditions flips from false to true: [false ...,\n  // true...]. With vertical scrolling and spreads, it is possible to have\n  // [false ..., true, false, true ...]. With wrapped scrolling we can have a\n  // similar sequence, with many more mixed true and false in the middle.\n  //\n  // So there is no guarantee that the binary search yields the index of the\n  // first visible element. It could have been any of the other visible elements\n  // that were preceded by a hidden element.\n\n  // Of course, if either this element or the previous (hidden) element is also\n  // the first element, there's nothing to worry about.\n  if (index < 2) {\n    return index;\n  }\n\n  // That aside, the possible cases are represented below.\n  //\n  //     ****  = fully hidden\n  //     A*B*  = mix of partially visible and/or hidden pages\n  //     CDEF  = fully visible\n  //\n  // (1) Binary search could have returned A, in which case we can stop.\n  // (2) Binary search could also have returned B, in which case we need to\n  // check the whole row.\n  // (3) Binary search could also have returned C, in which case we need to\n  // check the whole previous row.\n  //\n  // There's one other possibility:\n  //\n  //     ****  = fully hidden\n  //     ABCD  = mix of fully and/or partially visible pages\n  //\n  // (4) Binary search could only have returned A.\n\n  // Initially assume that we need to find the beginning of the current row\n  // (case 1, 2, or 4), which means finding a page that is above the current\n  // page's top. If the found page is partially visible, we're definitely not in\n  // case 3, and this assumption is correct.\n  let elt = views[index].div;\n  let pageTop = elt.offsetTop + elt.clientTop;\n\n  if (pageTop >= top) {\n    // The found page is fully visible, so we're actually either in case 3 or 4,\n    // and unfortunately we can't tell the difference between them without\n    // scanning the entire previous row, so we just conservatively assume that\n    // we do need to backtrack to that row. In both cases, the previous page is\n    // in the previous row, so use its top instead.\n    elt = views[index - 1].div;\n    pageTop = elt.offsetTop + elt.clientTop;\n  }\n\n  // Now we backtrack to the first page that still has its bottom below\n  // `pageTop`, which is the top of a page in the first visible row (unless\n  // we're in case 4, in which case it's the row before that).\n  // `index` is found by binary search, so the page at `index - 1` is\n  // invisible and we can start looking for potentially visible pages from\n  // `index - 2`. (However, if this loop terminates on its first iteration,\n  // which is the case when pages are stacked vertically, `index` should remain\n  // unchanged, so we use a distinct loop variable.)\n  for (let i = index - 2; i >= 0; --i) {\n    elt = views[i].div;\n    if (elt.offsetTop + elt.clientTop + elt.clientHeight <= pageTop) {\n      // We have reached the previous row, so stop now.\n      // This loop is expected to terminate relatively quickly because the\n      // number of pages per row is expected to be small.\n      break;\n    }\n    index = i;\n  }\n  return index;\n}\n\n/**\n * @typedef {Object} GetVisibleElementsParameters\n * @property {HTMLElement} scrollEl - A container that can possibly scroll.\n * @property {Array} views - Objects with a `div` property that contains an\n *   HTMLElement, which should all be descendants of `scrollEl` satisfying the\n *   relevant layout assumptions.\n * @property {boolean} sortByVisibility - If `true`, the returned elements are\n *   sorted in descending order of the percent of their padding box that is\n *   visible. The default value is `false`.\n * @property {boolean} horizontal - If `true`, the elements are assumed to be\n *   laid out horizontally instead of vertically. The default value is `false`.\n * @property {boolean} rtl - If `true`, the `scrollEl` container is assumed to\n *   be in right-to-left mode. The default value is `false`.\n */\n\n/**\n * Generic helper to find out what elements are visible within a scroll pane.\n *\n * Well, pretty generic. There are some assumptions placed on the elements\n * referenced by `views`:\n *   - If `horizontal`, no left of any earlier element is to the right of the\n *     left of any later element.\n *   - Otherwise, `views` can be split into contiguous rows where, within a row,\n *     no top of any element is below the bottom of any other element, and\n *     between rows, no bottom of any element in an earlier row is below the\n *     top of any element in a later row.\n *\n * (Here, top, left, etc. all refer to the padding edge of the element in\n * question. For pages, that ends up being equivalent to the bounding box of the\n * rendering canvas. Earlier and later refer to index in `views`, not page\n * layout.)\n *\n * @param {GetVisibleElementsParameters} params\n * @returns {Object} `{ first, last, views: [{ id, x, y, view, percent }] }`\n */\nfunction getVisibleElements({\n  scrollEl,\n  views,\n  sortByVisibility = false,\n  horizontal = false,\n  rtl = false,\n}) {\n  const top = scrollEl.scrollTop,\n    bottom = top + scrollEl.clientHeight;\n  const left = scrollEl.scrollLeft,\n    right = left + scrollEl.clientWidth;\n\n  // Throughout this \"generic\" function, comments will assume we're working with\n  // PDF document pages, which is the most important and complex case. In this\n  // case, the visible elements we're actually interested is the page canvas,\n  // which is contained in a wrapper which adds no padding/border/margin, which\n  // is itself contained in `view.div` which adds no padding (but does add a\n  // border). So, as specified in this function's doc comment, this function\n  // does all of its work on the padding edge of the provided views, starting at\n  // offsetLeft/Top (which includes margin) and adding clientLeft/Top (which is\n  // the border). Adding clientWidth/Height gets us the bottom-right corner of\n  // the padding edge.\n  function isElementBottomAfterViewTop(view) {\n    const element = view.div;\n    const elementBottom =\n      element.offsetTop + element.clientTop + element.clientHeight;\n    return elementBottom > top;\n  }\n  function isElementNextAfterViewHorizontally(view) {\n    const element = view.div;\n    const elementLeft = element.offsetLeft + element.clientLeft;\n    const elementRight = elementLeft + element.clientWidth;\n    return rtl ? elementLeft < right : elementRight > left;\n  }\n\n  const visible = [],\n    ids = new Set(),\n    numViews = views.length;\n  let firstVisibleElementInd = binarySearchFirstItem(\n    views,\n    horizontal\n      ? isElementNextAfterViewHorizontally\n      : isElementBottomAfterViewTop\n  );\n\n  // Please note the return value of the `binarySearchFirstItem` function when\n  // no valid element is found (hence the `firstVisibleElementInd` check below).\n  if (\n    firstVisibleElementInd > 0 &&\n    firstVisibleElementInd < numViews &&\n    !horizontal\n  ) {\n    // In wrapped scrolling (or vertical scrolling with spreads), with some page\n    // sizes, isElementBottomAfterViewTop doesn't satisfy the binary search\n    // condition: there can be pages with bottoms above the view top between\n    // pages with bottoms below. This function detects and corrects that error;\n    // see it for more comments.\n    firstVisibleElementInd = backtrackBeforeAllVisibleElements(\n      firstVisibleElementInd,\n      views,\n      top\n    );\n  }\n\n  // lastEdge acts as a cutoff for us to stop looping, because we know all\n  // subsequent pages will be hidden.\n  //\n  // When using wrapped scrolling or vertical scrolling with spreads, we can't\n  // simply stop the first time we reach a page below the bottom of the view;\n  // the tops of subsequent pages on the same row could still be visible. In\n  // horizontal scrolling, we don't have that issue, so we can stop as soon as\n  // we pass `right`, without needing the code below that handles the -1 case.\n  let lastEdge = horizontal ? right : -1;\n\n  for (let i = firstVisibleElementInd; i < numViews; i++) {\n    const view = views[i],\n      element = view.div;\n    const currentWidth = element.offsetLeft + element.clientLeft;\n    const currentHeight = element.offsetTop + element.clientTop;\n    const viewWidth = element.clientWidth,\n      viewHeight = element.clientHeight;\n    const viewRight = currentWidth + viewWidth;\n    const viewBottom = currentHeight + viewHeight;\n\n    if (lastEdge === -1) {\n      // As commented above, this is only needed in non-horizontal cases.\n      // Setting lastEdge to the bottom of the first page that is partially\n      // visible ensures that the next page fully below lastEdge is on the\n      // next row, which has to be fully hidden along with all subsequent rows.\n      if (viewBottom >= bottom) {\n        lastEdge = viewBottom;\n      }\n    } else if ((horizontal ? currentWidth : currentHeight) > lastEdge) {\n      break;\n    }\n\n    if (\n      viewBottom <= top ||\n      currentHeight >= bottom ||\n      viewRight <= left ||\n      currentWidth >= right\n    ) {\n      continue;\n    }\n\n    const hiddenHeight =\n      Math.max(0, top - currentHeight) + Math.max(0, viewBottom - bottom);\n    const hiddenWidth =\n      Math.max(0, left - currentWidth) + Math.max(0, viewRight - right);\n\n    const fractionHeight = (viewHeight - hiddenHeight) / viewHeight,\n      fractionWidth = (viewWidth - hiddenWidth) / viewWidth;\n    const percent = (fractionHeight * fractionWidth * 100) | 0;\n\n    visible.push({\n      id: view.id,\n      x: currentWidth,\n      y: currentHeight,\n      view,\n      percent,\n      widthPercent: (fractionWidth * 100) | 0,\n    });\n    ids.add(view.id);\n  }\n\n  const first = visible[0],\n    last = visible.at(-1);\n\n  if (sortByVisibility) {\n    visible.sort(function (a, b) {\n      const pc = a.percent - b.percent;\n      if (Math.abs(pc) > 0.001) {\n        return -pc;\n      }\n      return a.id - b.id; // ensure stability\n    });\n  }\n  return { first, last, views: visible, ids };\n}\n\nfunction normalizeWheelEventDirection(evt) {\n  let delta = Math.hypot(evt.deltaX, evt.deltaY);\n  const angle = Math.atan2(evt.deltaY, evt.deltaX);\n  if (-0.25 * Math.PI < angle && angle < 0.75 * Math.PI) {\n    // All that is left-up oriented has to change the sign.\n    delta = -delta;\n  }\n  return delta;\n}\n\nfunction normalizeWheelEventDelta(evt) {\n  const deltaMode = evt.deltaMode; // Avoid being affected by bug 1392460.\n  let delta = normalizeWheelEventDirection(evt);\n\n  const MOUSE_PIXELS_PER_LINE = 30;\n  const MOUSE_LINES_PER_PAGE = 30;\n\n  // Converts delta to per-page units\n  if (deltaMode === WheelEvent.DOM_DELTA_PIXEL) {\n    delta /= MOUSE_PIXELS_PER_LINE * MOUSE_LINES_PER_PAGE;\n  } else if (deltaMode === WheelEvent.DOM_DELTA_LINE) {\n    delta /= MOUSE_LINES_PER_PAGE;\n  }\n  return delta;\n}\n\nfunction isValidRotation(angle) {\n  return Number.isInteger(angle) && angle % 90 === 0;\n}\n\nfunction isValidScrollMode(mode) {\n  return (\n    Number.isInteger(mode) &&\n    Object.values(ScrollMode).includes(mode) &&\n    mode !== ScrollMode.UNKNOWN\n  );\n}\n\nfunction isValidSpreadMode(mode) {\n  return (\n    Number.isInteger(mode) &&\n    Object.values(SpreadMode).includes(mode) &&\n    mode !== SpreadMode.UNKNOWN\n  );\n}\n\nfunction isPortraitOrientation(size) {\n  return size.width <= size.height;\n}\n\n/**\n * Promise that is resolved when DOM window becomes visible.\n */\nconst animationStarted = new Promise(function (resolve) {\n  if (\n    typeof PDFJSDev !== \"undefined\" &&\n    PDFJSDev.test(\"LIB\") &&\n    typeof window === \"undefined\"\n  ) {\n    // Prevent \"ReferenceError: window is not defined\" errors when running the\n    // unit-tests in Node.js environments.\n    setTimeout(resolve, 20);\n    return;\n  }\n  window.requestAnimationFrame(resolve);\n});\n\nconst docStyle =\n  typeof PDFJSDev !== \"undefined\" &&\n  PDFJSDev.test(\"LIB\") &&\n  typeof document === \"undefined\"\n    ? null\n    : document.documentElement.style;\n\nfunction clamp(v, min, max) {\n  return Math.min(Math.max(v, min), max);\n}\n\nclass ProgressBar {\n  #classList = null;\n\n  #disableAutoFetchTimeout = null;\n\n  #percent = 0;\n\n  #style = null;\n\n  #visible = true;\n\n  constructor(bar) {\n    this.#classList = bar.classList;\n    this.#style = bar.style;\n  }\n\n  get percent() {\n    return this.#percent;\n  }\n\n  set percent(val) {\n    this.#percent = clamp(val, 0, 100);\n\n    if (isNaN(val)) {\n      this.#classList.add(\"indeterminate\");\n      return;\n    }\n    this.#classList.remove(\"indeterminate\");\n\n    this.#style.setProperty(\"--progressBar-percent\", `${this.#percent}%`);\n  }\n\n  setWidth(viewer) {\n    if (!viewer) {\n      return;\n    }\n    const container = viewer.parentNode;\n    const scrollbarWidth = container.offsetWidth - viewer.offsetWidth;\n    if (scrollbarWidth > 0) {\n      this.#style.setProperty(\n        \"--progressBar-end-offset\",\n        `${scrollbarWidth}px`\n      );\n    }\n  }\n\n  setDisableAutoFetch(delay = /* ms = */ 5000) {\n    if (this.#percent === 100 || isNaN(this.#percent)) {\n      return;\n    }\n    if (this.#disableAutoFetchTimeout) {\n      clearTimeout(this.#disableAutoFetchTimeout);\n    }\n    this.show();\n\n    this.#disableAutoFetchTimeout = setTimeout(() => {\n      this.#disableAutoFetchTimeout = null;\n      this.hide();\n    }, delay);\n  }\n\n  hide() {\n    if (!this.#visible) {\n      return;\n    }\n    this.#visible = false;\n    this.#classList.add(\"hidden\");\n  }\n\n  show() {\n    if (this.#visible) {\n      return;\n    }\n    this.#visible = true;\n    this.#classList.remove(\"hidden\");\n  }\n}\n\n/**\n * Get the active or focused element in current DOM.\n *\n * Recursively search for the truly active or focused element in case there are\n * shadow DOMs.\n *\n * @returns {Element} the truly active or focused element.\n */\nfunction getActiveOrFocusedElement() {\n  let curRoot = document;\n  let curActiveOrFocused =\n    curRoot.activeElement || curRoot.querySelector(\":focus\");\n\n  while (curActiveOrFocused?.shadowRoot) {\n    curRoot = curActiveOrFocused.shadowRoot;\n    curActiveOrFocused =\n      curRoot.activeElement || curRoot.querySelector(\":focus\");\n  }\n\n  return curActiveOrFocused;\n}\n\n/**\n * Converts API PageLayout values to the format used by `BaseViewer`.\n * @param {string} layout - The API PageLayout value.\n * @returns {Object}\n */\nfunction apiPageLayoutToViewerModes(layout) {\n  let scrollMode = ScrollMode.VERTICAL,\n    spreadMode = SpreadMode.NONE;\n\n  switch (layout) {\n    case \"SinglePage\":\n      scrollMode = ScrollMode.PAGE;\n      break;\n    case \"OneColumn\":\n      break;\n    case \"TwoPageLeft\":\n      scrollMode = ScrollMode.PAGE;\n    /* falls through */\n    case \"TwoColumnLeft\":\n      spreadMode = SpreadMode.ODD;\n      break;\n    case \"TwoPageRight\":\n      scrollMode = ScrollMode.PAGE;\n    /* falls through */\n    case \"TwoColumnRight\":\n      spreadMode = SpreadMode.EVEN;\n      break;\n  }\n  return { scrollMode, spreadMode };\n}\n\n/**\n * Converts API PageMode values to the format used by `PDFSidebar`.\n * NOTE: There's also a \"FullScreen\" parameter which is not possible to support,\n *       since the Fullscreen API used in browsers requires that entering\n *       fullscreen mode only occurs as a result of a user-initiated event.\n * @param {string} mode - The API PageMode value.\n * @returns {number} A value from {SidebarView}.\n */\nfunction apiPageModeToSidebarView(mode) {\n  switch (mode) {\n    case \"UseNone\":\n      return SidebarView.NONE;\n    case \"UseThumbs\":\n      return SidebarView.THUMBS;\n    case \"UseOutlines\":\n      return SidebarView.OUTLINE;\n    case \"UseAttachments\":\n      return SidebarView.ATTACHMENTS;\n    case \"UseOC\":\n      return SidebarView.LAYERS;\n  }\n  return SidebarView.NONE; // Default value.\n}\n\nfunction toggleCheckedBtn(button, toggle, view = null) {\n  button.classList.toggle(\"toggled\", toggle);\n  button.setAttribute(\"aria-checked\", toggle);\n\n  view?.classList.toggle(\"hidden\", !toggle);\n}\n\nfunction toggleExpandedBtn(button, toggle, view = null) {\n  button.classList.toggle(\"toggled\", toggle);\n  button.setAttribute(\"aria-expanded\", toggle);\n\n  view?.classList.toggle(\"hidden\", !toggle);\n}\n\n// In Firefox, the css calc function uses f32 precision but the Chrome or Safari\n// are using f64 one. So in order to have the same rendering in all browsers, we\n// need to use the right precision in order to have correct dimensions.\nconst calcRound =\n  typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")\n    ? Math.fround\n    : (function () {\n        if (\n          typeof PDFJSDev !== \"undefined\" &&\n          PDFJSDev.test(\"LIB\") &&\n          typeof document === \"undefined\"\n        ) {\n          return x => x;\n        }\n        const e = document.createElement(\"div\");\n        e.style.width = \"round(down, calc(1.6666666666666665 * 792px), 1px)\";\n        return e.style.width === \"calc(1320px)\" ? Math.fround : x => x;\n      })();\n\nexport {\n  animationStarted,\n  apiPageLayoutToViewerModes,\n  apiPageModeToSidebarView,\n  approximateFraction,\n  AutoPrintRegExp,\n  backtrackBeforeAllVisibleElements, // only exported for testing\n  binarySearchFirstItem,\n  calcRound,\n  CursorTool,\n  DEFAULT_SCALE,\n  DEFAULT_SCALE_DELTA,\n  DEFAULT_SCALE_VALUE,\n  docStyle,\n  floorToDivide,\n  getActiveOrFocusedElement,\n  getPageSizeInches,\n  getVisibleElements,\n  isPortraitOrientation,\n  isValidRotation,\n  isValidScrollMode,\n  isValidSpreadMode,\n  MAX_AUTO_SCALE,\n  MAX_SCALE,\n  MIN_SCALE,\n  normalizeWheelEventDelta,\n  normalizeWheelEventDirection,\n  parseQueryString,\n  PresentationModeState,\n  ProgressBar,\n  removeNullCharacters,\n  RenderingStates,\n  SCROLLBAR_PADDING,\n  scrollIntoView,\n  ScrollMode,\n  SidebarView,\n  SpreadMode,\n  TextLayerMode,\n  toggleCheckedBtn,\n  toggleExpandedBtn,\n  UNKNOWN_SCALE,\n  VERTICAL_PADDING,\n  watchScroll,\n};\n","/* Copyright 2018 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nif (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"GENERIC\")) {\n  // eslint-disable-next-line no-var\n  var compatParams = new Map();\n  if (\n    typeof PDFJSDev !== \"undefined\" &&\n    PDFJSDev.test(\"LIB\") &&\n    typeof navigator === \"undefined\"\n  ) {\n    globalThis.navigator = Object.create(null);\n  }\n  const userAgent = navigator.userAgent || \"\";\n  const platform = navigator.platform || \"\";\n  const maxTouchPoints = navigator.maxTouchPoints || 1;\n\n  const isAndroid = /Android/.test(userAgent);\n  const isIOS =\n    /\\b(iPad|iPhone|iPod)(?=;)/.test(userAgent) ||\n    (platform === \"MacIntel\" && maxTouchPoints > 1);\n\n  // Limit canvas size to 5 mega-pixels on mobile.\n  // Support: Android, iOS\n  (function () {\n    if (isIOS || isAndroid) {\n      compatParams.set(\"maxCanvasPixels\", 5242880);\n    }\n  })();\n\n  // Don't use system fonts on Android (issue 18210).\n  // Support: Android\n  (function () {\n    if (isAndroid) {\n      compatParams.set(\"useSystemFonts\", false);\n    }\n  })();\n}\n\nconst OptionKind = {\n  BROWSER: 0x01,\n  VIEWER: 0x02,\n  API: 0x04,\n  WORKER: 0x08,\n  EVENT_DISPATCH: 0x10,\n  PREFERENCE: 0x80,\n};\n\n// Should only be used with options that allow multiple types.\nconst Type = {\n  BOOLEAN: 0x01,\n  NUMBER: 0x02,\n  OBJECT: 0x04,\n  STRING: 0x08,\n  UNDEFINED: 0x10,\n};\n\n/**\n * NOTE: These options are used to generate the `default_preferences.json` file,\n *       see `OptionKind.PREFERENCE`, hence the values below must use only\n *       primitive types and cannot rely on any imported types.\n */\nconst defaultOptions = {\n  allowedGlobalEvents: {\n    /** @type {Object} */\n    value: null,\n    kind: OptionKind.BROWSER,\n  },\n  canvasMaxAreaInBytes: {\n    /** @type {number} */\n    value: -1,\n    kind: OptionKind.BROWSER + OptionKind.API,\n  },\n  isInAutomation: {\n    /** @type {boolean} */\n    value: false,\n    kind: OptionKind.BROWSER,\n  },\n  localeProperties: {\n    /** @type {Object} */\n    value:\n      typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"GENERIC\")\n        ? { lang: navigator.language || \"en-US\" }\n        : null,\n    kind: OptionKind.BROWSER,\n  },\n  nimbusDataStr: {\n    /** @type {string} */\n    value: \"\",\n    kind: OptionKind.BROWSER,\n  },\n  supportsCaretBrowsingMode: {\n    /** @type {boolean} */\n    value: false,\n    kind: OptionKind.BROWSER,\n  },\n  supportsDocumentFonts: {\n    /** @type {boolean} */\n    value: true,\n    kind: OptionKind.BROWSER,\n  },\n  supportsIntegratedFind: {\n    /** @type {boolean} */\n    value: false,\n    kind: OptionKind.BROWSER,\n  },\n  supportsMouseWheelZoomCtrlKey: {\n    /** @type {boolean} */\n    value: true,\n    kind: OptionKind.BROWSER,\n  },\n  supportsMouseWheelZoomMetaKey: {\n    /** @type {boolean} */\n    value: true,\n    kind: OptionKind.BROWSER,\n  },\n  supportsPinchToZoom: {\n    /** @type {boolean} */\n    value: true,\n    kind: OptionKind.BROWSER,\n  },\n  toolbarDensity: {\n    /** @type {number} */\n    value: 0, // 0 = \"normal\", 1 = \"compact\", 2 = \"touch\"\n    kind: OptionKind.BROWSER + OptionKind.EVENT_DISPATCH,\n  },\n\n  altTextLearnMoreUrl: {\n    /** @type {string} */\n    value:\n      typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")\n        ? \"https://support.mozilla.org/1/firefox/%VERSION%/%OS%/%LOCALE%/pdf-alt-text\"\n        : \"\",\n    kind: OptionKind.VIEWER + OptionKind.PREFERENCE,\n  },\n  annotationEditorMode: {\n    /** @type {number} */\n    value: 0,\n    kind: OptionKind.VIEWER + OptionKind.PREFERENCE,\n  },\n  annotationMode: {\n    /** @type {number} */\n    value: 2,\n    kind: OptionKind.VIEWER + OptionKind.PREFERENCE,\n  },\n  cursorToolOnLoad: {\n    /** @type {number} */\n    value: 0,\n    kind: OptionKind.VIEWER + OptionKind.PREFERENCE,\n  },\n  debuggerSrc: {\n    /** @type {string} */\n    value: \"./debugger.mjs\",\n    kind: OptionKind.VIEWER,\n  },\n  defaultZoomDelay: {\n    /** @type {number} */\n    value: 400,\n    kind: OptionKind.VIEWER + OptionKind.PREFERENCE,\n  },\n  defaultZoomValue: {\n    /** @type {string} */\n    value: \"\",\n    kind: OptionKind.VIEWER + OptionKind.PREFERENCE,\n  },\n  disableHistory: {\n    /** @type {boolean} */\n    value: false,\n    kind: OptionKind.VIEWER,\n  },\n  disablePageLabels: {\n    /** @type {boolean} */\n    value: false,\n    kind: OptionKind.VIEWER + OptionKind.PREFERENCE,\n  },\n  enableAltText: {\n    /** @type {boolean} */\n    value: false,\n    kind: OptionKind.VIEWER + OptionKind.PREFERENCE,\n  },\n  enableAltTextModelDownload: {\n    /** @type {boolean} */\n    value: true,\n    kind: OptionKind.VIEWER + OptionKind.PREFERENCE + OptionKind.EVENT_DISPATCH,\n  },\n  enableGuessAltText: {\n    /** @type {boolean} */\n    value: true,\n    kind: OptionKind.VIEWER + OptionKind.PREFERENCE + OptionKind.EVENT_DISPATCH,\n  },\n  enableHighlightFloatingButton: {\n    // We'll probably want to make some experiments before enabling this\n    // in Firefox release, but it has to be temporary.\n    // TODO: remove it when unnecessary.\n    /** @type {boolean} */\n    value: typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"TESTING\"),\n    kind: OptionKind.VIEWER + OptionKind.PREFERENCE,\n  },\n  enableNewAltTextWhenAddingImage: {\n    /** @type {boolean} */\n    value: true,\n    kind: OptionKind.VIEWER + OptionKind.PREFERENCE,\n  },\n  enablePermissions: {\n    /** @type {boolean} */\n    value: false,\n    kind: OptionKind.VIEWER + OptionKind.PREFERENCE,\n  },\n  enablePrintAutoRotate: {\n    /** @type {boolean} */\n    value: true,\n    kind: OptionKind.VIEWER + OptionKind.PREFERENCE,\n  },\n  enableScripting: {\n    /** @type {boolean} */\n    value: typeof PDFJSDev === \"undefined\" || !PDFJSDev.test(\"CHROME\"),\n    kind: OptionKind.VIEWER + OptionKind.PREFERENCE,\n  },\n  enableUpdatedAddImage: {\n    // We'll probably want to make some experiments before enabling this\n    // in Firefox release, but it has to be temporary.\n    // TODO: remove it when unnecessary.\n    /** @type {boolean} */\n    value: false,\n    kind: OptionKind.VIEWER + OptionKind.PREFERENCE,\n  },\n  externalLinkRel: {\n    /** @type {string} */\n    value: \"noopener noreferrer nofollow\",\n    kind: OptionKind.VIEWER,\n  },\n  externalLinkTarget: {\n    /** @type {number} */\n    value: 0,\n    kind: OptionKind.VIEWER + OptionKind.PREFERENCE,\n  },\n  highlightEditorColors: {\n    /** @type {string} */\n    value: \"yellow=#FFFF98,green=#53FFBC,blue=#80EBFF,pink=#FFCBE6,red=#FF4F5F\",\n    kind: OptionKind.VIEWER + OptionKind.PREFERENCE,\n  },\n  historyUpdateUrl: {\n    /** @type {boolean} */\n    value: false,\n    kind: OptionKind.VIEWER + OptionKind.PREFERENCE,\n  },\n  ignoreDestinationZoom: {\n    /** @type {boolean} */\n    value: false,\n    kind: OptionKind.VIEWER + OptionKind.PREFERENCE,\n  },\n  imageResourcesPath: {\n    /** @type {string} */\n    value:\n      typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")\n        ? \"resource://pdf.js/web/images/\"\n        : \"./images/\",\n    kind: OptionKind.VIEWER,\n  },\n  maxCanvasPixels: {\n    /** @type {number} */\n    value: 2 ** 25,\n    kind: OptionKind.VIEWER,\n  },\n  forcePageColors: {\n    /** @type {boolean} */\n    value: false,\n    kind: OptionKind.VIEWER + OptionKind.PREFERENCE,\n  },\n  pageColorsBackground: {\n    /** @type {string} */\n    value: \"Canvas\",\n    kind: OptionKind.VIEWER + OptionKind.PREFERENCE,\n  },\n  pageColorsForeground: {\n    /** @type {string} */\n    value: \"CanvasText\",\n    kind: OptionKind.VIEWER + OptionKind.PREFERENCE,\n  },\n  pdfBugEnabled: {\n    /** @type {boolean} */\n    value: typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"TESTING\"),\n    kind: OptionKind.VIEWER + OptionKind.PREFERENCE,\n  },\n  printResolution: {\n    /** @type {number} */\n    value: 150,\n    kind: OptionKind.VIEWER,\n  },\n  sidebarViewOnLoad: {\n    /** @type {number} */\n    value: -1,\n    kind: OptionKind.VIEWER + OptionKind.PREFERENCE,\n  },\n  scrollModeOnLoad: {\n    /** @type {number} */\n    value: -1,\n    kind: OptionKind.VIEWER + OptionKind.PREFERENCE,\n  },\n  spreadModeOnLoad: {\n    /** @type {number} */\n    value: -1,\n    kind: OptionKind.VIEWER + OptionKind.PREFERENCE,\n  },\n  textLayerMode: {\n    /** @type {number} */\n    value: 1,\n    kind: OptionKind.VIEWER + OptionKind.PREFERENCE,\n  },\n  viewOnLoad: {\n    /** @type {boolean} */\n    value: 0,\n    kind: OptionKind.VIEWER + OptionKind.PREFERENCE,\n  },\n\n  cMapPacked: {\n    /** @type {boolean} */\n    value: true,\n    kind: OptionKind.API,\n  },\n  cMapUrl: {\n    /** @type {string} */\n    value:\n      // eslint-disable-next-line no-nested-ternary\n      typeof PDFJSDev === \"undefined\"\n        ? \"../external/bcmaps/\"\n        : PDFJSDev.test(\"MOZCENTRAL\")\n          ? \"resource://pdf.js/web/cmaps/\"\n          : \"../web/cmaps/\",\n    kind: OptionKind.API,\n  },\n  disableAutoFetch: {\n    /** @type {boolean} */\n    value: false,\n    kind: OptionKind.API + OptionKind.PREFERENCE,\n  },\n  disableFontFace: {\n    /** @type {boolean} */\n    value: false,\n    kind: OptionKind.API + OptionKind.PREFERENCE,\n  },\n  disableRange: {\n    /** @type {boolean} */\n    value: false,\n    kind: OptionKind.API + OptionKind.PREFERENCE,\n  },\n  disableStream: {\n    /** @type {boolean} */\n    value: false,\n    kind: OptionKind.API + OptionKind.PREFERENCE,\n  },\n  docBaseUrl: {\n    /** @type {string} */\n    value: typeof PDFJSDev === \"undefined\" ? document.URL.split(\"#\", 1)[0] : \"\",\n    kind: OptionKind.API,\n  },\n  enableHWA: {\n    /** @type {boolean} */\n    value: typeof PDFJSDev !== \"undefined\" && !PDFJSDev.test(\"MOZCENTRAL\"),\n    kind: OptionKind.API + OptionKind.VIEWER + OptionKind.PREFERENCE,\n  },\n  enableXfa: {\n    /** @type {boolean} */\n    value: true,\n    kind: OptionKind.API + OptionKind.PREFERENCE,\n  },\n  fontExtraProperties: {\n    /** @type {boolean} */\n    value: false,\n    kind: OptionKind.API,\n  },\n  isEvalSupported: {\n    /** @type {boolean} */\n    value: true,\n    kind: OptionKind.API,\n  },\n  isOffscreenCanvasSupported: {\n    /** @type {boolean} */\n    value: true,\n    kind: OptionKind.API,\n  },\n  maxImageSize: {\n    /** @type {number} */\n    value: -1,\n    kind: OptionKind.API,\n  },\n  pdfBug: {\n    /** @type {boolean} */\n    value: false,\n    kind: OptionKind.API,\n  },\n  standardFontDataUrl: {\n    /** @type {string} */\n    value:\n      // eslint-disable-next-line no-nested-ternary\n      typeof PDFJSDev === \"undefined\"\n        ? \"../external/standard_fonts/\"\n        : PDFJSDev.test(\"MOZCENTRAL\")\n          ? \"resource://pdf.js/web/standard_fonts/\"\n          : \"../web/standard_fonts/\",\n    kind: OptionKind.API,\n  },\n  useSystemFonts: {\n    // On Android, there is almost no chance to have the font we want so we\n    // don't use the system fonts in this case (bug 1882613).\n    /** @type {boolean|undefined} */\n    value: (\n      typeof PDFJSDev === \"undefined\"\n        ? window.isGECKOVIEW\n        : PDFJSDev.test(\"GECKOVIEW\")\n    )\n      ? false\n      : undefined,\n    kind: OptionKind.API,\n    type: Type.BOOLEAN + Type.UNDEFINED,\n  },\n  verbosity: {\n    /** @type {number} */\n    value: 1,\n    kind: OptionKind.API,\n  },\n\n  workerPort: {\n    /** @type {Object} */\n    value: null,\n    kind: OptionKind.WORKER,\n  },\n  workerSrc: {\n    /** @type {string} */\n    value:\n      // eslint-disable-next-line no-nested-ternary\n      typeof PDFJSDev === \"undefined\"\n        ? \"../src/pdf.worker.js\"\n        : PDFJSDev.test(\"MOZCENTRAL\")\n          ? \"resource://pdf.js/build/pdf.worker.mjs\"\n          : \"../build/pdf.worker.mjs\",\n    kind: OptionKind.WORKER,\n  },\n};\nif (typeof PDFJSDev === \"undefined\" || !PDFJSDev.test(\"MOZCENTRAL\")) {\n  defaultOptions.defaultUrl = {\n    /** @type {string} */\n    value:\n      typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"CHROME\")\n        ? \"\"\n        : \"compressed.tracemonkey-pldi-09.pdf\",\n    kind: OptionKind.VIEWER,\n  };\n  defaultOptions.sandboxBundleSrc = {\n    /** @type {string} */\n    value:\n      typeof PDFJSDev === \"undefined\"\n        ? \"../build/dev-sandbox/pdf.sandbox.mjs\"\n        : \"../build/pdf.sandbox.mjs\",\n    kind: OptionKind.VIEWER,\n  };\n  defaultOptions.viewerCssTheme = {\n    /** @type {number} */\n    value: typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"CHROME\") ? 2 : 0,\n    kind: OptionKind.VIEWER + OptionKind.PREFERENCE,\n  };\n  defaultOptions.enableFakeMLManager = {\n    /** @type {boolean} */\n    value: true,\n    kind: OptionKind.VIEWER,\n  };\n}\nif (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"GENERIC\")) {\n  defaultOptions.disablePreferences = {\n    /** @type {boolean} */\n    value: typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"TESTING\"),\n    kind: OptionKind.VIEWER,\n  };\n} else if (PDFJSDev.test(\"CHROME\")) {\n  defaultOptions.disableTelemetry = {\n    /** @type {boolean} */\n    value: false,\n    kind: OptionKind.VIEWER + OptionKind.PREFERENCE,\n  };\n}\n\nif (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"TESTING || LIB\")) {\n  // Ensure that the `defaultOptions` are correctly specified.\n  for (const name in defaultOptions) {\n    const { value, kind, type } = defaultOptions[name];\n\n    if (kind & OptionKind.PREFERENCE) {\n      if (kind === OptionKind.PREFERENCE) {\n        throw new Error(`Cannot use only \"PREFERENCE\" kind: ${name}`);\n      }\n      if (kind & OptionKind.BROWSER) {\n        throw new Error(`Cannot mix \"PREFERENCE\" and \"BROWSER\" kind: ${name}`);\n      }\n      if (type !== undefined) {\n        throw new Error(\n          `Cannot have \\`type\\`-field for \"PREFERENCE\" kind: ${name}`\n        );\n      }\n      if (typeof compatParams === \"object\" && compatParams.has(name)) {\n        throw new Error(\n          `Should not have compatibility-value for \"PREFERENCE\" kind: ${name}`\n        );\n      }\n      // Only \"simple\" preference-values are allowed.\n      if (\n        typeof value !== \"boolean\" &&\n        typeof value !== \"string\" &&\n        !Number.isInteger(value)\n      ) {\n        throw new Error(`Invalid value for \"PREFERENCE\" kind: ${name}`);\n      }\n    } else if (kind & OptionKind.BROWSER) {\n      if (type !== undefined) {\n        throw new Error(\n          `Cannot have \\`type\\`-field for \"BROWSER\" kind: ${name}`\n        );\n      }\n      if (typeof compatParams === \"object\" && compatParams.has(name)) {\n        throw new Error(\n          `Should not have compatibility-value for \"BROWSER\" kind: ${name}`\n        );\n      }\n      if (value === undefined) {\n        throw new Error(`Invalid value for \"BROWSER\" kind: ${name}`);\n      }\n    }\n  }\n}\n\nclass AppOptions {\n  static eventBus;\n\n  static #opts = new Map();\n\n  static {\n    // Initialize all the user-options.\n    for (const name in defaultOptions) {\n      this.#opts.set(name, defaultOptions[name].value);\n    }\n\n    if (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"GENERIC\")) {\n      // Apply any compatibility-values to the user-options.\n      for (const [name, value] of compatParams) {\n        this.#opts.set(name, value);\n      }\n      this._hasInvokedSet = false;\n\n      this._checkDisablePreferences = () => {\n        if (this.get(\"disablePreferences\")) {\n          // Give custom implementations of the default viewer a simpler way to\n          // opt-out of having the `Preferences` override existing `AppOptions`.\n          return true;\n        }\n        if (this._hasInvokedSet) {\n          console.warn(\n            \"The Preferences may override manually set AppOptions; \" +\n              'please use the \"disablePreferences\"-option to prevent that.'\n          );\n        }\n        return false;\n      };\n    }\n  }\n\n  constructor() {\n    if (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"TESTING\")) {\n      throw new Error(\"Cannot initialize AppOptions.\");\n    }\n  }\n\n  static get(name) {\n    return this.#opts.get(name);\n  }\n\n  static getAll(kind = null, defaultOnly = false) {\n    const options = Object.create(null);\n    for (const name in defaultOptions) {\n      const defaultOpt = defaultOptions[name];\n\n      if (kind && !(kind & defaultOpt.kind)) {\n        continue;\n      }\n      options[name] = !defaultOnly ? this.#opts.get(name) : defaultOpt.value;\n    }\n    return options;\n  }\n\n  static set(name, value) {\n    this.setAll({ [name]: value });\n  }\n\n  static setAll(options, prefs = false) {\n    if (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"GENERIC\")) {\n      this._hasInvokedSet ||= true;\n    }\n    let events;\n\n    for (const name in options) {\n      const defaultOpt = defaultOptions[name],\n        userOpt = options[name];\n\n      if (\n        !defaultOpt ||\n        !(\n          typeof userOpt === typeof defaultOpt.value ||\n          Type[(typeof userOpt).toUpperCase()] & defaultOpt.type\n        )\n      ) {\n        continue;\n      }\n      const { kind } = defaultOpt;\n\n      if (\n        prefs &&\n        !(kind & OptionKind.BROWSER || kind & OptionKind.PREFERENCE)\n      ) {\n        continue;\n      }\n      if (this.eventBus && kind & OptionKind.EVENT_DISPATCH) {\n        (events ||= new Map()).set(name, userOpt);\n      }\n      this.#opts.set(name, userOpt);\n    }\n\n    if (events) {\n      for (const [name, value] of events) {\n        this.eventBus.dispatch(name.toLowerCase(), { source: this, value });\n      }\n    }\n  }\n}\n\nexport { AppOptions, OptionKind };\n","/* Copyright 2015 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/** @typedef {import(\"./event_utils\").EventBus} EventBus */\n/** @typedef {import(\"./interfaces\").IPDFLinkService} IPDFLinkService */\n\nimport { parseQueryString } from \"./ui_utils.js\";\n\nconst DEFAULT_LINK_REL = \"noopener noreferrer nofollow\";\n\nconst LinkTarget = {\n  NONE: 0, // Default value.\n  SELF: 1,\n  BLANK: 2,\n  PARENT: 3,\n  TOP: 4,\n};\n\n/**\n * @typedef {Object} PDFLinkServiceOptions\n * @property {EventBus} eventBus - The application event bus.\n * @property {number} [externalLinkTarget] - Specifies the `target` attribute\n *   for external links. Must use one of the values from {LinkTarget}.\n *   Defaults to using no target.\n * @property {string} [externalLinkRel] - Specifies the `rel` attribute for\n *   external links. Defaults to stripping the referrer.\n * @property {boolean} [ignoreDestinationZoom] - Ignores the zoom argument,\n *   thus preserving the current zoom level in the viewer, when navigating\n *   to internal destinations. The default value is `false`.\n */\n\n/**\n * Performs navigation functions inside PDF, such as opening specified page,\n * or destination.\n * @implements {IPDFLinkService}\n */\nclass PDFLinkService {\n  externalLinkEnabled = true;\n\n  /**\n   * @param {PDFLinkServiceOptions} options\n   */\n  constructor({\n    eventBus,\n    externalLinkTarget = null,\n    externalLinkRel = null,\n    ignoreDestinationZoom = false,\n  } = {}) {\n    this.eventBus = eventBus;\n    this.externalLinkTarget = externalLinkTarget;\n    this.externalLinkRel = externalLinkRel;\n    this._ignoreDestinationZoom = ignoreDestinationZoom;\n\n    this.baseUrl = null;\n    this.pdfDocument = null;\n    this.pdfViewer = null;\n    this.pdfHistory = null;\n  }\n\n  setDocument(pdfDocument, baseUrl = null) {\n    this.baseUrl = baseUrl;\n    this.pdfDocument = pdfDocument;\n  }\n\n  setViewer(pdfViewer) {\n    this.pdfViewer = pdfViewer;\n  }\n\n  setHistory(pdfHistory) {\n    this.pdfHistory = pdfHistory;\n  }\n\n  /**\n   * @type {number}\n   */\n  get pagesCount() {\n    return this.pdfDocument ? this.pdfDocument.numPages : 0;\n  }\n\n  /**\n   * @type {number}\n   */\n  get page() {\n    return this.pdfDocument ? this.pdfViewer.currentPageNumber : 1;\n  }\n\n  /**\n   * @param {number} value\n   */\n  set page(value) {\n    if (this.pdfDocument) {\n      this.pdfViewer.currentPageNumber = value;\n    }\n  }\n\n  /**\n   * @type {number}\n   */\n  get rotation() {\n    return this.pdfDocument ? this.pdfViewer.pagesRotation : 0;\n  }\n\n  /**\n   * @param {number} value\n   */\n  set rotation(value) {\n    if (this.pdfDocument) {\n      this.pdfViewer.pagesRotation = value;\n    }\n  }\n\n  /**\n   * @type {boolean}\n   */\n  get isInPresentationMode() {\n    return this.pdfDocument ? this.pdfViewer.isInPresentationMode : false;\n  }\n\n  /**\n   * This method will, when available, also update the browser history.\n   *\n   * @param {string|Array} dest - The named, or explicit, PDF destination.\n   */\n  async goToDestination(dest) {\n    if (!this.pdfDocument) {\n      return;\n    }\n    let namedDest, explicitDest, pageNumber;\n    if (typeof dest === \"string\") {\n      namedDest = dest;\n      explicitDest = await this.pdfDocument.getDestination(dest);\n    } else {\n      namedDest = null;\n      explicitDest = await dest;\n    }\n    if (!Array.isArray(explicitDest)) {\n      console.error(\n        `goToDestination: \"${explicitDest}\" is not a valid destination array, for dest=\"${dest}\".`\n      );\n      return;\n    }\n    // Dest array looks like that: <page-ref> </XYZ|/FitXXX> <args..>\n    const [destRef] = explicitDest;\n\n    if (destRef && typeof destRef === \"object\") {\n      pageNumber = this.pdfDocument.cachedPageNumber(destRef);\n\n      if (!pageNumber) {\n        // Fetch the page reference if it's not yet available. This could\n        // only occur during loading, before all pages have been resolved.\n        try {\n          pageNumber = (await this.pdfDocument.getPageIndex(destRef)) + 1;\n        } catch {\n          console.error(\n            `goToDestination: \"${destRef}\" is not a valid page reference, for dest=\"${dest}\".`\n          );\n          return;\n        }\n      }\n    } else if (Number.isInteger(destRef)) {\n      pageNumber = destRef + 1;\n    }\n    if (!pageNumber || pageNumber < 1 || pageNumber > this.pagesCount) {\n      console.error(\n        `goToDestination: \"${pageNumber}\" is not a valid page number, for dest=\"${dest}\".`\n      );\n      return;\n    }\n\n    if (this.pdfHistory) {\n      // Update the browser history before scrolling the new destination into\n      // view, to be able to accurately capture the current document position.\n      this.pdfHistory.pushCurrentPosition();\n      this.pdfHistory.push({ namedDest, explicitDest, pageNumber });\n    }\n\n    this.pdfViewer.scrollPageIntoView({\n      pageNumber,\n      destArray: explicitDest,\n      ignoreDestinationZoom: this._ignoreDestinationZoom,\n    });\n  }\n\n  /**\n   * This method will, when available, also update the browser history.\n   *\n   * @param {number|string} val - The page number, or page label.\n   */\n  goToPage(val) {\n    if (!this.pdfDocument) {\n      return;\n    }\n    const pageNumber =\n      (typeof val === \"string\" && this.pdfViewer.pageLabelToPageNumber(val)) ||\n      val | 0;\n    if (\n      !(\n        Number.isInteger(pageNumber) &&\n        pageNumber > 0 &&\n        pageNumber <= this.pagesCount\n      )\n    ) {\n      console.error(`PDFLinkService.goToPage: \"${val}\" is not a valid page.`);\n      return;\n    }\n\n    if (this.pdfHistory) {\n      // Update the browser history before scrolling the new page into view,\n      // to be able to accurately capture the current document position.\n      this.pdfHistory.pushCurrentPosition();\n      this.pdfHistory.pushPage(pageNumber);\n    }\n\n    this.pdfViewer.scrollPageIntoView({ pageNumber });\n  }\n\n  /**\n   * Adds various attributes (href, title, target, rel) to hyperlinks.\n   * @param {HTMLAnchorElement} link\n   * @param {string} url\n   * @param {boolean} [newWindow]\n   */\n  addLinkAttributes(link, url, newWindow = false) {\n    if (!url || typeof url !== \"string\") {\n      throw new Error('A valid \"url\" parameter must provided.');\n    }\n    const target = newWindow ? LinkTarget.BLANK : this.externalLinkTarget,\n      rel = this.externalLinkRel;\n\n    if (this.externalLinkEnabled) {\n      link.href = link.title = url;\n    } else {\n      link.href = \"\";\n      link.title = `Disabled: ${url}`;\n      link.onclick = () => false;\n    }\n\n    let targetStr = \"\"; // LinkTarget.NONE\n    switch (target) {\n      case LinkTarget.NONE:\n        break;\n      case LinkTarget.SELF:\n        targetStr = \"_self\";\n        break;\n      case LinkTarget.BLANK:\n        targetStr = \"_blank\";\n        break;\n      case LinkTarget.PARENT:\n        targetStr = \"_parent\";\n        break;\n      case LinkTarget.TOP:\n        targetStr = \"_top\";\n        break;\n    }\n    link.target = targetStr;\n\n    link.rel = typeof rel === \"string\" ? rel : DEFAULT_LINK_REL;\n  }\n\n  /**\n   * @param {string|Array} dest - The PDF destination object.\n   * @returns {string} The hyperlink to the PDF object.\n   */\n  getDestinationHash(dest) {\n    if (typeof dest === \"string\") {\n      if (dest.length > 0) {\n        return this.getAnchorUrl(\"#\" + escape(dest));\n      }\n    } else if (Array.isArray(dest)) {\n      const str = JSON.stringify(dest);\n      if (str.length > 0) {\n        return this.getAnchorUrl(\"#\" + escape(str));\n      }\n    }\n    return this.getAnchorUrl(\"\");\n  }\n\n  /**\n   * Prefix the full url on anchor links to make sure that links are resolved\n   * relative to the current URL instead of the one defined in <base href>.\n   * @param {string} anchor - The anchor hash, including the #.\n   * @returns {string} The hyperlink to the PDF object.\n   */\n  getAnchorUrl(anchor) {\n    return this.baseUrl ? this.baseUrl + anchor : anchor;\n  }\n\n  /**\n   * @param {string} hash\n   */\n  setHash(hash) {\n    if (!this.pdfDocument) {\n      return;\n    }\n    let pageNumber, dest;\n    if (hash.includes(\"=\")) {\n      const params = parseQueryString(hash);\n      if (params.has(\"search\")) {\n        const query = params.get(\"search\").replaceAll('\"', \"\"),\n          phrase = params.get(\"phrase\") === \"true\";\n\n        this.eventBus.dispatch(\"findfromurlhash\", {\n          source: this,\n          query: phrase ? query : query.match(/\\S+/g),\n        });\n      }\n      // borrowing syntax from \"Parameters for Opening PDF Files\"\n      if (params.has(\"page\")) {\n        pageNumber = params.get(\"page\") | 0 || 1;\n      }\n      if (params.has(\"zoom\")) {\n        // Build the destination array.\n        const zoomArgs = params.get(\"zoom\").split(\",\"); // scale,left,top\n        const zoomArg = zoomArgs[0];\n        const zoomArgNumber = parseFloat(zoomArg);\n\n        if (!zoomArg.includes(\"Fit\")) {\n          // If the zoomArg is a number, it has to get divided by 100. If it's\n          // a string, it should stay as it is.\n          dest = [\n            null,\n            { name: \"XYZ\" },\n            zoomArgs.length > 1 ? zoomArgs[1] | 0 : null,\n            zoomArgs.length > 2 ? zoomArgs[2] | 0 : null,\n            zoomArgNumber ? zoomArgNumber / 100 : zoomArg,\n          ];\n        } else if (zoomArg === \"Fit\" || zoomArg === \"FitB\") {\n          dest = [null, { name: zoomArg }];\n        } else if (\n          zoomArg === \"FitH\" ||\n          zoomArg === \"FitBH\" ||\n          zoomArg === \"FitV\" ||\n          zoomArg === \"FitBV\"\n        ) {\n          dest = [\n            null,\n            { name: zoomArg },\n            zoomArgs.length > 1 ? zoomArgs[1] | 0 : null,\n          ];\n        } else if (zoomArg === \"FitR\") {\n          if (zoomArgs.length !== 5) {\n            console.error(\n              'PDFLinkService.setHash: Not enough parameters for \"FitR\".'\n            );\n          } else {\n            dest = [\n              null,\n              { name: zoomArg },\n              zoomArgs[1] | 0,\n              zoomArgs[2] | 0,\n              zoomArgs[3] | 0,\n              zoomArgs[4] | 0,\n            ];\n          }\n        } else {\n          console.error(\n            `PDFLinkService.setHash: \"${zoomArg}\" is not a valid zoom value.`\n          );\n        }\n      }\n      if (dest) {\n        this.pdfViewer.scrollPageIntoView({\n          pageNumber: pageNumber || this.page,\n          destArray: dest,\n          allowNegativeOffset: true,\n        });\n      } else if (pageNumber) {\n        this.page = pageNumber; // simple page\n      }\n      if (params.has(\"pagemode\")) {\n        this.eventBus.dispatch(\"pagemode\", {\n          source: this,\n          mode: params.get(\"pagemode\"),\n        });\n      }\n      // Ensure that this parameter is *always* handled last, in order to\n      // guarantee that it won't be overridden (e.g. by the \"page\" parameter).\n      if (params.has(\"nameddest\")) {\n        this.goToDestination(params.get(\"nameddest\"));\n      }\n\n      if (typeof PDFJSDev === \"undefined\" || !PDFJSDev.test(\"MOZCENTRAL\")) {\n        return;\n      }\n      // Support opening of PDF attachments in the Firefox PDF Viewer,\n      // which uses a couple of non-standard hash parameters; refer to\n      // `DownloadManager.openOrDownloadData` in the firefoxcom.js file.\n      if (!params.has(\"filename\") || !params.has(\"filedest\")) {\n        return;\n      }\n      hash = params.get(\"filedest\");\n    }\n\n    // Named (or explicit) destination.\n    dest = unescape(hash);\n    try {\n      dest = JSON.parse(dest);\n\n      if (!Array.isArray(dest)) {\n        // Avoid incorrectly rejecting a valid named destination, such as\n        // e.g. \"4.3\" or \"true\", because `JSON.parse` converted its type.\n        dest = dest.toString();\n      }\n    } catch {}\n\n    if (typeof dest === \"string\" || PDFLinkService.#isValidExplicitDest(dest)) {\n      this.goToDestination(dest);\n      return;\n    }\n    console.error(\n      `PDFLinkService.setHash: \"${unescape(hash)}\" is not a valid destination.`\n    );\n  }\n\n  /**\n   * @param {string} action\n   */\n  executeNamedAction(action) {\n    if (!this.pdfDocument) {\n      return;\n    }\n    // See PDF reference, table 8.45 - Named action\n    switch (action) {\n      case \"GoBack\":\n        this.pdfHistory?.back();\n        break;\n\n      case \"GoForward\":\n        this.pdfHistory?.forward();\n        break;\n\n      case \"NextPage\":\n        this.pdfViewer.nextPage();\n        break;\n\n      case \"PrevPage\":\n        this.pdfViewer.previousPage();\n        break;\n\n      case \"LastPage\":\n        this.page = this.pagesCount;\n        break;\n\n      case \"FirstPage\":\n        this.page = 1;\n        break;\n\n      default:\n        break; // No action according to spec\n    }\n\n    this.eventBus.dispatch(\"namedaction\", {\n      source: this,\n      action,\n    });\n  }\n\n  /**\n   * @param {Object} action\n   */\n  async executeSetOCGState(action) {\n    if (!this.pdfDocument) {\n      return;\n    }\n    const pdfDocument = this.pdfDocument,\n      optionalContentConfig = await this.pdfViewer.optionalContentConfigPromise;\n\n    if (pdfDocument !== this.pdfDocument) {\n      return; // The document was closed while the optional content resolved.\n    }\n    optionalContentConfig.setOCGState(action);\n\n    this.pdfViewer.optionalContentConfigPromise = Promise.resolve(\n      optionalContentConfig\n    );\n  }\n\n  static #isValidExplicitDest(dest) {\n    if (!Array.isArray(dest) || dest.length < 2) {\n      return false;\n    }\n    const [page, zoom, ...args] = dest;\n    if (\n      !(\n        typeof page === \"object\" &&\n        Number.isInteger(page?.num) &&\n        Number.isInteger(page?.gen)\n      ) &&\n      !Number.isInteger(page)\n    ) {\n      return false;\n    }\n    if (!(typeof zoom === \"object\" && typeof zoom?.name === \"string\")) {\n      return false;\n    }\n    const argsLen = args.length;\n    let allowNull = true;\n    switch (zoom.name) {\n      case \"XYZ\":\n        if (argsLen < 2 || argsLen > 3) {\n          return false;\n        }\n        break;\n      case \"Fit\":\n      case \"FitB\":\n        return argsLen === 0;\n      case \"FitH\":\n      case \"FitBH\":\n      case \"FitV\":\n      case \"FitBV\":\n        if (argsLen > 1) {\n          return false;\n        }\n        break;\n      case \"FitR\":\n        if (argsLen !== 4) {\n          return false;\n        }\n        allowNull = false;\n        break;\n      default:\n        return false;\n    }\n    for (const arg of args) {\n      if (!(typeof arg === \"number\" || (allowNull && arg === null))) {\n        return false;\n      }\n    }\n    return true;\n  }\n}\n\n/**\n * @implements {IPDFLinkService}\n */\nclass SimpleLinkService extends PDFLinkService {\n  setDocument(pdfDocument, baseUrl = null) {}\n}\n\nexport { LinkTarget, PDFLinkService, SimpleLinkService };\n","/* Copyright 2016 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nconst {\n  AbortException,\n  AnnotationEditorLayer,\n  AnnotationEditorParamsType,\n  AnnotationEditorType,\n  AnnotationEditorUIManager,\n  AnnotationLayer,\n  AnnotationMode,\n  build,\n  ColorPicker,\n  createValidAbsoluteUrl,\n  DOMSVGFactory,\n  DrawLayer,\n  FeatureTest,\n  fetchData,\n  getDocument,\n  getFilenameFromUrl,\n  getPdfFilenameFromUrl,\n  getXfaPageViewport,\n  GlobalWorkerOptions,\n  ImageKind,\n  InvalidPDFException,\n  isDataScheme,\n  isPdfFile,\n  MissingPDFException,\n  noContextMenu,\n  normalizeUnicode,\n  OPS,\n  OutputScale,\n  PasswordResponses,\n  PDFDataRangeTransport,\n  PDFDateString,\n  PDFWorker,\n  PermissionFlag,\n  PixelsPerInch,\n  RenderingCancelledException,\n  setLayerDimensions,\n  shadow,\n  TextLayer,\n  UnexpectedResponseException,\n  Util,\n  VerbosityLevel,\n  version,\n  XfaLayer,\n} = globalThis.pdfjsLib;\n\nexport {\n  AbortException,\n  AnnotationEditorLayer,\n  AnnotationEditorParamsType,\n  AnnotationEditorType,\n  AnnotationEditorUIManager,\n  AnnotationLayer,\n  AnnotationMode,\n  build,\n  ColorPicker,\n  createValidAbsoluteUrl,\n  DOMSVGFactory,\n  DrawLayer,\n  FeatureTest,\n  fetchData,\n  getDocument,\n  getFilenameFromUrl,\n  getPdfFilenameFromUrl,\n  getXfaPageViewport,\n  GlobalWorkerOptions,\n  ImageKind,\n  InvalidPDFException,\n  isDataScheme,\n  isPdfFile,\n  MissingPDFException,\n  noContextMenu,\n  normalizeUnicode,\n  OPS,\n  OutputScale,\n  PasswordResponses,\n  PDFDataRangeTransport,\n  PDFDateString,\n  PDFWorker,\n  PermissionFlag,\n  PixelsPerInch,\n  RenderingCancelledException,\n  setLayerDimensions,\n  shadow,\n  TextLayer,\n  UnexpectedResponseException,\n  Util,\n  VerbosityLevel,\n  version,\n  XfaLayer,\n};\n","/* Copyright 2012 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nconst WaitOnType = {\n  EVENT: \"event\",\n  TIMEOUT: \"timeout\",\n};\n\n/**\n * @typedef {Object} WaitOnEventOrTimeoutParameters\n * @property {Object} target - The event target, can for example be:\n *   `window`, `document`, a DOM element, or an {EventBus} instance.\n * @property {string} name - The name of the event.\n * @property {number} delay - The delay, in milliseconds, after which the\n *   timeout occurs (if the event wasn't already dispatched).\n */\n\n/**\n * Allows waiting for an event or a timeout, whichever occurs first.\n * Can be used to ensure that an action always occurs, even when an event\n * arrives late or not at all.\n *\n * @param {WaitOnEventOrTimeoutParameters}\n * @returns {Promise} A promise that is resolved with a {WaitOnType} value.\n */\nasync function waitOnEventOrTimeout({ target, name, delay = 0 }) {\n  if (\n    typeof target !== \"object\" ||\n    !(name && typeof name === \"string\") ||\n    !(Number.isInteger(delay) && delay >= 0)\n  ) {\n    throw new Error(\"waitOnEventOrTimeout - invalid parameters.\");\n  }\n  const { promise, resolve } = Promise.withResolvers();\n  const ac = new AbortController();\n\n  function handler(type) {\n    ac.abort(); // Remove event listener.\n    clearTimeout(timeout);\n\n    resolve(type);\n  }\n\n  const evtMethod = target instanceof EventBus ? \"_on\" : \"addEventListener\";\n  target[evtMethod](name, handler.bind(null, WaitOnType.EVENT), {\n    signal: ac.signal,\n  });\n\n  const timeout = setTimeout(handler.bind(null, WaitOnType.TIMEOUT), delay);\n\n  return promise;\n}\n\n/**\n * Simple event bus for an application. Listeners are attached using the `on`\n * and `off` methods. To raise an event, the `dispatch` method shall be used.\n */\nclass EventBus {\n  #listeners = Object.create(null);\n\n  /**\n   * @param {string} eventName\n   * @param {function} listener\n   * @param {Object} [options]\n   */\n  on(eventName, listener, options = null) {\n    this._on(eventName, listener, {\n      external: true,\n      once: options?.once,\n      signal: options?.signal,\n    });\n  }\n\n  /**\n   * @param {string} eventName\n   * @param {function} listener\n   * @param {Object} [options]\n   */\n  off(eventName, listener, options = null) {\n    this._off(eventName, listener);\n  }\n\n  /**\n   * @param {string} eventName\n   * @param {Object} data\n   */\n  dispatch(eventName, data) {\n    const eventListeners = this.#listeners[eventName];\n    if (!eventListeners || eventListeners.length === 0) {\n      return;\n    }\n    let externalListeners;\n    // Making copy of the listeners array in case if it will be modified\n    // during dispatch.\n    for (const { listener, external, once } of eventListeners.slice(0)) {\n      if (once) {\n        this._off(eventName, listener);\n      }\n      if (external) {\n        (externalListeners ||= []).push(listener);\n        continue;\n      }\n      listener(data);\n    }\n    // Dispatch any \"external\" listeners *after* the internal ones, to give the\n    // viewer components time to handle events and update their state first.\n    if (externalListeners) {\n      for (const listener of externalListeners) {\n        listener(data);\n      }\n      externalListeners = null;\n    }\n  }\n\n  /**\n   * @ignore\n   */\n  _on(eventName, listener, options = null) {\n    let rmAbort = null;\n    if (options?.signal instanceof AbortSignal) {\n      const { signal } = options;\n      if (signal.aborted) {\n        console.error(\"Cannot use an `aborted` signal.\");\n        return;\n      }\n      const onAbort = () => this._off(eventName, listener);\n      rmAbort = () => signal.removeEventListener(\"abort\", onAbort);\n\n      signal.addEventListener(\"abort\", onAbort);\n    }\n\n    const eventListeners = (this.#listeners[eventName] ||= []);\n    eventListeners.push({\n      listener,\n      external: options?.external === true,\n      once: options?.once === true,\n      rmAbort,\n    });\n  }\n\n  /**\n   * @ignore\n   */\n  _off(eventName, listener, options = null) {\n    const eventListeners = this.#listeners[eventName];\n    if (!eventListeners) {\n      return;\n    }\n    for (let i = 0, ii = eventListeners.length; i < ii; i++) {\n      const evt = eventListeners[i];\n      if (evt.listener === listener) {\n        evt.rmAbort?.(); // Ensure that the `AbortSignal` listener is removed.\n        eventListeners.splice(i, 1);\n        return;\n      }\n    }\n  }\n}\n\n/**\n * NOTE: Only used in the Firefox build-in pdf viewer.\n */\nclass FirefoxEventBus extends EventBus {\n  #externalServices;\n\n  #globalEventNames;\n\n  #isInAutomation;\n\n  constructor(globalEventNames, externalServices, isInAutomation) {\n    super();\n    this.#globalEventNames = globalEventNames;\n    this.#externalServices = externalServices;\n    this.#isInAutomation = isInAutomation;\n  }\n\n  dispatch(eventName, data) {\n    if (typeof PDFJSDev !== \"undefined\" && !PDFJSDev.test(\"MOZCENTRAL\")) {\n      throw new Error(\"Not implemented: FirefoxEventBus.dispatch\");\n    }\n    super.dispatch(eventName, data);\n\n    if (this.#isInAutomation) {\n      const detail = Object.create(null);\n      if (data) {\n        for (const key in data) {\n          const value = data[key];\n          if (key === \"source\") {\n            if (value === window || value === document) {\n              return; // No need to re-dispatch (already) global events.\n            }\n            continue; // Ignore the `source` property.\n          }\n          detail[key] = value;\n        }\n      }\n      const event = new CustomEvent(eventName, {\n        bubbles: true,\n        cancelable: true,\n        detail,\n      });\n      document.dispatchEvent(event);\n    }\n\n    if (this.#globalEventNames?.has(eventName)) {\n      this.#externalServices.dispatchGlobalEvent({\n        eventName,\n        detail: data,\n      });\n    }\n  }\n}\n\nexport { EventBus, FirefoxEventBus, waitOnEventOrTimeout, WaitOnType };\n","/* Copyright 2024 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/** @typedef {import(\"./interfaces.js\").IL10n} IL10n */\n\nclass BaseExternalServices {\n  constructor() {\n    if (\n      (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"TESTING\")) &&\n      this.constructor === BaseExternalServices\n    ) {\n      throw new Error(\"Cannot initialize BaseExternalServices.\");\n    }\n  }\n\n  updateFindControlState(data) {}\n\n  updateFindMatchesCount(data) {}\n\n  initPassiveLoading() {}\n\n  reportTelemetry(data) {}\n\n  /**\n   * @returns {Promise<IL10n>}\n   */\n  async createL10n() {\n    throw new Error(\"Not implemented: createL10n\");\n  }\n\n  createScripting() {\n    throw new Error(\"Not implemented: createScripting\");\n  }\n\n  updateEditorStates(data) {\n    throw new Error(\"Not implemented: updateEditorStates\");\n  }\n\n  dispatchGlobalEvent(_event) {}\n}\n\nexport { BaseExternalServices };\n","/* Copyright 2013 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { AppOptions, OptionKind } from \"./app_options.js\";\n\n/**\n * BasePreferences - Abstract base class for storing persistent settings.\n *   Used for settings that should be applied to all opened documents,\n *   or every time the viewer is loaded.\n */\nclass BasePreferences {\n  #defaults = Object.freeze(\n    typeof PDFJSDev === \"undefined\"\n      ? AppOptions.getAll(OptionKind.PREFERENCE, /* defaultOnly = */ true)\n      : PDFJSDev.eval(\"DEFAULT_PREFERENCES\")\n  );\n\n  #initializedPromise = null;\n\n  constructor() {\n    if (\n      (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"TESTING\")) &&\n      this.constructor === BasePreferences\n    ) {\n      throw new Error(\"Cannot initialize BasePreferences.\");\n    }\n\n    if (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"CHROME\")) {\n      Object.defineProperty(this, \"defaults\", {\n        get() {\n          return this.#defaults;\n        },\n      });\n    }\n\n    this.#initializedPromise = this._readFromStorage(this.#defaults).then(\n      ({ browserPrefs, prefs }) => {\n        if (\n          (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"GENERIC\")) &&\n          AppOptions._checkDisablePreferences()\n        ) {\n          return;\n        }\n        AppOptions.setAll({ ...browserPrefs, ...prefs }, /* prefs = */ true);\n      }\n    );\n\n    if (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")) {\n      window.addEventListener(\n        \"updatedPreference\",\n        async ({ detail: { name, value } }) => {\n          await this.#initializedPromise;\n          AppOptions.setAll({ [name]: value }, /* prefs = */ true);\n        }\n      );\n    }\n  }\n\n  /**\n   * Stub function for writing preferences to storage.\n   * @param {Object} prefObj The preferences that should be written to storage.\n   * @returns {Promise} A promise that is resolved when the preference values\n   *                    have been written.\n   */\n  async _writeToStorage(prefObj) {\n    throw new Error(\"Not implemented: _writeToStorage\");\n  }\n\n  /**\n   * Stub function for reading preferences from storage.\n   * @param {Object} prefObj The preferences that should be read from storage.\n   * @returns {Promise} A promise that is resolved with an {Object} containing\n   *                    the preferences that have been read.\n   */\n  async _readFromStorage(prefObj) {\n    throw new Error(\"Not implemented: _readFromStorage\");\n  }\n\n  /**\n   * Reset the preferences to their default values and update storage.\n   * @returns {Promise} A promise that is resolved when the preference values\n   *                    have been reset.\n   */\n  async reset() {\n    if (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")) {\n      throw new Error(\"Please use `about:config` to change preferences.\");\n    }\n    await this.#initializedPromise;\n    AppOptions.setAll(this.#defaults, /* prefs = */ true);\n\n    await this._writeToStorage(this.#defaults);\n  }\n\n  /**\n   * Set the value of a preference.\n   * @param {string} name The name of the preference that should be changed.\n   * @param {boolean|number|string} value The new value of the preference.\n   * @returns {Promise} A promise that is resolved when the value has been set,\n   *                    provided that the preference exists and the types match.\n   */\n  async set(name, value) {\n    await this.#initializedPromise;\n    AppOptions.setAll({ [name]: value }, /* prefs = */ true);\n\n    await this._writeToStorage(\n      typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")\n        ? { [name]: AppOptions.get(name) }\n        : AppOptions.getAll(OptionKind.PREFERENCE)\n    );\n  }\n\n  /**\n   * Get the value of a preference.\n   * @param {string} name The name of the preference whose value is requested.\n   * @returns {Promise} A promise resolved with a {boolean|number|string}\n   *                    containing the value of the preference.\n   */\n  async get(name) {\n    if (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")) {\n      throw new Error(\"Not implemented: get\");\n    }\n    await this.#initializedPromise;\n    return AppOptions.get(name);\n  }\n\n  get initializedPromise() {\n    return this.#initializedPromise;\n  }\n}\n\nexport { BasePreferences };\n","/**\n * The `FluentType` class is the base of Fluent's type system.\n *\n * Fluent types wrap JavaScript values and store additional configuration for\n * them, which can then be used in the `toString` method together with a proper\n * `Intl` formatter.\n */\nexport class FluentType {\n    /**\n     * Create a `FluentType` instance.\n     *\n     * @param value The JavaScript value to wrap.\n     */\n    constructor(value) {\n        this.value = value;\n    }\n    /**\n     * Unwrap the raw value stored by this `FluentType`.\n     */\n    valueOf() {\n        return this.value;\n    }\n}\n/**\n * A `FluentType` representing no correct value.\n */\nexport class FluentNone extends FluentType {\n    /**\n     * Create an instance of `FluentNone` with an optional fallback value.\n     * @param value The fallback value of this `FluentNone`.\n     */\n    constructor(value = \"???\") {\n        super(value);\n    }\n    /**\n     * Format this `FluentNone` to the fallback string.\n     */\n    toString(scope) {\n        return `{${this.value}}`;\n    }\n}\n/**\n * A `FluentType` representing a number.\n *\n * A `FluentNumber` instance stores the number value of the number it\n * represents. It may also store an option bag of options which will be passed\n * to `Intl.NumerFormat` when the `FluentNumber` is formatted to a string.\n */\nexport class FluentNumber extends FluentType {\n    /**\n     * Create an instance of `FluentNumber` with options to the\n     * `Intl.NumberFormat` constructor.\n     *\n     * @param value The number value of this `FluentNumber`.\n     * @param opts Options which will be passed to `Intl.NumberFormat`.\n     */\n    constructor(value, opts = {}) {\n        super(value);\n        this.opts = opts;\n    }\n    /**\n     * Format this `FluentNumber` to a string.\n     */\n    toString(scope) {\n        try {\n            const nf = scope.memoizeIntlObject(Intl.NumberFormat, this.opts);\n            return nf.format(this.value);\n        }\n        catch (err) {\n            scope.reportError(err);\n            return this.value.toString(10);\n        }\n    }\n}\n/**\n * A `FluentType` representing a date and time.\n *\n * A `FluentDateTime` instance stores the number value of the date it\n * represents, as a numerical timestamp in milliseconds. It may also store an\n * option bag of options which will be passed to `Intl.DateTimeFormat` when the\n * `FluentDateTime` is formatted to a string.\n */\nexport class FluentDateTime extends FluentType {\n    /**\n     * Create an instance of `FluentDateTime` with options to the\n     * `Intl.DateTimeFormat` constructor.\n     *\n     * @param value The number value of this `FluentDateTime`, in milliseconds.\n     * @param opts Options which will be passed to `Intl.DateTimeFormat`.\n     */\n    constructor(value, opts = {}) {\n        super(value);\n        this.opts = opts;\n    }\n    /**\n     * Format this `FluentDateTime` to a string.\n     */\n    toString(scope) {\n        try {\n            const dtf = scope.memoizeIntlObject(Intl.DateTimeFormat, this.opts);\n            return dtf.format(this.value);\n        }\n        catch (err) {\n            scope.reportError(err);\n            return new Date(this.value).toISOString();\n        }\n    }\n}\n","/* global Intl */\n/**\n * @overview\n *\n * The role of the Fluent resolver is to format a `Pattern` to an instance of\n * `FluentValue`. For performance reasons, primitive strings are considered\n * such instances, too.\n *\n * Translations can contain references to other messages or variables,\n * conditional logic in form of select expressions, traits which describe their\n * grammatical features, and can use Fluent builtins which make use of the\n * `Intl` formatters to format numbers and dates into the bundle's languages.\n * See the documentation of the Fluent syntax for more information.\n *\n * In case of errors the resolver will try to salvage as much of the\n * translation as possible. In rare situations where the resolver didn't know\n * how to recover from an error it will return an instance of `FluentNone`.\n *\n * All expressions resolve to an instance of `FluentValue`. The caller should\n * use the `toString` method to convert the instance to a native value.\n *\n * Functions in this file pass around an instance of the `Scope` class, which\n * stores the data required for successful resolution and error recovery.\n */\nimport { FluentType, FluentNone, FluentNumber, FluentDateTime, } from \"./types.js\";\n/**\n * The maximum number of placeables which can be expanded in a single call to\n * `formatPattern`. The limit protects against the Billion Laughs and Quadratic\n * Blowup attacks. See https://msdn.microsoft.com/en-us/magazine/ee335713.aspx.\n */\nconst MAX_PLACEABLES = 100;\n/** Unicode bidi isolation characters. */\nconst FSI = \"\\u2068\";\nconst PDI = \"\\u2069\";\n/** Helper: match a variant key to the given selector. */\nfunction match(scope, selector, key) {\n    if (key === selector) {\n        // Both are strings.\n        return true;\n    }\n    // XXX Consider comparing options too, e.g. minimumFractionDigits.\n    if (key instanceof FluentNumber &&\n        selector instanceof FluentNumber &&\n        key.value === selector.value) {\n        return true;\n    }\n    if (selector instanceof FluentNumber && typeof key === \"string\") {\n        let category = scope\n            .memoizeIntlObject(Intl.PluralRules, selector.opts)\n            .select(selector.value);\n        if (key === category) {\n            return true;\n        }\n    }\n    return false;\n}\n/** Helper: resolve the default variant from a list of variants. */\nfunction getDefault(scope, variants, star) {\n    if (variants[star]) {\n        return resolvePattern(scope, variants[star].value);\n    }\n    scope.reportError(new RangeError(\"No default\"));\n    return new FluentNone();\n}\n/** Helper: resolve arguments to a call expression. */\nfunction getArguments(scope, args) {\n    const positional = [];\n    const named = Object.create(null);\n    for (const arg of args) {\n        if (arg.type === \"narg\") {\n            named[arg.name] = resolveExpression(scope, arg.value);\n        }\n        else {\n            positional.push(resolveExpression(scope, arg));\n        }\n    }\n    return { positional, named };\n}\n/** Resolve an expression to a Fluent type. */\nfunction resolveExpression(scope, expr) {\n    switch (expr.type) {\n        case \"str\":\n            return expr.value;\n        case \"num\":\n            return new FluentNumber(expr.value, {\n                minimumFractionDigits: expr.precision,\n            });\n        case \"var\":\n            return resolveVariableReference(scope, expr);\n        case \"mesg\":\n            return resolveMessageReference(scope, expr);\n        case \"term\":\n            return resolveTermReference(scope, expr);\n        case \"func\":\n            return resolveFunctionReference(scope, expr);\n        case \"select\":\n            return resolveSelectExpression(scope, expr);\n        default:\n            return new FluentNone();\n    }\n}\n/** Resolve a reference to a variable. */\nfunction resolveVariableReference(scope, { name }) {\n    let arg;\n    if (scope.params) {\n        // We're inside a TermReference. It's OK to reference undefined parameters.\n        if (Object.prototype.hasOwnProperty.call(scope.params, name)) {\n            arg = scope.params[name];\n        }\n        else {\n            return new FluentNone(`$${name}`);\n        }\n    }\n    else if (scope.args &&\n        Object.prototype.hasOwnProperty.call(scope.args, name)) {\n        // We're in the top-level Pattern or inside a MessageReference. Missing\n        // variables references produce ReferenceErrors.\n        arg = scope.args[name];\n    }\n    else {\n        scope.reportError(new ReferenceError(`Unknown variable: $${name}`));\n        return new FluentNone(`$${name}`);\n    }\n    // Return early if the argument already is an instance of FluentType.\n    if (arg instanceof FluentType) {\n        return arg;\n    }\n    // Convert the argument to a Fluent type.\n    switch (typeof arg) {\n        case \"string\":\n            return arg;\n        case \"number\":\n            return new FluentNumber(arg);\n        case \"object\":\n            if (arg instanceof Date) {\n                return new FluentDateTime(arg.getTime());\n            }\n        // eslint-disable-next-line no-fallthrough\n        default:\n            scope.reportError(new TypeError(`Variable type not supported: $${name}, ${typeof arg}`));\n            return new FluentNone(`$${name}`);\n    }\n}\n/** Resolve a reference to another message. */\nfunction resolveMessageReference(scope, { name, attr }) {\n    const message = scope.bundle._messages.get(name);\n    if (!message) {\n        scope.reportError(new ReferenceError(`Unknown message: ${name}`));\n        return new FluentNone(name);\n    }\n    if (attr) {\n        const attribute = message.attributes[attr];\n        if (attribute) {\n            return resolvePattern(scope, attribute);\n        }\n        scope.reportError(new ReferenceError(`Unknown attribute: ${attr}`));\n        return new FluentNone(`${name}.${attr}`);\n    }\n    if (message.value) {\n        return resolvePattern(scope, message.value);\n    }\n    scope.reportError(new ReferenceError(`No value: ${name}`));\n    return new FluentNone(name);\n}\n/** Resolve a call to a Term with key-value arguments. */\nfunction resolveTermReference(scope, { name, attr, args }) {\n    const id = `-${name}`;\n    const term = scope.bundle._terms.get(id);\n    if (!term) {\n        scope.reportError(new ReferenceError(`Unknown term: ${id}`));\n        return new FluentNone(id);\n    }\n    if (attr) {\n        const attribute = term.attributes[attr];\n        if (attribute) {\n            // Every TermReference has its own variables.\n            scope.params = getArguments(scope, args).named;\n            const resolved = resolvePattern(scope, attribute);\n            scope.params = null;\n            return resolved;\n        }\n        scope.reportError(new ReferenceError(`Unknown attribute: ${attr}`));\n        return new FluentNone(`${id}.${attr}`);\n    }\n    scope.params = getArguments(scope, args).named;\n    const resolved = resolvePattern(scope, term.value);\n    scope.params = null;\n    return resolved;\n}\n/** Resolve a call to a Function with positional and key-value arguments. */\nfunction resolveFunctionReference(scope, { name, args }) {\n    // Some functions are built-in. Others may be provided by the runtime via\n    // the `FluentBundle` constructor.\n    let func = scope.bundle._functions[name];\n    if (!func) {\n        scope.reportError(new ReferenceError(`Unknown function: ${name}()`));\n        return new FluentNone(`${name}()`);\n    }\n    if (typeof func !== \"function\") {\n        scope.reportError(new TypeError(`Function ${name}() is not callable`));\n        return new FluentNone(`${name}()`);\n    }\n    try {\n        let resolved = getArguments(scope, args);\n        return func(resolved.positional, resolved.named);\n    }\n    catch (err) {\n        scope.reportError(err);\n        return new FluentNone(`${name}()`);\n    }\n}\n/** Resolve a select expression to the member object. */\nfunction resolveSelectExpression(scope, { selector, variants, star }) {\n    let sel = resolveExpression(scope, selector);\n    if (sel instanceof FluentNone) {\n        return getDefault(scope, variants, star);\n    }\n    // Match the selector against keys of each variant, in order.\n    for (const variant of variants) {\n        const key = resolveExpression(scope, variant.key);\n        if (match(scope, sel, key)) {\n            return resolvePattern(scope, variant.value);\n        }\n    }\n    return getDefault(scope, variants, star);\n}\n/** Resolve a pattern (a complex string with placeables). */\nexport function resolveComplexPattern(scope, ptn) {\n    if (scope.dirty.has(ptn)) {\n        scope.reportError(new RangeError(\"Cyclic reference\"));\n        return new FluentNone();\n    }\n    // Tag the pattern as dirty for the purpose of the current resolution.\n    scope.dirty.add(ptn);\n    const result = [];\n    // Wrap interpolations with Directional Isolate Formatting characters\n    // only when the pattern has more than one element.\n    const useIsolating = scope.bundle._useIsolating && ptn.length > 1;\n    for (const elem of ptn) {\n        if (typeof elem === \"string\") {\n            result.push(scope.bundle._transform(elem));\n            continue;\n        }\n        scope.placeables++;\n        if (scope.placeables > MAX_PLACEABLES) {\n            scope.dirty.delete(ptn);\n            // This is a fatal error which causes the resolver to instantly bail out\n            // on this pattern. The length check protects against excessive memory\n            // usage, and throwing protects against eating up the CPU when long\n            // placeables are deeply nested.\n            throw new RangeError(`Too many placeables expanded: ${scope.placeables}, ` +\n                `max allowed is ${MAX_PLACEABLES}`);\n        }\n        if (useIsolating) {\n            result.push(FSI);\n        }\n        result.push(resolveExpression(scope, elem).toString(scope));\n        if (useIsolating) {\n            result.push(PDI);\n        }\n    }\n    scope.dirty.delete(ptn);\n    return result.join(\"\");\n}\n/**\n * Resolve a simple or a complex Pattern to a FluentString\n * (which is really the string primitive).\n */\nfunction resolvePattern(scope, value) {\n    // Resolve a simple pattern.\n    if (typeof value === \"string\") {\n        return scope.bundle._transform(value);\n    }\n    return resolveComplexPattern(scope, value);\n}\n","export class Scope {\n    constructor(bundle, errors, args) {\n        /**\n         * The Set of patterns already encountered during this resolution.\n         * Used to detect and prevent cyclic resolutions.\n         * @ignore\n         */\n        this.dirty = new WeakSet();\n        /** A dict of parameters passed to a TermReference. */\n        this.params = null;\n        /**\n         * The running count of placeables resolved so far.\n         * Used to detect the Billion Laughs and Quadratic Blowup attacks.\n         * @ignore\n         */\n        this.placeables = 0;\n        this.bundle = bundle;\n        this.errors = errors;\n        this.args = args;\n    }\n    reportError(error) {\n        if (!this.errors || !(error instanceof Error)) {\n            throw error;\n        }\n        this.errors.push(error);\n    }\n    memoizeIntlObject(ctor, opts) {\n        let cache = this.bundle._intls.get(ctor);\n        if (!cache) {\n            cache = {};\n            this.bundle._intls.set(ctor, cache);\n        }\n        let id = JSON.stringify(opts);\n        if (!cache[id]) {\n            cache[id] = new ctor(this.bundle.locales, opts);\n        }\n        return cache[id];\n    }\n}\n","/**\n * @overview\n *\n * The FTL resolver ships with a number of functions built-in.\n *\n * Each function take two arguments:\n *   - args - an array of positional args\n *   - opts - an object of key-value args\n *\n * Arguments to functions are guaranteed to already be instances of\n * `FluentValue`.  Functions must return `FluentValues` as well.\n */\nimport { FluentNone, FluentNumber, FluentDateTime, } from \"./types.js\";\nfunction values(opts, allowed) {\n    const unwrapped = Object.create(null);\n    for (const [name, opt] of Object.entries(opts)) {\n        if (allowed.includes(name)) {\n            unwrapped[name] = opt.valueOf();\n        }\n    }\n    return unwrapped;\n}\nconst NUMBER_ALLOWED = [\n    \"unitDisplay\",\n    \"currencyDisplay\",\n    \"useGrouping\",\n    \"minimumIntegerDigits\",\n    \"minimumFractionDigits\",\n    \"maximumFractionDigits\",\n    \"minimumSignificantDigits\",\n    \"maximumSignificantDigits\",\n];\n/**\n * The implementation of the `NUMBER()` builtin available to translations.\n *\n * Translations may call the `NUMBER()` builtin in order to specify formatting\n * options of a number. For example:\n *\n *     pi = The value of π is {NUMBER($pi, maximumFractionDigits: 2)}.\n *\n * The implementation expects an array of `FluentValues` representing the\n * positional arguments, and an object of named `FluentValues` representing the\n * named parameters.\n *\n * The following options are recognized:\n *\n *     unitDisplay\n *     currencyDisplay\n *     useGrouping\n *     minimumIntegerDigits\n *     minimumFractionDigits\n *     maximumFractionDigits\n *     minimumSignificantDigits\n *     maximumSignificantDigits\n *\n * Other options are ignored.\n *\n * @param args The positional arguments passed to this `NUMBER()`.\n * @param opts The named argments passed to this `NUMBER()`.\n */\nexport function NUMBER(args, opts) {\n    let arg = args[0];\n    if (arg instanceof FluentNone) {\n        return new FluentNone(`NUMBER(${arg.valueOf()})`);\n    }\n    if (arg instanceof FluentNumber) {\n        return new FluentNumber(arg.valueOf(), {\n            ...arg.opts,\n            ...values(opts, NUMBER_ALLOWED),\n        });\n    }\n    if (arg instanceof FluentDateTime) {\n        return new FluentNumber(arg.valueOf(), {\n            ...values(opts, NUMBER_ALLOWED),\n        });\n    }\n    throw new TypeError(\"Invalid argument to NUMBER\");\n}\nconst DATETIME_ALLOWED = [\n    \"dateStyle\",\n    \"timeStyle\",\n    \"fractionalSecondDigits\",\n    \"dayPeriod\",\n    \"hour12\",\n    \"weekday\",\n    \"era\",\n    \"year\",\n    \"month\",\n    \"day\",\n    \"hour\",\n    \"minute\",\n    \"second\",\n    \"timeZoneName\",\n];\n/**\n * The implementation of the `DATETIME()` builtin available to translations.\n *\n * Translations may call the `DATETIME()` builtin in order to specify\n * formatting options of a number. For example:\n *\n *     now = It's {DATETIME($today, month: \"long\")}.\n *\n * The implementation expects an array of `FluentValues` representing the\n * positional arguments, and an object of named `FluentValues` representing the\n * named parameters.\n *\n * The following options are recognized:\n *\n *     dateStyle\n *     timeStyle\n *     fractionalSecondDigits\n *     dayPeriod\n *     hour12\n *     weekday\n *     era\n *     year\n *     month\n *     day\n *     hour\n *     minute\n *     second\n *     timeZoneName\n *\n * Other options are ignored.\n *\n * @param args The positional arguments passed to this `DATETIME()`.\n * @param opts The named argments passed to this `DATETIME()`.\n */\nexport function DATETIME(args, opts) {\n    let arg = args[0];\n    if (arg instanceof FluentNone) {\n        return new FluentNone(`DATETIME(${arg.valueOf()})`);\n    }\n    if (arg instanceof FluentDateTime) {\n        return new FluentDateTime(arg.valueOf(), {\n            ...arg.opts,\n            ...values(opts, DATETIME_ALLOWED),\n        });\n    }\n    if (arg instanceof FluentNumber) {\n        return new FluentDateTime(arg.valueOf(), {\n            ...values(opts, DATETIME_ALLOWED),\n        });\n    }\n    throw new TypeError(\"Invalid argument to DATETIME\");\n}\n","const cache = new Map();\nexport function getMemoizerForLocale(locales) {\n    const stringLocale = Array.isArray(locales) ? locales.join(\" \") : locales;\n    let memoizer = cache.get(stringLocale);\n    if (memoizer === undefined) {\n        memoizer = new Map();\n        cache.set(stringLocale, memoizer);\n    }\n    return memoizer;\n}\n","import { resolveComplexPattern } from \"./resolver.js\";\nimport { Scope } from \"./scope.js\";\nimport { FluentNone } from \"./types.js\";\nimport { NUMBER, DATETIME } from \"./builtins.js\";\nimport { getMemoizerForLocale } from \"./memoizer.js\";\n/**\n * Message bundles are single-language stores of translation resources. They are\n * responsible for formatting message values and attributes to strings.\n */\nexport class FluentBundle {\n    /**\n     * Create an instance of `FluentBundle`.\n     *\n     * @example\n     * ```js\n     * let bundle = new FluentBundle([\"en-US\", \"en\"]);\n     *\n     * let bundle = new FluentBundle(locales, {useIsolating: false});\n     *\n     * let bundle = new FluentBundle(locales, {\n     *   useIsolating: true,\n     *   functions: {\n     *     NODE_ENV: () => process.env.NODE_ENV\n     *   }\n     * });\n     * ```\n     *\n     * @param locales - Used to instantiate `Intl` formatters used by translations.\n     * @param options - Optional configuration for the bundle.\n     */\n    constructor(locales, { functions, useIsolating = true, transform = (v) => v, } = {}) {\n        /** @ignore */\n        this._terms = new Map();\n        /** @ignore */\n        this._messages = new Map();\n        this.locales = Array.isArray(locales) ? locales : [locales];\n        this._functions = {\n            NUMBER,\n            DATETIME,\n            ...functions,\n        };\n        this._useIsolating = useIsolating;\n        this._transform = transform;\n        this._intls = getMemoizerForLocale(locales);\n    }\n    /**\n     * Check if a message is present in the bundle.\n     *\n     * @param id - The identifier of the message to check.\n     */\n    hasMessage(id) {\n        return this._messages.has(id);\n    }\n    /**\n     * Return a raw unformatted message object from the bundle.\n     *\n     * Raw messages are `{value, attributes}` shapes containing translation units\n     * called `Patterns`. `Patterns` are implementation-specific; they should be\n     * treated as black boxes and formatted with `FluentBundle.formatPattern`.\n     *\n     * @param id - The identifier of the message to check.\n     */\n    getMessage(id) {\n        return this._messages.get(id);\n    }\n    /**\n     * Add a translation resource to the bundle.\n     *\n     * @example\n     * ```js\n     * let res = new FluentResource(\"foo = Foo\");\n     * bundle.addResource(res);\n     * bundle.getMessage(\"foo\");\n     * // → {value: .., attributes: {..}}\n     * ```\n     *\n     * @param res\n     * @param options\n     */\n    addResource(res, { allowOverrides = false, } = {}) {\n        const errors = [];\n        for (let i = 0; i < res.body.length; i++) {\n            let entry = res.body[i];\n            if (entry.id.startsWith(\"-\")) {\n                // Identifiers starting with a dash (-) define terms. Terms are private\n                // and cannot be retrieved from FluentBundle.\n                if (allowOverrides === false && this._terms.has(entry.id)) {\n                    errors.push(new Error(`Attempt to override an existing term: \"${entry.id}\"`));\n                    continue;\n                }\n                this._terms.set(entry.id, entry);\n            }\n            else {\n                if (allowOverrides === false && this._messages.has(entry.id)) {\n                    errors.push(new Error(`Attempt to override an existing message: \"${entry.id}\"`));\n                    continue;\n                }\n                this._messages.set(entry.id, entry);\n            }\n        }\n        return errors;\n    }\n    /**\n     * Format a `Pattern` to a string.\n     *\n     * Format a raw `Pattern` into a string. `args` will be used to resolve\n     * references to variables passed as arguments to the translation.\n     *\n     * In case of errors `formatPattern` will try to salvage as much of the\n     * translation as possible and will still return a string. For performance\n     * reasons, the encountered errors are not returned but instead are appended\n     * to the `errors` array passed as the third argument.\n     *\n     * If `errors` is omitted, the first encountered error will be thrown.\n     *\n     * @example\n     * ```js\n     * let errors = [];\n     * bundle.addResource(\n     *     new FluentResource(\"hello = Hello, {$name}!\"));\n     *\n     * let hello = bundle.getMessage(\"hello\");\n     * if (hello.value) {\n     *     bundle.formatPattern(hello.value, {name: \"Jane\"}, errors);\n     *     // Returns \"Hello, Jane!\" and `errors` is empty.\n     *\n     *     bundle.formatPattern(hello.value, undefined, errors);\n     *     // Returns \"Hello, {$name}!\" and `errors` is now:\n     *     // [<ReferenceError: Unknown variable: name>]\n     * }\n     * ```\n     */\n    formatPattern(pattern, args = null, errors = null) {\n        // Resolve a simple pattern without creating a scope. No error handling is\n        // required; by definition simple patterns don't have placeables.\n        if (typeof pattern === \"string\") {\n            return this._transform(pattern);\n        }\n        // Resolve a complex pattern.\n        let scope = new Scope(this, errors, args);\n        try {\n            let value = resolveComplexPattern(scope, pattern);\n            return value.toString(scope);\n        }\n        catch (err) {\n            if (scope.errors && err instanceof Error) {\n                scope.errors.push(err);\n                return new FluentNone().toString(scope);\n            }\n            throw err;\n        }\n    }\n}\n","// This regex is used to iterate through the beginnings of messages and terms.\n// With the /m flag, the ^ matches at the beginning of every line.\nconst RE_MESSAGE_START = /^(-?[a-zA-Z][\\w-]*) *= */gm;\n// Both Attributes and Variants are parsed in while loops. These regexes are\n// used to break out of them.\nconst RE_ATTRIBUTE_START = /\\.([a-zA-Z][\\w-]*) *= */y;\nconst RE_VARIANT_START = /\\*?\\[/y;\nconst RE_NUMBER_LITERAL = /(-?[0-9]+(?:\\.([0-9]+))?)/y;\nconst RE_IDENTIFIER = /([a-zA-Z][\\w-]*)/y;\nconst RE_REFERENCE = /([$-])?([a-zA-Z][\\w-]*)(?:\\.([a-zA-Z][\\w-]*))?/y;\nconst RE_FUNCTION_NAME = /^[A-Z][A-Z0-9_-]*$/;\n// A \"run\" is a sequence of text or string literal characters which don't\n// require any special handling. For TextElements such special characters are: {\n// (starts a placeable), and line breaks which require additional logic to check\n// if the next line is indented. For StringLiterals they are: \\ (starts an\n// escape sequence), \" (ends the literal), and line breaks which are not allowed\n// in StringLiterals. Note that string runs may be empty; text runs may not.\nconst RE_TEXT_RUN = /([^{}\\n\\r]+)/y;\nconst RE_STRING_RUN = /([^\\\\\"\\n\\r]*)/y;\n// Escape sequences.\nconst RE_STRING_ESCAPE = /\\\\([\\\\\"])/y;\nconst RE_UNICODE_ESCAPE = /\\\\u([a-fA-F0-9]{4})|\\\\U([a-fA-F0-9]{6})/y;\n// Used for trimming TextElements and indents.\nconst RE_LEADING_NEWLINES = /^\\n+/;\nconst RE_TRAILING_SPACES = / +$/;\n// Used in makeIndent to strip spaces from blank lines and normalize CRLF to LF.\nconst RE_BLANK_LINES = / *\\r?\\n/g;\n// Used in makeIndent to measure the indentation.\nconst RE_INDENT = /( *)$/;\n// Common tokens.\nconst TOKEN_BRACE_OPEN = /{\\s*/y;\nconst TOKEN_BRACE_CLOSE = /\\s*}/y;\nconst TOKEN_BRACKET_OPEN = /\\[\\s*/y;\nconst TOKEN_BRACKET_CLOSE = /\\s*] */y;\nconst TOKEN_PAREN_OPEN = /\\s*\\(\\s*/y;\nconst TOKEN_ARROW = /\\s*->\\s*/y;\nconst TOKEN_COLON = /\\s*:\\s*/y;\n// Note the optional comma. As a deviation from the Fluent EBNF, the parser\n// doesn't enforce commas between call arguments.\nconst TOKEN_COMMA = /\\s*,?\\s*/y;\nconst TOKEN_BLANK = /\\s+/y;\n/**\n * Fluent Resource is a structure storing parsed localization entries.\n */\nexport class FluentResource {\n    constructor(source) {\n        this.body = [];\n        RE_MESSAGE_START.lastIndex = 0;\n        let cursor = 0;\n        // Iterate over the beginnings of messages and terms to efficiently skip\n        // comments and recover from errors.\n        while (true) {\n            let next = RE_MESSAGE_START.exec(source);\n            if (next === null) {\n                break;\n            }\n            cursor = RE_MESSAGE_START.lastIndex;\n            try {\n                this.body.push(parseMessage(next[1]));\n            }\n            catch (err) {\n                if (err instanceof SyntaxError) {\n                    // Don't report any Fluent syntax errors. Skip directly to the\n                    // beginning of the next message or term.\n                    continue;\n                }\n                throw err;\n            }\n        }\n        // The parser implementation is inlined below for performance reasons,\n        // as well as for convenience of accessing `source` and `cursor`.\n        // The parser focuses on minimizing the number of false negatives at the\n        // expense of increasing the risk of false positives. In other words, it\n        // aims at parsing valid Fluent messages with a success rate of 100%, but it\n        // may also parse a few invalid messages which the reference parser would\n        // reject. The parser doesn't perform any validation and may produce entries\n        // which wouldn't make sense in the real world. For best results users are\n        // advised to validate translations with the fluent-syntax parser\n        // pre-runtime.\n        // The parser makes an extensive use of sticky regexes which can be anchored\n        // to any offset of the source string without slicing it. Errors are thrown\n        // to bail out of parsing of ill-formed messages.\n        function test(re) {\n            re.lastIndex = cursor;\n            return re.test(source);\n        }\n        // Advance the cursor by the char if it matches. May be used as a predicate\n        // (was the match found?) or, if errorClass is passed, as an assertion.\n        function consumeChar(char, errorClass) {\n            if (source[cursor] === char) {\n                cursor++;\n                return true;\n            }\n            if (errorClass) {\n                throw new errorClass(`Expected ${char}`);\n            }\n            return false;\n        }\n        // Advance the cursor by the token if it matches. May be used as a predicate\n        // (was the match found?) or, if errorClass is passed, as an assertion.\n        function consumeToken(re, errorClass) {\n            if (test(re)) {\n                cursor = re.lastIndex;\n                return true;\n            }\n            if (errorClass) {\n                throw new errorClass(`Expected ${re.toString()}`);\n            }\n            return false;\n        }\n        // Execute a regex, advance the cursor, and return all capture groups.\n        function match(re) {\n            re.lastIndex = cursor;\n            let result = re.exec(source);\n            if (result === null) {\n                throw new SyntaxError(`Expected ${re.toString()}`);\n            }\n            cursor = re.lastIndex;\n            return result;\n        }\n        // Execute a regex, advance the cursor, and return the capture group.\n        function match1(re) {\n            return match(re)[1];\n        }\n        function parseMessage(id) {\n            let value = parsePattern();\n            let attributes = parseAttributes();\n            if (value === null && Object.keys(attributes).length === 0) {\n                throw new SyntaxError(\"Expected message value or attributes\");\n            }\n            return { id, value, attributes };\n        }\n        function parseAttributes() {\n            let attrs = Object.create(null);\n            while (test(RE_ATTRIBUTE_START)) {\n                let name = match1(RE_ATTRIBUTE_START);\n                let value = parsePattern();\n                if (value === null) {\n                    throw new SyntaxError(\"Expected attribute value\");\n                }\n                attrs[name] = value;\n            }\n            return attrs;\n        }\n        function parsePattern() {\n            let first;\n            // First try to parse any simple text on the same line as the id.\n            if (test(RE_TEXT_RUN)) {\n                first = match1(RE_TEXT_RUN);\n            }\n            // If there's a placeable on the first line, parse a complex pattern.\n            if (source[cursor] === \"{\" || source[cursor] === \"}\") {\n                // Re-use the text parsed above, if possible.\n                return parsePatternElements(first ? [first] : [], Infinity);\n            }\n            // RE_TEXT_VALUE stops at newlines. Only continue parsing the pattern if\n            // what comes after the newline is indented.\n            let indent = parseIndent();\n            if (indent) {\n                if (first) {\n                    // If there's text on the first line, the blank block is part of the\n                    // translation content in its entirety.\n                    return parsePatternElements([first, indent], indent.length);\n                }\n                // Otherwise, we're dealing with a block pattern, i.e. a pattern which\n                // starts on a new line. Discrad the leading newlines but keep the\n                // inline indent; it will be used by the dedentation logic.\n                indent.value = trim(indent.value, RE_LEADING_NEWLINES);\n                return parsePatternElements([indent], indent.length);\n            }\n            if (first) {\n                // It was just a simple inline text after all.\n                return trim(first, RE_TRAILING_SPACES);\n            }\n            return null;\n        }\n        // Parse a complex pattern as an array of elements.\n        function parsePatternElements(elements = [], commonIndent) {\n            while (true) {\n                if (test(RE_TEXT_RUN)) {\n                    elements.push(match1(RE_TEXT_RUN));\n                    continue;\n                }\n                if (source[cursor] === \"{\") {\n                    elements.push(parsePlaceable());\n                    continue;\n                }\n                if (source[cursor] === \"}\") {\n                    throw new SyntaxError(\"Unbalanced closing brace\");\n                }\n                let indent = parseIndent();\n                if (indent) {\n                    elements.push(indent);\n                    commonIndent = Math.min(commonIndent, indent.length);\n                    continue;\n                }\n                break;\n            }\n            let lastIndex = elements.length - 1;\n            let lastElement = elements[lastIndex];\n            // Trim the trailing spaces in the last element if it's a TextElement.\n            if (typeof lastElement === \"string\") {\n                elements[lastIndex] = trim(lastElement, RE_TRAILING_SPACES);\n            }\n            let baked = [];\n            for (let element of elements) {\n                if (element instanceof Indent) {\n                    // Dedent indented lines by the maximum common indent.\n                    element = element.value.slice(0, element.value.length - commonIndent);\n                }\n                if (element) {\n                    baked.push(element);\n                }\n            }\n            return baked;\n        }\n        function parsePlaceable() {\n            consumeToken(TOKEN_BRACE_OPEN, SyntaxError);\n            let selector = parseInlineExpression();\n            if (consumeToken(TOKEN_BRACE_CLOSE)) {\n                return selector;\n            }\n            if (consumeToken(TOKEN_ARROW)) {\n                let variants = parseVariants();\n                consumeToken(TOKEN_BRACE_CLOSE, SyntaxError);\n                return {\n                    type: \"select\",\n                    selector,\n                    ...variants,\n                };\n            }\n            throw new SyntaxError(\"Unclosed placeable\");\n        }\n        function parseInlineExpression() {\n            if (source[cursor] === \"{\") {\n                // It's a nested placeable.\n                return parsePlaceable();\n            }\n            if (test(RE_REFERENCE)) {\n                let [, sigil, name, attr = null] = match(RE_REFERENCE);\n                if (sigil === \"$\") {\n                    return { type: \"var\", name };\n                }\n                if (consumeToken(TOKEN_PAREN_OPEN)) {\n                    let args = parseArguments();\n                    if (sigil === \"-\") {\n                        // A parameterized term: -term(...).\n                        return { type: \"term\", name, attr, args };\n                    }\n                    if (RE_FUNCTION_NAME.test(name)) {\n                        return { type: \"func\", name, args };\n                    }\n                    throw new SyntaxError(\"Function names must be all upper-case\");\n                }\n                if (sigil === \"-\") {\n                    // A non-parameterized term: -term.\n                    return {\n                        type: \"term\",\n                        name,\n                        attr,\n                        args: [],\n                    };\n                }\n                return { type: \"mesg\", name, attr };\n            }\n            return parseLiteral();\n        }\n        function parseArguments() {\n            let args = [];\n            while (true) {\n                switch (source[cursor]) {\n                    case \")\": // End of the argument list.\n                        cursor++;\n                        return args;\n                    case undefined: // EOF\n                        throw new SyntaxError(\"Unclosed argument list\");\n                }\n                args.push(parseArgument());\n                // Commas between arguments are treated as whitespace.\n                consumeToken(TOKEN_COMMA);\n            }\n        }\n        function parseArgument() {\n            let expr = parseInlineExpression();\n            if (expr.type !== \"mesg\") {\n                return expr;\n            }\n            if (consumeToken(TOKEN_COLON)) {\n                // The reference is the beginning of a named argument.\n                return {\n                    type: \"narg\",\n                    name: expr.name,\n                    value: parseLiteral(),\n                };\n            }\n            // It's a regular message reference.\n            return expr;\n        }\n        function parseVariants() {\n            let variants = [];\n            let count = 0;\n            let star;\n            while (test(RE_VARIANT_START)) {\n                if (consumeChar(\"*\")) {\n                    star = count;\n                }\n                let key = parseVariantKey();\n                let value = parsePattern();\n                if (value === null) {\n                    throw new SyntaxError(\"Expected variant value\");\n                }\n                variants[count++] = { key, value };\n            }\n            if (count === 0) {\n                return null;\n            }\n            if (star === undefined) {\n                throw new SyntaxError(\"Expected default variant\");\n            }\n            return { variants, star };\n        }\n        function parseVariantKey() {\n            consumeToken(TOKEN_BRACKET_OPEN, SyntaxError);\n            let key;\n            if (test(RE_NUMBER_LITERAL)) {\n                key = parseNumberLiteral();\n            }\n            else {\n                key = {\n                    type: \"str\",\n                    value: match1(RE_IDENTIFIER),\n                };\n            }\n            consumeToken(TOKEN_BRACKET_CLOSE, SyntaxError);\n            return key;\n        }\n        function parseLiteral() {\n            if (test(RE_NUMBER_LITERAL)) {\n                return parseNumberLiteral();\n            }\n            if (source[cursor] === '\"') {\n                return parseStringLiteral();\n            }\n            throw new SyntaxError(\"Invalid expression\");\n        }\n        function parseNumberLiteral() {\n            let [, value, fraction = \"\"] = match(RE_NUMBER_LITERAL);\n            let precision = fraction.length;\n            return {\n                type: \"num\",\n                value: parseFloat(value),\n                precision,\n            };\n        }\n        function parseStringLiteral() {\n            consumeChar('\"', SyntaxError);\n            let value = \"\";\n            while (true) {\n                value += match1(RE_STRING_RUN);\n                if (source[cursor] === \"\\\\\") {\n                    value += parseEscapeSequence();\n                    continue;\n                }\n                if (consumeChar('\"')) {\n                    return { type: \"str\", value };\n                }\n                // We've reached an EOL of EOF.\n                throw new SyntaxError(\"Unclosed string literal\");\n            }\n        }\n        // Unescape known escape sequences.\n        function parseEscapeSequence() {\n            if (test(RE_STRING_ESCAPE)) {\n                return match1(RE_STRING_ESCAPE);\n            }\n            if (test(RE_UNICODE_ESCAPE)) {\n                let [, codepoint4, codepoint6] = match(RE_UNICODE_ESCAPE);\n                let codepoint = parseInt(codepoint4 || codepoint6, 16);\n                return codepoint <= 0xd7ff || 0xe000 <= codepoint\n                    ? // It's a Unicode scalar value.\n                        String.fromCodePoint(codepoint)\n                    : // Lonely surrogates can cause trouble when the parsing result is\n                        // saved using UTF-8. Use U+FFFD REPLACEMENT CHARACTER instead.\n                        \"�\";\n            }\n            throw new SyntaxError(\"Unknown escape sequence\");\n        }\n        // Parse blank space. Return it if it looks like indent before a pattern\n        // line. Skip it othwerwise.\n        function parseIndent() {\n            let start = cursor;\n            consumeToken(TOKEN_BLANK);\n            // Check the first non-blank character after the indent.\n            switch (source[cursor]) {\n                case \".\":\n                case \"[\":\n                case \"*\":\n                case \"}\":\n                case undefined: // EOF\n                    // A special character. End the Pattern.\n                    return false;\n                case \"{\":\n                    // Placeables don't require indentation (in EBNF: block-placeable).\n                    // Continue the Pattern.\n                    return makeIndent(source.slice(start, cursor));\n            }\n            // If the first character on the line is not one of the special characters\n            // listed above, it's a regular text character. Check if there's at least\n            // one space of indent before it.\n            if (source[cursor - 1] === \" \") {\n                // It's an indented text character (in EBNF: indented-char). Continue\n                // the Pattern.\n                return makeIndent(source.slice(start, cursor));\n            }\n            // A not-indented text character is likely the identifier of the next\n            // message. End the Pattern.\n            return false;\n        }\n        // Trim blanks in text according to the given regex.\n        function trim(text, re) {\n            return text.replace(re, \"\");\n        }\n        // Normalize a blank block and extract the indent details.\n        function makeIndent(blank) {\n            let value = blank.replace(RE_BLANK_LINES, \"\\n\");\n            // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n            let length = RE_INDENT.exec(blank)[1].length;\n            return new Indent(value, length);\n        }\n    }\n}\nclass Indent {\n    constructor(value, length) {\n        this.value = value;\n        this.length = length;\n    }\n}\n","/* eslint no-console: [\"error\", {allow: [\"warn\"]}] */\n/* global console */\n// Match the opening angle bracket (<) in HTML tags, and HTML entities like\n// &amp;, &#0038;, &#x0026;.\nconst reOverlay = /<|&#?\\w+;/;\n/**\n * Elements allowed in translations even if they are not present in the source\n * HTML. They are text-level elements as defined by the HTML5 spec:\n * https://www.w3.org/TR/html5/text-level-semantics.html with the exception of:\n *\n *   - a - because we don't allow href on it anyways,\n *   - ruby, rt, rp - because we don't allow nested elements to be inserted.\n */\nconst TEXT_LEVEL_ELEMENTS = {\n    \"http://www.w3.org/1999/xhtml\": [\n        \"em\",\n        \"strong\",\n        \"small\",\n        \"s\",\n        \"cite\",\n        \"q\",\n        \"dfn\",\n        \"abbr\",\n        \"data\",\n        \"time\",\n        \"code\",\n        \"var\",\n        \"samp\",\n        \"kbd\",\n        \"sub\",\n        \"sup\",\n        \"i\",\n        \"b\",\n        \"u\",\n        \"mark\",\n        \"bdi\",\n        \"bdo\",\n        \"span\",\n        \"br\",\n        \"wbr\",\n    ],\n};\nconst LOCALIZABLE_ATTRIBUTES = {\n    \"http://www.w3.org/1999/xhtml\": {\n        global: [\"title\", \"aria-label\", \"aria-valuetext\"],\n        a: [\"download\"],\n        area: [\"download\", \"alt\"],\n        // value is special-cased in isAttrNameLocalizable\n        input: [\"alt\", \"placeholder\"],\n        menuitem: [\"label\"],\n        menu: [\"label\"],\n        optgroup: [\"label\"],\n        option: [\"label\"],\n        track: [\"label\"],\n        img: [\"alt\"],\n        textarea: [\"placeholder\"],\n        th: [\"abbr\"],\n    },\n    \"http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul\": {\n        global: [\n            \"accesskey\",\n            \"aria-label\",\n            \"aria-valuetext\",\n            \"label\",\n            \"title\",\n            \"tooltiptext\",\n        ],\n        description: [\"value\"],\n        key: [\"key\", \"keycode\"],\n        label: [\"value\"],\n        textbox: [\"placeholder\", \"value\"],\n    },\n};\n/**\n * Translate an element.\n *\n * Translate the element's text content and attributes. Some HTML markup is\n * allowed in the translation. The element's children with the data-l10n-name\n * attribute will be treated as arguments to the translation. If the\n * translation defines the same children, their attributes and text contents\n * will be used for translating the matching source child.\n *\n * @param   {Element} element\n * @param   {Object} translation\n * @private\n */\nexport default function translateElement(element, translation) {\n    const { value } = translation;\n    if (typeof value === \"string\") {\n        if (element.localName === \"title\" &&\n            element.namespaceURI === \"http://www.w3.org/1999/xhtml\") {\n            // A special case for the HTML title element whose content must be text.\n            element.textContent = value;\n        }\n        else if (!reOverlay.test(value)) {\n            // If the translation doesn't contain any markup skip the overlay logic.\n            element.textContent = value;\n        }\n        else {\n            // Else parse the translation's HTML using an inert template element,\n            // sanitize it and replace the element's content.\n            const templateElement = element.ownerDocument.createElementNS(\"http://www.w3.org/1999/xhtml\", \"template\");\n            templateElement.innerHTML = value;\n            overlayChildNodes(templateElement.content, element);\n        }\n    }\n    // Even if the translation doesn't define any localizable attributes, run\n    // overlayAttributes to remove any localizable attributes set by previous\n    // translations.\n    overlayAttributes(translation, element);\n}\n/**\n * Replace child nodes of an element with child nodes of another element.\n *\n * The contents of the target element will be cleared and fully replaced with\n * sanitized contents of the source element.\n *\n * @param {DocumentFragment} fromFragment - The source of children to overlay.\n * @param {Element} toElement - The target of the overlay.\n * @private\n */\nfunction overlayChildNodes(fromFragment, toElement) {\n    for (const childNode of fromFragment.childNodes) {\n        if (childNode.nodeType === childNode.TEXT_NODE) {\n            // Keep the translated text node.\n            continue;\n        }\n        if (childNode.hasAttribute(\"data-l10n-name\")) {\n            const sanitized = getNodeForNamedElement(toElement, childNode);\n            fromFragment.replaceChild(sanitized, childNode);\n            continue;\n        }\n        if (isElementAllowed(childNode)) {\n            const sanitized = createSanitizedElement(childNode);\n            fromFragment.replaceChild(sanitized, childNode);\n            continue;\n        }\n        console.warn(`An element of forbidden type \"${childNode.localName}\" was found in ` +\n            \"the translation. Only safe text-level elements and elements with \" +\n            \"data-l10n-name are allowed.\");\n        // If all else fails, replace the element with its text content.\n        fromFragment.replaceChild(createTextNodeFromTextContent(childNode), childNode);\n    }\n    toElement.textContent = \"\";\n    toElement.appendChild(fromFragment);\n}\nfunction hasAttribute(attributes, name) {\n    if (!attributes) {\n        return false;\n    }\n    for (let attr of attributes) {\n        if (attr.name === name) {\n            return true;\n        }\n    }\n    return false;\n}\n/**\n * Transplant localizable attributes of an element to another element.\n *\n * Any localizable attributes already set on the target element will be\n * cleared.\n *\n * @param   {Element|Object} fromElement - The source of child nodes to overlay.\n * @param   {Element} toElement - The target of the overlay.\n * @private\n */\nfunction overlayAttributes(fromElement, toElement) {\n    const explicitlyAllowed = toElement.hasAttribute(\"data-l10n-attrs\")\n        ? toElement\n            .getAttribute(\"data-l10n-attrs\")\n            .split(\",\")\n            .map(i => i.trim())\n        : null;\n    // Remove existing localizable attributes if they\n    // will not be used in the new translation.\n    for (const attr of Array.from(toElement.attributes)) {\n        if (isAttrNameLocalizable(attr.name, toElement, explicitlyAllowed) &&\n            !hasAttribute(fromElement.attributes, attr.name)) {\n            toElement.removeAttribute(attr.name);\n        }\n    }\n    // fromElement might be a {value, attributes} object as returned by\n    // Localization.messageFromBundle. In which case attributes may be null to\n    // save GC cycles.\n    if (!fromElement.attributes) {\n        return;\n    }\n    // Set localizable attributes.\n    for (const attr of Array.from(fromElement.attributes)) {\n        if (isAttrNameLocalizable(attr.name, toElement, explicitlyAllowed) &&\n            toElement.getAttribute(attr.name) !== attr.value) {\n            toElement.setAttribute(attr.name, attr.value);\n        }\n    }\n}\n/**\n * Sanitize a child element created by the translation.\n *\n * Try to find a corresponding child in sourceElement and use it as the base\n * for the sanitization. This will preserve functional attribtues defined on\n * the child element in the source HTML.\n *\n * @param   {Element} sourceElement - The source for data-l10n-name lookups.\n * @param   {Element} translatedChild - The translated child to be sanitized.\n * @returns {Element}\n * @private\n */\nfunction getNodeForNamedElement(sourceElement, translatedChild) {\n    const childName = translatedChild.getAttribute(\"data-l10n-name\");\n    const sourceChild = sourceElement.querySelector(`[data-l10n-name=\"${childName}\"]`);\n    if (!sourceChild) {\n        console.warn(`An element named \"${childName}\" wasn't found in the source.`);\n        return createTextNodeFromTextContent(translatedChild);\n    }\n    if (sourceChild.localName !== translatedChild.localName) {\n        console.warn(`An element named \"${childName}\" was found in the translation ` +\n            `but its type ${translatedChild.localName} didn't match the ` +\n            `element found in the source (${sourceChild.localName}).`);\n        return createTextNodeFromTextContent(translatedChild);\n    }\n    // Remove it from sourceElement so that the translation cannot use\n    // the same reference name again.\n    sourceElement.removeChild(sourceChild);\n    // We can't currently guarantee that a translation won't remove\n    // sourceChild from the element completely, which could break the app if\n    // it relies on an event handler attached to the sourceChild. Let's make\n    // this limitation explicit for now by breaking the identitiy of the\n    // sourceChild by cloning it. This will destroy all event handlers\n    // attached to sourceChild via addEventListener and via on<name>\n    // properties.\n    const clone = sourceChild.cloneNode(false);\n    return shallowPopulateUsing(translatedChild, clone);\n}\n/**\n * Sanitize an allowed element.\n *\n * Text-level elements allowed in translations may only use safe attributes\n * and will have any nested markup stripped to text content.\n *\n * @param   {Element} element - The element to be sanitized.\n * @returns {Element}\n * @private\n */\nfunction createSanitizedElement(element) {\n    // Start with an empty element of the same type to remove nested children\n    // and non-localizable attributes defined by the translation.\n    const clone = element.ownerDocument.createElement(element.localName);\n    return shallowPopulateUsing(element, clone);\n}\n/**\n * Convert an element to a text node.\n *\n * @param   {Element} element - The element to be sanitized.\n * @returns {Node}\n * @private\n */\nfunction createTextNodeFromTextContent(element) {\n    return element.ownerDocument.createTextNode(element.textContent);\n}\n/**\n * Check if element is allowed in the translation.\n *\n * This method is used by the sanitizer when the translation markup contains\n * an element which is not present in the source code.\n *\n * @param   {Element} element\n * @returns {boolean}\n * @private\n */\nfunction isElementAllowed(element) {\n    const allowed = TEXT_LEVEL_ELEMENTS[element.namespaceURI];\n    return allowed && allowed.includes(element.localName);\n}\n/**\n * Check if attribute is allowed for the given element.\n *\n * This method is used by the sanitizer when the translation markup contains\n * DOM attributes, or when the translation has traits which map to DOM\n * attributes.\n *\n * `explicitlyAllowed` can be passed as a list of attributes explicitly\n * allowed on this element.\n *\n * @param   {string}         name\n * @param   {Element}        element\n * @param   {Array}          explicitlyAllowed\n * @returns {boolean}\n * @private\n */\nfunction isAttrNameLocalizable(name, element, explicitlyAllowed = null) {\n    if (explicitlyAllowed && explicitlyAllowed.includes(name)) {\n        return true;\n    }\n    const allowed = LOCALIZABLE_ATTRIBUTES[element.namespaceURI];\n    if (!allowed) {\n        return false;\n    }\n    const attrName = name.toLowerCase();\n    const elemName = element.localName;\n    // Is it a globally safe attribute?\n    if (allowed.global.includes(attrName)) {\n        return true;\n    }\n    // Are there no allowed attributes for this element?\n    if (!allowed[elemName]) {\n        return false;\n    }\n    // Is it allowed on this element?\n    if (allowed[elemName].includes(attrName)) {\n        return true;\n    }\n    // Special case for value on HTML inputs with type button, reset, submit\n    if (element.namespaceURI === \"http://www.w3.org/1999/xhtml\" &&\n        elemName === \"input\" &&\n        attrName === \"value\") {\n        const type = element.type.toLowerCase();\n        if (type === \"submit\" || type === \"button\" || type === \"reset\") {\n            return true;\n        }\n    }\n    return false;\n}\n/**\n * Helper to set textContent and localizable attributes on an element.\n *\n * @param   {Element} fromElement\n * @param   {Element} toElement\n * @returns {Element}\n * @private\n */\nfunction shallowPopulateUsing(fromElement, toElement) {\n    toElement.textContent = fromElement.textContent;\n    overlayAttributes(fromElement, toElement);\n    return toElement;\n}\n","/*\n * Base CachedIterable class.\n */\nexport default class CachedIterable extends Array {\n    /**\n     * Create a `CachedIterable` instance from an iterable or, if another\n     * instance of `CachedIterable` is passed, return it without any\n     * modifications.\n     *\n     * @param {Iterable} iterable\n     * @returns {CachedIterable}\n     */\n    static from(iterable) {\n        if (iterable instanceof this) {\n            return iterable;\n        }\n\n        return new this(iterable);\n    }\n}\n","import CachedIterable from \"./cached_iterable.mjs\";\n\n/*\n * CachedSyncIterable caches the elements yielded by an iterable.\n *\n * It can be used to iterate over an iterable many times without depleting the\n * iterable.\n */\nexport default class CachedSyncIterable extends CachedIterable {\n    /**\n     * Create an `CachedSyncIterable` instance.\n     *\n     * @param {Iterable} iterable\n     * @returns {CachedSyncIterable}\n     */\n    constructor(iterable) {\n        super();\n\n        if (Symbol.iterator in Object(iterable)) {\n            this.iterator = iterable[Symbol.iterator]();\n        } else {\n            throw new TypeError(\"Argument must implement the iteration protocol.\");\n        }\n    }\n\n    [Symbol.iterator]() {\n        const cached = this;\n        let cur = 0;\n\n        return {\n            next() {\n                if (cached.length <= cur) {\n                    cached.push(cached.iterator.next());\n                }\n                return cached[cur++];\n            }\n        };\n    }\n\n    /**\n     * This method allows user to consume the next element from the iterator\n     * into the cache.\n     *\n     * @param {number} count - number of elements to consume\n     */\n    touchNext(count = 1) {\n        let idx = 0;\n        while (idx++ < count) {\n            const last = this[this.length - 1];\n            if (last && last.done) {\n                break;\n            }\n            this.push(this.iterator.next());\n        }\n        // Return the last cached {value, done} object to allow the calling\n        // code to decide if it needs to call touchNext again.\n        return this[this.length - 1];\n    }\n}\n","import CachedIterable from \"./cached_iterable.mjs\";\n\n/*\n * CachedAsyncIterable caches the elements yielded by an async iterable.\n *\n * It can be used to iterate over an iterable many times without depleting the\n * iterable.\n */\nexport default class CachedAsyncIterable extends CachedIterable {\n    /**\n     * Create an `CachedAsyncIterable` instance.\n     *\n     * @param {Iterable} iterable\n     * @returns {CachedAsyncIterable}\n     */\n    constructor(iterable) {\n        super();\n\n        if (Symbol.asyncIterator in Object(iterable)) {\n            this.iterator = iterable[Symbol.asyncIterator]();\n        } else if (Symbol.iterator in Object(iterable)) {\n            this.iterator = iterable[Symbol.iterator]();\n        } else {\n            throw new TypeError(\"Argument must implement the iteration protocol.\");\n        }\n    }\n\n    /**\n     * Asynchronous iterator caching the yielded elements.\n     *\n     * Elements yielded by the original iterable will be cached and available\n     * synchronously. Returns an async generator object implementing the\n     * iterator protocol over the elements of the original (async or sync)\n     * iterable.\n     */\n    [Symbol.asyncIterator]() {\n        const cached = this;\n        let cur = 0;\n\n        return {\n            async next() {\n                if (cached.length <= cur) {\n                    cached.push(cached.iterator.next());\n                }\n                return cached[cur++];\n            }\n        };\n    }\n\n    /**\n     * This method allows user to consume the next element from the iterator\n     * into the cache.\n     *\n     * @param {number} count - number of elements to consume\n     */\n    async touchNext(count = 1) {\n        let idx = 0;\n        while (idx++ < count) {\n            const last = this[this.length - 1];\n            if (last && (await last).done) {\n                break;\n            }\n            this.push(this.iterator.next());\n        }\n        // Return the last cached {value, done} object to allow the calling\n        // code to decide if it needs to call touchNext again.\n        return this[this.length - 1];\n    }\n}\n","/* eslint no-console: [\"error\", { allow: [\"warn\", \"error\"] }] */\n/* global console */\nimport { CachedAsyncIterable } from \"cached-iterable\";\n/**\n * The `Localization` class is a central high-level API for vanilla\n * JavaScript use of Fluent.\n * It combines language negotiation, FluentBundle and I/O to\n * provide a scriptable API to format translations.\n */\nexport default class Localization {\n    /**\n     * @param {Array<String>} resourceIds     - List of resource IDs\n     * @param {Function}      generateBundles - Function that returns a\n     *                                          generator over FluentBundles\n     *\n     * @returns {Localization}\n     */\n    constructor(resourceIds = [], generateBundles) {\n        this.resourceIds = resourceIds;\n        this.generateBundles = generateBundles;\n        this.onChange(true);\n    }\n    addResourceIds(resourceIds, eager = false) {\n        this.resourceIds.push(...resourceIds);\n        this.onChange(eager);\n        return this.resourceIds.length;\n    }\n    removeResourceIds(resourceIds) {\n        this.resourceIds = this.resourceIds.filter(r => !resourceIds.includes(r));\n        this.onChange();\n        return this.resourceIds.length;\n    }\n    /**\n     * Format translations and handle fallback if needed.\n     *\n     * Format translations for `keys` from `FluentBundle` instances on this\n     * DOMLocalization. In case of errors, fetch the next context in the\n     * fallback chain.\n     *\n     * @param   {Array<Object>}         keys    - Translation keys to format.\n     * @param   {Function}              method  - Formatting function.\n     * @returns {Promise<Array<string|Object>>}\n     * @private\n     */\n    async formatWithFallback(keys, method) {\n        const translations = [];\n        let hasAtLeastOneBundle = false;\n        for await (const bundle of this.bundles) {\n            hasAtLeastOneBundle = true;\n            const missingIds = keysFromBundle(method, bundle, keys, translations);\n            if (missingIds.size === 0) {\n                break;\n            }\n            if (typeof console !== \"undefined\") {\n                const locale = bundle.locales[0];\n                const ids = Array.from(missingIds).join(\", \");\n                console.warn(`[fluent] Missing translations in ${locale}: ${ids}`);\n            }\n        }\n        if (!hasAtLeastOneBundle && typeof console !== \"undefined\") {\n            // eslint-disable-next-line max-len\n            console.warn(`[fluent] Request for keys failed because no resource bundles got generated.\n  keys: ${JSON.stringify(keys)}.\n  resourceIds: ${JSON.stringify(this.resourceIds)}.`);\n        }\n        return translations;\n    }\n    /**\n     * Format translations into `{value, attributes}` objects.\n     *\n     * The fallback logic is the same as in `formatValues`\n     * but it returns `{value, attributes}` objects\n     * which are suitable for the translation of DOM elements.\n     *\n     * Returns a Promise resolving to an array of the translation strings.\n     *\n     * @example\n     * ```js\n     * docL10n.formatMessages([\n     *   {id: 'hello', args: { who: 'Mary' }},\n     *   {id: 'welcome'}\n     * ]).then(console.log);\n     *\n     * // [\n     * //   { value: 'Hello, Mary!', attributes: null },\n     * //   {\n     * //     value: 'Welcome!',\n     * //     attributes: [ { name: \"title\", value: 'Hello' } ]\n     * //   }\n     * // ]\n     * ```\n     *\n     * @param   {Array<Object>} keys\n     * @returns {Promise<Array<{value: string, attributes: Object}>>}\n     * @private\n     */\n    formatMessages(keys) {\n        return this.formatWithFallback(keys, messageFromBundle);\n    }\n    /**\n     * Retrieve translations corresponding to the passed keys.\n     *\n     * A generalized version of `DOMLocalization.formatValue`. Keys must\n     * be `{id, args}` objects.\n     *\n     * Returns a Promise resolving to an array of the translation strings.\n     *\n     * @example\n     * ```js\n     * docL10n.formatValues([\n     *   {id: 'hello', args: { who: 'Mary' }},\n     *   {id: 'hello', args: { who: 'John' }},\n     *   {id: 'welcome'}\n     * ]).then(console.log);\n     *\n     * // ['Hello, Mary!', 'Hello, John!', 'Welcome!']\n     * ```\n     *\n     * @param   {Array<Object>} keys\n     * @returns {Promise<Array<string>>}\n     */\n    formatValues(keys) {\n        return this.formatWithFallback(keys, valueFromBundle);\n    }\n    /**\n     * Retrieve the translation corresponding to the `id` identifier.\n     *\n     * If passed, `args` is a simple hash object with a list of variables that\n     * will be interpolated in the value of the translation.\n     *\n     * Returns a Promise resolving to the translation string.\n     *\n     * Use this sparingly for one-off messages which don't need to be\n     * retranslated when the user changes their language preferences, e.g. in\n     * notifications.\n     *\n     * @example\n     * ```js\n     * docL10n.formatValue(\n     *   'hello', { who: 'world' }\n     * ).then(console.log);\n     *\n     * // 'Hello, world!'\n     * ```\n     *\n     * @param   {string}  id     - Identifier of the translation to format\n     * @param   {Object}  [args] - Optional external arguments\n     * @returns {Promise<string>}\n     */\n    async formatValue(id, args) {\n        const [val] = await this.formatValues([{ id, args }]);\n        return val;\n    }\n    handleEvent() {\n        this.onChange();\n    }\n    /**\n     * This method should be called when there's a reason to believe\n     * that language negotiation or available resources changed.\n     */\n    onChange(eager = false) {\n        this.bundles = CachedAsyncIterable.from(this.generateBundles(this.resourceIds));\n        if (eager) {\n            this.bundles.touchNext(2);\n        }\n    }\n}\n/**\n * Format the value of a message into a string or `null`.\n *\n * This function is passed as a method to `keysFromBundle` and resolve\n * a value of a single L10n Entity using provided `FluentBundle`.\n *\n * If the message doesn't have a value, return `null`.\n *\n * @param   {FluentBundle} bundle\n * @param   {Array<Error>} errors\n * @param   {Object} message\n * @param   {Object} args\n * @returns {string|null}\n * @private\n */\nfunction valueFromBundle(bundle, errors, message, args) {\n    if (message.value) {\n        return bundle.formatPattern(message.value, args, errors);\n    }\n    return null;\n}\n/**\n * Format all public values of a message into a {value, attributes} object.\n *\n * This function is passed as a method to `keysFromBundle` and resolve\n * a single L10n Entity using provided `FluentBundle`.\n *\n * The function will return an object with a value and attributes of the\n * entity.\n *\n * @param   {FluentBundle} bundle\n * @param   {Array<Error>} errors\n * @param   {Object} message\n * @param   {Object} args\n * @returns {Object}\n * @private\n */\nfunction messageFromBundle(bundle, errors, message, args) {\n    const formatted = {\n        value: null,\n        attributes: null,\n    };\n    if (message.value) {\n        formatted.value = bundle.formatPattern(message.value, args, errors);\n    }\n    let attrNames = Object.keys(message.attributes);\n    if (attrNames.length > 0) {\n        formatted.attributes = new Array(attrNames.length);\n        for (let [i, name] of attrNames.entries()) {\n            let value = bundle.formatPattern(message.attributes[name], args, errors);\n            formatted.attributes[i] = { name, value };\n        }\n    }\n    return formatted;\n}\n/**\n * This function is an inner function for `Localization.formatWithFallback`.\n *\n * It takes a `FluentBundle`, list of l10n-ids and a method to be used for\n * key resolution (either `valueFromBundle` or `messageFromBundle`) and\n * optionally a value returned from `keysFromBundle` executed against\n * another `FluentBundle`.\n *\n * The idea here is that if the previous `FluentBundle` did not resolve\n * all keys, we're calling this function with the next context to resolve\n * the remaining ones.\n *\n * In the function, we loop over `keys` and check if we have the `prev`\n * passed and if it has an error entry for the position we're in.\n *\n * If it doesn't, it means that we have a good translation for this key and\n * we return it. If it does, we'll try to resolve the key using the passed\n * `FluentBundle`.\n *\n * In the end, we fill the translations array, and return the Set with\n * missing ids.\n *\n * See `Localization.formatWithFallback` for more info on how this is used.\n *\n * @param {Function}       method\n * @param {FluentBundle} bundle\n * @param {Array<string>}  keys\n * @param {{Array<{value: string, attributes: Object}>}} translations\n *\n * @returns {Set<string>}\n * @private\n */\nfunction keysFromBundle(method, bundle, keys, translations) {\n    const messageErrors = [];\n    const missingIds = new Set();\n    keys.forEach(({ id, args }, i) => {\n        if (translations[i] !== undefined) {\n            return;\n        }\n        let message = bundle.getMessage(id);\n        if (message) {\n            messageErrors.length = 0;\n            translations[i] = method(bundle, messageErrors, message, args);\n            if (messageErrors.length > 0 && typeof console !== \"undefined\") {\n                const locale = bundle.locales[0];\n                const errors = messageErrors.join(\", \");\n                // eslint-disable-next-line max-len\n                console.warn(`[fluent][resolver] errors in ${locale}/${id}: ${errors}.`);\n            }\n        }\n        else {\n            missingIds.add(id);\n        }\n    });\n    return missingIds;\n}\n","import translateElement from \"./overlay.js\";\nimport Localization from \"./localization.js\";\nconst L10NID_ATTR_NAME = \"data-l10n-id\";\nconst L10NARGS_ATTR_NAME = \"data-l10n-args\";\nconst L10N_ELEMENT_QUERY = `[${L10NID_ATTR_NAME}]`;\n/**\n * The `DOMLocalization` class is responsible for fetching resources and\n * formatting translations.\n *\n * It implements the fallback strategy in case of errors encountered during the\n * formatting of translations and methods for observing DOM\n * trees with a `MutationObserver`.\n */\nexport default class DOMLocalization extends Localization {\n    /**\n     * @param {Array<String>}    resourceIds     - List of resource IDs\n     * @param {Function}         generateBundles - Function that returns a\n     *                                             generator over FluentBundles\n     * @returns {DOMLocalization}\n     */\n    constructor(resourceIds, generateBundles) {\n        super(resourceIds, generateBundles);\n        // A Set of DOM trees observed by the `MutationObserver`.\n        this.roots = new Set();\n        // requestAnimationFrame handler.\n        this.pendingrAF = null;\n        // list of elements pending for translation.\n        this.pendingElements = new Set();\n        this.windowElement = null;\n        this.mutationObserver = null;\n        this.observerConfig = {\n            attributes: true,\n            characterData: false,\n            childList: true,\n            subtree: true,\n            attributeFilter: [L10NID_ATTR_NAME, L10NARGS_ATTR_NAME],\n        };\n    }\n    onChange(eager = false) {\n        super.onChange(eager);\n        if (this.roots) {\n            this.translateRoots();\n        }\n    }\n    /**\n     * Set the `data-l10n-id` and `data-l10n-args` attributes on DOM elements.\n     * FluentDOM makes use of mutation observers to detect changes\n     * to `data-l10n-*` attributes and translate elements asynchronously.\n     * `setAttributes` is a convenience method which allows to translate\n     * DOM elements declaratively.\n     *\n     * You should always prefer to use `data-l10n-id` on elements (statically in\n     * HTML or dynamically via `setAttributes`) over manually retrieving\n     * translations with `format`.  The use of attributes ensures that the\n     * elements can be retranslated when the user changes their language\n     * preferences.\n     *\n     * ```javascript\n     * localization.setAttributes(\n     *   document.querySelector('#welcome'), 'hello', { who: 'world' }\n     * );\n     * ```\n     *\n     * This will set the following attributes on the `#welcome` element.\n     * The MutationObserver will pick up this change and will localize the element\n     * asynchronously.\n     *\n     * ```html\n     * <p id='welcome'\n     *   data-l10n-id='hello'\n     *   data-l10n-args='{\"who\": \"world\"}'>\n     * </p>\n     * ```\n     *\n     * @param {Element}                element - Element to set attributes on\n     * @param {string}                 id      - l10n-id string\n     * @param {Object<string, string>} args    - KVP list of l10n arguments\n     * @returns {Element}\n     */\n    setAttributes(element, id, args) {\n        element.setAttribute(L10NID_ATTR_NAME, id);\n        if (args) {\n            element.setAttribute(L10NARGS_ATTR_NAME, JSON.stringify(args));\n        }\n        else {\n            element.removeAttribute(L10NARGS_ATTR_NAME);\n        }\n        return element;\n    }\n    /**\n     * Get the `data-l10n-*` attributes from DOM elements.\n     *\n     * ```javascript\n     * localization.getAttributes(\n     *   document.querySelector('#welcome')\n     * );\n     * // -> { id: 'hello', args: { who: 'world' } }\n     * ```\n     *\n     * @param   {Element}  element - HTML element\n     * @returns {{id: string, args: Object}}\n     */\n    getAttributes(element) {\n        return {\n            id: element.getAttribute(L10NID_ATTR_NAME),\n            args: JSON.parse(element.getAttribute(L10NARGS_ATTR_NAME) || null),\n        };\n    }\n    /**\n     * Add `newRoot` to the list of roots managed by this `DOMLocalization`.\n     *\n     * Additionally, if this `DOMLocalization` has an observer, start observing\n     * `newRoot` in order to translate mutations in it.\n     *\n     * @param {Element}      newRoot - Root to observe.\n     */\n    connectRoot(newRoot) {\n        for (const root of this.roots) {\n            if (root === newRoot ||\n                root.contains(newRoot) ||\n                newRoot.contains(root)) {\n                throw new Error(\"Cannot add a root that overlaps with existing root.\");\n            }\n        }\n        if (this.windowElement) {\n            if (this.windowElement !== newRoot.ownerDocument.defaultView) {\n                throw new Error(`Cannot connect a root:\n          DOMLocalization already has a root from a different window.`);\n            }\n        }\n        else {\n            this.windowElement = newRoot.ownerDocument.defaultView;\n            this.mutationObserver = new this.windowElement.MutationObserver(mutations => this.translateMutations(mutations));\n        }\n        this.roots.add(newRoot);\n        this.mutationObserver.observe(newRoot, this.observerConfig);\n    }\n    /**\n     * Remove `root` from the list of roots managed by this `DOMLocalization`.\n     *\n     * Additionally, if this `DOMLocalization` has an observer, stop observing\n     * `root`.\n     *\n     * Returns `true` if the root was the last one managed by this\n     * `DOMLocalization`.\n     *\n     * @param   {Element} root - Root to disconnect.\n     * @returns {boolean}\n     */\n    disconnectRoot(root) {\n        this.roots.delete(root);\n        // Pause the mutation observer to stop observing `root`.\n        this.pauseObserving();\n        if (this.roots.size === 0) {\n            this.mutationObserver = null;\n            if (this.windowElement && this.pendingrAF) {\n                this.windowElement.cancelAnimationFrame(this.pendingrAF);\n            }\n            this.windowElement = null;\n            this.pendingrAF = null;\n            this.pendingElements.clear();\n            return true;\n        }\n        // Resume observing all other roots.\n        this.resumeObserving();\n        return false;\n    }\n    /**\n     * Translate all roots associated with this `DOMLocalization`.\n     *\n     * @returns {Promise}\n     */\n    translateRoots() {\n        const roots = Array.from(this.roots);\n        return Promise.all(roots.map(root => this.translateFragment(root)));\n    }\n    /**\n     * Pauses the `MutationObserver`.\n     */\n    pauseObserving() {\n        if (!this.mutationObserver) {\n            return;\n        }\n        this.translateMutations(this.mutationObserver.takeRecords());\n        this.mutationObserver.disconnect();\n    }\n    /**\n     * Resumes the `MutationObserver`.\n     */\n    resumeObserving() {\n        if (!this.mutationObserver) {\n            return;\n        }\n        for (const root of this.roots) {\n            this.mutationObserver.observe(root, this.observerConfig);\n        }\n    }\n    /**\n     * Translate mutations detected by the `MutationObserver`.\n     *\n     * @private\n     */\n    translateMutations(mutations) {\n        for (const mutation of mutations) {\n            switch (mutation.type) {\n                case \"attributes\":\n                    if (mutation.target.hasAttribute(\"data-l10n-id\")) {\n                        this.pendingElements.add(mutation.target);\n                    }\n                    break;\n                case \"childList\":\n                    for (const addedNode of mutation.addedNodes) {\n                        if (addedNode.nodeType === addedNode.ELEMENT_NODE) {\n                            if (addedNode.childElementCount) {\n                                for (const element of this.getTranslatables(addedNode)) {\n                                    this.pendingElements.add(element);\n                                }\n                            }\n                            else if (addedNode.hasAttribute(L10NID_ATTR_NAME)) {\n                                this.pendingElements.add(addedNode);\n                            }\n                        }\n                    }\n                    break;\n            }\n        }\n        // This fragment allows us to coalesce all pending translations\n        // into a single requestAnimationFrame.\n        if (this.pendingElements.size > 0) {\n            if (this.pendingrAF === null) {\n                this.pendingrAF = this.windowElement.requestAnimationFrame(() => {\n                    this.translateElements(Array.from(this.pendingElements));\n                    this.pendingElements.clear();\n                    this.pendingrAF = null;\n                });\n            }\n        }\n    }\n    /**\n     * Translate a DOM element or fragment asynchronously using this\n     * `DOMLocalization` object.\n     *\n     * Manually trigger the translation (or re-translation) of a DOM fragment.\n     * Use the `data-l10n-id` and `data-l10n-args` attributes to mark up the DOM\n     * with information about which translations to use.\n     *\n     * Returns a `Promise` that gets resolved once the translation is complete.\n     *\n     * @param   {DOMFragment} frag - Element or DocumentFragment to be translated\n     * @returns {Promise}\n     */\n    translateFragment(frag) {\n        return this.translateElements(this.getTranslatables(frag));\n    }\n    /**\n     * Translate a list of DOM elements asynchronously using this\n     * `DOMLocalization` object.\n     *\n     * Manually trigger the translation (or re-translation) of a list of elements.\n     * Use the `data-l10n-id` and `data-l10n-args` attributes to mark up the DOM\n     * with information about which translations to use.\n     *\n     * Returns a `Promise` that gets resolved once the translation is complete.\n     *\n     * @param   {Array<Element>} elements - List of elements to be translated\n     * @returns {Promise}\n     */\n    async translateElements(elements) {\n        if (!elements.length) {\n            return undefined;\n        }\n        const keys = elements.map(this.getKeysForElement);\n        const translations = await this.formatMessages(keys);\n        return this.applyTranslations(elements, translations);\n    }\n    /**\n     * Applies translations onto elements.\n     *\n     * @param {Array<Element>} elements\n     * @param {Array<Object>}  translations\n     * @private\n     */\n    applyTranslations(elements, translations) {\n        this.pauseObserving();\n        for (let i = 0; i < elements.length; i++) {\n            if (translations[i] !== undefined) {\n                translateElement(elements[i], translations[i]);\n            }\n        }\n        this.resumeObserving();\n    }\n    /**\n     * Collects all translatable child elements of the element.\n     *\n     * @param {Element} element\n     * @returns {Array<Element>}\n     * @private\n     */\n    getTranslatables(element) {\n        const nodes = Array.from(element.querySelectorAll(L10N_ELEMENT_QUERY));\n        if (typeof element.hasAttribute === \"function\" &&\n            element.hasAttribute(L10NID_ATTR_NAME)) {\n            nodes.push(element);\n        }\n        return nodes;\n    }\n    /**\n     * Get the `data-l10n-*` attributes from DOM elements as a two-element\n     * array.\n     *\n     * @param {Element} element\n     * @returns {Object}\n     * @private\n     */\n    getKeysForElement(element) {\n        return {\n            id: element.getAttribute(L10NID_ATTR_NAME),\n            args: JSON.parse(element.getAttribute(L10NARGS_ATTR_NAME) || null),\n        };\n    }\n}\n","/* Copyright 2023 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/** @typedef {import(\"./interfaces\").IL10n} IL10n */\n\n/**\n * NOTE: The L10n-implementations should use lowercase language-codes\n *       internally.\n * @implements {IL10n}\n */\nclass L10n {\n  #dir;\n\n  #elements;\n\n  #lang;\n\n  #l10n;\n\n  constructor({ lang, isRTL }, l10n = null) {\n    this.#lang = L10n.#fixupLangCode(lang);\n    this.#l10n = l10n;\n    this.#dir = (isRTL ?? L10n.#isRTL(this.#lang)) ? \"rtl\" : \"ltr\";\n  }\n\n  _setL10n(l10n) {\n    this.#l10n = l10n;\n    if (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"TESTING\")) {\n      document.l10n = l10n;\n    }\n  }\n\n  /** @inheritdoc */\n  getLanguage() {\n    return this.#lang;\n  }\n\n  /** @inheritdoc */\n  getDirection() {\n    return this.#dir;\n  }\n\n  /** @inheritdoc */\n  async get(ids, args = null, fallback) {\n    if (Array.isArray(ids)) {\n      ids = ids.map(id => ({ id }));\n      const messages = await this.#l10n.formatMessages(ids);\n      return messages.map(message => message.value);\n    }\n\n    const messages = await this.#l10n.formatMessages([\n      {\n        id: ids,\n        args,\n      },\n    ]);\n    return messages[0]?.value || fallback;\n  }\n\n  /** @inheritdoc */\n  async translate(element) {\n    (this.#elements ||= new Set()).add(element);\n    try {\n      this.#l10n.connectRoot(element);\n      await this.#l10n.translateRoots();\n    } catch {\n      // Element is under an existing root, so there is no need to add it again.\n    }\n  }\n\n  /** @inheritdoc */\n  async translateOnce(element) {\n    try {\n      await this.#l10n.translateElements([element]);\n    } catch (ex) {\n      console.error(`translateOnce: \"${ex}\".`);\n    }\n  }\n\n  /** @inheritdoc */\n  async destroy() {\n    if (this.#elements) {\n      for (const element of this.#elements) {\n        this.#l10n.disconnectRoot(element);\n      }\n      this.#elements.clear();\n      this.#elements = null;\n    }\n    this.#l10n.pauseObserving();\n  }\n\n  /** @inheritdoc */\n  pause() {\n    this.#l10n.pauseObserving();\n  }\n\n  /** @inheritdoc */\n  resume() {\n    this.#l10n.resumeObserving();\n  }\n\n  static #fixupLangCode(langCode) {\n    // Use only lowercase language-codes internally, and fallback to English.\n    langCode = langCode?.toLowerCase() || \"en-us\";\n\n    // Try to support \"incompletely\" specified language codes (see issue 13689).\n    const PARTIAL_LANG_CODES = {\n      en: \"en-us\",\n      es: \"es-es\",\n      fy: \"fy-nl\",\n      ga: \"ga-ie\",\n      gu: \"gu-in\",\n      hi: \"hi-in\",\n      hy: \"hy-am\",\n      nb: \"nb-no\",\n      ne: \"ne-np\",\n      nn: \"nn-no\",\n      pa: \"pa-in\",\n      pt: \"pt-pt\",\n      sv: \"sv-se\",\n      zh: \"zh-cn\",\n    };\n    return PARTIAL_LANG_CODES[langCode] || langCode;\n  }\n\n  static #isRTL(lang) {\n    const shortCode = lang.split(\"-\", 1)[0];\n    return [\"ar\", \"he\", \"fa\", \"ps\", \"ur\"].includes(shortCode);\n  }\n}\n\nconst GenericL10n = null;\n\nexport { GenericL10n, L10n };\n","/* Copyright 2017 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/** @typedef {import(\"./interfaces\").IL10n} IL10n */\n\nimport { FluentBundle, FluentResource } from \"fluent-bundle\";\nimport { DOMLocalization } from \"fluent-dom\";\nimport { fetchData } from \"pdfjs-lib\";\nimport { L10n } from \"./l10n.js\";\n\nfunction createBundle(lang, text) {\n  const resource = new FluentResource(text);\n  const bundle = new FluentBundle(lang);\n  const errors = bundle.addResource(resource);\n  if (errors.length) {\n    console.error(\"L10n errors\", errors);\n  }\n  return bundle;\n}\n\n/**\n * @implements {IL10n}\n */\nclass GenericL10n extends L10n {\n  constructor(lang) {\n    super({ lang });\n\n    const generateBundles = !lang\n      ? GenericL10n.#generateBundlesFallback.bind(\n          GenericL10n,\n          this.getLanguage()\n        )\n      : GenericL10n.#generateBundles.bind(\n          GenericL10n,\n          \"en-us\",\n          this.getLanguage()\n        );\n    this._setL10n(new DOMLocalization([], generateBundles));\n  }\n\n  /**\n   * Generate the bundles for Fluent.\n   * @param {String} defaultLang - The fallback language to use for\n   *   translations.\n   * @param {String} baseLang - The base language to use for translations.\n   */\n  static async *#generateBundles(defaultLang, baseLang) {\n    const { baseURL, paths } = await this.#getPaths();\n\n    const langs = [baseLang];\n    if (defaultLang !== baseLang) {\n      // Also fallback to the short-format of the base language\n      // (see issue 17269).\n      const shortLang = baseLang.split(\"-\", 1)[0];\n\n      if (shortLang !== baseLang) {\n        langs.push(shortLang);\n      }\n      langs.push(defaultLang);\n    }\n    for (const lang of langs) {\n      const bundle = await this.#createBundle(lang, baseURL, paths);\n      if (bundle) {\n        yield bundle;\n      } else if (lang === \"en-us\") {\n        yield this.#createBundleFallback(lang);\n      }\n    }\n  }\n\n  static async #createBundle(lang, baseURL, paths) {\n    const path = paths[lang];\n    if (!path) {\n      return null;\n    }\n    const url = new URL(path, baseURL);\n    const text = await fetchData(url, /* type = */ \"text\");\n\n    return createBundle(lang, text);\n  }\n\n  static async #getPaths() {\n    try {\n      const { href } = document.querySelector(`link[type=\"application/l10n\"]`);\n      const paths = await fetchData(href, /* type = */ \"json\");\n\n      return { baseURL: href.replace(/[^/]*$/, \"\") || \"./\", paths };\n    } catch {}\n    return { baseURL: \"./\", paths: Object.create(null) };\n  }\n\n  static async *#generateBundlesFallback(lang) {\n    yield this.#createBundleFallback(lang);\n  }\n\n  static async #createBundleFallback(lang) {\n    if (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"TESTING\")) {\n      throw new Error(\"Not implemented: #createBundleFallback\");\n    }\n    const text =\n      typeof PDFJSDev === \"undefined\"\n        ? await fetchData(\n            new URL(\"../l10n/en-US/viewer.ftl\", window.location.href),\n            /* type = */ \"text\"\n          )\n        : PDFJSDev.eval(\"DEFAULT_FTL\");\n\n    return createBundle(lang, text);\n  }\n}\n\nexport { GenericL10n };\n","/* Copyright 2020 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { getPdfFilenameFromUrl } from \"pdfjs-lib\";\n\nasync function docProperties(pdfDocument) {\n  const url = \"\",\n    baseUrl = url.split(\"#\", 1)[0];\n  // eslint-disable-next-line prefer-const\n  let { info, metadata, contentDispositionFilename, contentLength } =\n    await pdfDocument.getMetadata();\n\n  if (!contentLength) {\n    const { length } = await pdfDocument.getDownloadInfo();\n    contentLength = length;\n  }\n\n  return {\n    ...info,\n    baseURL: baseUrl,\n    filesize: contentLength,\n    filename: contentDispositionFilename || getPdfFilenameFromUrl(url),\n    metadata: metadata?.getRaw(),\n    authors: metadata?.get(\"dc:creator\"),\n    numPages: pdfDocument.numPages,\n    URL: url,\n  };\n}\n\nclass GenericScripting {\n  constructor(sandboxBundleSrc) {\n    this._ready = new Promise((resolve, reject) => {\n      const sandbox =\n        typeof PDFJSDev === \"undefined\"\n          ? import(sandboxBundleSrc) // eslint-disable-line no-unsanitized/method\n          : __non_webpack_import__(sandboxBundleSrc);\n      sandbox\n        .then(pdfjsSandbox => {\n          resolve(pdfjsSandbox.QuickJSSandbox());\n        })\n        .catch(reject);\n    });\n  }\n\n  async createSandbox(data) {\n    const sandbox = await this._ready;\n    sandbox.create(data);\n  }\n\n  async dispatchEventInSandbox(event) {\n    const sandbox = await this._ready;\n    setTimeout(() => sandbox.dispatchEvent(event), 0);\n  }\n\n  async destroySandbox() {\n    const sandbox = await this._ready;\n    sandbox.nukeSandbox();\n  }\n}\n\nexport { docProperties, GenericScripting };\n","/* Copyright 2017 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { AppOptions } from \"./app_options.js\";\nimport { BaseExternalServices } from \"./external_services.js\";\nimport { BasePreferences } from \"./preferences.js\";\nimport { GenericL10n } from \"./genericl10n.js\";\nimport { GenericScripting } from \"./generic_scripting.js\";\n\nif (typeof PDFJSDev !== \"undefined\" && !PDFJSDev.test(\"GENERIC\")) {\n  throw new Error(\n    'Module \"pdfjs-web/genericcom\" shall not be used outside GENERIC build.'\n  );\n}\n\nfunction initCom(app) {}\n\nclass Preferences extends BasePreferences {\n  async _writeToStorage(prefObj) {\n    localStorage.setItem(\"pdfjs.preferences\", JSON.stringify(prefObj));\n  }\n\n  async _readFromStorage(prefObj) {\n    return { prefs: JSON.parse(localStorage.getItem(\"pdfjs.preferences\")) };\n  }\n}\n\nclass ExternalServices extends BaseExternalServices {\n  async createL10n() {\n    return new GenericL10n(AppOptions.get(\"localeProperties\")?.lang);\n  }\n\n  createScripting() {\n    return new GenericScripting(AppOptions.get(\"sandboxBundleSrc\"));\n  }\n}\n\nclass MLManager {\n  async isEnabledFor(_name) {\n    return false;\n  }\n\n  async deleteModel(_service) {\n    return null;\n  }\n\n  isReady(_name) {\n    return false;\n  }\n\n  guess(_data) {}\n\n  toggleService(_name, _enabled) {}\n\n  static getFakeMLManager(options) {\n    return new FakeMLManager(options);\n  }\n}\n\nclass FakeMLManager {\n  eventBus = null;\n\n  hasProgress = false;\n\n  constructor({ enableGuessAltText, enableAltTextModelDownload }) {\n    this.enableGuessAltText = enableGuessAltText;\n    this.enableAltTextModelDownload = enableAltTextModelDownload;\n  }\n\n  setEventBus(eventBus, abortSignal) {\n    this.eventBus = eventBus;\n  }\n\n  async isEnabledFor(_name) {\n    return this.enableGuessAltText;\n  }\n\n  async deleteModel(_name) {\n    this.enableAltTextModelDownload = false;\n    return null;\n  }\n\n  async loadModel(_name) {}\n\n  async downloadModel(_name) {\n    // Simulate downloading the model but with progress.\n    // The progress can be seen in the new alt-text dialog.\n    this.hasProgress = true;\n\n    const { promise, resolve } = Promise.withResolvers();\n    const total = 1e8;\n    const end = 1.5 * total;\n    const increment = 5e6;\n    let loaded = 0;\n    const id = setInterval(() => {\n      loaded += increment;\n      if (loaded <= end) {\n        this.eventBus.dispatch(\"loadaiengineprogress\", {\n          source: this,\n          detail: {\n            total,\n            totalLoaded: loaded,\n            finished: loaded + increment >= end,\n          },\n        });\n        return;\n      }\n      clearInterval(id);\n      this.hasProgress = false;\n      this.enableAltTextModelDownload = true;\n      resolve(true);\n    }, 900);\n    return promise;\n  }\n\n  isReady(_name) {\n    return this.enableAltTextModelDownload;\n  }\n\n  guess({ request: { data } }) {\n    return new Promise(resolve => {\n      setTimeout(() => {\n        resolve(data ? { output: \"Fake alt text\" } : { error: true });\n      }, 3000);\n    });\n  }\n\n  toggleService(_name, enabled) {\n    this.enableGuessAltText = enabled;\n  }\n}\n\nexport { ExternalServices, initCom, MLManager, Preferences };\n","/* Copyright 2024 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { noContextMenu } from \"pdfjs-lib\";\n\nclass NewAltTextManager {\n  #boundCancel = this.#cancel.bind(this);\n\n  #createAutomaticallyButton;\n\n  #currentEditor = null;\n\n  #cancelButton;\n\n  #descriptionContainer;\n\n  #dialog;\n\n  #disclaimer;\n\n  #downloadModel;\n\n  #downloadModelDescription;\n\n  #eventBus;\n\n  #firstTime = false;\n\n  #guessedAltText;\n\n  #hasAI = null;\n\n  #isEditing = null;\n\n  #imagePreview;\n\n  #imageData;\n\n  #isAILoading = false;\n\n  #wasAILoading = false;\n\n  #learnMore;\n\n  #notNowButton;\n\n  #overlayManager;\n\n  #textarea;\n\n  #title;\n\n  #uiManager;\n\n  #previousAltText = null;\n\n  constructor(\n    {\n      descriptionContainer,\n      dialog,\n      imagePreview,\n      cancelButton,\n      disclaimer,\n      notNowButton,\n      saveButton,\n      textarea,\n      learnMore,\n      errorCloseButton,\n      createAutomaticallyButton,\n      downloadModel,\n      downloadModelDescription,\n      title,\n    },\n    overlayManager,\n    eventBus\n  ) {\n    this.#cancelButton = cancelButton;\n    this.#createAutomaticallyButton = createAutomaticallyButton;\n    this.#descriptionContainer = descriptionContainer;\n    this.#dialog = dialog;\n    this.#disclaimer = disclaimer;\n    this.#notNowButton = notNowButton;\n    this.#imagePreview = imagePreview;\n    this.#textarea = textarea;\n    this.#learnMore = learnMore;\n    this.#title = title;\n    this.#downloadModel = downloadModel;\n    this.#downloadModelDescription = downloadModelDescription;\n    this.#overlayManager = overlayManager;\n    this.#eventBus = eventBus;\n\n    dialog.addEventListener(\"close\", this.#close.bind(this));\n    dialog.addEventListener(\"contextmenu\", event => {\n      if (event.target !== this.#textarea) {\n        event.preventDefault();\n      }\n    });\n    cancelButton.addEventListener(\"click\", this.#boundCancel);\n    notNowButton.addEventListener(\"click\", this.#boundCancel);\n    saveButton.addEventListener(\"click\", this.#save.bind(this));\n    errorCloseButton.addEventListener(\"click\", () => {\n      this.#toggleError(false);\n    });\n    createAutomaticallyButton.addEventListener(\"click\", async () => {\n      const checked =\n        createAutomaticallyButton.getAttribute(\"aria-pressed\") !== \"true\";\n      this.#currentEditor._reportTelemetry({\n        action: \"pdfjs.image.alt_text.ai_generation_check\",\n        data: { status: checked },\n      });\n\n      if (this.#uiManager) {\n        this.#uiManager.setPreference(\"enableGuessAltText\", checked);\n        await this.#uiManager.mlManager.toggleService(\"altText\", checked);\n      }\n      this.#toggleGuessAltText(checked, /* isInitial = */ false);\n    });\n    textarea.addEventListener(\"focus\", () => {\n      this.#wasAILoading = this.#isAILoading;\n      this.#toggleLoading(false);\n      this.#toggleTitleAndDisclaimer();\n    });\n    textarea.addEventListener(\"blur\", () => {\n      if (!textarea.value) {\n        this.#toggleLoading(this.#wasAILoading);\n      }\n      this.#toggleTitleAndDisclaimer();\n    });\n    textarea.addEventListener(\"input\", () => {\n      this.#toggleTitleAndDisclaimer();\n    });\n\n    eventBus._on(\"enableguessalttext\", ({ value }) => {\n      this.#toggleGuessAltText(value, /* isInitial = */ false);\n    });\n\n    this.#overlayManager.register(dialog);\n\n    this.#learnMore.addEventListener(\"click\", () => {\n      this.#currentEditor._reportTelemetry({\n        action: \"pdfjs.image.alt_text.info\",\n        data: { topic: \"alt_text\" },\n      });\n    });\n  }\n\n  #toggleLoading(value) {\n    if (!this.#uiManager || this.#isAILoading === value) {\n      return;\n    }\n    this.#isAILoading = value;\n    this.#descriptionContainer.classList.toggle(\"loading\", value);\n  }\n\n  #toggleError(value) {\n    if (!this.#uiManager) {\n      return;\n    }\n    this.#dialog.classList.toggle(\"error\", value);\n  }\n\n  async #toggleGuessAltText(value, isInitial = false) {\n    if (!this.#uiManager) {\n      return;\n    }\n    this.#dialog.classList.toggle(\"aiDisabled\", !value);\n    this.#createAutomaticallyButton.setAttribute(\"aria-pressed\", value);\n\n    if (value) {\n      const { altTextLearnMoreUrl } = this.#uiManager.mlManager;\n      if (altTextLearnMoreUrl) {\n        this.#learnMore.href = altTextLearnMoreUrl;\n      }\n      this.#mlGuessAltText(isInitial);\n    } else {\n      this.#toggleLoading(false);\n      this.#isAILoading = false;\n      this.#toggleTitleAndDisclaimer();\n    }\n  }\n\n  #toggleNotNow() {\n    this.#notNowButton.classList.toggle(\"hidden\", !this.#firstTime);\n    this.#cancelButton.classList.toggle(\"hidden\", this.#firstTime);\n  }\n\n  #toggleAI(value) {\n    if (!this.#uiManager || this.#hasAI === value) {\n      return;\n    }\n    this.#hasAI = value;\n    this.#dialog.classList.toggle(\"noAi\", !value);\n    this.#toggleTitleAndDisclaimer();\n  }\n\n  #toggleTitleAndDisclaimer() {\n    // Disclaimer is visible when the AI is loading or the user didn't change\n    // the guessed alt text.\n    const visible =\n      this.#isAILoading ||\n      (this.#guessedAltText && this.#guessedAltText === this.#textarea.value);\n    this.#disclaimer.hidden = !visible;\n\n    // The title changes depending if the text area is empty or not.\n    const isEditing = this.#isAILoading || !!this.#textarea.value;\n    if (this.#isEditing === isEditing) {\n      return;\n    }\n    this.#isEditing = isEditing;\n    this.#title.setAttribute(\n      \"data-l10n-id\",\n      isEditing\n        ? \"pdfjs-editor-new-alt-text-dialog-edit-label\"\n        : \"pdfjs-editor-new-alt-text-dialog-add-label\"\n    );\n  }\n\n  async #mlGuessAltText(isInitial) {\n    if (this.#isAILoading) {\n      // We're still loading the previous guess.\n      return;\n    }\n\n    if (this.#textarea.value) {\n      // The user has already set an alt text.\n      return;\n    }\n\n    if (isInitial && this.#previousAltText !== null) {\n      // The user has already set an alt text (empty or not).\n      return;\n    }\n\n    this.#guessedAltText = this.#currentEditor.guessedAltText;\n    if (this.#previousAltText === null && this.#guessedAltText) {\n      // We have a guessed alt text and the user didn't change it.\n      this.#addAltText(this.#guessedAltText);\n      return;\n    }\n\n    this.#toggleLoading(true);\n    this.#toggleTitleAndDisclaimer();\n\n    let hasError = false;\n    try {\n      // When calling #mlGuessAltText we don't wait for it, so we must take care\n      // that the alt text dialog can have been closed before the response is.\n\n      const altText = await this.#currentEditor.mlGuessAltText(\n        this.#imageData,\n        /* updateAltTextData = */ false\n      );\n      if (altText) {\n        this.#guessedAltText = altText;\n        this.#wasAILoading = this.#isAILoading;\n        if (this.#isAILoading) {\n          this.#addAltText(altText);\n        }\n      }\n    } catch (e) {\n      console.error(e);\n      hasError = true;\n    }\n\n    this.#toggleLoading(false);\n    this.#toggleTitleAndDisclaimer();\n\n    if (hasError && this.#uiManager) {\n      this.#toggleError(true);\n    }\n  }\n\n  #addAltText(altText) {\n    if (!this.#uiManager || this.#textarea.value) {\n      return;\n    }\n    this.#textarea.value = altText;\n    this.#toggleTitleAndDisclaimer();\n  }\n\n  #setProgress() {\n    // Show the download model progress.\n    this.#downloadModel.classList.toggle(\"hidden\", false);\n\n    const callback = async ({ detail: { finished, total, totalLoaded } }) => {\n      const ONE_MEGA_BYTES = 1e6;\n      // totalLoaded can be greater than total if the download is compressed.\n      // So we cheat to avoid any confusion.\n      totalLoaded = Math.min(0.99 * total, totalLoaded);\n\n      // Update the progress.\n      const totalSize = (this.#downloadModelDescription.ariaValueMax =\n        Math.round(total / ONE_MEGA_BYTES));\n      const downloadedSize = (this.#downloadModelDescription.ariaValueNow =\n        Math.round(totalLoaded / ONE_MEGA_BYTES));\n      this.#downloadModelDescription.setAttribute(\n        \"data-l10n-args\",\n        JSON.stringify({ totalSize, downloadedSize })\n      );\n      if (!finished) {\n        return;\n      }\n\n      // We're done, remove the listener and hide the download model progress.\n      this.#eventBus._off(\"loadaiengineprogress\", callback);\n      this.#downloadModel.classList.toggle(\"hidden\", true);\n\n      this.#toggleAI(true);\n      if (!this.#uiManager) {\n        return;\n      }\n      const { mlManager } = this.#uiManager;\n\n      // The model has been downloaded, we can now enable the AI service.\n      mlManager.toggleService(\"altText\", true);\n      this.#toggleGuessAltText(\n        await mlManager.isEnabledFor(\"altText\"),\n        /* isInitial = */ true\n      );\n    };\n    this.#eventBus._on(\"loadaiengineprogress\", callback);\n  }\n\n  async editAltText(uiManager, editor, firstTime) {\n    if (this.#currentEditor || !editor) {\n      return;\n    }\n\n    if (firstTime && editor.hasAltTextData()) {\n      editor.altTextFinish();\n      return;\n    }\n\n    this.#firstTime = firstTime;\n    let { mlManager } = uiManager;\n    let hasAI = !!mlManager;\n    this.#toggleTitleAndDisclaimer();\n\n    if (mlManager && !mlManager.isReady(\"altText\")) {\n      hasAI = false;\n      if (mlManager.hasProgress) {\n        this.#setProgress();\n      } else {\n        mlManager = null;\n      }\n    } else {\n      this.#downloadModel.classList.toggle(\"hidden\", true);\n    }\n\n    const isAltTextEnabledPromise = mlManager?.isEnabledFor(\"altText\");\n\n    this.#currentEditor = editor;\n    this.#uiManager = uiManager;\n    this.#uiManager.removeEditListeners();\n\n    ({ altText: this.#previousAltText } = editor.altTextData);\n    this.#textarea.value = this.#previousAltText ?? \"\";\n\n    // TODO: get this value from Firefox\n    //   (https://bugzilla.mozilla.org/show_bug.cgi?id=1908184)\n    const AI_MAX_IMAGE_DIMENSION = 224;\n    const MAX_PREVIEW_DIMENSION = 180;\n\n    // The max dimension of the preview in the dialog is 180px, so we keep 224px\n    // and rescale it thanks to css.\n\n    let canvas, width, height;\n    if (mlManager) {\n      ({\n        canvas,\n        width,\n        height,\n        imageData: this.#imageData,\n      } = editor.copyCanvas(\n        AI_MAX_IMAGE_DIMENSION,\n        MAX_PREVIEW_DIMENSION,\n        /* createImageData = */ true\n      ));\n      if (hasAI) {\n        this.#toggleGuessAltText(\n          await isAltTextEnabledPromise,\n          /* isInitial = */ true\n        );\n      }\n    } else {\n      ({ canvas, width, height } = editor.copyCanvas(\n        AI_MAX_IMAGE_DIMENSION,\n        MAX_PREVIEW_DIMENSION,\n        /* createImageData = */ false\n      ));\n    }\n\n    canvas.setAttribute(\"role\", \"presentation\");\n    const { style } = canvas;\n    style.width = `${width}px`;\n    style.height = `${height}px`;\n    this.#imagePreview.append(canvas);\n\n    this.#toggleNotNow();\n    this.#toggleAI(hasAI);\n    this.#toggleError(false);\n\n    try {\n      await this.#overlayManager.open(this.#dialog);\n    } catch (ex) {\n      this.#close();\n      throw ex;\n    }\n  }\n\n  #cancel() {\n    this.#currentEditor.altTextData = {\n      cancel: true,\n    };\n    const altText = this.#textarea.value.trim();\n    this.#currentEditor._reportTelemetry({\n      action: \"pdfjs.image.alt_text.dismiss\",\n      data: {\n        alt_text_type: altText ? \"present\" : \"empty\",\n        flow: this.#firstTime ? \"image_add\" : \"alt_text_edit\",\n      },\n    });\n    this.#currentEditor._reportTelemetry({\n      action: \"pdfjs.image.image_added\",\n      data: { alt_text_modal: true, alt_text_type: \"skipped\" },\n    });\n    this.#finish();\n  }\n\n  #finish() {\n    if (this.#overlayManager.active === this.#dialog) {\n      this.#overlayManager.close(this.#dialog);\n    }\n  }\n\n  #close() {\n    const canvas = this.#imagePreview.firstChild;\n    canvas.remove();\n    canvas.width = canvas.height = 0;\n    this.#imageData = null;\n\n    this.#toggleLoading(false);\n\n    this.#uiManager?.addEditListeners();\n    this.#currentEditor.altTextFinish();\n    this.#uiManager?.setSelected(this.#currentEditor);\n    this.#currentEditor = null;\n    this.#uiManager = null;\n  }\n\n  #save() {\n    const altText = this.#textarea.value.trim();\n    this.#currentEditor.altTextData = {\n      altText,\n      decorative: false,\n    };\n    this.#currentEditor.altTextData.guessedAltText = this.#guessedAltText;\n\n    if (this.#guessedAltText && this.#guessedAltText !== altText) {\n      const guessedWords = new Set(this.#guessedAltText.split(/\\s+/));\n      const words = new Set(altText.split(/\\s+/));\n      this.#currentEditor._reportTelemetry({\n        action: \"pdfjs.image.alt_text.user_edit\",\n        data: {\n          total_words: guessedWords.size,\n          words_removed: guessedWords.difference(words).size,\n          words_added: words.difference(guessedWords).size,\n        },\n      });\n    }\n    this.#currentEditor._reportTelemetry({\n      action: \"pdfjs.image.image_added\",\n      data: {\n        alt_text_modal: true,\n        alt_text_type: altText ? \"present\" : \"empty\",\n      },\n    });\n\n    this.#currentEditor._reportTelemetry({\n      action: \"pdfjs.image.alt_text.save\",\n      data: {\n        alt_text_type: altText ? \"present\" : \"empty\",\n        flow: this.#firstTime ? \"image_add\" : \"alt_text_edit\",\n      },\n    });\n\n    this.#finish();\n  }\n\n  destroy() {\n    this.#uiManager = null; // Avoid re-adding the edit listeners.\n    this.#finish();\n  }\n}\n\nclass ImageAltTextSettings {\n  #aiModelSettings;\n\n  #createModelButton;\n\n  #downloadModelButton;\n\n  #dialog;\n\n  #eventBus;\n\n  #mlManager;\n\n  #overlayManager;\n\n  #showAltTextDialogButton;\n\n  constructor(\n    {\n      dialog,\n      createModelButton,\n      aiModelSettings,\n      learnMore,\n      closeButton,\n      deleteModelButton,\n      downloadModelButton,\n      showAltTextDialogButton,\n    },\n    overlayManager,\n    eventBus,\n    mlManager\n  ) {\n    this.#dialog = dialog;\n    this.#aiModelSettings = aiModelSettings;\n    this.#createModelButton = createModelButton;\n    this.#downloadModelButton = downloadModelButton;\n    this.#showAltTextDialogButton = showAltTextDialogButton;\n    this.#overlayManager = overlayManager;\n    this.#eventBus = eventBus;\n    this.#mlManager = mlManager;\n\n    const { altTextLearnMoreUrl } = mlManager;\n    if (altTextLearnMoreUrl) {\n      learnMore.href = altTextLearnMoreUrl;\n    }\n\n    dialog.addEventListener(\"contextmenu\", noContextMenu);\n\n    createModelButton.addEventListener(\"click\", async e => {\n      const checked = this.#togglePref(\"enableGuessAltText\", e);\n      await mlManager.toggleService(\"altText\", checked);\n      this.#reportTelemetry({\n        type: \"stamp\",\n        action: \"pdfjs.image.alt_text.settings_ai_generation_check\",\n        data: { status: checked },\n      });\n    });\n\n    showAltTextDialogButton.addEventListener(\"click\", e => {\n      const checked = this.#togglePref(\"enableNewAltTextWhenAddingImage\", e);\n      this.#reportTelemetry({\n        type: \"stamp\",\n        action: \"pdfjs.image.alt_text.settings_edit_alt_text_check\",\n        data: { status: checked },\n      });\n    });\n\n    deleteModelButton.addEventListener(\"click\", this.#delete.bind(this, true));\n    downloadModelButton.addEventListener(\n      \"click\",\n      this.#download.bind(this, true)\n    );\n\n    closeButton.addEventListener(\"click\", this.#finish.bind(this));\n\n    learnMore.addEventListener(\"click\", () => {\n      this.#reportTelemetry({\n        type: \"stamp\",\n        action: \"pdfjs.image.alt_text.info\",\n        data: { topic: \"ai_generation\" },\n      });\n    });\n\n    eventBus._on(\"enablealttextmodeldownload\", ({ value }) => {\n      if (value) {\n        this.#download(false);\n      } else {\n        this.#delete(false);\n      }\n    });\n\n    this.#overlayManager.register(dialog);\n  }\n\n  #reportTelemetry(data) {\n    this.#eventBus.dispatch(\"reporttelemetry\", {\n      source: this,\n      details: {\n        type: \"editing\",\n        data,\n      },\n    });\n  }\n\n  async #download(isFromUI = false) {\n    if (isFromUI) {\n      this.#downloadModelButton.disabled = true;\n      const span = this.#downloadModelButton.firstChild;\n      span.setAttribute(\n        \"data-l10n-id\",\n        \"pdfjs-editor-alt-text-settings-downloading-model-button\"\n      );\n\n      await this.#mlManager.downloadModel(\"altText\");\n\n      span.setAttribute(\n        \"data-l10n-id\",\n        \"pdfjs-editor-alt-text-settings-download-model-button\"\n      );\n\n      this.#createModelButton.disabled = false;\n      this.#setPref(\"enableGuessAltText\", true);\n      this.#mlManager.toggleService(\"altText\", true);\n      this.#setPref(\"enableAltTextModelDownload\", true);\n      this.#downloadModelButton.disabled = false;\n    }\n\n    this.#aiModelSettings.classList.toggle(\"download\", false);\n    this.#createModelButton.setAttribute(\"aria-pressed\", true);\n  }\n\n  async #delete(isFromUI = false) {\n    if (isFromUI) {\n      await this.#mlManager.deleteModel(\"altText\");\n      this.#setPref(\"enableGuessAltText\", false);\n      this.#setPref(\"enableAltTextModelDownload\", false);\n    }\n\n    this.#aiModelSettings.classList.toggle(\"download\", true);\n    this.#createModelButton.disabled = true;\n    this.#createModelButton.setAttribute(\"aria-pressed\", false);\n  }\n\n  async open({ enableGuessAltText, enableNewAltTextWhenAddingImage }) {\n    const { enableAltTextModelDownload } = this.#mlManager;\n    this.#createModelButton.disabled = !enableAltTextModelDownload;\n    this.#createModelButton.setAttribute(\n      \"aria-pressed\",\n      enableAltTextModelDownload && enableGuessAltText\n    );\n    this.#showAltTextDialogButton.setAttribute(\n      \"aria-pressed\",\n      enableNewAltTextWhenAddingImage\n    );\n    this.#aiModelSettings.classList.toggle(\n      \"download\",\n      !enableAltTextModelDownload\n    );\n\n    await this.#overlayManager.open(this.#dialog);\n    this.#reportTelemetry({\n      type: \"stamp\",\n      action: \"pdfjs.image.alt_text.settings_displayed\",\n    });\n  }\n\n  #togglePref(name, { target }) {\n    const checked = target.getAttribute(\"aria-pressed\") !== \"true\";\n    this.#setPref(name, checked);\n    target.setAttribute(\"aria-pressed\", checked);\n    return checked;\n  }\n\n  #setPref(name, value) {\n    this.#eventBus.dispatch(\"setpreference\", {\n      source: this,\n      name,\n      value,\n    });\n  }\n\n  #finish() {\n    if (this.#overlayManager.active === this.#dialog) {\n      this.#overlayManager.close(this.#dialog);\n    }\n  }\n}\n\nexport { ImageAltTextSettings, NewAltTextManager };\n","/* Copyright 2023 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { DOMSVGFactory } from \"pdfjs-lib\";\n\nclass AltTextManager {\n  #clickAC = null;\n\n  #currentEditor = null;\n\n  #cancelButton;\n\n  #dialog;\n\n  #eventBus;\n\n  #hasUsedPointer = false;\n\n  #optionDescription;\n\n  #optionDecorative;\n\n  #overlayManager;\n\n  #saveButton;\n\n  #textarea;\n\n  #uiManager;\n\n  #previousAltText = null;\n\n  #resizeAC = null;\n\n  #svgElement = null;\n\n  #rectElement = null;\n\n  #container;\n\n  #telemetryData = null;\n\n  constructor(\n    {\n      dialog,\n      optionDescription,\n      optionDecorative,\n      textarea,\n      cancelButton,\n      saveButton,\n    },\n    container,\n    overlayManager,\n    eventBus\n  ) {\n    this.#dialog = dialog;\n    this.#optionDescription = optionDescription;\n    this.#optionDecorative = optionDecorative;\n    this.#textarea = textarea;\n    this.#cancelButton = cancelButton;\n    this.#saveButton = saveButton;\n    this.#overlayManager = overlayManager;\n    this.#eventBus = eventBus;\n    this.#container = container;\n\n    const onUpdateUIState = this.#updateUIState.bind(this);\n\n    dialog.addEventListener(\"close\", this.#close.bind(this));\n    dialog.addEventListener(\"contextmenu\", event => {\n      if (event.target !== this.#textarea) {\n        event.preventDefault();\n      }\n    });\n    cancelButton.addEventListener(\"click\", this.#finish.bind(this));\n    saveButton.addEventListener(\"click\", this.#save.bind(this));\n    optionDescription.addEventListener(\"change\", onUpdateUIState);\n    optionDecorative.addEventListener(\"change\", onUpdateUIState);\n\n    this.#overlayManager.register(dialog);\n  }\n\n  #createSVGElement() {\n    if (this.#svgElement) {\n      return;\n    }\n\n    // We create a mask to add to the dialog backdrop: the idea is to have a\n    // darken background everywhere except on the editor to clearly see the\n    // picture to describe.\n\n    const svgFactory = new DOMSVGFactory();\n    const svg = (this.#svgElement = svgFactory.createElement(\"svg\"));\n    svg.setAttribute(\"width\", \"0\");\n    svg.setAttribute(\"height\", \"0\");\n    const defs = svgFactory.createElement(\"defs\");\n    svg.append(defs);\n    const mask = svgFactory.createElement(\"mask\");\n    defs.append(mask);\n    mask.setAttribute(\"id\", \"alttext-manager-mask\");\n    mask.setAttribute(\"maskContentUnits\", \"objectBoundingBox\");\n    let rect = svgFactory.createElement(\"rect\");\n    mask.append(rect);\n    rect.setAttribute(\"fill\", \"white\");\n    rect.setAttribute(\"width\", \"1\");\n    rect.setAttribute(\"height\", \"1\");\n    rect.setAttribute(\"x\", \"0\");\n    rect.setAttribute(\"y\", \"0\");\n\n    rect = this.#rectElement = svgFactory.createElement(\"rect\");\n    mask.append(rect);\n    rect.setAttribute(\"fill\", \"black\");\n    this.#dialog.append(svg);\n  }\n\n  async editAltText(uiManager, editor) {\n    if (this.#currentEditor || !editor) {\n      return;\n    }\n    this.#createSVGElement();\n\n    this.#hasUsedPointer = false;\n\n    this.#clickAC = new AbortController();\n    const clickOpts = { signal: this.#clickAC.signal },\n      onClick = this.#onClick.bind(this);\n    for (const element of [\n      this.#optionDescription,\n      this.#optionDecorative,\n      this.#textarea,\n      this.#saveButton,\n      this.#cancelButton,\n    ]) {\n      element.addEventListener(\"click\", onClick, clickOpts);\n    }\n\n    const { altText, decorative } = editor.altTextData;\n    if (decorative === true) {\n      this.#optionDecorative.checked = true;\n      this.#optionDescription.checked = false;\n    } else {\n      this.#optionDecorative.checked = false;\n      this.#optionDescription.checked = true;\n    }\n    this.#previousAltText = this.#textarea.value = altText?.trim() || \"\";\n    this.#updateUIState();\n\n    this.#currentEditor = editor;\n    this.#uiManager = uiManager;\n    this.#uiManager.removeEditListeners();\n\n    this.#resizeAC = new AbortController();\n    this.#eventBus._on(\"resize\", this.#setPosition.bind(this), {\n      signal: this.#resizeAC.signal,\n    });\n\n    try {\n      await this.#overlayManager.open(this.#dialog);\n      this.#setPosition();\n    } catch (ex) {\n      this.#close();\n      throw ex;\n    }\n  }\n\n  #setPosition() {\n    if (!this.#currentEditor) {\n      return;\n    }\n    const dialog = this.#dialog;\n    const { style } = dialog;\n    const {\n      x: containerX,\n      y: containerY,\n      width: containerW,\n      height: containerH,\n    } = this.#container.getBoundingClientRect();\n    const { innerWidth: windowW, innerHeight: windowH } = window;\n    const { width: dialogW, height: dialogH } = dialog.getBoundingClientRect();\n    const { x, y, width, height } = this.#currentEditor.getClientDimensions();\n    const MARGIN = 10;\n    const isLTR = this.#uiManager.direction === \"ltr\";\n\n    const xs = Math.max(x, containerX);\n    const xe = Math.min(x + width, containerX + containerW);\n    const ys = Math.max(y, containerY);\n    const ye = Math.min(y + height, containerY + containerH);\n    this.#rectElement.setAttribute(\"width\", `${(xe - xs) / windowW}`);\n    this.#rectElement.setAttribute(\"height\", `${(ye - ys) / windowH}`);\n    this.#rectElement.setAttribute(\"x\", `${xs / windowW}`);\n    this.#rectElement.setAttribute(\"y\", `${ys / windowH}`);\n\n    let left = null;\n    let top = Math.max(y, 0);\n    top += Math.min(windowH - (top + dialogH), 0);\n\n    if (isLTR) {\n      // Prefer to position the dialog \"after\" (so on the right) the editor.\n      if (x + width + MARGIN + dialogW < windowW) {\n        left = x + width + MARGIN;\n      } else if (x > dialogW + MARGIN) {\n        left = x - dialogW - MARGIN;\n      }\n    } else if (x > dialogW + MARGIN) {\n      left = x - dialogW - MARGIN;\n    } else if (x + width + MARGIN + dialogW < windowW) {\n      left = x + width + MARGIN;\n    }\n\n    if (left === null) {\n      top = null;\n      left = Math.max(x, 0);\n      left += Math.min(windowW - (left + dialogW), 0);\n      if (y > dialogH + MARGIN) {\n        top = y - dialogH - MARGIN;\n      } else if (y + height + MARGIN + dialogH < windowH) {\n        top = y + height + MARGIN;\n      }\n    }\n\n    if (top !== null) {\n      dialog.classList.add(\"positioned\");\n      if (isLTR) {\n        style.left = `${left}px`;\n      } else {\n        style.right = `${windowW - left - dialogW}px`;\n      }\n      style.top = `${top}px`;\n    } else {\n      dialog.classList.remove(\"positioned\");\n      style.left = \"\";\n      style.top = \"\";\n    }\n  }\n\n  #finish() {\n    if (this.#overlayManager.active === this.#dialog) {\n      this.#overlayManager.close(this.#dialog);\n    }\n  }\n\n  #close() {\n    this.#currentEditor._reportTelemetry(\n      this.#telemetryData || {\n        action: \"alt_text_cancel\",\n        alt_text_keyboard: !this.#hasUsedPointer,\n      }\n    );\n    this.#telemetryData = null;\n\n    this.#removeOnClickListeners();\n    this.#uiManager?.addEditListeners();\n    this.#resizeAC?.abort();\n    this.#resizeAC = null;\n    this.#currentEditor.altTextFinish();\n    this.#currentEditor = null;\n    this.#uiManager = null;\n  }\n\n  #updateUIState() {\n    this.#textarea.disabled = this.#optionDecorative.checked;\n  }\n\n  #save() {\n    const altText = this.#textarea.value.trim();\n    const decorative = this.#optionDecorative.checked;\n    this.#currentEditor.altTextData = {\n      altText,\n      decorative,\n    };\n    this.#telemetryData = {\n      action: \"alt_text_save\",\n      alt_text_description: !!altText,\n      alt_text_edit:\n        !!this.#previousAltText && this.#previousAltText !== altText,\n      alt_text_decorative: decorative,\n      alt_text_keyboard: !this.#hasUsedPointer,\n    };\n    this.#finish();\n  }\n\n  #onClick(evt) {\n    if (evt.detail === 0) {\n      return; // The keyboard was used.\n    }\n    this.#hasUsedPointer = true;\n    this.#removeOnClickListeners();\n  }\n\n  #removeOnClickListeners() {\n    this.#clickAC?.abort();\n    this.#clickAC = null;\n  }\n\n  destroy() {\n    this.#uiManager = null; // Avoid re-adding the edit listeners.\n    this.#finish();\n    this.#svgElement?.remove();\n    this.#svgElement = this.#rectElement = null;\n  }\n}\n\nexport { AltTextManager };\n","/* Copyright 2022 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/** @typedef {import(\"./event_utils.js\").EventBus} EventBus */\n\nimport { AnnotationEditorParamsType } from \"pdfjs-lib\";\n\n/**\n * @typedef {Object} AnnotationEditorParamsOptions\n * @property {HTMLInputElement} editorFreeTextFontSize\n * @property {HTMLInputElement} editorFreeTextColor\n * @property {HTMLInputElement} editorInkColor\n * @property {HTMLInputElement} editorInkThickness\n * @property {HTMLInputElement} editorInkOpacity\n * @property {HTMLButtonElement} editorStampAddImage\n * @property {HTMLInputElement} editorFreeHighlightThickness\n * @property {HTMLButtonElement} editorHighlightShowAll\n */\n\nclass AnnotationEditorParams {\n  /**\n   * @param {AnnotationEditorParamsOptions} options\n   * @param {EventBus} eventBus\n   */\n  constructor(options, eventBus) {\n    this.eventBus = eventBus;\n    this.#bindListeners(options);\n  }\n\n  /**\n   * @param {AnnotationEditorParamsOptions} options\n   */\n  #bindListeners({\n    editorFreeTextFontSize,\n    editorFreeTextColor,\n    editorInkColor,\n    editorInkThickness,\n    editorInkOpacity,\n    editorStampAddImage,\n    editorFreeHighlightThickness,\n    editorHighlightShowAll,\n  }) {\n    const dispatchEvent = (typeStr, value) => {\n      this.eventBus.dispatch(\"switchannotationeditorparams\", {\n        source: this,\n        type: AnnotationEditorParamsType[typeStr],\n        value,\n      });\n    };\n    editorFreeTextFontSize.addEventListener(\"input\", function () {\n      dispatchEvent(\"FREETEXT_SIZE\", this.valueAsNumber);\n    });\n    editorFreeTextColor.addEventListener(\"input\", function () {\n      dispatchEvent(\"FREETEXT_COLOR\", this.value);\n    });\n    editorInkColor.addEventListener(\"input\", function () {\n      dispatchEvent(\"INK_COLOR\", this.value);\n    });\n    editorInkThickness.addEventListener(\"input\", function () {\n      dispatchEvent(\"INK_THICKNESS\", this.valueAsNumber);\n    });\n    editorInkOpacity.addEventListener(\"input\", function () {\n      dispatchEvent(\"INK_OPACITY\", this.valueAsNumber);\n    });\n    editorStampAddImage.addEventListener(\"click\", () => {\n      this.eventBus.dispatch(\"reporttelemetry\", {\n        source: this,\n        details: {\n          type: \"editing\",\n          data: { action: \"pdfjs.image.add_image_click\" },\n        },\n      });\n      dispatchEvent(\"CREATE\");\n    });\n    editorFreeHighlightThickness.addEventListener(\"input\", function () {\n      dispatchEvent(\"HIGHLIGHT_THICKNESS\", this.valueAsNumber);\n    });\n    editorHighlightShowAll.addEventListener(\"click\", function () {\n      const checked = this.getAttribute(\"aria-pressed\") === \"true\";\n      this.setAttribute(\"aria-pressed\", !checked);\n      dispatchEvent(\"HIGHLIGHT_SHOW_ALL\", !checked);\n    });\n\n    this.eventBus._on(\"annotationeditorparamschanged\", evt => {\n      for (const [type, value] of evt.details) {\n        switch (type) {\n          case AnnotationEditorParamsType.FREETEXT_SIZE:\n            editorFreeTextFontSize.value = value;\n            break;\n          case AnnotationEditorParamsType.FREETEXT_COLOR:\n            editorFreeTextColor.value = value;\n            break;\n          case AnnotationEditorParamsType.INK_COLOR:\n            editorInkColor.value = value;\n            break;\n          case AnnotationEditorParamsType.INK_THICKNESS:\n            editorInkThickness.value = value;\n            break;\n          case AnnotationEditorParamsType.INK_OPACITY:\n            editorInkOpacity.value = value;\n            break;\n          case AnnotationEditorParamsType.HIGHLIGHT_THICKNESS:\n            editorFreeHighlightThickness.value = value;\n            break;\n          case AnnotationEditorParamsType.HIGHLIGHT_FREE:\n            editorFreeHighlightThickness.disabled = !value;\n            break;\n          case AnnotationEditorParamsType.HIGHLIGHT_SHOW_ALL:\n            editorHighlightShowAll.setAttribute(\"aria-pressed\", value);\n            break;\n        }\n      }\n    });\n  }\n}\n\nexport { AnnotationEditorParams };\n","/* Copyright 2024 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n// Used to compare floats: there is no exact equality due to rounding errors.\nconst PRECISION = 1e-1;\n\nclass CaretBrowsingMode {\n  #mainContainer;\n\n  #toolBarHeight = 0;\n\n  #viewerContainer;\n\n  constructor(abortSignal, mainContainer, viewerContainer, toolbarContainer) {\n    this.#mainContainer = mainContainer;\n    this.#viewerContainer = viewerContainer;\n\n    if (!toolbarContainer) {\n      return;\n    }\n    this.#toolBarHeight = toolbarContainer.getBoundingClientRect().height;\n\n    const toolbarObserver = new ResizeObserver(entries => {\n      for (const entry of entries) {\n        if (entry.target === toolbarContainer) {\n          this.#toolBarHeight = Math.floor(entry.borderBoxSize[0].blockSize);\n          break;\n        }\n      }\n    });\n    toolbarObserver.observe(toolbarContainer);\n\n    abortSignal.addEventListener(\"abort\", () => toolbarObserver.disconnect(), {\n      once: true,\n    });\n  }\n\n  /**\n   * Return true if the two rectangles are on the same line.\n   * @param {DOMRect} rect1\n   * @param {DOMRect} rect2\n   * @returns {boolean}\n   */\n  #isOnSameLine(rect1, rect2) {\n    const top1 = rect1.y;\n    const bot1 = rect1.bottom;\n    const mid1 = rect1.y + rect1.height / 2;\n\n    const top2 = rect2.y;\n    const bot2 = rect2.bottom;\n    const mid2 = rect2.y + rect2.height / 2;\n\n    return (top1 <= mid2 && mid2 <= bot1) || (top2 <= mid1 && mid1 <= bot2);\n  }\n\n  /**\n   * Return `true` if the rectangle is:\n   *  - under the caret when `isUp === false`.\n   *  - over the caret when `isUp === true`.\n   * @param {DOMRect} rect\n   * @param {number} x\n   * @param {number} y\n   * @param {boolean} isUp\n   * @returns {boolean}\n   */\n  #isUnderOver(rect, x, y, isUp) {\n    const midY = rect.y + rect.height / 2;\n    return (\n      (isUp ? y >= midY : y <= midY) &&\n      rect.x - PRECISION <= x &&\n      x <= rect.right + PRECISION\n    );\n  }\n\n  /**\n   * Check if the rectangle is visible.\n   * @param {DOMRect} rect\n   * @returns {boolean}\n   */\n  #isVisible(rect) {\n    return (\n      rect.top >= this.#toolBarHeight &&\n      rect.left >= 0 &&\n      rect.bottom <=\n        (window.innerHeight || document.documentElement.clientHeight) &&\n      rect.right <= (window.innerWidth || document.documentElement.clientWidth)\n    );\n  }\n\n  /**\n   * Get the position of the caret.\n   * @param {Selection} selection\n   * @param {boolean} isUp\n   * @returns {Array<number>}\n   */\n  #getCaretPosition(selection, isUp) {\n    const { focusNode, focusOffset } = selection;\n    const range = document.createRange();\n    range.setStart(focusNode, focusOffset);\n    range.setEnd(focusNode, focusOffset);\n    const rect = range.getBoundingClientRect();\n\n    return [rect.x, isUp ? rect.top : rect.bottom];\n  }\n\n  static #caretPositionFromPoint(x, y) {\n    if (\n      (typeof PDFJSDev === \"undefined\" || !PDFJSDev.test(\"MOZCENTRAL\")) &&\n      !document.caretPositionFromPoint\n    ) {\n      const { startContainer: offsetNode, startOffset: offset } =\n        document.caretRangeFromPoint(x, y);\n      return { offsetNode, offset };\n    }\n    return document.caretPositionFromPoint(x, y);\n  }\n\n  #setCaretPositionHelper(selection, caretX, select, element, rect) {\n    rect ||= element.getBoundingClientRect();\n    if (caretX <= rect.x + PRECISION) {\n      if (select) {\n        selection.extend(element.firstChild, 0);\n      } else {\n        selection.setPosition(element.firstChild, 0);\n      }\n      return;\n    }\n    if (rect.right - PRECISION <= caretX) {\n      const { lastChild } = element;\n      if (select) {\n        selection.extend(lastChild, lastChild.length);\n      } else {\n        selection.setPosition(lastChild, lastChild.length);\n      }\n      return;\n    }\n\n    const midY = rect.y + rect.height / 2;\n    let caretPosition = CaretBrowsingMode.#caretPositionFromPoint(caretX, midY);\n    let parentElement = caretPosition.offsetNode?.parentElement;\n    if (parentElement && parentElement !== element) {\n      // There is an element on top of the one in the text layer, so we\n      // need to hide all the elements (except the one in the text layer)\n      // at this position in order to get the correct caret position.\n      const elementsAtPoint = document.elementsFromPoint(caretX, midY);\n      const savedVisibilities = [];\n      for (const el of elementsAtPoint) {\n        if (el === element) {\n          break;\n        }\n        const { style } = el;\n        savedVisibilities.push([el, style.visibility]);\n        style.visibility = \"hidden\";\n      }\n      caretPosition = CaretBrowsingMode.#caretPositionFromPoint(caretX, midY);\n      parentElement = caretPosition.offsetNode?.parentElement;\n      for (const [el, visibility] of savedVisibilities) {\n        el.style.visibility = visibility;\n      }\n    }\n    if (parentElement !== element) {\n      // The element targeted by caretPositionFromPoint isn't in the text\n      // layer.\n      if (select) {\n        selection.extend(element.firstChild, 0);\n      } else {\n        selection.setPosition(element.firstChild, 0);\n      }\n      return;\n    }\n    if (select) {\n      selection.extend(caretPosition.offsetNode, caretPosition.offset);\n    } else {\n      selection.setPosition(caretPosition.offsetNode, caretPosition.offset);\n    }\n  }\n\n  /**\n   * Set the caret position or extend the selection (it depends on the select\n   * parameter).\n   * @param {boolean} select\n   * @param {Selection} selection\n   * @param {Element} newLineElement\n   * @param {DOMRect} newLineElementRect\n   * @param {number} caretX\n   */\n  #setCaretPosition(\n    select,\n    selection,\n    newLineElement,\n    newLineElementRect,\n    caretX\n  ) {\n    if (this.#isVisible(newLineElementRect)) {\n      this.#setCaretPositionHelper(\n        selection,\n        caretX,\n        select,\n        newLineElement,\n        newLineElementRect\n      );\n      return;\n    }\n    this.#mainContainer.addEventListener(\n      \"scrollend\",\n      this.#setCaretPositionHelper.bind(\n        this,\n        selection,\n        caretX,\n        select,\n        newLineElement,\n        null\n      ),\n      { once: true }\n    );\n    newLineElement.scrollIntoView();\n  }\n\n  /**\n   * Get the node on the next page.\n   * @param {Element} textLayer\n   * @param {boolean} isUp\n   * @returns {Node}\n   */\n  #getNodeOnNextPage(textLayer, isUp) {\n    while (true) {\n      const page = textLayer.closest(\".page\");\n      const pageNumber = parseInt(page.getAttribute(\"data-page-number\"));\n      const nextPage = isUp ? pageNumber - 1 : pageNumber + 1;\n      textLayer = this.#viewerContainer.querySelector(\n        `.page[data-page-number=\"${nextPage}\"] .textLayer`\n      );\n      if (!textLayer) {\n        return null;\n      }\n      const walker = document.createTreeWalker(textLayer, NodeFilter.SHOW_TEXT);\n      const node = isUp ? walker.lastChild() : walker.firstChild();\n      if (node) {\n        return node;\n      }\n    }\n  }\n\n  /**\n   * Move the caret in the given direction.\n   * @param {boolean} isUp\n   * @param {boolean} select\n   */\n  moveCaret(isUp, select) {\n    const selection = document.getSelection();\n    if (selection.rangeCount === 0) {\n      return;\n    }\n    const { focusNode } = selection;\n    const focusElement =\n      focusNode.nodeType !== Node.ELEMENT_NODE\n        ? focusNode.parentElement\n        : focusNode;\n    const root = focusElement.closest(\".textLayer\");\n    if (!root) {\n      return;\n    }\n    const walker = document.createTreeWalker(root, NodeFilter.SHOW_TEXT);\n    walker.currentNode = focusNode;\n\n    // Move to the next element which is not on the same line as the focus\n    // element.\n    const focusRect = focusElement.getBoundingClientRect();\n    let newLineElement = null;\n    const nodeIterator = (\n      isUp ? walker.previousSibling : walker.nextSibling\n    ).bind(walker);\n    while (nodeIterator()) {\n      const element = walker.currentNode.parentElement;\n      if (!this.#isOnSameLine(focusRect, element.getBoundingClientRect())) {\n        newLineElement = element;\n        break;\n      }\n    }\n\n    if (!newLineElement) {\n      // Need to find the next line on the next page.\n      const node = this.#getNodeOnNextPage(root, isUp);\n      if (!node) {\n        return;\n      }\n      if (select) {\n        const lastNode =\n          (isUp ? walker.firstChild() : walker.lastChild()) || focusNode;\n        selection.extend(lastNode, isUp ? 0 : lastNode.length);\n        const range = document.createRange();\n        range.setStart(node, isUp ? node.length : 0);\n        range.setEnd(node, isUp ? node.length : 0);\n        selection.addRange(range);\n        return;\n      }\n      const [caretX] = this.#getCaretPosition(selection, isUp);\n      const { parentElement } = node;\n      this.#setCaretPosition(\n        select,\n        selection,\n        parentElement,\n        parentElement.getBoundingClientRect(),\n        caretX\n      );\n      return;\n    }\n\n    // We've a candidate for the next line now we want to find the first element\n    // which is under/over the caret.\n    const [caretX, caretY] = this.#getCaretPosition(selection, isUp);\n    const newLineElementRect = newLineElement.getBoundingClientRect();\n\n    // Maybe the element on the new line is a valid candidate.\n    if (this.#isUnderOver(newLineElementRect, caretX, caretY, isUp)) {\n      this.#setCaretPosition(\n        select,\n        selection,\n        newLineElement,\n        newLineElementRect,\n        caretX\n      );\n      return;\n    }\n\n    while (nodeIterator()) {\n      // Search an element on the same line as newLineElement\n      // which could be under/over the caret.\n      const element = walker.currentNode.parentElement;\n      const elementRect = element.getBoundingClientRect();\n      if (!this.#isOnSameLine(newLineElementRect, elementRect)) {\n        break;\n      }\n      if (this.#isUnderOver(elementRect, caretX, caretY, isUp)) {\n        // We found the element.\n        this.#setCaretPosition(select, selection, element, elementRect, caretX);\n        return;\n      }\n    }\n\n    // No element has been found so just put the caret on the element on the new\n    // line.\n    this.#setCaretPosition(\n      select,\n      selection,\n      newLineElement,\n      newLineElementRect,\n      caretX\n    );\n  }\n}\n\nexport { CaretBrowsingMode };\n","/* Copyright 2013 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/** @typedef {import(\"./interfaces\").IDownloadManager} IDownloadManager */\n\nimport { createValidAbsoluteUrl, isPdfFile } from \"pdfjs-lib\";\n\nif (typeof PDFJSDev !== \"undefined\" && !PDFJSDev.test(\"CHROME || GENERIC\")) {\n  throw new Error(\n    'Module \"pdfjs-web/download_manager\" shall not be used ' +\n      \"outside CHROME and GENERIC builds.\"\n  );\n}\n\nfunction download(blobUrl, filename) {\n  const a = document.createElement(\"a\");\n  if (!a.click) {\n    throw new Error('DownloadManager: \"a.click()\" is not supported.');\n  }\n  a.href = blobUrl;\n  a.target = \"_parent\";\n  // Use a.download if available. This increases the likelihood that\n  // the file is downloaded instead of opened by another PDF plugin.\n  if (\"download\" in a) {\n    a.download = filename;\n  }\n  // <a> must be in the document for recent Firefox versions,\n  // otherwise .click() is ignored.\n  (document.body || document.documentElement).append(a);\n  a.click();\n  a.remove();\n}\n\n/**\n * @implements {IDownloadManager}\n */\nclass DownloadManager {\n  #openBlobUrls = new WeakMap();\n\n  downloadData(data, filename, contentType) {\n    const blobUrl = URL.createObjectURL(\n      new Blob([data], { type: contentType })\n    );\n    download(blobUrl, filename);\n  }\n\n  /**\n   * @returns {boolean} Indicating if the data was opened.\n   */\n  openOrDownloadData(data, filename, dest = null) {\n    const isPdfData = isPdfFile(filename);\n    const contentType = isPdfData ? \"application/pdf\" : \"\";\n\n    if (\n      (typeof PDFJSDev === \"undefined\" || !PDFJSDev.test(\"COMPONENTS\")) &&\n      isPdfData\n    ) {\n      let blobUrl = this.#openBlobUrls.get(data);\n      if (!blobUrl) {\n        blobUrl = URL.createObjectURL(new Blob([data], { type: contentType }));\n        this.#openBlobUrls.set(data, blobUrl);\n      }\n      let viewerUrl;\n      if (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"GENERIC\")) {\n        // The current URL is the viewer, let's use it and append the file.\n        viewerUrl = \"?file=\" + encodeURIComponent(blobUrl + \"#\" + filename);\n      } else if (PDFJSDev.test(\"CHROME\")) {\n        // In the Chrome extension, the URL is rewritten using the history API\n        // in viewer.js, so an absolute URL must be generated.\n        viewerUrl =\n          // eslint-disable-next-line no-undef\n          chrome.runtime.getURL(\"/content/web/viewer.html\") +\n          \"?file=\" +\n          encodeURIComponent(blobUrl + \"#\" + filename);\n      }\n      if (dest) {\n        viewerUrl += `#${escape(dest)}`;\n      }\n\n      try {\n        window.open(viewerUrl);\n        return true;\n      } catch (ex) {\n        console.error(`openOrDownloadData: ${ex}`);\n        // Release the `blobUrl`, since opening it failed, and fallback to\n        // downloading the PDF file.\n        URL.revokeObjectURL(blobUrl);\n        this.#openBlobUrls.delete(data);\n      }\n    }\n\n    this.downloadData(data, filename, contentType);\n    return false;\n  }\n\n  download(data, url, filename) {\n    let blobUrl;\n    if (data) {\n      blobUrl = URL.createObjectURL(\n        new Blob([data], { type: \"application/pdf\" })\n      );\n    } else {\n      if (!createValidAbsoluteUrl(url, \"http://example.com\")) {\n        console.error(`download - not a valid URL: ${url}`);\n        return;\n      }\n      blobUrl = url + \"#pdfjs.action=download\";\n    }\n    download(blobUrl, filename);\n  }\n}\n\nexport { DownloadManager };\n","/* Copyright 2014 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nclass OverlayManager {\n  #overlays = new WeakMap();\n\n  #active = null;\n\n  get active() {\n    return this.#active;\n  }\n\n  /**\n   * @param {HTMLDialogElement} dialog - The overlay's DOM element.\n   * @param {boolean} [canForceClose] - Indicates if opening the overlay closes\n   *                  an active overlay. The default is `false`.\n   * @returns {Promise} A promise that is resolved when the overlay has been\n   *                    registered.\n   */\n  async register(dialog, canForceClose = false) {\n    if (typeof dialog !== \"object\") {\n      throw new Error(\"Not enough parameters.\");\n    } else if (this.#overlays.has(dialog)) {\n      throw new Error(\"The overlay is already registered.\");\n    }\n    this.#overlays.set(dialog, { canForceClose });\n\n    dialog.addEventListener(\"cancel\", evt => {\n      this.#active = null;\n    });\n  }\n\n  /**\n   * @param {HTMLDialogElement} dialog - The overlay's DOM element.\n   * @returns {Promise} A promise that is resolved when the overlay has been\n   *                    opened.\n   */\n  async open(dialog) {\n    if (!this.#overlays.has(dialog)) {\n      throw new Error(\"The overlay does not exist.\");\n    } else if (this.#active) {\n      if (this.#active === dialog) {\n        throw new Error(\"The overlay is already active.\");\n      } else if (this.#overlays.get(dialog).canForceClose) {\n        await this.close();\n      } else {\n        throw new Error(\"Another overlay is currently active.\");\n      }\n    }\n    this.#active = dialog;\n    dialog.showModal();\n  }\n\n  /**\n   * @param {HTMLDialogElement} dialog - The overlay's DOM element.\n   * @returns {Promise} A promise that is resolved when the overlay has been\n   *                    closed.\n   */\n  async close(dialog = this.#active) {\n    if (!this.#overlays.has(dialog)) {\n      throw new Error(\"The overlay does not exist.\");\n    } else if (!this.#active) {\n      throw new Error(\"The overlay is currently not active.\");\n    } else if (this.#active !== dialog) {\n      throw new Error(\"Another overlay is currently active.\");\n    }\n    dialog.close();\n    this.#active = null;\n  }\n}\n\nexport { OverlayManager };\n","/* Copyright 2012 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/** @typedef {import(\"./overlay_manager.js\").OverlayManager} OverlayManager */\n\nimport { PasswordResponses } from \"pdfjs-lib\";\n\n/**\n * @typedef {Object} PasswordPromptOptions\n * @property {HTMLDialogElement} dialog - The overlay's DOM element.\n * @property {HTMLParagraphElement} label - Label containing instructions for\n *                                          entering the password.\n * @property {HTMLInputElement} input - Input field for entering the password.\n * @property {HTMLButtonElement} submitButton - Button for submitting the\n *                                              password.\n * @property {HTMLButtonElement} cancelButton - Button for cancelling password\n *                                              entry.\n */\n\nclass PasswordPrompt {\n  #activeCapability = null;\n\n  #updateCallback = null;\n\n  #reason = null;\n\n  /**\n   * @param {PasswordPromptOptions} options\n   * @param {OverlayManager} overlayManager - Manager for the viewer overlays.\n   * @param {boolean} [isViewerEmbedded] - If the viewer is embedded, in e.g.\n   *   an <iframe> or an <object>. The default value is `false`.\n   */\n  constructor(options, overlayManager, isViewerEmbedded = false) {\n    this.dialog = options.dialog;\n    this.label = options.label;\n    this.input = options.input;\n    this.submitButton = options.submitButton;\n    this.cancelButton = options.cancelButton;\n    this.overlayManager = overlayManager;\n    this._isViewerEmbedded = isViewerEmbedded;\n\n    // Attach the event listeners.\n    this.submitButton.addEventListener(\"click\", this.#verify.bind(this));\n    this.cancelButton.addEventListener(\"click\", this.close.bind(this));\n    this.input.addEventListener(\"keydown\", e => {\n      if (e.keyCode === /* Enter = */ 13) {\n        this.#verify();\n      }\n    });\n\n    this.overlayManager.register(this.dialog, /* canForceClose = */ true);\n\n    this.dialog.addEventListener(\"close\", this.#cancel.bind(this));\n  }\n\n  async open() {\n    await this.#activeCapability?.promise;\n    this.#activeCapability = Promise.withResolvers();\n\n    try {\n      await this.overlayManager.open(this.dialog);\n    } catch (ex) {\n      this.#activeCapability.resolve();\n      throw ex;\n    }\n\n    const passwordIncorrect =\n      this.#reason === PasswordResponses.INCORRECT_PASSWORD;\n\n    if (!this._isViewerEmbedded || passwordIncorrect) {\n      this.input.focus();\n    }\n    this.label.setAttribute(\n      \"data-l10n-id\",\n      passwordIncorrect ? \"pdfjs-password-invalid\" : \"pdfjs-password-label\"\n    );\n  }\n\n  async close() {\n    if (this.overlayManager.active === this.dialog) {\n      this.overlayManager.close(this.dialog);\n    }\n  }\n\n  #verify() {\n    const password = this.input.value;\n    if (password?.length > 0) {\n      this.#invokeCallback(password);\n    }\n  }\n\n  #cancel() {\n    this.#invokeCallback(new Error(\"PasswordPrompt cancelled.\"));\n    this.#activeCapability.resolve();\n  }\n\n  #invokeCallback(password) {\n    if (!this.#updateCallback) {\n      return; // Ensure that the callback is only invoked once.\n    }\n    this.close();\n    this.input.value = \"\";\n\n    this.#updateCallback(password);\n    this.#updateCallback = null;\n  }\n\n  async setUpdateCallback(updateCallback, reason) {\n    if (this.#activeCapability) {\n      await this.#activeCapability.promise;\n    }\n    this.#updateCallback = updateCallback;\n    this.#reason = reason;\n  }\n}\n\nexport { PasswordPrompt };\n","/* Copyright 2020 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { removeNullCharacters } from \"./ui_utils.js\";\n\nconst TREEITEM_OFFSET_TOP = -100; // px\nconst TREEITEM_SELECTED_CLASS = \"selected\";\n\nclass BaseTreeViewer {\n  constructor(options) {\n    if (\n      (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"TESTING\")) &&\n      this.constructor === BaseTreeViewer\n    ) {\n      throw new Error(\"Cannot initialize BaseTreeViewer.\");\n    }\n    this.container = options.container;\n    this.eventBus = options.eventBus;\n    this._l10n = options.l10n;\n\n    this.reset();\n  }\n\n  reset() {\n    this._pdfDocument = null;\n    this._lastToggleIsShow = true;\n    this._currentTreeItem = null;\n\n    // Remove the tree from the DOM.\n    this.container.textContent = \"\";\n    // Ensure that the left (right in RTL locales) margin is always reset,\n    // to prevent incorrect tree alignment if a new document is opened.\n    this.container.classList.remove(\"treeWithDeepNesting\");\n  }\n\n  /**\n   * @protected\n   */\n  _dispatchEvent(count) {\n    throw new Error(\"Not implemented: _dispatchEvent\");\n  }\n\n  /**\n   * @protected\n   */\n  _bindLink(element, params) {\n    throw new Error(\"Not implemented: _bindLink\");\n  }\n\n  /**\n   * @private\n   */\n  _normalizeTextContent(str) {\n    // Chars in range [0x01-0x1F] will be replaced with a white space\n    // and 0x00 by \"\".\n    return (\n      removeNullCharacters(str, /* replaceInvisible */ true) ||\n      /* en dash = */ \"\\u2013\"\n    );\n  }\n\n  /**\n   * Prepend a button before a tree item which allows the user to collapse or\n   * expand all tree items at that level; see `_toggleTreeItem`.\n   * @param {HTMLDivElement} div\n   * @param {boolean|object} [hidden]\n   * @protected\n   */\n  _addToggleButton(div, hidden = false) {\n    const toggler = document.createElement(\"div\");\n    toggler.className = \"treeItemToggler\";\n    if (hidden) {\n      toggler.classList.add(\"treeItemsHidden\");\n    }\n    toggler.onclick = evt => {\n      evt.stopPropagation();\n      toggler.classList.toggle(\"treeItemsHidden\");\n\n      if (evt.shiftKey) {\n        const shouldShowAll = !toggler.classList.contains(\"treeItemsHidden\");\n        this._toggleTreeItem(div, shouldShowAll);\n      }\n    };\n    div.prepend(toggler);\n  }\n\n  /**\n   * Collapse or expand the subtree of a tree item.\n   *\n   * @param {Element} root - the root of the item (sub)tree.\n   * @param {boolean} show - whether to show the item (sub)tree. If false,\n   *   the item subtree rooted at `root` will be collapsed.\n   * @private\n   */\n  _toggleTreeItem(root, show = false) {\n    // Pause translation when collapsing/expanding the subtree.\n    this._l10n.pause();\n\n    this._lastToggleIsShow = show;\n    for (const toggler of root.querySelectorAll(\".treeItemToggler\")) {\n      toggler.classList.toggle(\"treeItemsHidden\", !show);\n    }\n    this._l10n.resume();\n  }\n\n  /**\n   * Collapse or expand all subtrees of the `container`.\n   * @private\n   */\n  _toggleAllTreeItems() {\n    this._toggleTreeItem(this.container, !this._lastToggleIsShow);\n  }\n\n  /**\n   * @private\n   */\n  _finishRendering(fragment, count, hasAnyNesting = false) {\n    if (hasAnyNesting) {\n      this.container.classList.add(\"treeWithDeepNesting\");\n\n      this._lastToggleIsShow = !fragment.querySelector(\".treeItemsHidden\");\n    }\n    // Pause translation when inserting the tree into the DOM.\n    this._l10n.pause();\n    this.container.append(fragment);\n    this._l10n.resume();\n\n    this._dispatchEvent(count);\n  }\n\n  render(params) {\n    throw new Error(\"Not implemented: render\");\n  }\n\n  /**\n   * @private\n   */\n  _updateCurrentTreeItem(treeItem = null) {\n    if (this._currentTreeItem) {\n      // Ensure that the current treeItem-selection is always removed.\n      this._currentTreeItem.classList.remove(TREEITEM_SELECTED_CLASS);\n      this._currentTreeItem = null;\n    }\n    if (treeItem) {\n      treeItem.classList.add(TREEITEM_SELECTED_CLASS);\n      this._currentTreeItem = treeItem;\n    }\n  }\n\n  /**\n   * @private\n   */\n  _scrollToCurrentTreeItem(treeItem) {\n    if (!treeItem) {\n      return;\n    }\n    // Pause translation when expanding the treeItem.\n    this._l10n.pause();\n    // Ensure that the treeItem is *fully* expanded, such that it will first of\n    // all be visible and secondly that scrolling it into view works correctly.\n    let currentNode = treeItem.parentNode;\n    while (currentNode && currentNode !== this.container) {\n      if (currentNode.classList.contains(\"treeItem\")) {\n        const toggler = currentNode.firstElementChild;\n        toggler?.classList.remove(\"treeItemsHidden\");\n      }\n      currentNode = currentNode.parentNode;\n    }\n    this._l10n.resume();\n\n    this._updateCurrentTreeItem(treeItem);\n\n    this.container.scrollTo(\n      treeItem.offsetLeft,\n      treeItem.offsetTop + TREEITEM_OFFSET_TOP\n    );\n  }\n}\n\nexport { BaseTreeViewer };\n","/* Copyright 2012 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/** @typedef {import(\"./event_utils.js\").EventBus} EventBus */\n// eslint-disable-next-line max-len\n/** @typedef {import(\"./download_manager.js\").DownloadManager} DownloadManager */\n\nimport { BaseTreeViewer } from \"./base_tree_viewer.js\";\nimport { waitOnEventOrTimeout } from \"./event_utils.js\";\n\n/**\n * @typedef {Object} PDFAttachmentViewerOptions\n * @property {HTMLDivElement} container - The viewer element.\n * @property {EventBus} eventBus - The application event bus.\n * @property {DownloadManager} downloadManager - The download manager.\n */\n\n/**\n * @typedef {Object} PDFAttachmentViewerRenderParameters\n * @property {Object|null} attachments - A lookup table of attachment objects.\n * @property {boolean} [keepRenderedCapability]\n */\n\nclass PDFAttachmentViewer extends BaseTreeViewer {\n  /**\n   * @param {PDFAttachmentViewerOptions} options\n   */\n  constructor(options) {\n    super(options);\n    this.downloadManager = options.downloadManager;\n\n    this.eventBus._on(\n      \"fileattachmentannotation\",\n      this.#appendAttachment.bind(this)\n    );\n  }\n\n  reset(keepRenderedCapability = false) {\n    super.reset();\n    this._attachments = null;\n\n    if (!keepRenderedCapability) {\n      // The only situation in which the `_renderedCapability` should *not* be\n      // replaced is when appending FileAttachment annotations.\n      this._renderedCapability = Promise.withResolvers();\n    }\n    this._pendingDispatchEvent = false;\n  }\n\n  /**\n   * @protected\n   */\n  async _dispatchEvent(attachmentsCount) {\n    this._renderedCapability.resolve();\n\n    if (attachmentsCount === 0 && !this._pendingDispatchEvent) {\n      // Delay the event when no \"regular\" attachments exist, to allow time for\n      // parsing of any FileAttachment annotations that may be present on the\n      // *initially* rendered page; this reduces the likelihood of temporarily\n      // disabling the attachmentsView when the `PDFSidebar` handles the event.\n      this._pendingDispatchEvent = true;\n\n      await waitOnEventOrTimeout({\n        target: this.eventBus,\n        name: \"annotationlayerrendered\",\n        delay: 1000,\n      });\n\n      if (!this._pendingDispatchEvent) {\n        return; // There was already another `_dispatchEvent`-call`.\n      }\n    }\n    this._pendingDispatchEvent = false;\n\n    this.eventBus.dispatch(\"attachmentsloaded\", {\n      source: this,\n      attachmentsCount,\n    });\n  }\n\n  /**\n   * @protected\n   */\n  _bindLink(element, { content, description, filename }) {\n    if (description) {\n      element.title = description;\n    }\n    element.onclick = () => {\n      this.downloadManager.openOrDownloadData(content, filename);\n      return false;\n    };\n  }\n\n  /**\n   * @param {PDFAttachmentViewerRenderParameters} params\n   */\n  render({ attachments, keepRenderedCapability = false }) {\n    if (this._attachments) {\n      this.reset(keepRenderedCapability);\n    }\n    this._attachments = attachments || null;\n\n    if (!attachments) {\n      this._dispatchEvent(/* attachmentsCount = */ 0);\n      return;\n    }\n\n    const fragment = document.createDocumentFragment();\n    let attachmentsCount = 0;\n    for (const name in attachments) {\n      const item = attachments[name];\n\n      const div = document.createElement(\"div\");\n      div.className = \"treeItem\";\n\n      const element = document.createElement(\"a\");\n      this._bindLink(element, item);\n      element.textContent = this._normalizeTextContent(item.filename);\n\n      div.append(element);\n\n      fragment.append(div);\n      attachmentsCount++;\n    }\n\n    this._finishRendering(fragment, attachmentsCount);\n  }\n\n  /**\n   * Used to append FileAttachment annotations to the sidebar.\n   */\n  #appendAttachment(item) {\n    const renderedPromise = this._renderedCapability.promise;\n\n    renderedPromise.then(() => {\n      if (renderedPromise !== this._renderedCapability.promise) {\n        return; // The FileAttachment annotation belongs to a previous document.\n      }\n      const attachments = this._attachments || Object.create(null);\n\n      for (const name in attachments) {\n        if (item.filename === name) {\n          return; // Ignore the new attachment if it already exists.\n        }\n      }\n      attachments[item.filename] = item;\n\n      this.render({\n        attachments,\n        keepRenderedCapability: true,\n      });\n    });\n  }\n}\n\nexport { PDFAttachmentViewer };\n","/* Copyright 2013 Rob Wu <rob@robwu.nl>\n * https://github.com/Rob--W/grab-to-pan.js\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n// Class name of element which can be grabbed.\nconst CSS_CLASS_GRAB = \"grab-to-pan-grab\";\n\n/**\n * @typedef {Object} GrabToPanOptions\n * @property {HTMLElement} element\n */\n\nclass GrabToPan {\n  #activateAC = null;\n\n  #mouseDownAC = null;\n\n  #scrollAC = null;\n\n  /**\n   * Construct a GrabToPan instance for a given HTML element.\n   * @param {GrabToPanOptions} options\n   */\n  constructor({ element }) {\n    this.element = element;\n    this.document = element.ownerDocument;\n\n    // This overlay will be inserted in the document when the mouse moves during\n    // a grab operation, to ensure that the cursor has the desired appearance.\n    const overlay = (this.overlay = document.createElement(\"div\"));\n    overlay.className = \"grab-to-pan-grabbing\";\n  }\n\n  /**\n   * Bind a mousedown event to the element to enable grab-detection.\n   */\n  activate() {\n    if (!this.#activateAC) {\n      this.#activateAC = new AbortController();\n\n      this.element.addEventListener(\"mousedown\", this.#onMouseDown.bind(this), {\n        capture: true,\n        signal: this.#activateAC.signal,\n      });\n      this.element.classList.add(CSS_CLASS_GRAB);\n    }\n  }\n\n  /**\n   * Removes all events. Any pending pan session is immediately stopped.\n   */\n  deactivate() {\n    if (this.#activateAC) {\n      this.#activateAC.abort();\n      this.#activateAC = null;\n\n      this.#endPan();\n      this.element.classList.remove(CSS_CLASS_GRAB);\n    }\n  }\n\n  toggle() {\n    if (this.#activateAC) {\n      this.deactivate();\n    } else {\n      this.activate();\n    }\n  }\n\n  /**\n   * Whether to not pan if the target element is clicked.\n   * Override this method to change the default behaviour.\n   *\n   * @param {Element} node - The target of the event.\n   * @returns {boolean} Whether to not react to the click event.\n   */\n  ignoreTarget(node) {\n    // Check whether the clicked element is, a child of, an input element/link.\n    return node.matches(\n      \"a[href], a[href] *, input, textarea, button, button *, select, option\"\n    );\n  }\n\n  #onMouseDown(event) {\n    if (event.button !== 0 || this.ignoreTarget(event.target)) {\n      return;\n    }\n    if (event.originalTarget) {\n      try {\n        // eslint-disable-next-line no-unused-expressions\n        event.originalTarget.tagName;\n      } catch {\n        // Mozilla-specific: element is a scrollbar (XUL element)\n        return;\n      }\n    }\n\n    this.scrollLeftStart = this.element.scrollLeft;\n    this.scrollTopStart = this.element.scrollTop;\n    this.clientXStart = event.clientX;\n    this.clientYStart = event.clientY;\n\n    this.#mouseDownAC = new AbortController();\n    const boundEndPan = this.#endPan.bind(this),\n      mouseOpts = { capture: true, signal: this.#mouseDownAC.signal };\n\n    this.document.addEventListener(\n      \"mousemove\",\n      this.#onMouseMove.bind(this),\n      mouseOpts\n    );\n    this.document.addEventListener(\"mouseup\", boundEndPan, mouseOpts);\n    // When a scroll event occurs before a mousemove, assume that the user\n    // dragged a scrollbar (necessary for Opera Presto, Safari and IE)\n    // (not needed for Chrome/Firefox)\n    this.#scrollAC = new AbortController();\n\n    this.element.addEventListener(\"scroll\", boundEndPan, {\n      capture: true,\n      signal: this.#scrollAC.signal,\n    });\n    event.preventDefault();\n    event.stopPropagation();\n\n    const focusedElement = document.activeElement;\n    if (focusedElement && !focusedElement.contains(event.target)) {\n      focusedElement.blur();\n    }\n  }\n\n  #onMouseMove(event) {\n    this.#scrollAC?.abort();\n    this.#scrollAC = null;\n\n    if (!(event.buttons & 1)) {\n      // The left mouse button is released.\n      this.#endPan();\n      return;\n    }\n    const xDiff = event.clientX - this.clientXStart;\n    const yDiff = event.clientY - this.clientYStart;\n    this.element.scrollTo({\n      top: this.scrollTopStart - yDiff,\n      left: this.scrollLeftStart - xDiff,\n      behavior: \"instant\",\n    });\n\n    if (!this.overlay.parentNode) {\n      document.body.append(this.overlay);\n    }\n  }\n\n  #endPan() {\n    this.#mouseDownAC?.abort();\n    this.#mouseDownAC = null;\n    this.#scrollAC?.abort();\n    this.#scrollAC = null;\n    // Note: ChildNode.remove doesn't throw if the parentNode is undefined.\n    this.overlay.remove();\n  }\n}\n\nexport { GrabToPan };\n","/* Copyright 2017 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/** @typedef {import(\"./event_utils.js\").EventBus} EventBus */\n\nimport { AnnotationEditorType, shadow } from \"pdfjs-lib\";\nimport { CursorTool, PresentationModeState } from \"./ui_utils.js\";\nimport { GrabToPan } from \"./grab_to_pan.js\";\n\n/**\n * @typedef {Object} PDFCursorToolsOptions\n * @property {HTMLDivElement} container - The document container.\n * @property {EventBus} eventBus - The application event bus.\n * @property {number} [cursorToolOnLoad] - The cursor tool that will be enabled\n *   on load; the constants from {CursorTool} should be used. The default value\n *   is `CursorTool.SELECT`.\n */\n\nclass PDFCursorTools {\n  #active = CursorTool.SELECT;\n\n  #prevActive = null;\n\n  /**\n   * @param {PDFCursorToolsOptions} options\n   */\n  constructor({ container, eventBus, cursorToolOnLoad = CursorTool.SELECT }) {\n    this.container = container;\n    this.eventBus = eventBus;\n\n    this.#addEventListeners();\n\n    // Defer the initial `switchTool` call, to give other viewer components\n    // time to initialize *and* register 'cursortoolchanged' event listeners.\n    Promise.resolve().then(() => {\n      this.switchTool(cursorToolOnLoad);\n    });\n  }\n\n  /**\n   * @type {number} One of the values in {CursorTool}.\n   */\n  get activeTool() {\n    return this.#active;\n  }\n\n  /**\n   * @param {number} tool - The cursor mode that should be switched to,\n   *                        must be one of the values in {CursorTool}.\n   */\n  switchTool(tool) {\n    if (this.#prevActive !== null) {\n      // Cursor tools cannot be used in PresentationMode/AnnotationEditor.\n      return;\n    }\n    this.#switchTool(tool);\n  }\n\n  #switchTool(tool, disabled = false) {\n    if (tool === this.#active) {\n      if (this.#prevActive !== null) {\n        // Ensure that the `disabled`-attribute of the buttons will be updated.\n        this.eventBus.dispatch(\"cursortoolchanged\", {\n          source: this,\n          tool,\n          disabled,\n        });\n      }\n      return; // The requested tool is already active.\n    }\n\n    const disableActiveTool = () => {\n      switch (this.#active) {\n        case CursorTool.SELECT:\n          break;\n        case CursorTool.HAND:\n          this._handTool.deactivate();\n          break;\n        case CursorTool.ZOOM:\n        /* falls through */\n      }\n    };\n\n    // Enable the new cursor tool.\n    switch (tool) {\n      case CursorTool.SELECT:\n        disableActiveTool();\n        break;\n      case CursorTool.HAND:\n        disableActiveTool();\n        this._handTool.activate();\n        break;\n      case CursorTool.ZOOM:\n      /* falls through */\n      default:\n        console.error(`switchTool: \"${tool}\" is an unsupported value.`);\n        return;\n    }\n    // Update the active tool *after* it has been validated above,\n    // in order to prevent setting it to an invalid state.\n    this.#active = tool;\n\n    this.eventBus.dispatch(\"cursortoolchanged\", {\n      source: this,\n      tool,\n      disabled,\n    });\n  }\n\n  #addEventListeners() {\n    this.eventBus._on(\"switchcursortool\", evt => {\n      if (!evt.reset) {\n        this.switchTool(evt.tool);\n      } else if (this.#prevActive !== null) {\n        annotationEditorMode = AnnotationEditorType.NONE;\n        presentationModeState = PresentationModeState.NORMAL;\n\n        enableActive();\n      }\n    });\n\n    let annotationEditorMode = AnnotationEditorType.NONE,\n      presentationModeState = PresentationModeState.NORMAL;\n\n    const disableActive = () => {\n      this.#prevActive ??= this.#active; // Keep track of the first one.\n      this.#switchTool(CursorTool.SELECT, /* disabled = */ true);\n    };\n    const enableActive = () => {\n      if (\n        this.#prevActive !== null &&\n        annotationEditorMode === AnnotationEditorType.NONE &&\n        presentationModeState === PresentationModeState.NORMAL\n      ) {\n        this.#switchTool(this.#prevActive);\n        this.#prevActive = null;\n      }\n    };\n\n    this.eventBus._on(\"annotationeditormodechanged\", ({ mode }) => {\n      annotationEditorMode = mode;\n\n      if (mode === AnnotationEditorType.NONE) {\n        enableActive();\n      } else {\n        disableActive();\n      }\n    });\n\n    this.eventBus._on(\"presentationmodechanged\", ({ state }) => {\n      presentationModeState = state;\n\n      if (state === PresentationModeState.NORMAL) {\n        enableActive();\n      } else if (state === PresentationModeState.FULLSCREEN) {\n        disableActive();\n      }\n    });\n  }\n\n  /**\n   * @private\n   */\n  get _handTool() {\n    return shadow(\n      this,\n      \"_handTool\",\n      new GrabToPan({\n        element: this.container,\n      })\n    );\n  }\n}\n\nexport { PDFCursorTools };\n","/* Copyright 2012 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/** @typedef {import(\"./event_utils.js\").EventBus} EventBus */\n/** @typedef {import(\"./interfaces.js\").IL10n} IL10n */\n/** @typedef {import(\"./overlay_manager.js\").OverlayManager} OverlayManager */\n// eslint-disable-next-line max-len\n/** @typedef {import(\"../src/display/api.js\").PDFDocumentProxy} PDFDocumentProxy */\n\nimport { getPageSizeInches, isPortraitOrientation } from \"./ui_utils.js\";\nimport { PDFDateString } from \"pdfjs-lib\";\n\n// See https://en.wikibooks.org/wiki/Lentis/Conversion_to_the_Metric_Standard_in_the_United_States\nconst NON_METRIC_LOCALES = [\"en-us\", \"en-lr\", \"my\"];\n\n// Should use the format: `width x height`, in portrait orientation. The names,\n// which are l10n-ids, should be lowercase.\n// See https://en.wikipedia.org/wiki/Paper_size\nconst US_PAGE_NAMES = {\n  \"8.5x11\": \"pdfjs-document-properties-page-size-name-letter\",\n  \"8.5x14\": \"pdfjs-document-properties-page-size-name-legal\",\n};\nconst METRIC_PAGE_NAMES = {\n  \"297x420\": \"pdfjs-document-properties-page-size-name-a-three\",\n  \"210x297\": \"pdfjs-document-properties-page-size-name-a-four\",\n};\n\nfunction getPageName(size, isPortrait, pageNames) {\n  const width = isPortrait ? size.width : size.height;\n  const height = isPortrait ? size.height : size.width;\n\n  return pageNames[`${width}x${height}`];\n}\n\n/**\n * @typedef {Object} PDFDocumentPropertiesOptions\n * @property {HTMLDialogElement} dialog - The overlay's DOM element.\n * @property {Object} fields - Names and elements of the overlay's fields.\n * @property {HTMLButtonElement} closeButton - Button for closing the overlay.\n */\n\nclass PDFDocumentProperties {\n  #fieldData = null;\n\n  /**\n   * @param {PDFDocumentPropertiesOptions} options\n   * @param {OverlayManager} overlayManager - Manager for the viewer overlays.\n   * @param {EventBus} eventBus - The application event bus.\n   * @param {IL10n} l10n - Localization service.\n   * @param {function} fileNameLookup - The function that is used to lookup\n   *   the document fileName.\n   */\n  constructor(\n    { dialog, fields, closeButton },\n    overlayManager,\n    eventBus,\n    l10n,\n    fileNameLookup\n  ) {\n    this.dialog = dialog;\n    this.fields = fields;\n    this.overlayManager = overlayManager;\n    this.l10n = l10n;\n    this._fileNameLookup = fileNameLookup;\n\n    this.#reset();\n    // Bind the event listener for the Close button.\n    closeButton.addEventListener(\"click\", this.close.bind(this));\n\n    this.overlayManager.register(this.dialog);\n\n    eventBus._on(\"pagechanging\", evt => {\n      this._currentPageNumber = evt.pageNumber;\n    });\n    eventBus._on(\"rotationchanging\", evt => {\n      this._pagesRotation = evt.pagesRotation;\n    });\n  }\n\n  /**\n   * Open the document properties overlay.\n   */\n  async open() {\n    await Promise.all([\n      this.overlayManager.open(this.dialog),\n      this._dataAvailableCapability.promise,\n    ]);\n    const currentPageNumber = this._currentPageNumber;\n    const pagesRotation = this._pagesRotation;\n\n    // If the document properties were previously fetched (for this PDF file),\n    // just update the dialog immediately to avoid redundant lookups.\n    if (\n      this.#fieldData &&\n      currentPageNumber === this.#fieldData._currentPageNumber &&\n      pagesRotation === this.#fieldData._pagesRotation\n    ) {\n      this.#updateUI();\n      return;\n    }\n\n    // Get the document properties.\n    const {\n      info,\n      /* metadata, */\n      /* contentDispositionFilename, */\n      contentLength,\n    } = await this.pdfDocument.getMetadata();\n\n    const [\n      fileName,\n      fileSize,\n      creationDate,\n      modificationDate,\n      pageSize,\n      isLinearized,\n    ] = await Promise.all([\n      this._fileNameLookup(),\n      this.#parseFileSize(contentLength),\n      this.#parseDate(info.CreationDate),\n      this.#parseDate(info.ModDate),\n      // eslint-disable-next-line arrow-body-style\n      this.pdfDocument.getPage(currentPageNumber).then(pdfPage => {\n        return this.#parsePageSize(getPageSizeInches(pdfPage), pagesRotation);\n      }),\n      this.#parseLinearization(info.IsLinearized),\n    ]);\n\n    this.#fieldData = Object.freeze({\n      fileName,\n      fileSize,\n      title: info.Title,\n      author: info.Author,\n      subject: info.Subject,\n      keywords: info.Keywords,\n      creationDate,\n      modificationDate,\n      creator: info.Creator,\n      producer: info.Producer,\n      version: info.PDFFormatVersion,\n      pageCount: this.pdfDocument.numPages,\n      pageSize,\n      linearized: isLinearized,\n      _currentPageNumber: currentPageNumber,\n      _pagesRotation: pagesRotation,\n    });\n    this.#updateUI();\n\n    // Get the correct fileSize, since it may not have been available\n    // or could potentially be wrong.\n    const { length } = await this.pdfDocument.getDownloadInfo();\n    if (contentLength === length) {\n      return; // The fileSize has already been correctly set.\n    }\n    const data = Object.assign(Object.create(null), this.#fieldData);\n    data.fileSize = await this.#parseFileSize(length);\n\n    this.#fieldData = Object.freeze(data);\n    this.#updateUI();\n  }\n\n  /**\n   * Close the document properties overlay.\n   */\n  async close() {\n    this.overlayManager.close(this.dialog);\n  }\n\n  /**\n   * Set a reference to the PDF document in order to populate the dialog fields\n   * with the document properties. Note that the dialog will contain no\n   * information if this method is not called.\n   *\n   * @param {PDFDocumentProxy} pdfDocument - A reference to the PDF document.\n   */\n  setDocument(pdfDocument) {\n    if (this.pdfDocument) {\n      this.#reset();\n      this.#updateUI();\n    }\n    if (!pdfDocument) {\n      return;\n    }\n    this.pdfDocument = pdfDocument;\n\n    this._dataAvailableCapability.resolve();\n  }\n\n  #reset() {\n    this.pdfDocument = null;\n\n    this.#fieldData = null;\n    this._dataAvailableCapability = Promise.withResolvers();\n    this._currentPageNumber = 1;\n    this._pagesRotation = 0;\n  }\n\n  /**\n   * Always updates all of the dialog fields, to prevent inconsistent UI state.\n   * NOTE: If the contents of a particular field is neither a non-empty string,\n   *       nor a number, it will fall back to \"-\".\n   */\n  #updateUI() {\n    if (this.#fieldData && this.overlayManager.active !== this.dialog) {\n      // Don't bother updating the dialog if it's already been closed,\n      // unless it's being reset (i.e. `this.#fieldData === null`),\n      // since it will be updated the next time `this.open` is called.\n      return;\n    }\n    for (const id in this.fields) {\n      const content = this.#fieldData?.[id];\n      this.fields[id].textContent = content || content === 0 ? content : \"-\";\n    }\n  }\n\n  async #parseFileSize(b = 0) {\n    const kb = b / 1024,\n      mb = kb / 1024;\n    return kb\n      ? this.l10n.get(\n          mb >= 1\n            ? \"pdfjs-document-properties-size-mb\"\n            : \"pdfjs-document-properties-size-kb\",\n          { mb, kb, b }\n        )\n      : undefined;\n  }\n\n  async #parsePageSize(pageSizeInches, pagesRotation) {\n    if (!pageSizeInches) {\n      return undefined;\n    }\n    // Take the viewer rotation into account as well; compare with Adobe Reader.\n    if (pagesRotation % 180 !== 0) {\n      pageSizeInches = {\n        width: pageSizeInches.height,\n        height: pageSizeInches.width,\n      };\n    }\n    const isPortrait = isPortraitOrientation(pageSizeInches),\n      nonMetric = NON_METRIC_LOCALES.includes(this.l10n.getLanguage());\n\n    let sizeInches = {\n      width: Math.round(pageSizeInches.width * 100) / 100,\n      height: Math.round(pageSizeInches.height * 100) / 100,\n    };\n    // 1in == 25.4mm; no need to round to 2 decimals for millimeters.\n    let sizeMillimeters = {\n      width: Math.round(pageSizeInches.width * 25.4 * 10) / 10,\n      height: Math.round(pageSizeInches.height * 25.4 * 10) / 10,\n    };\n\n    let nameId =\n      getPageName(sizeInches, isPortrait, US_PAGE_NAMES) ||\n      getPageName(sizeMillimeters, isPortrait, METRIC_PAGE_NAMES);\n\n    if (\n      !nameId &&\n      !(\n        Number.isInteger(sizeMillimeters.width) &&\n        Number.isInteger(sizeMillimeters.height)\n      )\n    ) {\n      // Attempt to improve the page name detection by falling back to fuzzy\n      // matching of the metric dimensions, to account for e.g. rounding errors\n      // and/or PDF files that define the page sizes in an imprecise manner.\n      const exactMillimeters = {\n        width: pageSizeInches.width * 25.4,\n        height: pageSizeInches.height * 25.4,\n      };\n      const intMillimeters = {\n        width: Math.round(sizeMillimeters.width),\n        height: Math.round(sizeMillimeters.height),\n      };\n\n      // Try to avoid false positives, by only considering \"small\" differences.\n      if (\n        Math.abs(exactMillimeters.width - intMillimeters.width) < 0.1 &&\n        Math.abs(exactMillimeters.height - intMillimeters.height) < 0.1\n      ) {\n        nameId = getPageName(intMillimeters, isPortrait, METRIC_PAGE_NAMES);\n        if (nameId) {\n          // Update *both* sizes, computed above, to ensure that the displayed\n          // dimensions always correspond to the detected page name.\n          sizeInches = {\n            width: Math.round((intMillimeters.width / 25.4) * 100) / 100,\n            height: Math.round((intMillimeters.height / 25.4) * 100) / 100,\n          };\n          sizeMillimeters = intMillimeters;\n        }\n      }\n    }\n\n    const [{ width, height }, unit, name, orientation] = await Promise.all([\n      nonMetric ? sizeInches : sizeMillimeters,\n      this.l10n.get(\n        nonMetric\n          ? \"pdfjs-document-properties-page-size-unit-inches\"\n          : \"pdfjs-document-properties-page-size-unit-millimeters\"\n      ),\n      nameId && this.l10n.get(nameId),\n      this.l10n.get(\n        isPortrait\n          ? \"pdfjs-document-properties-page-size-orientation-portrait\"\n          : \"pdfjs-document-properties-page-size-orientation-landscape\"\n      ),\n    ]);\n\n    return this.l10n.get(\n      name\n        ? \"pdfjs-document-properties-page-size-dimension-name-string\"\n        : \"pdfjs-document-properties-page-size-dimension-string\",\n      { width, height, unit, name, orientation }\n    );\n  }\n\n  async #parseDate(inputDate) {\n    const dateObj = PDFDateString.toDateObject(inputDate);\n    return dateObj\n      ? this.l10n.get(\"pdfjs-document-properties-date-time-string\", {\n          dateObj: dateObj.valueOf(),\n        })\n      : undefined;\n  }\n\n  #parseLinearization(isLinearized) {\n    return this.l10n.get(\n      isLinearized\n        ? \"pdfjs-document-properties-linearized-yes\"\n        : \"pdfjs-document-properties-linearized-no\"\n    );\n  }\n}\n\nexport { PDFDocumentProperties };\n","/* Copyright 2018 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nconst CharacterType = {\n  SPACE: 0,\n  ALPHA_LETTER: 1,\n  PUNCT: 2,\n  HAN_LETTER: 3,\n  KATAKANA_LETTER: 4,\n  HIRAGANA_LETTER: 5,\n  HALFWIDTH_KATAKANA_LETTER: 6,\n  THAI_LETTER: 7,\n};\n\nfunction isAlphabeticalScript(charCode) {\n  return charCode < 0x2e80;\n}\n\nfunction isAscii(charCode) {\n  return (charCode & 0xff80) === 0;\n}\n\nfunction isAsciiAlpha(charCode) {\n  return (\n    (charCode >= /* a = */ 0x61 && charCode <= /* z = */ 0x7a) ||\n    (charCode >= /* A = */ 0x41 && charCode <= /* Z = */ 0x5a)\n  );\n}\n\nfunction isAsciiDigit(charCode) {\n  return charCode >= /* 0 = */ 0x30 && charCode <= /* 9 = */ 0x39;\n}\n\nfunction isAsciiSpace(charCode) {\n  return (\n    charCode === /* SPACE = */ 0x20 ||\n    charCode === /* TAB = */ 0x09 ||\n    charCode === /* CR = */ 0x0d ||\n    charCode === /* LF = */ 0x0a\n  );\n}\n\nfunction isHan(charCode) {\n  return (\n    (charCode >= 0x3400 && charCode <= 0x9fff) ||\n    (charCode >= 0xf900 && charCode <= 0xfaff)\n  );\n}\n\nfunction isKatakana(charCode) {\n  return charCode >= 0x30a0 && charCode <= 0x30ff;\n}\n\nfunction isHiragana(charCode) {\n  return charCode >= 0x3040 && charCode <= 0x309f;\n}\n\nfunction isHalfwidthKatakana(charCode) {\n  return charCode >= 0xff60 && charCode <= 0xff9f;\n}\n\nfunction isThai(charCode) {\n  return (charCode & 0xff80) === 0x0e00;\n}\n\n/**\n * This function is based on the word-break detection implemented in:\n * https://hg.mozilla.org/mozilla-central/file/tip/intl/lwbrk/WordBreaker.cpp\n */\nfunction getCharacterType(charCode) {\n  if (isAlphabeticalScript(charCode)) {\n    if (isAscii(charCode)) {\n      if (isAsciiSpace(charCode)) {\n        return CharacterType.SPACE;\n      } else if (\n        isAsciiAlpha(charCode) ||\n        isAsciiDigit(charCode) ||\n        charCode === /* UNDERSCORE = */ 0x5f\n      ) {\n        return CharacterType.ALPHA_LETTER;\n      }\n      return CharacterType.PUNCT;\n    } else if (isThai(charCode)) {\n      return CharacterType.THAI_LETTER;\n    } else if (charCode === /* NBSP = */ 0xa0) {\n      return CharacterType.SPACE;\n    }\n    return CharacterType.ALPHA_LETTER;\n  }\n\n  if (isHan(charCode)) {\n    return CharacterType.HAN_LETTER;\n  } else if (isKatakana(charCode)) {\n    return CharacterType.KATAKANA_LETTER;\n  } else if (isHiragana(charCode)) {\n    return CharacterType.HIRAGANA_LETTER;\n  } else if (isHalfwidthKatakana(charCode)) {\n    return CharacterType.HALFWIDTH_KATAKANA_LETTER;\n  }\n  return CharacterType.ALPHA_LETTER;\n}\n\nlet NormalizeWithNFKC;\nfunction getNormalizeWithNFKC() {\n  /* eslint-disable no-irregular-whitespace */\n  NormalizeWithNFKC ||= ` ¨ª¯²-µ¸-º¼-¾Ĳ-ĳĿ-ŀŉſǄ-ǌǱ-ǳʰ-ʸ˘-˝ˠ-ˤʹͺ;΄-΅·ϐ-ϖϰ-ϲϴ-ϵϹևٵ-ٸक़-य़ড়-ঢ়য়ਲ਼ਸ਼ਖ਼-ਜ਼ਫ਼ଡ଼-ଢ଼ำຳໜ-ໝ༌གྷཌྷདྷབྷཛྷཀྵჼᴬ-ᴮᴰ-ᴺᴼ-ᵍᵏ-ᵪᵸᶛ-ᶿẚ-ẛάέήίόύώΆ᾽-῁ΈΉ῍-῏ΐΊ῝-῟ΰΎ῭-`ΌΏ´-῾ - ‑‗․-… ″-‴‶-‷‼‾⁇-⁉⁗ ⁰-ⁱ⁴-₎ₐ-ₜ₨℀-℃℅-ℇ℉-ℓℕ-№ℙ-ℝ℠-™ℤΩℨK-ℭℯ-ℱℳ-ℹ℻-⅀ⅅ-ⅉ⅐-ⅿ↉∬-∭∯-∰〈-〉①-⓪⨌⩴-⩶⫝̸ⱼ-ⱽⵯ⺟⻳⼀-⿕　〶〸-〺゛-゜ゟヿㄱ-ㆎ㆒-㆟㈀-㈞㈠-㉇㉐-㉾㊀-㏿ꚜ-ꚝꝰꟲ-ꟴꟸ-ꟹꭜ-ꭟꭩ豈-嗀塚晴凞-羽蘒諸逸-都飯-舘並-龎ﬀ-ﬆﬓ-ﬗיִײַ-זּטּ-לּמּנּ-סּףּ-פּצּ-ﮱﯓ-ﴽﵐ-ﶏﶒ-ﷇﷰ-﷼︐-︙︰-﹄﹇-﹒﹔-﹦﹨-﹫ﹰ-ﹲﹴﹶ-ﻼ！-ﾾￂ-ￇￊ-ￏￒ-ￗￚ-ￜ￠-￦`;\n\n  if (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"TESTING\")) {\n    const ranges = [];\n    const range = [];\n    const diacriticsRegex = /^\\p{M}$/u;\n    // Some chars must be replaced by their NFKC counterpart during a search.\n    for (let i = 0; i < 65536; i++) {\n      const c = String.fromCharCode(i);\n      if (c.normalize(\"NFKC\") !== c && !diacriticsRegex.test(c)) {\n        if (range.length !== 2) {\n          range[0] = range[1] = i;\n          continue;\n        }\n        if (range[1] + 1 !== i) {\n          if (range[0] === range[1]) {\n            ranges.push(String.fromCharCode(range[0]));\n          } else {\n            ranges.push(\n              `${String.fromCharCode(range[0])}-${String.fromCharCode(\n                range[1]\n              )}`\n            );\n          }\n          range[0] = range[1] = i;\n        } else {\n          range[1] = i;\n        }\n      }\n    }\n    if (ranges.join(\"\") !== NormalizeWithNFKC) {\n      throw new Error(\n        \"getNormalizeWithNFKC - update the `NormalizeWithNFKC` string.\"\n      );\n    }\n  }\n  return NormalizeWithNFKC;\n}\n\nexport { CharacterType, getCharacterType, getNormalizeWithNFKC };\n","/* Copyright 2012 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/** @typedef {import(\"../src/display/api\").PDFDocumentProxy} PDFDocumentProxy */\n/** @typedef {import(\"./event_utils\").EventBus} EventBus */\n/** @typedef {import(\"./interfaces\").IPDFLinkService} IPDFLinkService */\n\nimport { binarySearchFirstItem, scrollIntoView } from \"./ui_utils.js\";\nimport { getCharacterType, getNormalizeWithNFKC } from \"./pdf_find_utils.js\";\n\nconst FindState = {\n  FOUND: 0,\n  NOT_FOUND: 1,\n  WRAPPED: 2,\n  PENDING: 3,\n};\n\nconst FIND_TIMEOUT = 250; // ms\nconst MATCH_SCROLL_OFFSET_TOP = -50; // px\nconst MATCH_SCROLL_OFFSET_LEFT = -400; // px\n\nconst CHARACTERS_TO_NORMALIZE = {\n  \"\\u2010\": \"-\", // Hyphen\n  \"\\u2018\": \"'\", // Left single quotation mark\n  \"\\u2019\": \"'\", // Right single quotation mark\n  \"\\u201A\": \"'\", // Single low-9 quotation mark\n  \"\\u201B\": \"'\", // Single high-reversed-9 quotation mark\n  \"\\u201C\": '\"', // Left double quotation mark\n  \"\\u201D\": '\"', // Right double quotation mark\n  \"\\u201E\": '\"', // Double low-9 quotation mark\n  \"\\u201F\": '\"', // Double high-reversed-9 quotation mark\n  \"\\u00BC\": \"1/4\", // Vulgar fraction one quarter\n  \"\\u00BD\": \"1/2\", // Vulgar fraction one half\n  \"\\u00BE\": \"3/4\", // Vulgar fraction three quarters\n};\n\n// These diacritics aren't considered as combining diacritics\n// when searching in a document:\n//   https://searchfox.org/mozilla-central/source/intl/unicharutil/util/is_combining_diacritic.py.\n// The combining class definitions can be found:\n//   https://www.unicode.org/reports/tr44/#Canonical_Combining_Class_Values\n// Category 0 corresponds to [^\\p{Mn}].\nconst DIACRITICS_EXCEPTION = new Set([\n  // UNICODE_COMBINING_CLASS_KANA_VOICING\n  // https://www.compart.com/fr/unicode/combining/8\n  0x3099, 0x309a,\n  // UNICODE_COMBINING_CLASS_VIRAMA (under 0xFFFF)\n  // https://www.compart.com/fr/unicode/combining/9\n  0x094d, 0x09cd, 0x0a4d, 0x0acd, 0x0b4d, 0x0bcd, 0x0c4d, 0x0ccd, 0x0d3b,\n  0x0d3c, 0x0d4d, 0x0dca, 0x0e3a, 0x0eba, 0x0f84, 0x1039, 0x103a, 0x1714,\n  0x1734, 0x17d2, 0x1a60, 0x1b44, 0x1baa, 0x1bab, 0x1bf2, 0x1bf3, 0x2d7f,\n  0xa806, 0xa82c, 0xa8c4, 0xa953, 0xa9c0, 0xaaf6, 0xabed,\n  // 91\n  // https://www.compart.com/fr/unicode/combining/91\n  0x0c56,\n  // 129\n  // https://www.compart.com/fr/unicode/combining/129\n  0x0f71,\n  // 130\n  // https://www.compart.com/fr/unicode/combining/130\n  0x0f72, 0x0f7a, 0x0f7b, 0x0f7c, 0x0f7d, 0x0f80,\n  // 132\n  // https://www.compart.com/fr/unicode/combining/132\n  0x0f74,\n]);\nlet DIACRITICS_EXCEPTION_STR; // Lazily initialized, see below.\n\nconst DIACRITICS_REG_EXP = /\\p{M}+/gu;\nconst SPECIAL_CHARS_REG_EXP =\n  /([.*+?^${}()|[\\]\\\\])|(\\p{P})|(\\s+)|(\\p{M})|(\\p{L})/gu;\nconst NOT_DIACRITIC_FROM_END_REG_EXP = /([^\\p{M}])\\p{M}*$/u;\nconst NOT_DIACRITIC_FROM_START_REG_EXP = /^\\p{M}*([^\\p{M}])/u;\n\n// The range [AC00-D7AF] corresponds to the Hangul syllables.\n// The few other chars are some CJK Compatibility Ideographs.\nconst SYLLABLES_REG_EXP = /[\\uAC00-\\uD7AF\\uFA6C\\uFACF-\\uFAD1\\uFAD5-\\uFAD7]+/g;\nconst SYLLABLES_LENGTHS = new Map();\n// When decomposed (in using NFD) the above syllables will start\n// with one of the chars in this regexp.\nconst FIRST_CHAR_SYLLABLES_REG_EXP =\n  \"[\\\\u1100-\\\\u1112\\\\ud7a4-\\\\ud7af\\\\ud84a\\\\ud84c\\\\ud850\\\\ud854\\\\ud857\\\\ud85f]\";\n\nconst NFKC_CHARS_TO_NORMALIZE = new Map();\n\nlet noSyllablesRegExp = null;\nlet withSyllablesRegExp = null;\n\nfunction normalize(text) {\n  // The diacritics in the text or in the query can be composed or not.\n  // So we use a decomposed text using NFD (and the same for the query)\n  // in order to be sure that diacritics are in the same order.\n\n  // Collect syllables length and positions.\n  const syllablePositions = [];\n  let m;\n  while ((m = SYLLABLES_REG_EXP.exec(text)) !== null) {\n    let { index } = m;\n    for (const char of m[0]) {\n      let len = SYLLABLES_LENGTHS.get(char);\n      if (!len) {\n        len = char.normalize(\"NFD\").length;\n        SYLLABLES_LENGTHS.set(char, len);\n      }\n      syllablePositions.push([len, index++]);\n    }\n  }\n\n  let normalizationRegex;\n  if (syllablePositions.length === 0 && noSyllablesRegExp) {\n    normalizationRegex = noSyllablesRegExp;\n  } else if (syllablePositions.length > 0 && withSyllablesRegExp) {\n    normalizationRegex = withSyllablesRegExp;\n  } else {\n    // Compile the regular expression for text normalization once.\n    const replace = Object.keys(CHARACTERS_TO_NORMALIZE).join(\"\");\n    const toNormalizeWithNFKC = getNormalizeWithNFKC();\n\n    // 3040-309F: Hiragana\n    // 30A0-30FF: Katakana\n    const CJK = \"(?:\\\\p{Ideographic}|[\\u3040-\\u30FF])\";\n    const HKDiacritics = \"(?:\\u3099|\\u309A)\";\n    const CompoundWord = \"\\\\p{Ll}-\\\\n\\\\p{Lu}\";\n    const regexp = `([${replace}])|([${toNormalizeWithNFKC}])|(${HKDiacritics}\\\\n)|(\\\\p{M}+(?:-\\\\n)?)|(${CompoundWord})|(\\\\S-\\\\n)|(${CJK}\\\\n)|(\\\\n)`;\n\n    if (syllablePositions.length === 0) {\n      // Most of the syllables belong to Hangul so there are no need\n      // to search for them in a non-Hangul document.\n      // We use the \\0 in order to have the same number of groups.\n      normalizationRegex = noSyllablesRegExp = new RegExp(\n        regexp + \"|(\\\\u0000)\",\n        \"gum\"\n      );\n    } else {\n      normalizationRegex = withSyllablesRegExp = new RegExp(\n        regexp + `|(${FIRST_CHAR_SYLLABLES_REG_EXP})`,\n        \"gum\"\n      );\n    }\n  }\n\n  // The goal of this function is to normalize the string and\n  // be able to get from an index in the new string the\n  // corresponding index in the old string.\n  // For example if we have: abCd12ef456gh where C is replaced by ccc\n  // and numbers replaced by nothing (it's the case for diacritics), then\n  // we'll obtain the normalized string: abcccdefgh.\n  // So here the reverse map is: [0,1,2,2,2,3,6,7,11,12].\n\n  // The goal is to obtain the array: [[0, 0], [3, -1], [4, -2],\n  // [6, 0], [8, 3]].\n  // which can be used like this:\n  //  - let say that i is the index in new string and j the index\n  //    the old string.\n  //  - if i is in [0; 3[ then j = i + 0\n  //  - if i is in [3; 4[ then j = i - 1\n  //  - if i is in [4; 6[ then j = i - 2\n  //  ...\n  // Thanks to a binary search it's easy to know where is i and what's the\n  // shift.\n  // Let say that the last entry in the array is [x, s] and we have a\n  // substitution at index y (old string) which will replace o chars by n chars.\n  // Firstly, if o === n, then no need to add a new entry: the shift is\n  // the same.\n  // Secondly, if o < n, then we push the n - o elements:\n  // [y - (s - 1), s - 1], [y - (s - 2), s - 2], ...\n  // Thirdly, if o > n, then we push the element: [y - (s - n), o + s - n]\n\n  // Collect diacritics length and positions.\n  const rawDiacriticsPositions = [];\n  while ((m = DIACRITICS_REG_EXP.exec(text)) !== null) {\n    rawDiacriticsPositions.push([m[0].length, m.index]);\n  }\n\n  let normalized = text.normalize(\"NFD\");\n  const positions = [[0, 0]];\n  let rawDiacriticsIndex = 0;\n  let syllableIndex = 0;\n  let shift = 0;\n  let shiftOrigin = 0;\n  let eol = 0;\n  let hasDiacritics = false;\n\n  normalized = normalized.replace(\n    normalizationRegex,\n    (match, p1, p2, p3, p4, p5, p6, p7, p8, p9, i) => {\n      i -= shiftOrigin;\n      if (p1) {\n        // Maybe fractions or quotations mark...\n        const replacement = CHARACTERS_TO_NORMALIZE[p1];\n        const jj = replacement.length;\n        for (let j = 1; j < jj; j++) {\n          positions.push([i - shift + j, shift - j]);\n        }\n        shift -= jj - 1;\n        return replacement;\n      }\n\n      if (p2) {\n        // Use the NFKC representation to normalize the char.\n        let replacement = NFKC_CHARS_TO_NORMALIZE.get(p2);\n        if (!replacement) {\n          replacement = p2.normalize(\"NFKC\");\n          NFKC_CHARS_TO_NORMALIZE.set(p2, replacement);\n        }\n        const jj = replacement.length;\n        for (let j = 1; j < jj; j++) {\n          positions.push([i - shift + j, shift - j]);\n        }\n        shift -= jj - 1;\n        return replacement;\n      }\n\n      if (p3) {\n        // We've a Katakana-Hiragana diacritic followed by a \\n so don't replace\n        // the \\n by a whitespace.\n        hasDiacritics = true;\n\n        // Diacritic.\n        if (i + eol === rawDiacriticsPositions[rawDiacriticsIndex]?.[1]) {\n          ++rawDiacriticsIndex;\n        } else {\n          // i is the position of the first diacritic\n          // so (i - 1) is the position for the letter before.\n          positions.push([i - 1 - shift + 1, shift - 1]);\n          shift -= 1;\n          shiftOrigin += 1;\n        }\n\n        // End-of-line.\n        positions.push([i - shift + 1, shift]);\n        shiftOrigin += 1;\n        eol += 1;\n\n        return p3.charAt(0);\n      }\n\n      if (p4) {\n        const hasTrailingDashEOL = p4.endsWith(\"\\n\");\n        const len = hasTrailingDashEOL ? p4.length - 2 : p4.length;\n\n        // Diacritics.\n        hasDiacritics = true;\n        let jj = len;\n        if (i + eol === rawDiacriticsPositions[rawDiacriticsIndex]?.[1]) {\n          jj -= rawDiacriticsPositions[rawDiacriticsIndex][0];\n          ++rawDiacriticsIndex;\n        }\n\n        for (let j = 1; j <= jj; j++) {\n          // i is the position of the first diacritic\n          // so (i - 1) is the position for the letter before.\n          positions.push([i - 1 - shift + j, shift - j]);\n        }\n        shift -= jj;\n        shiftOrigin += jj;\n\n        if (hasTrailingDashEOL) {\n          // Diacritics are followed by a -\\n.\n          // See comments in `if (p6)` block.\n          i += len - 1;\n          positions.push([i - shift + 1, 1 + shift]);\n          shift += 1;\n          shiftOrigin += 1;\n          eol += 1;\n          return p4.slice(0, len);\n        }\n\n        return p4;\n      }\n\n      if (p5) {\n        // Compound word with a line break after the hyphen.\n        positions.push([i - shift + 3, 1 + shift]);\n        shift += 1;\n        shiftOrigin += 1;\n        eol += 1;\n        return p5.replace(\"\\n\", \"\");\n      }\n\n      if (p6) {\n        // \"X-\\n\" is removed because an hyphen at the end of a line\n        // with not a space before is likely here to mark a break\n        // in a word.\n        // If X is encoded with UTF-32 then it can have a length greater than 1.\n        // The \\n isn't in the original text so here y = i, n = X.len - 2 and\n        // o = X.len - 1.\n        const len = p6.length - 2;\n        positions.push([i - shift + len, 1 + shift]);\n        shift += 1;\n        shiftOrigin += 1;\n        eol += 1;\n        return p6.slice(0, -2);\n      }\n\n      if (p7) {\n        // An ideographic at the end of a line doesn't imply adding an extra\n        // white space.\n        // A CJK can be encoded in UTF-32, hence their length isn't always 1.\n        const len = p7.length - 1;\n        positions.push([i - shift + len, shift]);\n        shiftOrigin += 1;\n        eol += 1;\n        return p7.slice(0, -1);\n      }\n\n      if (p8) {\n        // eol is replaced by space: \"foo\\nbar\" is likely equivalent to\n        // \"foo bar\".\n        positions.push([i - shift + 1, shift - 1]);\n        shift -= 1;\n        shiftOrigin += 1;\n        eol += 1;\n        return \" \";\n      }\n\n      // p8\n      if (i + eol === syllablePositions[syllableIndex]?.[1]) {\n        // A syllable (1 char) is replaced with several chars (n) so\n        // newCharsLen = n - 1.\n        const newCharLen = syllablePositions[syllableIndex][0] - 1;\n        ++syllableIndex;\n        for (let j = 1; j <= newCharLen; j++) {\n          positions.push([i - (shift - j), shift - j]);\n        }\n        shift -= newCharLen;\n        shiftOrigin += newCharLen;\n      }\n      return p9;\n    }\n  );\n\n  positions.push([normalized.length, shift]);\n\n  return [normalized, positions, hasDiacritics];\n}\n\n// Determine the original, non-normalized, match index such that highlighting of\n// search results is correct in the `textLayer` for strings containing e.g. \"½\"\n// characters; essentially \"inverting\" the result of the `normalize` function.\nfunction getOriginalIndex(diffs, pos, len) {\n  if (!diffs) {\n    return [pos, len];\n  }\n\n  // First char in the new string.\n  const start = pos;\n  // Last char in the new string.\n  const end = pos + len - 1;\n  let i = binarySearchFirstItem(diffs, x => x[0] >= start);\n  if (diffs[i][0] > start) {\n    --i;\n  }\n\n  let j = binarySearchFirstItem(diffs, x => x[0] >= end, i);\n  if (diffs[j][0] > end) {\n    --j;\n  }\n\n  // First char in the old string.\n  const oldStart = start + diffs[i][1];\n\n  // Last char in the old string.\n  const oldEnd = end + diffs[j][1];\n  const oldLen = oldEnd + 1 - oldStart;\n\n  return [oldStart, oldLen];\n}\n\n/**\n * @typedef {Object} PDFFindControllerOptions\n * @property {IPDFLinkService} linkService - The navigation/linking service.\n * @property {EventBus} eventBus - The application event bus.\n * @property {boolean} [updateMatchesCountOnProgress] - True if the matches\n *   count must be updated on progress or only when the last page is reached.\n *   The default value is `true`.\n */\n\n/**\n * Provides search functionality to find a given string in a PDF document.\n */\nclass PDFFindController {\n  #state = null;\n\n  #updateMatchesCountOnProgress = true;\n\n  #visitedPagesCount = 0;\n\n  /**\n   * @param {PDFFindControllerOptions} options\n   */\n  constructor({ linkService, eventBus, updateMatchesCountOnProgress = true }) {\n    this._linkService = linkService;\n    this._eventBus = eventBus;\n    this.#updateMatchesCountOnProgress = updateMatchesCountOnProgress;\n\n    /**\n     * Callback used to check if a `pageNumber` is currently visible.\n     * @type {function}\n     */\n    this.onIsPageVisible = null;\n\n    this.#reset();\n    eventBus._on(\"find\", this.#onFind.bind(this));\n    eventBus._on(\"findbarclose\", this.#onFindBarClose.bind(this));\n  }\n\n  get highlightMatches() {\n    return this._highlightMatches;\n  }\n\n  get pageMatches() {\n    return this._pageMatches;\n  }\n\n  get pageMatchesLength() {\n    return this._pageMatchesLength;\n  }\n\n  get selected() {\n    return this._selected;\n  }\n\n  get state() {\n    return this.#state;\n  }\n\n  /**\n   * Set a reference to the PDF document in order to search it.\n   * Note that searching is not possible if this method is not called.\n   *\n   * @param {PDFDocumentProxy} pdfDocument - The PDF document to search.\n   */\n  setDocument(pdfDocument) {\n    if (this._pdfDocument) {\n      this.#reset();\n    }\n    if (!pdfDocument) {\n      return;\n    }\n    this._pdfDocument = pdfDocument;\n    this._firstPageCapability.resolve();\n  }\n\n  #onFind(state) {\n    if (!state) {\n      return;\n    }\n    const pdfDocument = this._pdfDocument;\n    const { type } = state;\n\n    if (this.#state === null || this.#shouldDirtyMatch(state)) {\n      this._dirtyMatch = true;\n    }\n    this.#state = state;\n    if (type !== \"highlightallchange\") {\n      this.#updateUIState(FindState.PENDING);\n    }\n\n    this._firstPageCapability.promise.then(() => {\n      // If the document was closed before searching began, or if the search\n      // operation was relevant for a previously opened document, do nothing.\n      if (\n        !this._pdfDocument ||\n        (pdfDocument && this._pdfDocument !== pdfDocument)\n      ) {\n        return;\n      }\n      this.#extractText();\n\n      const findbarClosed = !this._highlightMatches;\n      const pendingTimeout = !!this._findTimeout;\n\n      if (this._findTimeout) {\n        clearTimeout(this._findTimeout);\n        this._findTimeout = null;\n      }\n      if (!type) {\n        // Trigger the find action with a small delay to avoid starting the\n        // search when the user is still typing (saving resources).\n        this._findTimeout = setTimeout(() => {\n          this.#nextMatch();\n          this._findTimeout = null;\n        }, FIND_TIMEOUT);\n      } else if (this._dirtyMatch) {\n        // Immediately trigger searching for non-'find' operations, when the\n        // current state needs to be reset and matches re-calculated.\n        this.#nextMatch();\n      } else if (type === \"again\") {\n        this.#nextMatch();\n\n        // When the findbar was previously closed, and `highlightAll` is set,\n        // ensure that the matches on all active pages are highlighted again.\n        if (findbarClosed && this.#state.highlightAll) {\n          this.#updateAllPages();\n        }\n      } else if (type === \"highlightallchange\") {\n        // If there was a pending search operation, synchronously trigger a new\n        // search *first* to ensure that the correct matches are highlighted.\n        if (pendingTimeout) {\n          this.#nextMatch();\n        } else {\n          this._highlightMatches = true;\n        }\n        this.#updateAllPages(); // Update the highlighting on all active pages.\n      } else {\n        this.#nextMatch();\n      }\n    });\n  }\n\n  /**\n   * @typedef {Object} PDFFindControllerScrollMatchIntoViewParams\n   * @property {HTMLElement} element\n   * @property {number} selectedLeft\n   * @property {number} pageIndex\n   * @property {number} matchIndex\n   */\n\n  /**\n   * Scroll the current match into view.\n   * @param {PDFFindControllerScrollMatchIntoViewParams}\n   */\n  scrollMatchIntoView({\n    element = null,\n    selectedLeft = 0,\n    pageIndex = -1,\n    matchIndex = -1,\n  }) {\n    if (!this._scrollMatches || !element) {\n      return;\n    } else if (matchIndex === -1 || matchIndex !== this._selected.matchIdx) {\n      return;\n    } else if (pageIndex === -1 || pageIndex !== this._selected.pageIdx) {\n      return;\n    }\n    this._scrollMatches = false; // Ensure that scrolling only happens once.\n\n    const spot = {\n      top: MATCH_SCROLL_OFFSET_TOP,\n      left: selectedLeft + MATCH_SCROLL_OFFSET_LEFT,\n    };\n    scrollIntoView(element, spot, /* scrollMatches = */ true);\n  }\n\n  #reset() {\n    this._highlightMatches = false;\n    this._scrollMatches = false;\n    this._pdfDocument = null;\n    this._pageMatches = [];\n    this._pageMatchesLength = [];\n    this.#visitedPagesCount = 0;\n    this.#state = null;\n    // Currently selected match.\n    this._selected = {\n      pageIdx: -1,\n      matchIdx: -1,\n    };\n    // Where the find algorithm currently is in the document.\n    this._offset = {\n      pageIdx: null,\n      matchIdx: null,\n      wrapped: false,\n    };\n    this._extractTextPromises = [];\n    this._pageContents = []; // Stores the normalized text for each page.\n    this._pageDiffs = [];\n    this._hasDiacritics = [];\n    this._matchesCountTotal = 0;\n    this._pagesToSearch = null;\n    this._pendingFindMatches = new Set();\n    this._resumePageIdx = null;\n    this._dirtyMatch = false;\n    clearTimeout(this._findTimeout);\n    this._findTimeout = null;\n\n    this._firstPageCapability = Promise.withResolvers();\n  }\n\n  /**\n   * @type {string|Array} The (current) normalized search query.\n   */\n  get #query() {\n    const { query } = this.#state;\n    if (typeof query === \"string\") {\n      if (query !== this._rawQuery) {\n        this._rawQuery = query;\n        [this._normalizedQuery] = normalize(query);\n      }\n      return this._normalizedQuery;\n    }\n    // We don't bother caching the normalized search query in the Array-case,\n    // since this code-path is *essentially* unused in the default viewer.\n    return (query || []).filter(q => !!q).map(q => normalize(q)[0]);\n  }\n\n  #shouldDirtyMatch(state) {\n    // When the search query changes, regardless of the actual search command\n    // used, always re-calculate matches to avoid errors (fixes bug 1030622).\n    const newQuery = state.query,\n      prevQuery = this.#state.query;\n    const newType = typeof newQuery,\n      prevType = typeof prevQuery;\n\n    if (newType !== prevType) {\n      return true;\n    }\n    if (newType === \"string\") {\n      if (newQuery !== prevQuery) {\n        return true;\n      }\n    } else if (\n      /* isArray && */ JSON.stringify(newQuery) !== JSON.stringify(prevQuery)\n    ) {\n      return true;\n    }\n\n    switch (state.type) {\n      case \"again\":\n        const pageNumber = this._selected.pageIdx + 1;\n        const linkService = this._linkService;\n        // Only treat a 'findagain' event as a new search operation when it's\n        // *absolutely* certain that the currently selected match is no longer\n        // visible, e.g. as a result of the user scrolling in the document.\n        //\n        // NOTE: If only a simple `this._linkService.page` check was used here,\n        // there's a risk that consecutive 'findagain' operations could \"skip\"\n        // over matches at the top/bottom of pages thus making them completely\n        // inaccessible when there's multiple pages visible in the viewer.\n        return (\n          pageNumber >= 1 &&\n          pageNumber <= linkService.pagesCount &&\n          pageNumber !== linkService.page &&\n          !(this.onIsPageVisible?.(pageNumber) ?? true)\n        );\n      case \"highlightallchange\":\n        return false;\n    }\n    return true;\n  }\n\n  /**\n   * Determine if the search query constitutes a \"whole word\", by comparing the\n   * first/last character type with the preceding/following character type.\n   */\n  #isEntireWord(content, startIdx, length) {\n    let match = content\n      .slice(0, startIdx)\n      .match(NOT_DIACRITIC_FROM_END_REG_EXP);\n    if (match) {\n      const first = content.charCodeAt(startIdx);\n      const limit = match[1].charCodeAt(0);\n      if (getCharacterType(first) === getCharacterType(limit)) {\n        return false;\n      }\n    }\n\n    match = content\n      .slice(startIdx + length)\n      .match(NOT_DIACRITIC_FROM_START_REG_EXP);\n    if (match) {\n      const last = content.charCodeAt(startIdx + length - 1);\n      const limit = match[1].charCodeAt(0);\n      if (getCharacterType(last) === getCharacterType(limit)) {\n        return false;\n      }\n    }\n\n    return true;\n  }\n\n  #convertToRegExpString(query, hasDiacritics) {\n    const { matchDiacritics } = this.#state;\n    let isUnicode = false;\n    query = query.replaceAll(\n      SPECIAL_CHARS_REG_EXP,\n      (\n        match,\n        p1 /* to escape */,\n        p2 /* punctuation */,\n        p3 /* whitespaces */,\n        p4 /* diacritics */,\n        p5 /* letters */\n      ) => {\n        // We don't need to use a \\s for whitespaces since all the different\n        // kind of whitespaces are replaced by a single \" \".\n\n        if (p1) {\n          // Escape characters like *+?... to not interfer with regexp syntax.\n          return `[ ]*\\\\${p1}[ ]*`;\n        }\n        if (p2) {\n          // Allow whitespaces around punctuation signs.\n          return `[ ]*${p2}[ ]*`;\n        }\n        if (p3) {\n          // Replace spaces by \\s+ to be sure to match any spaces.\n          return \"[ ]+\";\n        }\n        if (matchDiacritics) {\n          return p4 || p5;\n        }\n\n        if (p4) {\n          // Diacritics are removed with few exceptions.\n          return DIACRITICS_EXCEPTION.has(p4.charCodeAt(0)) ? p4 : \"\";\n        }\n\n        // A letter has been matched and it can be followed by any diacritics\n        // in normalized text.\n        if (hasDiacritics) {\n          isUnicode = true;\n          return `${p5}\\\\p{M}*`;\n        }\n        return p5;\n      }\n    );\n\n    const trailingSpaces = \"[ ]*\";\n    if (query.endsWith(trailingSpaces)) {\n      // The [ ]* has been added in order to help to match \"foo . bar\" but\n      // it doesn't make sense to match some whitespaces after the dot\n      // when it's the last character.\n      query = query.slice(0, query.length - trailingSpaces.length);\n    }\n\n    if (matchDiacritics) {\n      // aX must not match aXY.\n      if (hasDiacritics) {\n        DIACRITICS_EXCEPTION_STR ||= String.fromCharCode(\n          ...DIACRITICS_EXCEPTION\n        );\n\n        isUnicode = true;\n        query = `${query}(?=[${DIACRITICS_EXCEPTION_STR}]|[^\\\\p{M}]|$)`;\n      }\n    }\n\n    return [isUnicode, query];\n  }\n\n  #calculateMatch(pageIndex) {\n    const query = this.#query;\n    if (query.length === 0) {\n      return; // Do nothing: the matches should be wiped out already.\n    }\n    const pageContent = this._pageContents[pageIndex];\n    const matcherResult = this.match(query, pageContent, pageIndex);\n\n    const matches = (this._pageMatches[pageIndex] = []);\n    const matchesLength = (this._pageMatchesLength[pageIndex] = []);\n    const diffs = this._pageDiffs[pageIndex];\n\n    matcherResult?.forEach(({ index, length }) => {\n      const [matchPos, matchLen] = getOriginalIndex(diffs, index, length);\n      if (matchLen) {\n        matches.push(matchPos);\n        matchesLength.push(matchLen);\n      }\n    });\n\n    // When `highlightAll` is set, ensure that the matches on previously\n    // rendered (and still active) pages are correctly highlighted.\n    if (this.#state.highlightAll) {\n      this.#updatePage(pageIndex);\n    }\n    if (this._resumePageIdx === pageIndex) {\n      this._resumePageIdx = null;\n      this.#nextPageMatch();\n    }\n\n    // Update the match count.\n    const pageMatchesCount = matches.length;\n    this._matchesCountTotal += pageMatchesCount;\n    if (this.#updateMatchesCountOnProgress) {\n      if (pageMatchesCount > 0) {\n        this.#updateUIResultsCount();\n      }\n    } else if (++this.#visitedPagesCount === this._linkService.pagesCount) {\n      // For example, in GeckoView we want to have only the final update because\n      // the Java side provides only one object to update the counts.\n      this.#updateUIResultsCount();\n    }\n  }\n\n  /**\n   * @typedef {Object} FindMatch\n   * @property {number} index - The start of the matched text in the page's\n   *   string contents.\n   * @property {number} length - The length of the matched text.\n   */\n\n  /**\n   * @param {string | string[]} query - The search query.\n   * @param {string} pageContent - The text content of the page to search in.\n   * @param {number} pageIndex - The index of the page that is being processed.\n   * @returns {FindMatch[] | undefined} An array of matches in the provided\n   *   page.\n   */\n  match(query, pageContent, pageIndex) {\n    const hasDiacritics = this._hasDiacritics[pageIndex];\n\n    let isUnicode = false;\n    if (typeof query === \"string\") {\n      [isUnicode, query] = this.#convertToRegExpString(query, hasDiacritics);\n    } else {\n      // Words are sorted in reverse order to be sure that \"foobar\" is matched\n      // before \"foo\" in case the query is \"foobar foo\".\n      query = query\n        .sort()\n        .reverse()\n        .map(q => {\n          const [isUnicodePart, queryPart] = this.#convertToRegExpString(\n            q,\n            hasDiacritics\n          );\n          isUnicode ||= isUnicodePart;\n          return `(${queryPart})`;\n        })\n        .join(\"|\");\n    }\n    if (!query) {\n      // The query can be empty because some chars like diacritics could have\n      // been stripped out.\n      return undefined;\n    }\n\n    const { caseSensitive, entireWord } = this.#state;\n    const flags = `g${isUnicode ? \"u\" : \"\"}${caseSensitive ? \"\" : \"i\"}`;\n    query = new RegExp(query, flags);\n\n    const matches = [];\n    let match;\n    while ((match = query.exec(pageContent)) !== null) {\n      if (\n        entireWord &&\n        !this.#isEntireWord(pageContent, match.index, match[0].length)\n      ) {\n        continue;\n      }\n      matches.push({ index: match.index, length: match[0].length });\n    }\n    return matches;\n  }\n\n  #extractText() {\n    // Perform text extraction once if this method is called multiple times.\n    if (this._extractTextPromises.length > 0) {\n      return;\n    }\n\n    let deferred = Promise.resolve();\n    const textOptions = { disableNormalization: true };\n    for (let i = 0, ii = this._linkService.pagesCount; i < ii; i++) {\n      const { promise, resolve } = Promise.withResolvers();\n      this._extractTextPromises[i] = promise;\n\n      // eslint-disable-next-line arrow-body-style\n      deferred = deferred.then(() => {\n        return this._pdfDocument\n          .getPage(i + 1)\n          .then(pdfPage => pdfPage.getTextContent(textOptions))\n          .then(\n            textContent => {\n              const strBuf = [];\n\n              for (const textItem of textContent.items) {\n                strBuf.push(textItem.str);\n                if (textItem.hasEOL) {\n                  strBuf.push(\"\\n\");\n                }\n              }\n\n              // Store the normalized page content (text items) as one string.\n              [\n                this._pageContents[i],\n                this._pageDiffs[i],\n                this._hasDiacritics[i],\n              ] = normalize(strBuf.join(\"\"));\n              resolve();\n            },\n            reason => {\n              console.error(\n                `Unable to get text content for page ${i + 1}`,\n                reason\n              );\n              // Page error -- assuming no text content.\n              this._pageContents[i] = \"\";\n              this._pageDiffs[i] = null;\n              this._hasDiacritics[i] = false;\n              resolve();\n            }\n          );\n      });\n    }\n  }\n\n  #updatePage(index) {\n    if (this._scrollMatches && this._selected.pageIdx === index) {\n      // If the page is selected, scroll the page into view, which triggers\n      // rendering the page, which adds the text layer. Once the text layer\n      // is built, it will attempt to scroll the selected match into view.\n      this._linkService.page = index + 1;\n    }\n\n    this._eventBus.dispatch(\"updatetextlayermatches\", {\n      source: this,\n      pageIndex: index,\n    });\n  }\n\n  #updateAllPages() {\n    this._eventBus.dispatch(\"updatetextlayermatches\", {\n      source: this,\n      pageIndex: -1,\n    });\n  }\n\n  #nextMatch() {\n    const previous = this.#state.findPrevious;\n    const currentPageIndex = this._linkService.page - 1;\n    const numPages = this._linkService.pagesCount;\n\n    this._highlightMatches = true;\n\n    if (this._dirtyMatch) {\n      // Need to recalculate the matches, reset everything.\n      this._dirtyMatch = false;\n      this._selected.pageIdx = this._selected.matchIdx = -1;\n      this._offset.pageIdx = currentPageIndex;\n      this._offset.matchIdx = null;\n      this._offset.wrapped = false;\n      this._resumePageIdx = null;\n      this._pageMatches.length = 0;\n      this._pageMatchesLength.length = 0;\n      this.#visitedPagesCount = 0;\n      this._matchesCountTotal = 0;\n\n      this.#updateAllPages(); // Wipe out any previously highlighted matches.\n\n      for (let i = 0; i < numPages; i++) {\n        // Start finding the matches as soon as the text is extracted.\n        if (this._pendingFindMatches.has(i)) {\n          continue;\n        }\n        this._pendingFindMatches.add(i);\n        this._extractTextPromises[i].then(() => {\n          this._pendingFindMatches.delete(i);\n          this.#calculateMatch(i);\n        });\n      }\n    }\n\n    // If there's no query there's no point in searching.\n    const query = this.#query;\n    if (query.length === 0) {\n      this.#updateUIState(FindState.FOUND);\n      return;\n    }\n    // If we're waiting on a page, we return since we can't do anything else.\n    if (this._resumePageIdx) {\n      return;\n    }\n\n    const offset = this._offset;\n    // Keep track of how many pages we should maximally iterate through.\n    this._pagesToSearch = numPages;\n    // If there's already a `matchIdx` that means we are iterating through a\n    // page's matches.\n    if (offset.matchIdx !== null) {\n      const numPageMatches = this._pageMatches[offset.pageIdx].length;\n      if (\n        (!previous && offset.matchIdx + 1 < numPageMatches) ||\n        (previous && offset.matchIdx > 0)\n      ) {\n        // The simple case; we just have advance the matchIdx to select\n        // the next match on the page.\n        offset.matchIdx = previous ? offset.matchIdx - 1 : offset.matchIdx + 1;\n        this.#updateMatch(/* found = */ true);\n        return;\n      }\n      // We went beyond the current page's matches, so we advance to\n      // the next page.\n      this.#advanceOffsetPage(previous);\n    }\n    // Start searching through the page.\n    this.#nextPageMatch();\n  }\n\n  #matchesReady(matches) {\n    const offset = this._offset;\n    const numMatches = matches.length;\n    const previous = this.#state.findPrevious;\n\n    if (numMatches) {\n      // There were matches for the page, so initialize `matchIdx`.\n      offset.matchIdx = previous ? numMatches - 1 : 0;\n      this.#updateMatch(/* found = */ true);\n      return true;\n    }\n    // No matches, so attempt to search the next page.\n    this.#advanceOffsetPage(previous);\n    if (offset.wrapped) {\n      offset.matchIdx = null;\n      if (this._pagesToSearch < 0) {\n        // No point in wrapping again, there were no matches.\n        this.#updateMatch(/* found = */ false);\n        // While matches were not found, searching for a page\n        // with matches should nevertheless halt.\n        return true;\n      }\n    }\n    // Matches were not found (and searching is not done).\n    return false;\n  }\n\n  #nextPageMatch() {\n    if (this._resumePageIdx !== null) {\n      console.error(\"There can only be one pending page.\");\n    }\n\n    let matches = null;\n    do {\n      const pageIdx = this._offset.pageIdx;\n      matches = this._pageMatches[pageIdx];\n      if (!matches) {\n        // The matches don't exist yet for processing by `_matchesReady`,\n        // so set a resume point for when they do exist.\n        this._resumePageIdx = pageIdx;\n        break;\n      }\n    } while (!this.#matchesReady(matches));\n  }\n\n  #advanceOffsetPage(previous) {\n    const offset = this._offset;\n    const numPages = this._linkService.pagesCount;\n    offset.pageIdx = previous ? offset.pageIdx - 1 : offset.pageIdx + 1;\n    offset.matchIdx = null;\n\n    this._pagesToSearch--;\n\n    if (offset.pageIdx >= numPages || offset.pageIdx < 0) {\n      offset.pageIdx = previous ? numPages - 1 : 0;\n      offset.wrapped = true;\n    }\n  }\n\n  #updateMatch(found = false) {\n    let state = FindState.NOT_FOUND;\n    const wrapped = this._offset.wrapped;\n    this._offset.wrapped = false;\n\n    if (found) {\n      const previousPage = this._selected.pageIdx;\n      this._selected.pageIdx = this._offset.pageIdx;\n      this._selected.matchIdx = this._offset.matchIdx;\n      state = wrapped ? FindState.WRAPPED : FindState.FOUND;\n\n      // Update the currently selected page to wipe out any selected matches.\n      if (previousPage !== -1 && previousPage !== this._selected.pageIdx) {\n        this.#updatePage(previousPage);\n      }\n    }\n\n    this.#updateUIState(state, this.#state.findPrevious);\n    if (this._selected.pageIdx !== -1) {\n      // Ensure that the match will be scrolled into view.\n      this._scrollMatches = true;\n\n      this.#updatePage(this._selected.pageIdx);\n    }\n  }\n\n  #onFindBarClose(evt) {\n    const pdfDocument = this._pdfDocument;\n    // Since searching is asynchronous, ensure that the removal of highlighted\n    // matches (from the UI) is async too such that the 'updatetextlayermatches'\n    // events will always be dispatched in the expected order.\n    this._firstPageCapability.promise.then(() => {\n      // Only update the UI if the document is open, and is the current one.\n      if (\n        !this._pdfDocument ||\n        (pdfDocument && this._pdfDocument !== pdfDocument)\n      ) {\n        return;\n      }\n      // Ensure that a pending, not yet started, search operation is aborted.\n      if (this._findTimeout) {\n        clearTimeout(this._findTimeout);\n        this._findTimeout = null;\n      }\n      // Abort any long running searches, to avoid a match being scrolled into\n      // view *after* the findbar has been closed. In this case `this._offset`\n      // will most likely differ from `this._selected`, hence we also ensure\n      // that any new search operation will always start with a clean slate.\n      if (this._resumePageIdx) {\n        this._resumePageIdx = null;\n        this._dirtyMatch = true;\n      }\n      // Avoid the UI being in a pending state when the findbar is re-opened.\n      this.#updateUIState(FindState.FOUND);\n\n      this._highlightMatches = false;\n      this.#updateAllPages(); // Wipe out any previously highlighted matches.\n    });\n  }\n\n  #requestMatchesCount() {\n    const { pageIdx, matchIdx } = this._selected;\n    let current = 0,\n      total = this._matchesCountTotal;\n    if (matchIdx !== -1) {\n      for (let i = 0; i < pageIdx; i++) {\n        current += this._pageMatches[i]?.length || 0;\n      }\n      current += matchIdx + 1;\n    }\n    // When searching starts, this method may be called before the `pageMatches`\n    // have been counted (in `#calculateMatch`). Ensure that the UI won't show\n    // temporarily broken state when the active find result doesn't make sense.\n    if (current < 1 || current > total) {\n      current = total = 0;\n    }\n    return { current, total };\n  }\n\n  #updateUIResultsCount() {\n    this._eventBus.dispatch(\"updatefindmatchescount\", {\n      source: this,\n      matchesCount: this.#requestMatchesCount(),\n    });\n  }\n\n  #updateUIState(state, previous = false) {\n    if (\n      !this.#updateMatchesCountOnProgress &&\n      (this.#visitedPagesCount !== this._linkService.pagesCount ||\n        state === FindState.PENDING)\n    ) {\n      // When this.#updateMatchesCountOnProgress is false we only send an update\n      // when everything is ready.\n      return;\n    }\n\n    this._eventBus.dispatch(\"updatefindcontrolstate\", {\n      source: this,\n      state,\n      previous,\n      entireWord: this.#state?.entireWord ?? null,\n      matchesCount: this.#requestMatchesCount(),\n      rawQuery: this.#state?.query ?? null,\n    });\n  }\n}\n\nexport { FindState, PDFFindController };\n","/* Copyright 2012 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { FindState } from \"./pdf_find_controller.js\";\nimport { toggleExpandedBtn } from \"./ui_utils.js\";\n\nconst MATCHES_COUNT_LIMIT = 1000;\n\n/**\n * Creates a \"search bar\" given a set of DOM elements that act as controls\n * for searching or for setting search preferences in the UI. This object\n * also sets up the appropriate events for the controls. Actual searching\n * is done by PDFFindController.\n */\nclass PDFFindBar {\n  #mainContainer;\n\n  #resizeObserver = new ResizeObserver(this.#resizeObserverCallback.bind(this));\n\n  constructor(options, mainContainer, eventBus) {\n    this.opened = false;\n\n    this.bar = options.bar;\n    this.toggleButton = options.toggleButton;\n    this.findField = options.findField;\n    this.highlightAll = options.highlightAllCheckbox;\n    this.caseSensitive = options.caseSensitiveCheckbox;\n    this.matchDiacritics = options.matchDiacriticsCheckbox;\n    this.entireWord = options.entireWordCheckbox;\n    this.findMsg = options.findMsg;\n    this.findResultsCount = options.findResultsCount;\n    this.findPreviousButton = options.findPreviousButton;\n    this.findNextButton = options.findNextButton;\n    this.eventBus = eventBus;\n    this.#mainContainer = mainContainer;\n\n    // Add event listeners to the DOM elements.\n    this.toggleButton.addEventListener(\"click\", () => {\n      this.toggle();\n    });\n\n    this.findField.addEventListener(\"input\", () => {\n      this.dispatchEvent(\"\");\n    });\n\n    this.bar.addEventListener(\"keydown\", e => {\n      switch (e.keyCode) {\n        case 13: // Enter\n          if (e.target === this.findField) {\n            this.dispatchEvent(\"again\", e.shiftKey);\n          }\n          break;\n        case 27: // Escape\n          this.close();\n          break;\n      }\n    });\n\n    this.findPreviousButton.addEventListener(\"click\", () => {\n      this.dispatchEvent(\"again\", true);\n    });\n\n    this.findNextButton.addEventListener(\"click\", () => {\n      this.dispatchEvent(\"again\", false);\n    });\n\n    this.highlightAll.addEventListener(\"click\", () => {\n      this.dispatchEvent(\"highlightallchange\");\n    });\n\n    this.caseSensitive.addEventListener(\"click\", () => {\n      this.dispatchEvent(\"casesensitivitychange\");\n    });\n\n    this.entireWord.addEventListener(\"click\", () => {\n      this.dispatchEvent(\"entirewordchange\");\n    });\n\n    this.matchDiacritics.addEventListener(\"click\", () => {\n      this.dispatchEvent(\"diacriticmatchingchange\");\n    });\n  }\n\n  reset() {\n    this.updateUIState();\n  }\n\n  dispatchEvent(type, findPrev = false) {\n    this.eventBus.dispatch(\"find\", {\n      source: this,\n      type,\n      query: this.findField.value,\n      caseSensitive: this.caseSensitive.checked,\n      entireWord: this.entireWord.checked,\n      highlightAll: this.highlightAll.checked,\n      findPrevious: findPrev,\n      matchDiacritics: this.matchDiacritics.checked,\n    });\n  }\n\n  updateUIState(state, previous, matchesCount) {\n    const { findField, findMsg } = this;\n    let findMsgId = \"\",\n      status = \"\";\n\n    switch (state) {\n      case FindState.FOUND:\n        break;\n      case FindState.PENDING:\n        status = \"pending\";\n        break;\n      case FindState.NOT_FOUND:\n        findMsgId = \"pdfjs-find-not-found\";\n        status = \"notFound\";\n        break;\n      case FindState.WRAPPED:\n        findMsgId = previous\n          ? \"pdfjs-find-reached-top\"\n          : \"pdfjs-find-reached-bottom\";\n        break;\n    }\n    findField.setAttribute(\"data-status\", status);\n    findField.setAttribute(\"aria-invalid\", state === FindState.NOT_FOUND);\n\n    findMsg.setAttribute(\"data-status\", status);\n    if (findMsgId) {\n      findMsg.setAttribute(\"data-l10n-id\", findMsgId);\n    } else {\n      findMsg.removeAttribute(\"data-l10n-id\");\n      findMsg.textContent = \"\";\n    }\n\n    this.updateResultsCount(matchesCount);\n  }\n\n  updateResultsCount({ current = 0, total = 0 } = {}) {\n    const { findResultsCount } = this;\n\n    if (total > 0) {\n      const limit = MATCHES_COUNT_LIMIT;\n\n      findResultsCount.setAttribute(\n        \"data-l10n-id\",\n        total > limit\n          ? \"pdfjs-find-match-count-limit\"\n          : \"pdfjs-find-match-count\"\n      );\n      findResultsCount.setAttribute(\n        \"data-l10n-args\",\n        JSON.stringify({ limit, current, total })\n      );\n    } else {\n      findResultsCount.removeAttribute(\"data-l10n-id\");\n      findResultsCount.textContent = \"\";\n    }\n  }\n\n  open() {\n    if (!this.opened) {\n      // Potentially update the findbar layout, row vs column, when:\n      //  - The width of the viewer itself changes.\n      //  - The width of the findbar changes, by toggling the visibility\n      //    (or localization) of find count/status messages.\n      this.#resizeObserver.observe(this.#mainContainer);\n      this.#resizeObserver.observe(this.bar);\n\n      this.opened = true;\n      toggleExpandedBtn(this.toggleButton, true, this.bar);\n    }\n    this.findField.select();\n    this.findField.focus();\n  }\n\n  close() {\n    if (!this.opened) {\n      return;\n    }\n    this.#resizeObserver.disconnect();\n\n    this.opened = false;\n    toggleExpandedBtn(this.toggleButton, false, this.bar);\n\n    this.eventBus.dispatch(\"findbarclose\", { source: this });\n  }\n\n  toggle() {\n    if (this.opened) {\n      this.close();\n    } else {\n      this.open();\n    }\n  }\n\n  #resizeObserverCallback() {\n    const { bar } = this;\n    // The find bar has an absolute position and thus the browser extends\n    // its width to the maximum possible width once the find bar does not fit\n    // entirely within the window anymore (and its elements are automatically\n    // wrapped). Here we detect and fix that.\n    bar.classList.remove(\"wrapContainers\");\n\n    const findbarHeight = bar.clientHeight;\n    const inputContainerHeight = bar.firstElementChild.clientHeight;\n\n    if (findbarHeight > inputContainerHeight) {\n      // The findbar is taller than the input container, which means that\n      // the browser wrapped some of the elements. For a consistent look,\n      // wrap all of them to adjust the width of the find bar.\n      bar.classList.add(\"wrapContainers\");\n    }\n  }\n}\n\nexport { PDFFindBar };\n","/* Copyright 2017 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/** @typedef {import(\"./event_utils\").EventBus} EventBus */\n/** @typedef {import(\"./interfaces\").IPDFLinkService} IPDFLinkService */\n\nimport { isValidRotation, parseQueryString } from \"./ui_utils.js\";\nimport { waitOnEventOrTimeout } from \"./event_utils.js\";\n\n// Heuristic value used when force-resetting `this._blockHashChange`.\nconst HASH_CHANGE_TIMEOUT = 1000; // milliseconds\n// Heuristic value used when adding the current position to the browser history.\nconst POSITION_UPDATED_THRESHOLD = 50;\n// Heuristic value used when adding a temporary position to the browser history.\nconst UPDATE_VIEWAREA_TIMEOUT = 1000; // milliseconds\n\n/**\n * @typedef {Object} PDFHistoryOptions\n * @property {IPDFLinkService} linkService - The navigation/linking service.\n * @property {EventBus} eventBus - The application event bus.\n */\n\n/**\n * @typedef {Object} InitializeParameters\n * @property {string} fingerprint - The PDF document's unique fingerprint.\n * @property {boolean} [resetHistory] - Reset the browsing history.\n * @property {boolean} [updateUrl] - Attempt to update the document URL, with\n *   the current hash, when pushing/replacing browser history entries.\n */\n\n/**\n * @typedef {Object} PushParameters\n * @property {string} [namedDest] - The named destination. If absent, a\n *   stringified version of `explicitDest` is used.\n * @property {Array} explicitDest - The explicit destination array.\n * @property {number} pageNumber - The page to which the destination points.\n */\n\nfunction getCurrentHash() {\n  return document.location.hash;\n}\n\nclass PDFHistory {\n  #eventAbortController = null;\n\n  /**\n   * @param {PDFHistoryOptions} options\n   */\n  constructor({ linkService, eventBus }) {\n    this.linkService = linkService;\n    this.eventBus = eventBus;\n\n    this._initialized = false;\n    this._fingerprint = \"\";\n    this.reset();\n\n    // Ensure that we don't miss a \"pagesinit\" event,\n    // by registering the listener immediately.\n    this.eventBus._on(\"pagesinit\", () => {\n      this._isPagesLoaded = false;\n\n      this.eventBus._on(\n        \"pagesloaded\",\n        evt => {\n          this._isPagesLoaded = !!evt.pagesCount;\n        },\n        { once: true }\n      );\n    });\n  }\n\n  /**\n   * Initialize the history for the PDF document, using either the current\n   * browser history entry or the document hash, whichever is present.\n   * @param {InitializeParameters} params\n   */\n  initialize({ fingerprint, resetHistory = false, updateUrl = false }) {\n    if (!fingerprint || typeof fingerprint !== \"string\") {\n      console.error(\n        'PDFHistory.initialize: The \"fingerprint\" must be a non-empty string.'\n      );\n      return;\n    }\n    // Ensure that any old state is always reset upon initialization.\n    if (this._initialized) {\n      this.reset();\n    }\n    const reInitialized =\n      this._fingerprint !== \"\" && this._fingerprint !== fingerprint;\n    this._fingerprint = fingerprint;\n    this._updateUrl = updateUrl === true;\n\n    this._initialized = true;\n    this.#bindEvents();\n    const state = window.history.state;\n\n    this._popStateInProgress = false;\n    this._blockHashChange = 0;\n    this._currentHash = getCurrentHash();\n    this._numPositionUpdates = 0;\n\n    this._uid = this._maxUid = 0;\n    this._destination = null;\n    this._position = null;\n\n    if (!this.#isValidState(state, /* checkReload = */ true) || resetHistory) {\n      const { hash, page, rotation } = this.#parseCurrentHash(\n        /* checkNameddest = */ true\n      );\n\n      if (!hash || reInitialized || resetHistory) {\n        // Ensure that the browser history is reset on PDF document load.\n        this.#pushOrReplaceState(null, /* forceReplace = */ true);\n        return;\n      }\n      // Ensure that the browser history is initialized correctly when\n      // the document hash is present on PDF document load.\n      this.#pushOrReplaceState(\n        { hash, page, rotation },\n        /* forceReplace = */ true\n      );\n      return;\n    }\n\n    // The browser history contains a valid entry, ensure that the history is\n    // initialized correctly on PDF document load.\n    const destination = state.destination;\n    this.#updateInternalState(\n      destination,\n      state.uid,\n      /* removeTemporary = */ true\n    );\n\n    if (destination.rotation !== undefined) {\n      this._initialRotation = destination.rotation;\n    }\n    if (destination.dest) {\n      this._initialBookmark = JSON.stringify(destination.dest);\n\n      // If the history is updated, e.g. through the user changing the hash,\n      // before the initial destination has become visible, then we do *not*\n      // want to potentially add `this._position` to the browser history.\n      this._destination.page = null;\n    } else if (destination.hash) {\n      this._initialBookmark = destination.hash;\n    } else if (destination.page) {\n      // Fallback case; shouldn't be necessary, but better safe than sorry.\n      this._initialBookmark = `page=${destination.page}`;\n    }\n  }\n\n  /**\n   * Reset the current `PDFHistory` instance, and consequently prevent any\n   * further updates and/or navigation of the browser history.\n   */\n  reset() {\n    if (this._initialized) {\n      this.#pageHide(); // Simulate a 'pagehide' event when resetting.\n\n      this._initialized = false;\n      this.#unbindEvents();\n    }\n    if (this._updateViewareaTimeout) {\n      clearTimeout(this._updateViewareaTimeout);\n      this._updateViewareaTimeout = null;\n    }\n    this._initialBookmark = null;\n    this._initialRotation = null;\n  }\n\n  /**\n   * Push an internal destination to the browser history.\n   * @param {PushParameters}\n   */\n  push({ namedDest = null, explicitDest, pageNumber }) {\n    if (!this._initialized) {\n      return;\n    }\n    if (namedDest && typeof namedDest !== \"string\") {\n      console.error(\n        \"PDFHistory.push: \" +\n          `\"${namedDest}\" is not a valid namedDest parameter.`\n      );\n      return;\n    } else if (!Array.isArray(explicitDest)) {\n      console.error(\n        \"PDFHistory.push: \" +\n          `\"${explicitDest}\" is not a valid explicitDest parameter.`\n      );\n      return;\n    } else if (!this.#isValidPage(pageNumber)) {\n      // Allow an unset `pageNumber` if and only if the history is still empty;\n      // please refer to the `this._destination.page = null;` comment above.\n      if (pageNumber !== null || this._destination) {\n        console.error(\n          \"PDFHistory.push: \" +\n            `\"${pageNumber}\" is not a valid pageNumber parameter.`\n        );\n        return;\n      }\n    }\n\n    const hash = namedDest || JSON.stringify(explicitDest);\n    if (!hash) {\n      // The hash *should* never be undefined, but if that were to occur,\n      // avoid any possible issues by not updating the browser history.\n      return;\n    }\n\n    let forceReplace = false;\n    if (\n      this._destination &&\n      (isDestHashesEqual(this._destination.hash, hash) ||\n        isDestArraysEqual(this._destination.dest, explicitDest))\n    ) {\n      // When the new destination is identical to `this._destination`, and\n      // its `page` is undefined, replace the current browser history entry.\n      // NOTE: This can only occur if `this._destination` was set either:\n      //  - through the document hash being specified on load.\n      //  - through the user changing the hash of the document.\n      if (this._destination.page) {\n        return;\n      }\n      forceReplace = true;\n    }\n    if (this._popStateInProgress && !forceReplace) {\n      return;\n    }\n\n    this.#pushOrReplaceState(\n      {\n        dest: explicitDest,\n        hash,\n        page: pageNumber,\n        rotation: this.linkService.rotation,\n      },\n      forceReplace\n    );\n\n    if (!this._popStateInProgress) {\n      // Prevent the browser history from updating while the new destination is\n      // being scrolled into view, to avoid potentially inconsistent state.\n      this._popStateInProgress = true;\n      // We defer the resetting of `this._popStateInProgress`, to account for\n      // e.g. zooming occurring when the new destination is being navigated to.\n      Promise.resolve().then(() => {\n        this._popStateInProgress = false;\n      });\n    }\n  }\n\n  /**\n   * Push a page to the browser history; generally the `push` method should be\n   * used instead.\n   * @param {number} pageNumber\n   */\n  pushPage(pageNumber) {\n    if (!this._initialized) {\n      return;\n    }\n    if (!this.#isValidPage(pageNumber)) {\n      console.error(\n        `PDFHistory.pushPage: \"${pageNumber}\" is not a valid page number.`\n      );\n      return;\n    }\n\n    if (this._destination?.page === pageNumber) {\n      // When the new page is identical to the one in `this._destination`, we\n      // don't want to add a potential duplicate entry in the browser history.\n      return;\n    }\n    if (this._popStateInProgress) {\n      return;\n    }\n\n    this.#pushOrReplaceState({\n      // Simulate an internal destination, for `this.#tryPushCurrentPosition`:\n      dest: null,\n      hash: `page=${pageNumber}`,\n      page: pageNumber,\n      rotation: this.linkService.rotation,\n    });\n\n    if (!this._popStateInProgress) {\n      // Prevent the browser history from updating while the new page is\n      // being scrolled into view, to avoid potentially inconsistent state.\n      this._popStateInProgress = true;\n      // We defer the resetting of `this._popStateInProgress`, to account for\n      // e.g. zooming occurring when the new page is being navigated to.\n      Promise.resolve().then(() => {\n        this._popStateInProgress = false;\n      });\n    }\n  }\n\n  /**\n   * Push the current position to the browser history.\n   */\n  pushCurrentPosition() {\n    if (!this._initialized || this._popStateInProgress) {\n      return;\n    }\n    this.#tryPushCurrentPosition();\n  }\n\n  /**\n   * Go back one step in the browser history.\n   * NOTE: Avoids navigating away from the document, useful for \"named actions\".\n   */\n  back() {\n    if (!this._initialized || this._popStateInProgress) {\n      return;\n    }\n    const state = window.history.state;\n    if (this.#isValidState(state) && state.uid > 0) {\n      window.history.back();\n    }\n  }\n\n  /**\n   * Go forward one step in the browser history.\n   * NOTE: Avoids navigating away from the document, useful for \"named actions\".\n   */\n  forward() {\n    if (!this._initialized || this._popStateInProgress) {\n      return;\n    }\n    const state = window.history.state;\n    if (this.#isValidState(state) && state.uid < this._maxUid) {\n      window.history.forward();\n    }\n  }\n\n  /**\n   * @type {boolean} Indicating if the user is currently moving through the\n   *   browser history, useful e.g. for skipping the next 'hashchange' event.\n   */\n  get popStateInProgress() {\n    return (\n      this._initialized &&\n      (this._popStateInProgress || this._blockHashChange > 0)\n    );\n  }\n\n  get initialBookmark() {\n    return this._initialized ? this._initialBookmark : null;\n  }\n\n  get initialRotation() {\n    return this._initialized ? this._initialRotation : null;\n  }\n\n  #pushOrReplaceState(destination, forceReplace = false) {\n    const shouldReplace = forceReplace || !this._destination;\n    const newState = {\n      fingerprint: this._fingerprint,\n      uid: shouldReplace ? this._uid : this._uid + 1,\n      destination,\n    };\n\n    if (\n      typeof PDFJSDev !== \"undefined\" &&\n      PDFJSDev.test(\"CHROME\") &&\n      window.history.state?.chromecomState\n    ) {\n      // history.state.chromecomState is managed by chromecom.js.\n      newState.chromecomState = window.history.state.chromecomState;\n    }\n    this.#updateInternalState(destination, newState.uid);\n\n    let newUrl;\n    if (this._updateUrl && destination?.hash) {\n      const baseUrl = document.location.href.split(\"#\", 1)[0];\n      // Prevent errors in Firefox.\n      if (!baseUrl.startsWith(\"file://\")) {\n        newUrl = `${baseUrl}#${destination.hash}`;\n      }\n    }\n    if (shouldReplace) {\n      window.history.replaceState(newState, \"\", newUrl);\n    } else {\n      window.history.pushState(newState, \"\", newUrl);\n    }\n  }\n\n  #tryPushCurrentPosition(temporary = false) {\n    if (!this._position) {\n      return;\n    }\n    let position = this._position;\n    if (temporary) {\n      position = Object.assign(Object.create(null), this._position);\n      position.temporary = true;\n    }\n\n    if (!this._destination) {\n      this.#pushOrReplaceState(position);\n      return;\n    }\n    if (this._destination.temporary) {\n      // Always replace a previous *temporary* position.\n      this.#pushOrReplaceState(position, /* forceReplace = */ true);\n      return;\n    }\n    if (this._destination.hash === position.hash) {\n      return; // The current document position has not changed.\n    }\n    if (\n      !this._destination.page &&\n      (POSITION_UPDATED_THRESHOLD <= 0 ||\n        this._numPositionUpdates <= POSITION_UPDATED_THRESHOLD)\n    ) {\n      // `this._destination` was set through the user changing the hash of\n      // the document. Do not add `this._position` to the browser history,\n      // to avoid \"flooding\" it with lots of (nearly) identical entries,\n      // since we cannot ensure that the document position has changed.\n      return;\n    }\n\n    let forceReplace = false;\n    if (\n      this._destination.page >= position.first &&\n      this._destination.page <= position.page\n    ) {\n      // When the `page` of `this._destination` is still visible, do not\n      // update the browsing history when `this._destination` either:\n      //  - contains an internal destination, since in this case we\n      //    cannot ensure that the document position has actually changed.\n      //  - was set through the user changing the hash of the document.\n      if (this._destination.dest !== undefined || !this._destination.first) {\n        return;\n      }\n      // To avoid \"flooding\" the browser history, replace the current entry.\n      forceReplace = true;\n    }\n    this.#pushOrReplaceState(position, forceReplace);\n  }\n\n  #isValidPage(val) {\n    return (\n      Number.isInteger(val) && val > 0 && val <= this.linkService.pagesCount\n    );\n  }\n\n  #isValidState(state, checkReload = false) {\n    if (!state) {\n      return false;\n    }\n    if (state.fingerprint !== this._fingerprint) {\n      if (checkReload) {\n        // Potentially accept the history entry, even if the fingerprints don't\n        // match, when the viewer was reloaded (see issue 6847).\n        if (\n          typeof state.fingerprint !== \"string\" ||\n          state.fingerprint.length !== this._fingerprint.length\n        ) {\n          return false;\n        }\n        const [perfEntry] = performance.getEntriesByType(\"navigation\");\n        if (perfEntry?.type !== \"reload\") {\n          return false;\n        }\n      } else {\n        // This should only occur in viewers with support for opening more than\n        // one PDF document, e.g. the GENERIC viewer.\n        return false;\n      }\n    }\n    if (!Number.isInteger(state.uid) || state.uid < 0) {\n      return false;\n    }\n    if (state.destination === null || typeof state.destination !== \"object\") {\n      return false;\n    }\n    return true;\n  }\n\n  #updateInternalState(destination, uid, removeTemporary = false) {\n    if (this._updateViewareaTimeout) {\n      // When updating `this._destination`, make sure that we always wait for\n      // the next 'updateviewarea' event before (potentially) attempting to\n      // push the current position to the browser history.\n      clearTimeout(this._updateViewareaTimeout);\n      this._updateViewareaTimeout = null;\n    }\n    if (removeTemporary && destination?.temporary) {\n      // When the `destination` comes from the browser history,\n      // we no longer treat it as a *temporary* position.\n      delete destination.temporary;\n    }\n    this._destination = destination;\n    this._uid = uid;\n    this._maxUid = Math.max(this._maxUid, uid);\n    // This should always be reset when `this._destination` is updated.\n    this._numPositionUpdates = 0;\n  }\n\n  #parseCurrentHash(checkNameddest = false) {\n    const hash = unescape(getCurrentHash()).substring(1);\n    const params = parseQueryString(hash);\n\n    const nameddest = params.get(\"nameddest\") || \"\";\n    let page = params.get(\"page\") | 0;\n\n    if (!this.#isValidPage(page) || (checkNameddest && nameddest.length > 0)) {\n      page = null;\n    }\n    return { hash, page, rotation: this.linkService.rotation };\n  }\n\n  #updateViewarea({ location }) {\n    if (this._updateViewareaTimeout) {\n      clearTimeout(this._updateViewareaTimeout);\n      this._updateViewareaTimeout = null;\n    }\n\n    this._position = {\n      hash: location.pdfOpenParams.substring(1),\n      page: this.linkService.page,\n      first: location.pageNumber,\n      rotation: location.rotation,\n    };\n\n    if (this._popStateInProgress) {\n      return;\n    }\n\n    if (\n      POSITION_UPDATED_THRESHOLD > 0 &&\n      this._isPagesLoaded &&\n      this._destination &&\n      !this._destination.page\n    ) {\n      // If the current destination was set through the user changing the hash\n      // of the document, we will usually not try to push the current position\n      // to the browser history; see `this.#tryPushCurrentPosition()`.\n      //\n      // To prevent `this.#tryPushCurrentPosition()` from effectively being\n      // reduced to a no-op in this case, we will assume that the position\n      // *did* in fact change if the 'updateviewarea' event was dispatched\n      // more than `POSITION_UPDATED_THRESHOLD` times.\n      this._numPositionUpdates++;\n    }\n\n    if (UPDATE_VIEWAREA_TIMEOUT > 0) {\n      // When closing the browser, a 'pagehide' event will be dispatched which\n      // *should* allow us to push the current position to the browser history.\n      // In practice, it seems that the event is arriving too late in order for\n      // the session history to be successfully updated.\n      // (For additional details, please refer to the discussion in\n      //  https://bugzilla.mozilla.org/show_bug.cgi?id=1153393.)\n      //\n      // To workaround this we attempt to *temporarily* add the current position\n      // to the browser history only when the viewer is *idle*,\n      // i.e. when scrolling and/or zooming does not occur.\n      //\n      // PLEASE NOTE: It's absolutely imperative that the browser history is\n      // *not* updated too often, since that would render the viewer more or\n      // less unusable. Hence the use of a timeout to delay the update until\n      // the viewer has been idle for `UPDATE_VIEWAREA_TIMEOUT` milliseconds.\n      this._updateViewareaTimeout = setTimeout(() => {\n        if (!this._popStateInProgress) {\n          this.#tryPushCurrentPosition(/* temporary = */ true);\n        }\n        this._updateViewareaTimeout = null;\n      }, UPDATE_VIEWAREA_TIMEOUT);\n    }\n  }\n\n  #popState({ state }) {\n    const newHash = getCurrentHash(),\n      hashChanged = this._currentHash !== newHash;\n    this._currentHash = newHash;\n\n    if (\n      (typeof PDFJSDev !== \"undefined\" &&\n        PDFJSDev.test(\"CHROME\") &&\n        state?.chromecomState &&\n        !this.#isValidState(state)) ||\n      !state\n    ) {\n      // This case corresponds to the user changing the hash of the document.\n      this._uid++;\n\n      const { hash, page, rotation } = this.#parseCurrentHash();\n      this.#pushOrReplaceState(\n        { hash, page, rotation },\n        /* forceReplace = */ true\n      );\n      return;\n    }\n    if (!this.#isValidState(state)) {\n      // This should only occur in viewers with support for opening more than\n      // one PDF document, e.g. the GENERIC viewer.\n      return;\n    }\n\n    // Prevent the browser history from updating until the new destination,\n    // as stored in the browser history, has been scrolled into view.\n    this._popStateInProgress = true;\n\n    if (hashChanged) {\n      // When the hash changed, implying that the 'popstate' event will be\n      // followed by a 'hashchange' event, then we do *not* want to update the\n      // browser history when handling the 'hashchange' event (in web/app.js)\n      // since that would *overwrite* the new destination navigated to below.\n      //\n      // To avoid accidentally disabling all future user-initiated hash changes,\n      // if there's e.g. another 'hashchange' listener that stops the event\n      // propagation, we make sure to always force-reset `this._blockHashChange`\n      // after `HASH_CHANGE_TIMEOUT` milliseconds have passed.\n      this._blockHashChange++;\n      waitOnEventOrTimeout({\n        target: window,\n        name: \"hashchange\",\n        delay: HASH_CHANGE_TIMEOUT,\n      }).then(() => {\n        this._blockHashChange--;\n      });\n    }\n\n    // Navigate to the new destination.\n    const destination = state.destination;\n    this.#updateInternalState(\n      destination,\n      state.uid,\n      /* removeTemporary = */ true\n    );\n\n    if (isValidRotation(destination.rotation)) {\n      this.linkService.rotation = destination.rotation;\n    }\n    if (destination.dest) {\n      this.linkService.goToDestination(destination.dest);\n    } else if (destination.hash) {\n      this.linkService.setHash(destination.hash);\n    } else if (destination.page) {\n      // Fallback case; shouldn't be necessary, but better safe than sorry.\n      this.linkService.page = destination.page;\n    }\n\n    // Since `PDFLinkService.goToDestination` is asynchronous, we thus defer the\n    // resetting of `this._popStateInProgress` slightly.\n    Promise.resolve().then(() => {\n      this._popStateInProgress = false;\n    });\n  }\n\n  #pageHide() {\n    // Attempt to push the `this._position` into the browser history when\n    // navigating away from the document. This is *only* done if the history\n    // is empty/temporary, since otherwise an existing browser history entry\n    // will end up being overwritten (given that new entries cannot be pushed\n    // into the browser history when the 'unload' event has already fired).\n    if (!this._destination || this._destination.temporary) {\n      this.#tryPushCurrentPosition();\n    }\n  }\n\n  #bindEvents() {\n    if (this.#eventAbortController) {\n      return; // The event listeners were already added.\n    }\n    this.#eventAbortController = new AbortController();\n    const { signal } = this.#eventAbortController;\n\n    this.eventBus._on(\"updateviewarea\", this.#updateViewarea.bind(this), {\n      signal,\n    });\n    window.addEventListener(\"popstate\", this.#popState.bind(this), { signal });\n    window.addEventListener(\"pagehide\", this.#pageHide.bind(this), { signal });\n  }\n\n  #unbindEvents() {\n    this.#eventAbortController?.abort();\n    this.#eventAbortController = null;\n  }\n}\n\nfunction isDestHashesEqual(destHash, pushHash) {\n  if (typeof destHash !== \"string\" || typeof pushHash !== \"string\") {\n    return false;\n  }\n  if (destHash === pushHash) {\n    return true;\n  }\n  const nameddest = parseQueryString(destHash).get(\"nameddest\");\n  if (nameddest === pushHash) {\n    return true;\n  }\n  return false;\n}\n\nfunction isDestArraysEqual(firstDest, secondDest) {\n  function isEntryEqual(first, second) {\n    if (typeof first !== typeof second) {\n      return false;\n    }\n    if (Array.isArray(first) || Array.isArray(second)) {\n      return false;\n    }\n    if (first !== null && typeof first === \"object\" && second !== null) {\n      if (Object.keys(first).length !== Object.keys(second).length) {\n        return false;\n      }\n      for (const key in first) {\n        if (!isEntryEqual(first[key], second[key])) {\n          return false;\n        }\n      }\n      return true;\n    }\n    return first === second || (Number.isNaN(first) && Number.isNaN(second));\n  }\n\n  if (!(Array.isArray(firstDest) && Array.isArray(secondDest))) {\n    return false;\n  }\n  if (firstDest.length !== secondDest.length) {\n    return false;\n  }\n  for (let i = 0, ii = firstDest.length; i < ii; i++) {\n    if (!isEntryEqual(firstDest[i], secondDest[i])) {\n      return false;\n    }\n  }\n  return true;\n}\n\nexport { isDestArraysEqual, isDestHashesEqual, PDFHistory };\n","/* Copyright 2020 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/** @typedef {import(\"./event_utils.js\").EventBus} EventBus */\n// eslint-disable-next-line max-len\n/** @typedef {import(\"../src/optional_content_config.js\").OptionalContentConfig} OptionalContentConfig */\n// eslint-disable-next-line max-len\n/** @typedef {import(\"../src/display/api.js\").PDFDocumentProxy} PDFDocumentProxy */\n\nimport { BaseTreeViewer } from \"./base_tree_viewer.js\";\n\n/**\n * @typedef {Object} PDFLayerViewerOptions\n * @property {HTMLDivElement} container - The viewer element.\n * @property {EventBus} eventBus - The application event bus.\n */\n\n/**\n * @typedef {Object} PDFLayerViewerRenderParameters\n * @property {OptionalContentConfig|null} optionalContentConfig - An\n *   {OptionalContentConfig} instance.\n * @property {PDFDocumentProxy} pdfDocument - A {PDFDocument} instance.\n */\n\nclass PDFLayerViewer extends BaseTreeViewer {\n  constructor(options) {\n    super(options);\n\n    this.eventBus._on(\"optionalcontentconfigchanged\", evt => {\n      this.#updateLayers(evt.promise);\n    });\n    this.eventBus._on(\"resetlayers\", () => {\n      this.#updateLayers();\n    });\n    this.eventBus._on(\"togglelayerstree\", this._toggleAllTreeItems.bind(this));\n  }\n\n  reset() {\n    super.reset();\n    this._optionalContentConfig = null;\n\n    this._optionalContentVisibility?.clear();\n    this._optionalContentVisibility = null;\n  }\n\n  /**\n   * @protected\n   */\n  _dispatchEvent(layersCount) {\n    this.eventBus.dispatch(\"layersloaded\", {\n      source: this,\n      layersCount,\n    });\n  }\n\n  /**\n   * @protected\n   */\n  _bindLink(element, { groupId, input }) {\n    const setVisibility = () => {\n      const visible = input.checked;\n      this._optionalContentConfig.setVisibility(groupId, visible);\n\n      const cached = this._optionalContentVisibility.get(groupId);\n      if (cached) {\n        cached.visible = visible;\n      }\n\n      this.eventBus.dispatch(\"optionalcontentconfig\", {\n        source: this,\n        promise: Promise.resolve(this._optionalContentConfig),\n      });\n    };\n\n    element.onclick = evt => {\n      if (evt.target === input) {\n        setVisibility();\n        return true;\n      } else if (evt.target !== element) {\n        return true; // The target is the \"label\", which is handled above.\n      }\n      input.checked = !input.checked;\n      setVisibility();\n      return false;\n    };\n  }\n\n  /**\n   * @private\n   */\n  _setNestedName(element, { name = null }) {\n    if (typeof name === \"string\") {\n      element.textContent = this._normalizeTextContent(name);\n      return;\n    }\n    element.setAttribute(\"data-l10n-id\", \"pdfjs-additional-layers\");\n    element.style.fontStyle = \"italic\";\n    // Trigger translation manually, since translation is paused when\n    // the final layer-tree is appended to the DOM.\n    this._l10n.translateOnce(element);\n  }\n\n  /**\n   * @protected\n   */\n  _addToggleButton(div, { name = null }) {\n    super._addToggleButton(div, /* hidden = */ name === null);\n  }\n\n  /**\n   * @private\n   */\n  _toggleAllTreeItems() {\n    if (!this._optionalContentConfig) {\n      return;\n    }\n    super._toggleAllTreeItems();\n  }\n\n  /**\n   * @param {PDFLayerViewerRenderParameters} params\n   */\n  render({ optionalContentConfig, pdfDocument }) {\n    if (this._optionalContentConfig) {\n      this.reset();\n    }\n    this._optionalContentConfig = optionalContentConfig || null;\n    this._pdfDocument = pdfDocument || null;\n\n    const groups = optionalContentConfig?.getOrder();\n    if (!groups) {\n      this._dispatchEvent(/* layersCount = */ 0);\n      return;\n    }\n    this._optionalContentVisibility = new Map();\n\n    const fragment = document.createDocumentFragment(),\n      queue = [{ parent: fragment, groups }];\n    let layersCount = 0,\n      hasAnyNesting = false;\n    while (queue.length > 0) {\n      const levelData = queue.shift();\n      for (const groupId of levelData.groups) {\n        const div = document.createElement(\"div\");\n        div.className = \"treeItem\";\n\n        const element = document.createElement(\"a\");\n        div.append(element);\n\n        if (typeof groupId === \"object\") {\n          hasAnyNesting = true;\n          this._addToggleButton(div, groupId);\n          this._setNestedName(element, groupId);\n\n          const itemsDiv = document.createElement(\"div\");\n          itemsDiv.className = \"treeItems\";\n          div.append(itemsDiv);\n\n          queue.push({ parent: itemsDiv, groups: groupId.order });\n        } else {\n          const group = optionalContentConfig.getGroup(groupId);\n\n          const input = document.createElement(\"input\");\n          this._bindLink(element, { groupId, input });\n          input.type = \"checkbox\";\n          input.checked = group.visible;\n\n          this._optionalContentVisibility.set(groupId, {\n            input,\n            visible: input.checked,\n          });\n\n          const label = document.createElement(\"label\");\n          label.textContent = this._normalizeTextContent(group.name);\n\n          label.append(input);\n          element.append(label);\n          layersCount++;\n        }\n\n        levelData.parent.append(div);\n      }\n    }\n\n    this._finishRendering(fragment, layersCount, hasAnyNesting);\n  }\n\n  async #updateLayers(promise = null) {\n    if (!this._optionalContentConfig) {\n      return;\n    }\n    const pdfDocument = this._pdfDocument;\n    const optionalContentConfig = await (promise ||\n      pdfDocument.getOptionalContentConfig({ intent: \"display\" }));\n\n    if (pdfDocument !== this._pdfDocument) {\n      return; // The document was closed while the optional content resolved.\n    }\n    if (promise) {\n      // Ensure that the UI displays the correct state (e.g. with RBGroups).\n      for (const [groupId, cached] of this._optionalContentVisibility) {\n        const group = optionalContentConfig.getGroup(groupId);\n\n        if (group && cached.visible !== group.visible) {\n          cached.input.checked = cached.visible = !cached.visible;\n        }\n      }\n      return;\n    }\n    this.eventBus.dispatch(\"optionalcontentconfig\", {\n      source: this,\n      promise: Promise.resolve(optionalContentConfig),\n    });\n\n    // Reset the sidebarView to the new state.\n    this.render({\n      optionalContentConfig,\n      pdfDocument: this._pdfDocument,\n    });\n  }\n}\n\nexport { PDFLayerViewer };\n","/* Copyright 2012 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/** @typedef {import(\"./event_utils.js\").EventBus} EventBus */\n// eslint-disable-next-line max-len\n/** @typedef {import(\"./download_manager.js\").DownloadManager} DownloadManager */\n/** @typedef {import(\"./interfaces.js\").IPDFLinkService} IPDFLinkService */\n// eslint-disable-next-line max-len\n/** @typedef {import(\"../src/display/api.js\").PDFDocumentProxy} PDFDocumentProxy */\n\nimport { BaseTreeViewer } from \"./base_tree_viewer.js\";\nimport { SidebarView } from \"./ui_utils.js\";\n\n/**\n * @typedef {Object} PDFOutlineViewerOptions\n * @property {HTMLDivElement} container - The viewer element.\n * @property {EventBus} eventBus - The application event bus.\n * @property {IPDFLinkService} linkService - The navigation/linking service.\n * @property {DownloadManager} downloadManager - The download manager.\n */\n\n/**\n * @typedef {Object} PDFOutlineViewerRenderParameters\n * @property {Array|null} outline - An array of outline objects.\n * @property {PDFDocumentProxy} pdfDocument - A {PDFDocument} instance.\n */\n\nclass PDFOutlineViewer extends BaseTreeViewer {\n  /**\n   * @param {PDFOutlineViewerOptions} options\n   */\n  constructor(options) {\n    super(options);\n    this.linkService = options.linkService;\n    this.downloadManager = options.downloadManager;\n\n    this.eventBus._on(\"toggleoutlinetree\", this._toggleAllTreeItems.bind(this));\n    this.eventBus._on(\n      \"currentoutlineitem\",\n      this._currentOutlineItem.bind(this)\n    );\n\n    this.eventBus._on(\"pagechanging\", evt => {\n      this._currentPageNumber = evt.pageNumber;\n    });\n    this.eventBus._on(\"pagesloaded\", evt => {\n      this._isPagesLoaded = !!evt.pagesCount;\n\n      // If the capability is still pending, see the `_dispatchEvent`-method,\n      // we know that the `currentOutlineItem`-button can be enabled here.\n      this._currentOutlineItemCapability?.resolve(\n        /* enabled = */ this._isPagesLoaded\n      );\n    });\n    this.eventBus._on(\"sidebarviewchanged\", evt => {\n      this._sidebarView = evt.view;\n    });\n  }\n\n  reset() {\n    super.reset();\n    this._outline = null;\n\n    this._pageNumberToDestHashCapability = null;\n    this._currentPageNumber = 1;\n    this._isPagesLoaded = null;\n\n    this._currentOutlineItemCapability?.resolve(/* enabled = */ false);\n    this._currentOutlineItemCapability = null;\n  }\n\n  /**\n   * @protected\n   */\n  _dispatchEvent(outlineCount) {\n    this._currentOutlineItemCapability = Promise.withResolvers();\n    if (\n      outlineCount === 0 ||\n      this._pdfDocument?.loadingParams.disableAutoFetch\n    ) {\n      this._currentOutlineItemCapability.resolve(/* enabled = */ false);\n    } else if (this._isPagesLoaded !== null) {\n      this._currentOutlineItemCapability.resolve(\n        /* enabled = */ this._isPagesLoaded\n      );\n    }\n\n    this.eventBus.dispatch(\"outlineloaded\", {\n      source: this,\n      outlineCount,\n      currentOutlineItemPromise: this._currentOutlineItemCapability.promise,\n    });\n  }\n\n  /**\n   * @protected\n   */\n  _bindLink(\n    element,\n    { url, newWindow, action, attachment, dest, setOCGState }\n  ) {\n    const { linkService } = this;\n\n    if (url) {\n      linkService.addLinkAttributes(element, url, newWindow);\n      return;\n    }\n    if (action) {\n      element.href = linkService.getAnchorUrl(\"\");\n      element.onclick = () => {\n        linkService.executeNamedAction(action);\n        return false;\n      };\n      return;\n    }\n    if (attachment) {\n      element.href = linkService.getAnchorUrl(\"\");\n      element.onclick = () => {\n        this.downloadManager.openOrDownloadData(\n          attachment.content,\n          attachment.filename\n        );\n        return false;\n      };\n      return;\n    }\n    if (setOCGState) {\n      element.href = linkService.getAnchorUrl(\"\");\n      element.onclick = () => {\n        linkService.executeSetOCGState(setOCGState);\n        return false;\n      };\n      return;\n    }\n\n    element.href = linkService.getDestinationHash(dest);\n    element.onclick = evt => {\n      this._updateCurrentTreeItem(evt.target.parentNode);\n\n      if (dest) {\n        linkService.goToDestination(dest);\n      }\n      return false;\n    };\n  }\n\n  /**\n   * @private\n   */\n  _setStyles(element, { bold, italic }) {\n    if (bold) {\n      element.style.fontWeight = \"bold\";\n    }\n    if (italic) {\n      element.style.fontStyle = \"italic\";\n    }\n  }\n\n  /**\n   * @protected\n   */\n  _addToggleButton(div, { count, items }) {\n    let hidden = false;\n    if (count < 0) {\n      let totalCount = items.length;\n      if (totalCount > 0) {\n        const queue = [...items];\n        while (queue.length > 0) {\n          const { count: nestedCount, items: nestedItems } = queue.shift();\n          if (nestedCount > 0 && nestedItems.length > 0) {\n            totalCount += nestedItems.length;\n            queue.push(...nestedItems);\n          }\n        }\n      }\n      if (Math.abs(count) === totalCount) {\n        hidden = true;\n      }\n    }\n    super._addToggleButton(div, hidden);\n  }\n\n  /**\n   * @private\n   */\n  _toggleAllTreeItems() {\n    if (!this._outline) {\n      return;\n    }\n    super._toggleAllTreeItems();\n  }\n\n  /**\n   * @param {PDFOutlineViewerRenderParameters} params\n   */\n  render({ outline, pdfDocument }) {\n    if (this._outline) {\n      this.reset();\n    }\n    this._outline = outline || null;\n    this._pdfDocument = pdfDocument || null;\n\n    if (!outline) {\n      this._dispatchEvent(/* outlineCount = */ 0);\n      return;\n    }\n\n    const fragment = document.createDocumentFragment();\n    const queue = [{ parent: fragment, items: outline }];\n    let outlineCount = 0,\n      hasAnyNesting = false;\n    while (queue.length > 0) {\n      const levelData = queue.shift();\n      for (const item of levelData.items) {\n        const div = document.createElement(\"div\");\n        div.className = \"treeItem\";\n\n        const element = document.createElement(\"a\");\n        this._bindLink(element, item);\n        this._setStyles(element, item);\n        element.textContent = this._normalizeTextContent(item.title);\n\n        div.append(element);\n\n        if (item.items.length > 0) {\n          hasAnyNesting = true;\n          this._addToggleButton(div, item);\n\n          const itemsDiv = document.createElement(\"div\");\n          itemsDiv.className = \"treeItems\";\n          div.append(itemsDiv);\n\n          queue.push({ parent: itemsDiv, items: item.items });\n        }\n\n        levelData.parent.append(div);\n        outlineCount++;\n      }\n    }\n\n    this._finishRendering(fragment, outlineCount, hasAnyNesting);\n  }\n\n  /**\n   * Find/highlight the current outline item, corresponding to the active page.\n   * @private\n   */\n  async _currentOutlineItem() {\n    if (!this._isPagesLoaded) {\n      throw new Error(\"_currentOutlineItem: All pages have not been loaded.\");\n    }\n    if (!this._outline || !this._pdfDocument) {\n      return;\n    }\n\n    const pageNumberToDestHash = await this._getPageNumberToDestHash(\n      this._pdfDocument\n    );\n    if (!pageNumberToDestHash) {\n      return;\n    }\n    this._updateCurrentTreeItem(/* treeItem = */ null);\n\n    if (this._sidebarView !== SidebarView.OUTLINE) {\n      return; // The outline view is no longer visible, hence do nothing.\n    }\n    // When there is no destination on the current page, always check the\n    // previous ones in (reverse) order.\n    for (let i = this._currentPageNumber; i > 0; i--) {\n      const destHash = pageNumberToDestHash.get(i);\n      if (!destHash) {\n        continue;\n      }\n      const linkElement = this.container.querySelector(`a[href=\"${destHash}\"]`);\n      if (!linkElement) {\n        continue;\n      }\n      this._scrollToCurrentTreeItem(linkElement.parentNode);\n      break;\n    }\n  }\n\n  /**\n   * To (significantly) simplify the overall implementation, we will only\n   * consider *one* destination per page when finding/highlighting the current\n   * outline item (similar to e.g. Adobe Reader); more specifically, we choose\n   * the *first* outline item at the *lowest* level of the outline tree.\n   * @private\n   */\n  async _getPageNumberToDestHash(pdfDocument) {\n    if (this._pageNumberToDestHashCapability) {\n      return this._pageNumberToDestHashCapability.promise;\n    }\n    this._pageNumberToDestHashCapability = Promise.withResolvers();\n\n    const pageNumberToDestHash = new Map(),\n      pageNumberNesting = new Map();\n    const queue = [{ nesting: 0, items: this._outline }];\n    while (queue.length > 0) {\n      const levelData = queue.shift(),\n        currentNesting = levelData.nesting;\n      for (const { dest, items } of levelData.items) {\n        let explicitDest, pageNumber;\n        if (typeof dest === \"string\") {\n          explicitDest = await pdfDocument.getDestination(dest);\n\n          if (pdfDocument !== this._pdfDocument) {\n            return null; // The document was closed while the data resolved.\n          }\n        } else {\n          explicitDest = dest;\n        }\n        if (Array.isArray(explicitDest)) {\n          const [destRef] = explicitDest;\n\n          if (destRef && typeof destRef === \"object\") {\n            // The page reference must be available, since the current method\n            // won't be invoked until all pages have been loaded.\n            pageNumber = pdfDocument.cachedPageNumber(destRef);\n          } else if (Number.isInteger(destRef)) {\n            pageNumber = destRef + 1;\n          }\n\n          if (\n            Number.isInteger(pageNumber) &&\n            (!pageNumberToDestHash.has(pageNumber) ||\n              currentNesting > pageNumberNesting.get(pageNumber))\n          ) {\n            const destHash = this.linkService.getDestinationHash(dest);\n            pageNumberToDestHash.set(pageNumber, destHash);\n            pageNumberNesting.set(pageNumber, currentNesting);\n          }\n        }\n\n        if (items.length > 0) {\n          queue.push({ nesting: currentNesting + 1, items });\n        }\n      }\n    }\n\n    this._pageNumberToDestHashCapability.resolve(\n      pageNumberToDestHash.size > 0 ? pageNumberToDestHash : null\n    );\n    return this._pageNumberToDestHashCapability.promise;\n  }\n}\n\nexport { PDFOutlineViewer };\n","/* Copyright 2012 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/** @typedef {import(\"./event_utils.js\").EventBus} EventBus */\n/** @typedef {import(\"./pdf_viewer.js\").PDFViewer} PDFViewer */\n\nimport {\n  normalizeWheelEventDelta,\n  PresentationModeState,\n  ScrollMode,\n  SpreadMode,\n} from \"./ui_utils.js\";\nimport { AnnotationEditorType } from \"pdfjs-lib\";\n\nconst DELAY_BEFORE_HIDING_CONTROLS = 3000; // in ms\nconst ACTIVE_SELECTOR = \"pdfPresentationMode\";\nconst CONTROLS_SELECTOR = \"pdfPresentationModeControls\";\nconst MOUSE_SCROLL_COOLDOWN_TIME = 50; // in ms\nconst PAGE_SWITCH_THRESHOLD = 0.1;\n\n// Number of CSS pixels for a movement to count as a swipe.\nconst SWIPE_MIN_DISTANCE_THRESHOLD = 50;\n\n// Swipe angle deviation from the x or y axis before it is not\n// considered a swipe in that direction any more.\nconst SWIPE_ANGLE_THRESHOLD = Math.PI / 6;\n\n/**\n * @typedef {Object} PDFPresentationModeOptions\n * @property {HTMLDivElement} container - The container for the viewer element.\n * @property {PDFViewer} pdfViewer - The document viewer.\n * @property {EventBus} eventBus - The application event bus.\n */\n\nclass PDFPresentationMode {\n  #state = PresentationModeState.UNKNOWN;\n\n  #args = null;\n\n  #fullscreenChangeAbortController = null;\n\n  #windowAbortController = null;\n\n  /**\n   * @param {PDFPresentationModeOptions} options\n   */\n  constructor({ container, pdfViewer, eventBus }) {\n    this.container = container;\n    this.pdfViewer = pdfViewer;\n    this.eventBus = eventBus;\n\n    this.contextMenuOpen = false;\n    this.mouseScrollTimeStamp = 0;\n    this.mouseScrollDelta = 0;\n    this.touchSwipeState = null;\n  }\n\n  /**\n   * Request the browser to enter fullscreen mode.\n   * @returns {Promise<boolean>} Indicating if the request was successful.\n   */\n  async request() {\n    const { container, pdfViewer } = this;\n\n    if (this.active || !pdfViewer.pagesCount || !container.requestFullscreen) {\n      return false;\n    }\n    this.#addFullscreenChangeListeners();\n    this.#notifyStateChange(PresentationModeState.CHANGING);\n\n    const promise = container.requestFullscreen();\n\n    this.#args = {\n      pageNumber: pdfViewer.currentPageNumber,\n      scaleValue: pdfViewer.currentScaleValue,\n      scrollMode: pdfViewer.scrollMode,\n      spreadMode: null,\n      annotationEditorMode: null,\n    };\n\n    if (\n      pdfViewer.spreadMode !== SpreadMode.NONE &&\n      !(pdfViewer.pageViewsReady && pdfViewer.hasEqualPageSizes)\n    ) {\n      console.warn(\n        \"Ignoring Spread modes when entering PresentationMode, \" +\n          \"since the document may contain varying page sizes.\"\n      );\n      this.#args.spreadMode = pdfViewer.spreadMode;\n    }\n    if (pdfViewer.annotationEditorMode !== AnnotationEditorType.DISABLE) {\n      this.#args.annotationEditorMode = pdfViewer.annotationEditorMode;\n    }\n\n    try {\n      await promise;\n      pdfViewer.focus(); // Fixes bug 1787456.\n      return true;\n    } catch {\n      this.#removeFullscreenChangeListeners();\n      this.#notifyStateChange(PresentationModeState.NORMAL);\n    }\n    return false;\n  }\n\n  get active() {\n    return (\n      this.#state === PresentationModeState.CHANGING ||\n      this.#state === PresentationModeState.FULLSCREEN\n    );\n  }\n\n  #mouseWheel(evt) {\n    if (!this.active) {\n      return;\n    }\n    evt.preventDefault();\n\n    const delta = normalizeWheelEventDelta(evt);\n    const currentTime = Date.now();\n    const storedTime = this.mouseScrollTimeStamp;\n\n    // If we've already switched page, avoid accidentally switching again.\n    if (\n      currentTime > storedTime &&\n      currentTime - storedTime < MOUSE_SCROLL_COOLDOWN_TIME\n    ) {\n      return;\n    }\n    // If the scroll direction changed, reset the accumulated scroll delta.\n    if (\n      (this.mouseScrollDelta > 0 && delta < 0) ||\n      (this.mouseScrollDelta < 0 && delta > 0)\n    ) {\n      this.#resetMouseScrollState();\n    }\n    this.mouseScrollDelta += delta;\n\n    if (Math.abs(this.mouseScrollDelta) >= PAGE_SWITCH_THRESHOLD) {\n      const totalDelta = this.mouseScrollDelta;\n      this.#resetMouseScrollState();\n      const success =\n        totalDelta > 0\n          ? this.pdfViewer.previousPage()\n          : this.pdfViewer.nextPage();\n      if (success) {\n        this.mouseScrollTimeStamp = currentTime;\n      }\n    }\n  }\n\n  #notifyStateChange(state) {\n    this.#state = state;\n\n    this.eventBus.dispatch(\"presentationmodechanged\", { source: this, state });\n  }\n\n  #enter() {\n    this.#notifyStateChange(PresentationModeState.FULLSCREEN);\n    this.container.classList.add(ACTIVE_SELECTOR);\n\n    // Ensure that the correct page is scrolled into view when entering\n    // Presentation Mode, by waiting until fullscreen mode in enabled.\n    setTimeout(() => {\n      this.pdfViewer.scrollMode = ScrollMode.PAGE;\n      if (this.#args.spreadMode !== null) {\n        this.pdfViewer.spreadMode = SpreadMode.NONE;\n      }\n      this.pdfViewer.currentPageNumber = this.#args.pageNumber;\n      this.pdfViewer.currentScaleValue = \"page-fit\";\n\n      if (this.#args.annotationEditorMode !== null) {\n        this.pdfViewer.annotationEditorMode = {\n          mode: AnnotationEditorType.NONE,\n        };\n      }\n    }, 0);\n\n    this.#addWindowListeners();\n    this.#showControls();\n    this.contextMenuOpen = false;\n\n    // Text selection is disabled in Presentation Mode, thus it's not possible\n    // for the user to deselect text that is selected (e.g. with \"Select all\")\n    // when entering Presentation Mode, hence we remove any active selection.\n    document.getSelection().empty();\n  }\n\n  #exit() {\n    const pageNumber = this.pdfViewer.currentPageNumber;\n    this.container.classList.remove(ACTIVE_SELECTOR);\n\n    // Ensure that the correct page is scrolled into view when exiting\n    // Presentation Mode, by waiting until fullscreen mode is disabled.\n    setTimeout(() => {\n      this.#removeFullscreenChangeListeners();\n      this.#notifyStateChange(PresentationModeState.NORMAL);\n\n      this.pdfViewer.scrollMode = this.#args.scrollMode;\n      if (this.#args.spreadMode !== null) {\n        this.pdfViewer.spreadMode = this.#args.spreadMode;\n      }\n      this.pdfViewer.currentScaleValue = this.#args.scaleValue;\n      this.pdfViewer.currentPageNumber = pageNumber;\n\n      if (this.#args.annotationEditorMode !== null) {\n        this.pdfViewer.annotationEditorMode = {\n          mode: this.#args.annotationEditorMode,\n        };\n      }\n      this.#args = null;\n    }, 0);\n\n    this.#removeWindowListeners();\n    this.#hideControls();\n    this.#resetMouseScrollState();\n    this.contextMenuOpen = false;\n  }\n\n  #mouseDown(evt) {\n    if (this.contextMenuOpen) {\n      this.contextMenuOpen = false;\n      evt.preventDefault();\n      return;\n    }\n    if (evt.button !== 0) {\n      return;\n    }\n    // Enable clicking of links in presentation mode. Note: only links\n    // pointing to destinations in the current PDF document work.\n    if (\n      evt.target.href &&\n      evt.target.parentNode?.hasAttribute(\"data-internal-link\")\n    ) {\n      return;\n    }\n    // Unless an internal link was clicked, advance one page.\n    evt.preventDefault();\n\n    if (evt.shiftKey) {\n      this.pdfViewer.previousPage();\n    } else {\n      this.pdfViewer.nextPage();\n    }\n  }\n\n  #contextMenu() {\n    this.contextMenuOpen = true;\n  }\n\n  #showControls() {\n    if (this.controlsTimeout) {\n      clearTimeout(this.controlsTimeout);\n    } else {\n      this.container.classList.add(CONTROLS_SELECTOR);\n    }\n    this.controlsTimeout = setTimeout(() => {\n      this.container.classList.remove(CONTROLS_SELECTOR);\n      delete this.controlsTimeout;\n    }, DELAY_BEFORE_HIDING_CONTROLS);\n  }\n\n  #hideControls() {\n    if (!this.controlsTimeout) {\n      return;\n    }\n    clearTimeout(this.controlsTimeout);\n    this.container.classList.remove(CONTROLS_SELECTOR);\n    delete this.controlsTimeout;\n  }\n\n  /**\n   * Resets the properties used for tracking mouse scrolling events.\n   */\n  #resetMouseScrollState() {\n    this.mouseScrollTimeStamp = 0;\n    this.mouseScrollDelta = 0;\n  }\n\n  #touchSwipe(evt) {\n    if (!this.active) {\n      return;\n    }\n    if (evt.touches.length > 1) {\n      // Multiple touch points detected; cancel the swipe.\n      this.touchSwipeState = null;\n      return;\n    }\n\n    switch (evt.type) {\n      case \"touchstart\":\n        this.touchSwipeState = {\n          startX: evt.touches[0].pageX,\n          startY: evt.touches[0].pageY,\n          endX: evt.touches[0].pageX,\n          endY: evt.touches[0].pageY,\n        };\n        break;\n      case \"touchmove\":\n        if (this.touchSwipeState === null) {\n          return;\n        }\n        this.touchSwipeState.endX = evt.touches[0].pageX;\n        this.touchSwipeState.endY = evt.touches[0].pageY;\n        // Avoid the swipe from triggering browser gestures (Chrome in\n        // particular has some sort of swipe gesture in fullscreen mode).\n        evt.preventDefault();\n        break;\n      case \"touchend\":\n        if (this.touchSwipeState === null) {\n          return;\n        }\n        let delta = 0;\n        const dx = this.touchSwipeState.endX - this.touchSwipeState.startX;\n        const dy = this.touchSwipeState.endY - this.touchSwipeState.startY;\n        const absAngle = Math.abs(Math.atan2(dy, dx));\n        if (\n          Math.abs(dx) > SWIPE_MIN_DISTANCE_THRESHOLD &&\n          (absAngle <= SWIPE_ANGLE_THRESHOLD ||\n            absAngle >= Math.PI - SWIPE_ANGLE_THRESHOLD)\n        ) {\n          // Horizontal swipe.\n          delta = dx;\n        } else if (\n          Math.abs(dy) > SWIPE_MIN_DISTANCE_THRESHOLD &&\n          Math.abs(absAngle - Math.PI / 2) <= SWIPE_ANGLE_THRESHOLD\n        ) {\n          // Vertical swipe.\n          delta = dy;\n        }\n        if (delta > 0) {\n          this.pdfViewer.previousPage();\n        } else if (delta < 0) {\n          this.pdfViewer.nextPage();\n        }\n        break;\n    }\n  }\n\n  #addWindowListeners() {\n    if (this.#windowAbortController) {\n      return;\n    }\n    this.#windowAbortController = new AbortController();\n    const { signal } = this.#windowAbortController;\n\n    const touchSwipeBind = this.#touchSwipe.bind(this);\n\n    window.addEventListener(\"mousemove\", this.#showControls.bind(this), {\n      signal,\n    });\n    window.addEventListener(\"mousedown\", this.#mouseDown.bind(this), {\n      signal,\n    });\n    window.addEventListener(\"wheel\", this.#mouseWheel.bind(this), {\n      passive: false,\n      signal,\n    });\n    window.addEventListener(\"keydown\", this.#resetMouseScrollState.bind(this), {\n      signal,\n    });\n    window.addEventListener(\"contextmenu\", this.#contextMenu.bind(this), {\n      signal,\n    });\n    window.addEventListener(\"touchstart\", touchSwipeBind, { signal });\n    window.addEventListener(\"touchmove\", touchSwipeBind, { signal });\n    window.addEventListener(\"touchend\", touchSwipeBind, { signal });\n  }\n\n  #removeWindowListeners() {\n    this.#windowAbortController?.abort();\n    this.#windowAbortController = null;\n  }\n\n  #addFullscreenChangeListeners() {\n    if (this.#fullscreenChangeAbortController) {\n      return;\n    }\n    this.#fullscreenChangeAbortController = new AbortController();\n\n    window.addEventListener(\n      \"fullscreenchange\",\n      () => {\n        if (/* isFullscreen = */ document.fullscreenElement) {\n          this.#enter();\n        } else {\n          this.#exit();\n        }\n      },\n      { signal: this.#fullscreenChangeAbortController.signal }\n    );\n  }\n\n  #removeFullscreenChangeListeners() {\n    this.#fullscreenChangeAbortController?.abort();\n    this.#fullscreenChangeAbortController = null;\n  }\n}\n\nexport { PDFPresentationMode };\n","/* Copyright 2021 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/** @typedef {import(\"../src/display/api\").PDFPageProxy} PDFPageProxy */\n// eslint-disable-next-line max-len\n/** @typedef {import(\"../src/display/annotation_storage\").AnnotationStorage} AnnotationStorage */\n// eslint-disable-next-line max-len\n/** @typedef {import(\"../src/display/display_utils\").PageViewport} PageViewport */\n/** @typedef {import(\"./interfaces\").IPDFLinkService} IPDFLinkService */\n\nimport { XfaLayer } from \"pdfjs-lib\";\n\n/**\n * @typedef {Object} XfaLayerBuilderOptions\n * @property {PDFPageProxy} pdfPage\n * @property {AnnotationStorage} [annotationStorage]\n * @property {IPDFLinkService} linkService\n * @property {Object} [xfaHtml]\n */\n\nclass XfaLayerBuilder {\n  /**\n   * @param {XfaLayerBuilderOptions} options\n   */\n  constructor({\n    pdfPage,\n    annotationStorage = null,\n    linkService,\n    xfaHtml = null,\n  }) {\n    this.pdfPage = pdfPage;\n    this.annotationStorage = annotationStorage;\n    this.linkService = linkService;\n    this.xfaHtml = xfaHtml;\n\n    this.div = null;\n    this._cancelled = false;\n  }\n\n  /**\n   * @param {PageViewport} viewport\n   * @param {string} intent (default value is 'display')\n   * @returns {Promise<Object | void>} A promise that is resolved when rendering\n   *   of the XFA layer is complete. The first rendering will return an object\n   *   with a `textDivs` property that can be used with the TextHighlighter.\n   */\n  async render(viewport, intent = \"display\") {\n    if (intent === \"print\") {\n      const parameters = {\n        viewport: viewport.clone({ dontFlip: true }),\n        div: this.div,\n        xfaHtml: this.xfaHtml,\n        annotationStorage: this.annotationStorage,\n        linkService: this.linkService,\n        intent,\n      };\n\n      // Create an xfa layer div and render the form\n      this.div = document.createElement(\"div\");\n      parameters.div = this.div;\n\n      return XfaLayer.render(parameters);\n    }\n\n    // intent === \"display\"\n    const xfaHtml = await this.pdfPage.getXfa();\n    if (this._cancelled || !xfaHtml) {\n      return { textDivs: [] };\n    }\n\n    const parameters = {\n      viewport: viewport.clone({ dontFlip: true }),\n      div: this.div,\n      xfaHtml,\n      annotationStorage: this.annotationStorage,\n      linkService: this.linkService,\n      intent,\n    };\n\n    if (this.div) {\n      return XfaLayer.update(parameters);\n    }\n    // Create an xfa layer div and render the form\n    this.div = document.createElement(\"div\");\n    parameters.div = this.div;\n\n    return XfaLayer.render(parameters);\n  }\n\n  cancel() {\n    this._cancelled = true;\n  }\n\n  hide() {\n    if (!this.div) {\n      return;\n    }\n    this.div.hidden = true;\n  }\n}\n\nexport { XfaLayerBuilder };\n","/* Copyright 2016 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n// eslint-disable-next-line max-len\n/** @typedef {import(\"./interfaces.js\").IPDFPrintServiceFactory} IPDFPrintServiceFactory */\n\nimport {\n  AnnotationMode,\n  PixelsPerInch,\n  RenderingCancelledException,\n  shadow,\n} from \"pdfjs-lib\";\nimport { getXfaHtmlForPrinting } from \"./print_utils.js\";\n\nlet activeService = null;\nlet dialog = null;\nlet overlayManager = null;\nlet viewerApp = { initialized: false };\n\n// Renders the page to the canvas of the given print service, and returns\n// the suggested dimensions of the output page.\nfunction renderPage(\n  activeServiceOnEntry,\n  pdfDocument,\n  pageNumber,\n  size,\n  printResolution,\n  optionalContentConfigPromise,\n  printAnnotationStoragePromise\n) {\n  const scratchCanvas = activeService.scratchCanvas;\n\n  // The size of the canvas in pixels for printing.\n  const PRINT_UNITS = printResolution / PixelsPerInch.PDF;\n  scratchCanvas.width = Math.floor(size.width * PRINT_UNITS);\n  scratchCanvas.height = Math.floor(size.height * PRINT_UNITS);\n\n  const ctx = scratchCanvas.getContext(\"2d\");\n  ctx.save();\n  ctx.fillStyle = \"rgb(255, 255, 255)\";\n  ctx.fillRect(0, 0, scratchCanvas.width, scratchCanvas.height);\n  ctx.restore();\n\n  return Promise.all([\n    pdfDocument.getPage(pageNumber),\n    printAnnotationStoragePromise,\n  ]).then(function ([pdfPage, printAnnotationStorage]) {\n    const renderContext = {\n      canvasContext: ctx,\n      transform: [PRINT_UNITS, 0, 0, PRINT_UNITS, 0, 0],\n      viewport: pdfPage.getViewport({ scale: 1, rotation: size.rotation }),\n      intent: \"print\",\n      annotationMode: AnnotationMode.ENABLE_STORAGE,\n      optionalContentConfigPromise,\n      printAnnotationStorage,\n    };\n    const renderTask = pdfPage.render(renderContext);\n\n    return renderTask.promise.catch(reason => {\n      if (!(reason instanceof RenderingCancelledException)) {\n        console.error(reason);\n      }\n      throw reason;\n    });\n  });\n}\n\nclass PDFPrintService {\n  constructor({\n    pdfDocument,\n    pagesOverview,\n    printContainer,\n    printResolution,\n    printAnnotationStoragePromise = null,\n  }) {\n    this.pdfDocument = pdfDocument;\n    this.pagesOverview = pagesOverview;\n    this.printContainer = printContainer;\n    this._printResolution = printResolution || 150;\n    this._optionalContentConfigPromise = pdfDocument.getOptionalContentConfig({\n      intent: \"print\",\n    });\n    this._printAnnotationStoragePromise =\n      printAnnotationStoragePromise || Promise.resolve();\n    this.currentPage = -1;\n    // The temporary canvas where renderPage paints one page at a time.\n    this.scratchCanvas = document.createElement(\"canvas\");\n  }\n\n  layout() {\n    this.throwIfInactive();\n\n    const body = document.querySelector(\"body\");\n    body.setAttribute(\"data-pdfjsprinting\", true);\n\n    const { width, height } = this.pagesOverview[0];\n    const hasEqualPageSizes = this.pagesOverview.every(\n      size => size.width === width && size.height === height\n    );\n    if (!hasEqualPageSizes) {\n      console.warn(\n        \"Not all pages have the same size. The printed result may be incorrect!\"\n      );\n    }\n\n    // Insert a @page + size rule to make sure that the page size is correctly\n    // set. Note that we assume that all pages have the same size, because\n    // variable-size pages are not supported yet (e.g. in Chrome & Firefox).\n    // TODO(robwu): Use named pages when size calculation bugs get resolved\n    // (e.g. https://crbug.com/355116) AND when support for named pages is\n    // added (http://www.w3.org/TR/css3-page/#using-named-pages).\n    // In browsers where @page + size is not supported, the next stylesheet\n    // will be ignored and the user has to select the correct paper size in\n    // the UI if wanted.\n    this.pageStyleSheet = document.createElement(\"style\");\n    this.pageStyleSheet.textContent = `@page { size: ${width}pt ${height}pt;}`;\n    body.append(this.pageStyleSheet);\n  }\n\n  destroy() {\n    if (activeService !== this) {\n      // |activeService| cannot be replaced without calling destroy() first,\n      // so if it differs then an external consumer has a stale reference to us.\n      return;\n    }\n    this.printContainer.textContent = \"\";\n\n    const body = document.querySelector(\"body\");\n    body.removeAttribute(\"data-pdfjsprinting\");\n\n    if (this.pageStyleSheet) {\n      this.pageStyleSheet.remove();\n      this.pageStyleSheet = null;\n    }\n    this.scratchCanvas.width = this.scratchCanvas.height = 0;\n    this.scratchCanvas = null;\n    activeService = null;\n    ensureOverlay().then(function () {\n      if (overlayManager.active === dialog) {\n        overlayManager.close(dialog);\n      }\n    });\n  }\n\n  renderPages() {\n    if (this.pdfDocument.isPureXfa) {\n      getXfaHtmlForPrinting(this.printContainer, this.pdfDocument);\n      return Promise.resolve();\n    }\n\n    const pageCount = this.pagesOverview.length;\n    const renderNextPage = (resolve, reject) => {\n      this.throwIfInactive();\n      if (++this.currentPage >= pageCount) {\n        renderProgress(pageCount, pageCount);\n        resolve();\n        return;\n      }\n      const index = this.currentPage;\n      renderProgress(index, pageCount);\n      renderPage(\n        this,\n        this.pdfDocument,\n        /* pageNumber = */ index + 1,\n        this.pagesOverview[index],\n        this._printResolution,\n        this._optionalContentConfigPromise,\n        this._printAnnotationStoragePromise\n      )\n        .then(this.useRenderedPage.bind(this))\n        .then(function () {\n          renderNextPage(resolve, reject);\n        }, reject);\n    };\n    return new Promise(renderNextPage);\n  }\n\n  useRenderedPage() {\n    this.throwIfInactive();\n    const img = document.createElement(\"img\");\n    this.scratchCanvas.toBlob(blob => {\n      img.src = URL.createObjectURL(blob);\n    });\n\n    const wrapper = document.createElement(\"div\");\n    wrapper.className = \"printedPage\";\n    wrapper.append(img);\n    this.printContainer.append(wrapper);\n\n    const { promise, resolve, reject } = Promise.withResolvers();\n    img.onload = resolve;\n    img.onerror = reject;\n\n    promise\n      .catch(() => {\n        // Avoid \"Uncaught promise\" messages in the console.\n      })\n      .then(() => {\n        URL.revokeObjectURL(img.src);\n      });\n    return promise;\n  }\n\n  performPrint() {\n    this.throwIfInactive();\n    return new Promise(resolve => {\n      // Push window.print in the macrotask queue to avoid being affected by\n      // the deprecation of running print() code in a microtask, see\n      // https://github.com/mozilla/pdf.js/issues/7547.\n      setTimeout(() => {\n        if (!this.active) {\n          resolve();\n          return;\n        }\n        print.call(window);\n        // Delay promise resolution in case print() was not synchronous.\n        setTimeout(resolve, 20); // Tidy-up.\n      }, 0);\n    });\n  }\n\n  get active() {\n    return this === activeService;\n  }\n\n  throwIfInactive() {\n    if (!this.active) {\n      throw new Error(\"This print request was cancelled or completed.\");\n    }\n  }\n}\n\nconst print = window.print;\nwindow.print = function () {\n  if (activeService) {\n    console.warn(\"Ignored window.print() because of a pending print job.\");\n    return;\n  }\n  ensureOverlay().then(function () {\n    if (activeService) {\n      overlayManager.open(dialog);\n    }\n  });\n\n  try {\n    dispatchEvent(\"beforeprint\");\n  } finally {\n    if (!activeService) {\n      console.error(\"Expected print service to be initialized.\");\n      ensureOverlay().then(function () {\n        if (overlayManager.active === dialog) {\n          overlayManager.close(dialog);\n        }\n      });\n      return; // eslint-disable-line no-unsafe-finally\n    }\n    const activeServiceOnEntry = activeService;\n    activeService\n      .renderPages()\n      .then(function () {\n        return activeServiceOnEntry.performPrint();\n      })\n      .catch(function () {\n        // Ignore any error messages.\n      })\n      .then(function () {\n        // aborts acts on the \"active\" print request, so we need to check\n        // whether the print request (activeServiceOnEntry) is still active.\n        // Without the check, an unrelated print request (created after aborting\n        // this print request while the pages were being generated) would be\n        // aborted.\n        if (activeServiceOnEntry.active) {\n          abort();\n        }\n      });\n  }\n};\n\nfunction dispatchEvent(eventType) {\n  const event = new CustomEvent(eventType, {\n    bubbles: false,\n    cancelable: false,\n    detail: \"custom\",\n  });\n  window.dispatchEvent(event);\n}\n\nfunction abort() {\n  if (activeService) {\n    activeService.destroy();\n    dispatchEvent(\"afterprint\");\n  }\n}\n\nfunction renderProgress(index, total) {\n  if (typeof PDFJSDev === \"undefined\" && window.isGECKOVIEW) {\n    return;\n  }\n  dialog ||= document.getElementById(\"printServiceDialog\");\n  const progress = Math.round((100 * index) / total);\n  const progressBar = dialog.querySelector(\"progress\");\n  const progressPerc = dialog.querySelector(\".relative-progress\");\n  progressBar.value = progress;\n  progressPerc.setAttribute(\"data-l10n-args\", JSON.stringify({ progress }));\n}\n\nwindow.addEventListener(\n  \"keydown\",\n  function (event) {\n    // Intercept Cmd/Ctrl + P in all browsers.\n    // Also intercept Cmd/Ctrl + Shift + P in Chrome and Opera\n    if (\n      event.keyCode === /* P= */ 80 &&\n      (event.ctrlKey || event.metaKey) &&\n      !event.altKey &&\n      (!event.shiftKey || window.chrome || window.opera)\n    ) {\n      window.print();\n\n      event.preventDefault();\n      event.stopImmediatePropagation();\n    }\n  },\n  true\n);\n\nif (\"onbeforeprint\" in window) {\n  // Do not propagate before/afterprint events when they are not triggered\n  // from within this polyfill. (FF / Chrome 63+).\n  const stopPropagationIfNeeded = function (event) {\n    if (event.detail !== \"custom\") {\n      event.stopImmediatePropagation();\n    }\n  };\n  window.addEventListener(\"beforeprint\", stopPropagationIfNeeded);\n  window.addEventListener(\"afterprint\", stopPropagationIfNeeded);\n}\n\nlet overlayPromise;\nfunction ensureOverlay() {\n  if (typeof PDFJSDev === \"undefined\" && window.isGECKOVIEW) {\n    return Promise.reject(\n      new Error(\"ensureOverlay not implemented in GECKOVIEW development mode.\")\n    );\n  }\n  if (!overlayPromise) {\n    overlayManager = viewerApp.overlayManager;\n    if (!overlayManager) {\n      throw new Error(\"The overlay manager has not yet been initialized.\");\n    }\n    dialog ||= document.getElementById(\"printServiceDialog\");\n\n    overlayPromise = overlayManager.register(\n      dialog,\n      /* canForceClose = */ true\n    );\n\n    document.getElementById(\"printCancel\").onclick = abort;\n    dialog.addEventListener(\"close\", abort);\n  }\n  return overlayPromise;\n}\n\n/**\n * @implements {IPDFPrintServiceFactory}\n */\nclass PDFPrintServiceFactory {\n  static initGlobals(app) {\n    viewerApp = app;\n  }\n\n  static get supportsPrinting() {\n    return shadow(this, \"supportsPrinting\", true);\n  }\n\n  static createPrintService(params) {\n    if (activeService) {\n      throw new Error(\"The print service is created and active.\");\n    }\n    return (activeService = new PDFPrintService(params));\n  }\n}\n\nexport { PDFPrintServiceFactory };\n","/* Copyright 2021 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { getXfaPageViewport, PixelsPerInch } from \"pdfjs-lib\";\nimport { SimpleLinkService } from \"./pdf_link_service.js\";\nimport { XfaLayerBuilder } from \"./xfa_layer_builder.js\";\n\nfunction getXfaHtmlForPrinting(printContainer, pdfDocument) {\n  const xfaHtml = pdfDocument.allXfaHtml;\n  const linkService = new SimpleLinkService();\n  const scale = Math.round(PixelsPerInch.PDF_TO_CSS_UNITS * 100) / 100;\n\n  for (const xfaPage of xfaHtml.children) {\n    const page = document.createElement(\"div\");\n    page.className = \"xfaPrintedPage\";\n    printContainer.append(page);\n\n    const builder = new XfaLayerBuilder({\n      pdfPage: null,\n      annotationStorage: pdfDocument.annotationStorage,\n      linkService,\n      xfaHtml: xfaPage,\n    });\n    const viewport = getXfaPageViewport(xfaPage, { scale });\n\n    builder.render(viewport, \"print\");\n    page.append(builder.div);\n  }\n}\n\nexport { getXfaHtmlForPrinting };\n","/* Copyright 2012 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/** @typedef {import(\"./interfaces\").IRenderableView} IRenderableView */\n/** @typedef {import(\"./pdf_viewer\").PDFViewer} PDFViewer */\n// eslint-disable-next-line max-len\n/** @typedef {import(\"./pdf_thumbnail_viewer\").PDFThumbnailViewer} PDFThumbnailViewer */\n\nimport { RenderingCancelledException } from \"pdfjs-lib\";\nimport { RenderingStates } from \"./ui_utils.js\";\n\nconst CLEANUP_TIMEOUT = 30000;\n\n/**\n * Controls rendering of the views for pages and thumbnails.\n */\nclass PDFRenderingQueue {\n  constructor() {\n    this.pdfViewer = null;\n    this.pdfThumbnailViewer = null;\n    this.onIdle = null;\n    this.highestPriorityPage = null;\n    /** @type {number} */\n    this.idleTimeout = null;\n    this.printing = false;\n    this.isThumbnailViewEnabled = false;\n\n    if (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"GENERIC\")) {\n      Object.defineProperty(this, \"hasViewer\", {\n        value: () => !!this.pdfViewer,\n      });\n    }\n  }\n\n  /**\n   * @param {PDFViewer} pdfViewer\n   */\n  setViewer(pdfViewer) {\n    this.pdfViewer = pdfViewer;\n  }\n\n  /**\n   * @param {PDFThumbnailViewer} pdfThumbnailViewer\n   */\n  setThumbnailViewer(pdfThumbnailViewer) {\n    this.pdfThumbnailViewer = pdfThumbnailViewer;\n  }\n\n  /**\n   * @param {IRenderableView} view\n   * @returns {boolean}\n   */\n  isHighestPriority(view) {\n    return this.highestPriorityPage === view.renderingId;\n  }\n\n  /**\n   * @param {Object} currentlyVisiblePages\n   */\n  renderHighestPriority(currentlyVisiblePages) {\n    if (this.idleTimeout) {\n      clearTimeout(this.idleTimeout);\n      this.idleTimeout = null;\n    }\n\n    // Pages have a higher priority than thumbnails, so check them first.\n    if (this.pdfViewer.forceRendering(currentlyVisiblePages)) {\n      return;\n    }\n    // No pages needed rendering, so check thumbnails.\n    if (\n      this.isThumbnailViewEnabled &&\n      this.pdfThumbnailViewer?.forceRendering()\n    ) {\n      return;\n    }\n\n    if (this.printing) {\n      // If printing is currently ongoing do not reschedule cleanup.\n      return;\n    }\n\n    if (this.onIdle) {\n      this.idleTimeout = setTimeout(this.onIdle.bind(this), CLEANUP_TIMEOUT);\n    }\n  }\n\n  /**\n   * @param {Object} visible\n   * @param {Array} views\n   * @param {boolean} scrolledDown\n   * @param {boolean} [preRenderExtra]\n   */\n  getHighestPriority(visible, views, scrolledDown, preRenderExtra = false) {\n    /**\n     * The state has changed. Figure out which page has the highest priority to\n     * render next (if any).\n     *\n     * Priority:\n     * 1. visible pages\n     * 2. if last scrolled down, the page after the visible pages, or\n     *    if last scrolled up, the page before the visible pages\n     */\n    const visibleViews = visible.views,\n      numVisible = visibleViews.length;\n\n    if (numVisible === 0) {\n      return null;\n    }\n    for (let i = 0; i < numVisible; i++) {\n      const view = visibleViews[i].view;\n      if (!this.isViewFinished(view)) {\n        return view;\n      }\n    }\n    const firstId = visible.first.id,\n      lastId = visible.last.id;\n\n    // All the visible views have rendered; try to handle any \"holes\" in the\n    // page layout (can happen e.g. with spreadModes at higher zoom levels).\n    if (lastId - firstId + 1 > numVisible) {\n      const visibleIds = visible.ids;\n      for (let i = 1, ii = lastId - firstId; i < ii; i++) {\n        const holeId = scrolledDown ? firstId + i : lastId - i;\n        if (visibleIds.has(holeId)) {\n          continue;\n        }\n        const holeView = views[holeId - 1];\n        if (!this.isViewFinished(holeView)) {\n          return holeView;\n        }\n      }\n    }\n\n    // All the visible views have rendered; try to render next/previous page.\n    // (IDs start at 1, so no need to add 1 when `scrolledDown === true`.)\n    let preRenderIndex = scrolledDown ? lastId : firstId - 2;\n    let preRenderView = views[preRenderIndex];\n\n    if (preRenderView && !this.isViewFinished(preRenderView)) {\n      return preRenderView;\n    }\n    if (preRenderExtra) {\n      preRenderIndex += scrolledDown ? 1 : -1;\n      preRenderView = views[preRenderIndex];\n\n      if (preRenderView && !this.isViewFinished(preRenderView)) {\n        return preRenderView;\n      }\n    }\n    // Everything that needs to be rendered has been.\n    return null;\n  }\n\n  /**\n   * @param {IRenderableView} view\n   * @returns {boolean}\n   */\n  isViewFinished(view) {\n    return view.renderingState === RenderingStates.FINISHED;\n  }\n\n  /**\n   * Render a page or thumbnail view. This calls the appropriate function\n   * based on the views state. If the view is already rendered it will return\n   * `false`.\n   *\n   * @param {IRenderableView} view\n   */\n  renderView(view) {\n    switch (view.renderingState) {\n      case RenderingStates.FINISHED:\n        return false;\n      case RenderingStates.PAUSED:\n        this.highestPriorityPage = view.renderingId;\n        view.resume();\n        break;\n      case RenderingStates.RUNNING:\n        this.highestPriorityPage = view.renderingId;\n        break;\n      case RenderingStates.INITIAL:\n        this.highestPriorityPage = view.renderingId;\n        view\n          .draw()\n          .finally(() => {\n            this.renderHighestPriority();\n          })\n          .catch(reason => {\n            if (reason instanceof RenderingCancelledException) {\n              return;\n            }\n            console.error(`renderView: \"${reason}\"`);\n          });\n        break;\n    }\n    return true;\n  }\n}\n\nexport { PDFRenderingQueue };\n","/* Copyright 2021 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/** @typedef {import(\"./event_utils\").EventBus} EventBus */\n\nimport { apiPageLayoutToViewerModes, RenderingStates } from \"./ui_utils.js\";\nimport { shadow } from \"pdfjs-lib\";\n\n/**\n * @typedef {Object} PDFScriptingManagerOptions\n * @property {EventBus} eventBus - The application event bus.\n * @property {string} [sandboxBundleSrc] - The path and filename of the\n *   scripting bundle.\n * @property {Object} [externalServices] - The factory that is used when\n *   initializing scripting; must contain a `createScripting` method.\n *   PLEASE NOTE: Primarily intended for the default viewer use-case.\n * @property {function} [docProperties] - The function that is used to lookup\n *   the necessary document properties.\n */\n\nclass PDFScriptingManager {\n  #closeCapability = null;\n\n  #destroyCapability = null;\n\n  #docProperties = null;\n\n  #eventAbortController = null;\n\n  #eventBus = null;\n\n  #externalServices = null;\n\n  #pdfDocument = null;\n\n  #pdfViewer = null;\n\n  #ready = false;\n\n  #scripting = null;\n\n  #willPrintCapability = null;\n\n  /**\n   * @param {PDFScriptingManagerOptions} options\n   */\n  constructor({ eventBus, externalServices = null, docProperties = null }) {\n    this.#eventBus = eventBus;\n    this.#externalServices = externalServices;\n    this.#docProperties = docProperties;\n\n    if (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"TESTING\")) {\n      Object.defineProperty(this, \"sandboxTrip\", {\n        value: () =>\n          setTimeout(\n            () =>\n              this.#scripting?.dispatchEventInSandbox({\n                name: \"sandboxtripbegin\",\n              }),\n            0\n          ),\n      });\n    }\n  }\n\n  setViewer(pdfViewer) {\n    this.#pdfViewer = pdfViewer;\n  }\n\n  async setDocument(pdfDocument) {\n    if (this.#pdfDocument) {\n      await this.#destroyScripting();\n    }\n    this.#pdfDocument = pdfDocument;\n\n    if (!pdfDocument) {\n      return;\n    }\n    const [objects, calculationOrder, docActions] = await Promise.all([\n      pdfDocument.getFieldObjects(),\n      pdfDocument.getCalculationOrderIds(),\n      pdfDocument.getJSActions(),\n    ]);\n\n    if (!objects && !docActions) {\n      // No FieldObjects or JavaScript actions were found in the document.\n      await this.#destroyScripting();\n      return;\n    }\n    if (pdfDocument !== this.#pdfDocument) {\n      return; // The document was closed while the data resolved.\n    }\n    try {\n      this.#scripting = this.#initScripting();\n    } catch (error) {\n      console.error(`setDocument: \"${error.message}\".`);\n\n      await this.#destroyScripting();\n      return;\n    }\n    const eventBus = this.#eventBus;\n\n    this.#eventAbortController = new AbortController();\n    const { signal } = this.#eventAbortController;\n\n    eventBus._on(\n      \"updatefromsandbox\",\n      event => {\n        if (event?.source === window) {\n          this.#updateFromSandbox(event.detail);\n        }\n      },\n      { signal }\n    );\n    eventBus._on(\n      \"dispatcheventinsandbox\",\n      event => {\n        this.#scripting?.dispatchEventInSandbox(event.detail);\n      },\n      { signal }\n    );\n\n    eventBus._on(\n      \"pagechanging\",\n      ({ pageNumber, previous }) => {\n        if (pageNumber === previous) {\n          return; // The current page didn't change.\n        }\n        this.#dispatchPageClose(previous);\n        this.#dispatchPageOpen(pageNumber);\n      },\n      { signal }\n    );\n    eventBus._on(\n      \"pagerendered\",\n      ({ pageNumber }) => {\n        if (!this._pageOpenPending.has(pageNumber)) {\n          return; // No pending \"PageOpen\" event for the newly rendered page.\n        }\n        if (pageNumber !== this.#pdfViewer.currentPageNumber) {\n          return; // The newly rendered page is no longer the current one.\n        }\n        this.#dispatchPageOpen(pageNumber);\n      },\n      { signal }\n    );\n    eventBus._on(\n      \"pagesdestroy\",\n      async () => {\n        await this.#dispatchPageClose(this.#pdfViewer.currentPageNumber);\n\n        await this.#scripting?.dispatchEventInSandbox({\n          id: \"doc\",\n          name: \"WillClose\",\n        });\n\n        this.#closeCapability?.resolve();\n      },\n      { signal }\n    );\n\n    try {\n      const docProperties = await this.#docProperties(pdfDocument);\n      if (pdfDocument !== this.#pdfDocument) {\n        return; // The document was closed while the properties resolved.\n      }\n\n      await this.#scripting.createSandbox({\n        objects,\n        calculationOrder,\n        appInfo: {\n          platform: navigator.platform,\n          language: navigator.language,\n        },\n        docInfo: {\n          ...docProperties,\n          actions: docActions,\n        },\n      });\n\n      eventBus.dispatch(\"sandboxcreated\", { source: this });\n    } catch (error) {\n      console.error(`setDocument: \"${error.message}\".`);\n\n      await this.#destroyScripting();\n      return;\n    }\n\n    await this.#scripting?.dispatchEventInSandbox({\n      id: \"doc\",\n      name: \"Open\",\n    });\n    await this.#dispatchPageOpen(\n      this.#pdfViewer.currentPageNumber,\n      /* initialize = */ true\n    );\n\n    // Defer this slightly, to ensure that scripting is *fully* initialized.\n    Promise.resolve().then(() => {\n      if (pdfDocument === this.#pdfDocument) {\n        this.#ready = true;\n      }\n    });\n  }\n\n  async dispatchWillSave() {\n    return this.#scripting?.dispatchEventInSandbox({\n      id: \"doc\",\n      name: \"WillSave\",\n    });\n  }\n\n  async dispatchDidSave() {\n    return this.#scripting?.dispatchEventInSandbox({\n      id: \"doc\",\n      name: \"DidSave\",\n    });\n  }\n\n  async dispatchWillPrint() {\n    if (!this.#scripting) {\n      return;\n    }\n    await this.#willPrintCapability?.promise;\n    this.#willPrintCapability = Promise.withResolvers();\n    try {\n      await this.#scripting.dispatchEventInSandbox({\n        id: \"doc\",\n        name: \"WillPrint\",\n      });\n    } catch (ex) {\n      this.#willPrintCapability.resolve();\n      this.#willPrintCapability = null;\n      throw ex;\n    }\n\n    await this.#willPrintCapability.promise;\n  }\n\n  async dispatchDidPrint() {\n    return this.#scripting?.dispatchEventInSandbox({\n      id: \"doc\",\n      name: \"DidPrint\",\n    });\n  }\n\n  get destroyPromise() {\n    return this.#destroyCapability?.promise || null;\n  }\n\n  get ready() {\n    return this.#ready;\n  }\n\n  /**\n   * @private\n   */\n  get _pageOpenPending() {\n    return shadow(this, \"_pageOpenPending\", new Set());\n  }\n\n  /**\n   * @private\n   */\n  get _visitedPages() {\n    return shadow(this, \"_visitedPages\", new Map());\n  }\n\n  async #updateFromSandbox(detail) {\n    const pdfViewer = this.#pdfViewer;\n    // Ignore some events, see below, that don't make sense in PresentationMode.\n    const isInPresentationMode =\n      pdfViewer.isInPresentationMode || pdfViewer.isChangingPresentationMode;\n\n    const { id, siblings, command, value } = detail;\n    if (!id) {\n      if (\n        typeof PDFJSDev !== \"undefined\" &&\n        PDFJSDev.test(\"TESTING\") &&\n        command === \"sandboxTripEnd\"\n      ) {\n        window.setTimeout(() => {\n          window.dispatchEvent(new CustomEvent(\"sandboxtripend\"));\n        }, 0);\n        return;\n      }\n\n      switch (command) {\n        case \"clear\":\n          console.clear();\n          break;\n        case \"error\":\n          console.error(value);\n          break;\n        case \"layout\":\n          if (!isInPresentationMode) {\n            const modes = apiPageLayoutToViewerModes(value);\n            pdfViewer.spreadMode = modes.spreadMode;\n          }\n          break;\n        case \"page-num\":\n          pdfViewer.currentPageNumber = value + 1;\n          break;\n        case \"print\":\n          await pdfViewer.pagesPromise;\n          this.#eventBus.dispatch(\"print\", { source: this });\n          break;\n        case \"println\":\n          console.log(value);\n          break;\n        case \"zoom\":\n          if (!isInPresentationMode) {\n            pdfViewer.currentScaleValue = value;\n          }\n          break;\n        case \"SaveAs\":\n          this.#eventBus.dispatch(\"download\", { source: this });\n          break;\n        case \"FirstPage\":\n          pdfViewer.currentPageNumber = 1;\n          break;\n        case \"LastPage\":\n          pdfViewer.currentPageNumber = pdfViewer.pagesCount;\n          break;\n        case \"NextPage\":\n          pdfViewer.nextPage();\n          break;\n        case \"PrevPage\":\n          pdfViewer.previousPage();\n          break;\n        case \"ZoomViewIn\":\n          if (!isInPresentationMode) {\n            pdfViewer.increaseScale();\n          }\n          break;\n        case \"ZoomViewOut\":\n          if (!isInPresentationMode) {\n            pdfViewer.decreaseScale();\n          }\n          break;\n        case \"WillPrintFinished\":\n          this.#willPrintCapability?.resolve();\n          this.#willPrintCapability = null;\n          break;\n      }\n      return;\n    }\n\n    if (isInPresentationMode && detail.focus) {\n      return;\n    }\n    delete detail.id;\n    delete detail.siblings;\n\n    const ids = siblings ? [id, ...siblings] : [id];\n    for (const elementId of ids) {\n      const element = document.querySelector(\n        `[data-element-id=\"${elementId}\"]`\n      );\n      if (element) {\n        element.dispatchEvent(new CustomEvent(\"updatefromsandbox\", { detail }));\n      } else {\n        // The element hasn't been rendered yet, use the AnnotationStorage.\n        this.#pdfDocument?.annotationStorage.setValue(elementId, detail);\n      }\n    }\n  }\n\n  async #dispatchPageOpen(pageNumber, initialize = false) {\n    const pdfDocument = this.#pdfDocument,\n      visitedPages = this._visitedPages;\n\n    if (initialize) {\n      this.#closeCapability = Promise.withResolvers();\n    }\n    if (!this.#closeCapability) {\n      return; // Scripting isn't fully initialized yet.\n    }\n    const pageView = this.#pdfViewer.getPageView(/* index = */ pageNumber - 1);\n\n    if (pageView?.renderingState !== RenderingStates.FINISHED) {\n      this._pageOpenPending.add(pageNumber);\n      return; // Wait for the page to finish rendering.\n    }\n    this._pageOpenPending.delete(pageNumber);\n\n    const actionsPromise = (async () => {\n      // Avoid sending, and thus serializing, the `actions` data more than once.\n      const actions = await (!visitedPages.has(pageNumber)\n        ? pageView.pdfPage?.getJSActions()\n        : null);\n      if (pdfDocument !== this.#pdfDocument) {\n        return; // The document was closed while the actions resolved.\n      }\n\n      await this.#scripting?.dispatchEventInSandbox({\n        id: \"page\",\n        name: \"PageOpen\",\n        pageNumber,\n        actions,\n      });\n    })();\n    visitedPages.set(pageNumber, actionsPromise);\n  }\n\n  async #dispatchPageClose(pageNumber) {\n    const pdfDocument = this.#pdfDocument,\n      visitedPages = this._visitedPages;\n\n    if (!this.#closeCapability) {\n      return; // Scripting isn't fully initialized yet.\n    }\n    if (this._pageOpenPending.has(pageNumber)) {\n      return; // The page is still rendering; no \"PageOpen\" event dispatched.\n    }\n    const actionsPromise = visitedPages.get(pageNumber);\n    if (!actionsPromise) {\n      return; // The \"PageClose\" event must be preceded by a \"PageOpen\" event.\n    }\n    visitedPages.set(pageNumber, null);\n\n    // Ensure that the \"PageOpen\" event is dispatched first.\n    await actionsPromise;\n    if (pdfDocument !== this.#pdfDocument) {\n      return; // The document was closed while the actions resolved.\n    }\n\n    await this.#scripting?.dispatchEventInSandbox({\n      id: \"page\",\n      name: \"PageClose\",\n      pageNumber,\n    });\n  }\n\n  #initScripting() {\n    this.#destroyCapability = Promise.withResolvers();\n\n    if (this.#scripting) {\n      throw new Error(\"#initScripting: Scripting already exists.\");\n    }\n    return this.#externalServices.createScripting();\n  }\n\n  async #destroyScripting() {\n    if (!this.#scripting) {\n      this.#pdfDocument = null;\n\n      this.#destroyCapability?.resolve();\n      return;\n    }\n    if (this.#closeCapability) {\n      await Promise.race([\n        this.#closeCapability.promise,\n        new Promise(resolve => {\n          // Avoid the scripting/sandbox-destruction hanging indefinitely.\n          setTimeout(resolve, 1000);\n        }),\n      ]).catch(() => {\n        // Ignore any errors, to ensure that the sandbox is always destroyed.\n      });\n      this.#closeCapability = null;\n    }\n    this.#pdfDocument = null;\n\n    try {\n      await this.#scripting.destroySandbox();\n    } catch {}\n\n    this.#willPrintCapability?.reject(new Error(\"Scripting destroyed.\"));\n    this.#willPrintCapability = null;\n\n    this.#eventAbortController?.abort();\n    this.#eventAbortController = null;\n\n    this._pageOpenPending.clear();\n    this._visitedPages.clear();\n\n    this.#scripting = null;\n    this.#ready = false;\n\n    this.#destroyCapability?.resolve();\n  }\n}\n\nexport { PDFScriptingManager };\n","/* Copyright 2016 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/** @typedef {import(\"./event_utils.js\").EventBus} EventBus */\n/** @typedef {import(\"./interfaces.js\").IL10n} IL10n */\n\nimport {\n  docStyle,\n  PresentationModeState,\n  SidebarView,\n  toggleCheckedBtn,\n  toggleExpandedBtn,\n} from \"./ui_utils.js\";\n\nconst SIDEBAR_WIDTH_VAR = \"--sidebar-width\";\nconst SIDEBAR_MIN_WIDTH = 200; // pixels\nconst SIDEBAR_RESIZING_CLASS = \"sidebarResizing\";\nconst UI_NOTIFICATION_CLASS = \"pdfSidebarNotification\";\n\n/**\n * @typedef {Object} PDFSidebarOptions\n * @property {PDFSidebarElements} elements - The DOM elements.\n * @property {EventBus} eventBus - The application event bus.\n * @property {IL10n} l10n - The localization service.\n */\n\n/**\n * @typedef {Object} PDFSidebarElements\n * @property {HTMLDivElement} outerContainer - The outer container\n *   (encasing both the viewer and sidebar elements).\n * @property {HTMLDivElement} sidebarContainer - The sidebar container\n *   (in which the views are placed).\n * @property {HTMLButtonElement} toggleButton - The button used for\n *   opening/closing the sidebar.\n * @property {HTMLDivElement} resizer - The DOM element that can be dragged in\n *   order to adjust the width of the sidebar.\n * @property {HTMLButtonElement} thumbnailButton - The button used to show\n *   the thumbnail view.\n * @property {HTMLButtonElement} outlineButton - The button used to show\n *   the outline view.\n * @property {HTMLButtonElement} attachmentsButton - The button used to show\n *   the attachments view.\n * @property {HTMLButtonElement} layersButton - The button used to show\n *   the layers view.\n * @property {HTMLDivElement} thumbnailView - The container in which\n *   the thumbnails are placed.\n * @property {HTMLDivElement} outlineView - The container in which\n *   the outline is placed.\n * @property {HTMLDivElement} attachmentsView - The container in which\n *   the attachments are placed.\n * @property {HTMLDivElement} layersView - The container in which\n *   the layers are placed.\n * @property {HTMLButtonElement} currentOutlineItemButton - The button used to\n *   find the current outline item.\n */\n\nclass PDFSidebar {\n  #isRTL = false;\n\n  #mouseAC = null;\n\n  #outerContainerWidth = null;\n\n  #width = null;\n\n  /**\n   * @param {PDFSidebarOptions} options\n   */\n  constructor({ elements, eventBus, l10n }) {\n    this.isOpen = false;\n    this.active = SidebarView.THUMBS;\n    this.isInitialViewSet = false;\n    this.isInitialEventDispatched = false;\n\n    /**\n     * Callback used when the sidebar has been opened/closed, to ensure that\n     * the viewers (PDFViewer/PDFThumbnailViewer) are updated correctly.\n     */\n    this.onToggled = null;\n    this.onUpdateThumbnails = null;\n\n    this.outerContainer = elements.outerContainer;\n    this.sidebarContainer = elements.sidebarContainer;\n    this.toggleButton = elements.toggleButton;\n    this.resizer = elements.resizer;\n\n    this.thumbnailButton = elements.thumbnailButton;\n    this.outlineButton = elements.outlineButton;\n    this.attachmentsButton = elements.attachmentsButton;\n    this.layersButton = elements.layersButton;\n\n    this.thumbnailView = elements.thumbnailView;\n    this.outlineView = elements.outlineView;\n    this.attachmentsView = elements.attachmentsView;\n    this.layersView = elements.layersView;\n\n    this._currentOutlineItemButton = elements.currentOutlineItemButton;\n\n    this.eventBus = eventBus;\n\n    this.#isRTL = l10n.getDirection() === \"rtl\";\n    this.#addEventListeners();\n  }\n\n  reset() {\n    this.isInitialViewSet = false;\n    this.isInitialEventDispatched = false;\n\n    this.#hideUINotification(/* reset = */ true);\n    this.switchView(SidebarView.THUMBS);\n\n    this.outlineButton.disabled = false;\n    this.attachmentsButton.disabled = false;\n    this.layersButton.disabled = false;\n    this._currentOutlineItemButton.disabled = true;\n  }\n\n  /**\n   * @type {number} One of the values in {SidebarView}.\n   */\n  get visibleView() {\n    return this.isOpen ? this.active : SidebarView.NONE;\n  }\n\n  /**\n   * @param {number} view - The sidebar view that should become visible,\n   *                        must be one of the values in {SidebarView}.\n   */\n  setInitialView(view = SidebarView.NONE) {\n    if (this.isInitialViewSet) {\n      return;\n    }\n    this.isInitialViewSet = true;\n\n    // If the user has already manually opened the sidebar, immediately closing\n    // it would be bad UX; also ignore the \"unknown\" sidebar view value.\n    if (view === SidebarView.NONE || view === SidebarView.UNKNOWN) {\n      this.#dispatchEvent();\n      return;\n    }\n    this.switchView(view, /* forceOpen = */ true);\n\n    // Prevent dispatching two back-to-back \"sidebarviewchanged\" events,\n    // since `this.switchView` dispatched the event if the view changed.\n    if (!this.isInitialEventDispatched) {\n      this.#dispatchEvent();\n    }\n  }\n\n  /**\n   * @param {number} view - The sidebar view that should be switched to,\n   *                        must be one of the values in {SidebarView}.\n   * @param {boolean} [forceOpen] - Ensure that the sidebar is open.\n   *                                The default value is `false`.\n   */\n  switchView(view, forceOpen = false) {\n    const isViewChanged = view !== this.active;\n    let forceRendering = false;\n\n    switch (view) {\n      case SidebarView.NONE:\n        if (this.isOpen) {\n          this.close();\n        }\n        return; // Closing will trigger rendering and dispatch the event.\n      case SidebarView.THUMBS:\n        if (this.isOpen && isViewChanged) {\n          forceRendering = true;\n        }\n        break;\n      case SidebarView.OUTLINE:\n        if (this.outlineButton.disabled) {\n          return;\n        }\n        break;\n      case SidebarView.ATTACHMENTS:\n        if (this.attachmentsButton.disabled) {\n          return;\n        }\n        break;\n      case SidebarView.LAYERS:\n        if (this.layersButton.disabled) {\n          return;\n        }\n        break;\n      default:\n        console.error(`PDFSidebar.switchView: \"${view}\" is not a valid view.`);\n        return;\n    }\n    // Update the active view *after* it has been validated above,\n    // in order to prevent setting it to an invalid state.\n    this.active = view;\n\n    // Update the CSS classes (and aria attributes), for all buttons and views.\n    toggleCheckedBtn(\n      this.thumbnailButton,\n      view === SidebarView.THUMBS,\n      this.thumbnailView\n    );\n    toggleCheckedBtn(\n      this.outlineButton,\n      view === SidebarView.OUTLINE,\n      this.outlineView\n    );\n    toggleCheckedBtn(\n      this.attachmentsButton,\n      view === SidebarView.ATTACHMENTS,\n      this.attachmentsView\n    );\n    toggleCheckedBtn(\n      this.layersButton,\n      view === SidebarView.LAYERS,\n      this.layersView\n    );\n\n    if (forceOpen && !this.isOpen) {\n      this.open();\n      return; // Opening will trigger rendering and dispatch the event.\n    }\n    if (forceRendering) {\n      this.onUpdateThumbnails();\n      this.onToggled();\n    }\n    if (isViewChanged) {\n      this.#dispatchEvent();\n    }\n  }\n\n  open() {\n    if (this.isOpen) {\n      return;\n    }\n    this.isOpen = true;\n    toggleExpandedBtn(this.toggleButton, true);\n\n    this.outerContainer.classList.add(\"sidebarMoving\", \"sidebarOpen\");\n\n    if (this.active === SidebarView.THUMBS) {\n      this.onUpdateThumbnails();\n    }\n    this.onToggled();\n    this.#dispatchEvent();\n\n    this.#hideUINotification();\n  }\n\n  close(evt = null) {\n    if (!this.isOpen) {\n      return;\n    }\n    this.isOpen = false;\n    toggleExpandedBtn(this.toggleButton, false);\n\n    this.outerContainer.classList.add(\"sidebarMoving\");\n    this.outerContainer.classList.remove(\"sidebarOpen\");\n\n    this.onToggled();\n    this.#dispatchEvent();\n\n    if (evt?.detail > 0) {\n      // Remove focus from the toggleButton if it's clicked (see issue 17361).\n      this.toggleButton.blur();\n    }\n  }\n\n  toggle(evt = null) {\n    if (this.isOpen) {\n      this.close(evt);\n    } else {\n      this.open();\n    }\n  }\n\n  #dispatchEvent() {\n    if (this.isInitialViewSet) {\n      this.isInitialEventDispatched ||= true;\n    }\n\n    this.eventBus.dispatch(\"sidebarviewchanged\", {\n      source: this,\n      view: this.visibleView,\n    });\n  }\n\n  #showUINotification() {\n    this.toggleButton.setAttribute(\n      \"data-l10n-id\",\n      \"pdfjs-toggle-sidebar-notification-button\"\n    );\n\n    if (!this.isOpen) {\n      // Only show the notification on the `toggleButton` if the sidebar is\n      // currently closed, to avoid unnecessarily bothering the user.\n      this.toggleButton.classList.add(UI_NOTIFICATION_CLASS);\n    }\n  }\n\n  #hideUINotification(reset = false) {\n    if (this.isOpen || reset) {\n      // Only hide the notification on the `toggleButton` if the sidebar is\n      // currently open, or when the current PDF document is being closed.\n      this.toggleButton.classList.remove(UI_NOTIFICATION_CLASS);\n    }\n\n    if (reset) {\n      this.toggleButton.setAttribute(\n        \"data-l10n-id\",\n        \"pdfjs-toggle-sidebar-button\"\n      );\n    }\n  }\n\n  #addEventListeners() {\n    const { eventBus, outerContainer } = this;\n\n    this.sidebarContainer.addEventListener(\"transitionend\", evt => {\n      if (evt.target === this.sidebarContainer) {\n        outerContainer.classList.remove(\"sidebarMoving\");\n        // Ensure that rendering is triggered after opening/closing the sidebar.\n        eventBus.dispatch(\"resize\", { source: this });\n      }\n    });\n\n    this.toggleButton.addEventListener(\"click\", evt => {\n      this.toggle(evt);\n    });\n\n    // Buttons for switching views.\n    this.thumbnailButton.addEventListener(\"click\", () => {\n      this.switchView(SidebarView.THUMBS);\n    });\n\n    this.outlineButton.addEventListener(\"click\", () => {\n      this.switchView(SidebarView.OUTLINE);\n    });\n    this.outlineButton.addEventListener(\"dblclick\", () => {\n      eventBus.dispatch(\"toggleoutlinetree\", { source: this });\n    });\n\n    this.attachmentsButton.addEventListener(\"click\", () => {\n      this.switchView(SidebarView.ATTACHMENTS);\n    });\n\n    this.layersButton.addEventListener(\"click\", () => {\n      this.switchView(SidebarView.LAYERS);\n    });\n    this.layersButton.addEventListener(\"dblclick\", () => {\n      eventBus.dispatch(\"resetlayers\", { source: this });\n    });\n\n    // Buttons for view-specific options.\n    this._currentOutlineItemButton.addEventListener(\"click\", () => {\n      eventBus.dispatch(\"currentoutlineitem\", { source: this });\n    });\n\n    // Disable/enable views.\n    const onTreeLoaded = (count, button, view) => {\n      button.disabled = !count;\n\n      if (count) {\n        this.#showUINotification();\n      } else if (this.active === view) {\n        // If the `view` was opened by the user during document load,\n        // switch away from it if it turns out to be empty.\n        this.switchView(SidebarView.THUMBS);\n      }\n    };\n\n    eventBus._on(\"outlineloaded\", evt => {\n      onTreeLoaded(evt.outlineCount, this.outlineButton, SidebarView.OUTLINE);\n\n      evt.currentOutlineItemPromise.then(enabled => {\n        if (!this.isInitialViewSet) {\n          return;\n        }\n        this._currentOutlineItemButton.disabled = !enabled;\n      });\n    });\n\n    eventBus._on(\"attachmentsloaded\", evt => {\n      onTreeLoaded(\n        evt.attachmentsCount,\n        this.attachmentsButton,\n        SidebarView.ATTACHMENTS\n      );\n    });\n\n    eventBus._on(\"layersloaded\", evt => {\n      onTreeLoaded(evt.layersCount, this.layersButton, SidebarView.LAYERS);\n    });\n\n    // Update the thumbnailViewer, if visible, when exiting presentation mode.\n    eventBus._on(\"presentationmodechanged\", evt => {\n      if (\n        evt.state === PresentationModeState.NORMAL &&\n        this.visibleView === SidebarView.THUMBS\n      ) {\n        this.onUpdateThumbnails();\n      }\n    });\n\n    // Handle resizing of the sidebar.\n    this.resizer.addEventListener(\"mousedown\", evt => {\n      if (evt.button !== 0) {\n        return;\n      }\n      // Disable the `transition-duration` rules when sidebar resizing begins,\n      // in order to improve responsiveness and to avoid visual glitches.\n      outerContainer.classList.add(SIDEBAR_RESIZING_CLASS);\n\n      this.#mouseAC = new AbortController();\n      const opts = { signal: this.#mouseAC.signal };\n\n      window.addEventListener(\"mousemove\", this.#mouseMove.bind(this), opts);\n      window.addEventListener(\"mouseup\", this.#mouseUp.bind(this), opts);\n      window.addEventListener(\"blur\", this.#mouseUp.bind(this), opts);\n    });\n\n    eventBus._on(\"resize\", evt => {\n      // When the *entire* viewer is resized, such that it becomes narrower,\n      // ensure that the sidebar doesn't end up being too wide.\n      if (evt.source !== window) {\n        return;\n      }\n      // Always reset the cached width when the viewer is resized.\n      this.#outerContainerWidth = null;\n\n      if (!this.#width) {\n        // The sidebar hasn't been resized, hence no need to adjust its width.\n        return;\n      }\n      // NOTE: If the sidebar is closed, we don't need to worry about\n      //       visual glitches nor ensure that rendering is triggered.\n      if (!this.isOpen) {\n        this.#updateWidth(this.#width);\n        return;\n      }\n      outerContainer.classList.add(SIDEBAR_RESIZING_CLASS);\n      const updated = this.#updateWidth(this.#width);\n\n      Promise.resolve().then(() => {\n        outerContainer.classList.remove(SIDEBAR_RESIZING_CLASS);\n        // Trigger rendering if the sidebar width changed, to avoid\n        // depending on the order in which 'resize' events are handled.\n        if (updated) {\n          eventBus.dispatch(\"resize\", { source: this });\n        }\n      });\n    });\n  }\n\n  /**\n   * @type {number}\n   */\n  get outerContainerWidth() {\n    return (this.#outerContainerWidth ||= this.outerContainer.clientWidth);\n  }\n\n  /**\n   * returns {boolean} Indicating if the sidebar width was updated.\n   */\n  #updateWidth(width = 0) {\n    // Prevent the sidebar from becoming too narrow, or from occupying more\n    // than half of the available viewer width.\n    const maxWidth = Math.floor(this.outerContainerWidth / 2);\n    if (width > maxWidth) {\n      width = maxWidth;\n    }\n    if (width < SIDEBAR_MIN_WIDTH) {\n      width = SIDEBAR_MIN_WIDTH;\n    }\n    // Only update the UI when the sidebar width did in fact change.\n    if (width === this.#width) {\n      return false;\n    }\n    this.#width = width;\n\n    docStyle.setProperty(SIDEBAR_WIDTH_VAR, `${width}px`);\n    return true;\n  }\n\n  #mouseMove(evt) {\n    let width = evt.clientX;\n    // For sidebar resizing to work correctly in RTL mode, invert the width.\n    if (this.#isRTL) {\n      width = this.outerContainerWidth - width;\n    }\n    this.#updateWidth(width);\n  }\n\n  #mouseUp(evt) {\n    // Re-enable the `transition-duration` rules when sidebar resizing ends...\n    this.outerContainer.classList.remove(SIDEBAR_RESIZING_CLASS);\n    // ... and ensure that rendering will always be triggered.\n    this.eventBus.dispatch(\"resize\", { source: this });\n\n    this.#mouseAC?.abort();\n    this.#mouseAC = null;\n  }\n}\n\nexport { PDFSidebar };\n","/* Copyright 2012 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n// eslint-disable-next-line max-len\n/** @typedef {import(\"../src/display/optional_content_config\").OptionalContentConfig} OptionalContentConfig */\n// eslint-disable-next-line max-len\n/** @typedef {import(\"../src/display/display_utils\").PageViewport} PageViewport */\n/** @typedef {import(\"./event_utils\").EventBus} EventBus */\n/** @typedef {import(\"./interfaces\").IPDFLinkService} IPDFLinkService */\n/** @typedef {import(\"./interfaces\").IRenderableView} IRenderableView */\n// eslint-disable-next-line max-len\n/** @typedef {import(\"./pdf_rendering_queue\").PDFRenderingQueue} PDFRenderingQueue */\n\nimport { OutputScale, RenderingCancelledException } from \"pdfjs-lib\";\nimport { RenderingStates } from \"./ui_utils.js\";\n\nconst DRAW_UPSCALE_FACTOR = 2; // See comment in `PDFThumbnailView.draw` below.\nconst MAX_NUM_SCALING_STEPS = 3;\nconst THUMBNAIL_WIDTH = 98; // px\n\n/**\n * @typedef {Object} PDFThumbnailViewOptions\n * @property {HTMLDivElement} container - The viewer element.\n * @property {EventBus} eventBus - The application event bus.\n * @property {number} id - The thumbnail's unique ID (normally its number).\n * @property {PageViewport} defaultViewport - The page viewport.\n * @property {Promise<OptionalContentConfig>} [optionalContentConfigPromise] -\n *   A promise that is resolved with an {@link OptionalContentConfig} instance.\n *   The default value is `null`.\n * @property {IPDFLinkService} linkService - The navigation/linking service.\n * @property {PDFRenderingQueue} renderingQueue - The rendering queue object.\n * @property {Object} [pageColors] - Overwrites background and foreground colors\n *   with user defined ones in order to improve readability in high contrast\n *   mode.\n * @property {boolean} [enableHWA] - Enables hardware acceleration for\n *   rendering. The default value is `false`.\n */\n\nclass TempImageFactory {\n  static #tempCanvas = null;\n\n  static getCanvas(width, height) {\n    const tempCanvas = (this.#tempCanvas ||= document.createElement(\"canvas\"));\n    tempCanvas.width = width;\n    tempCanvas.height = height;\n\n    // Since this is a temporary canvas, we need to fill it with a white\n    // background ourselves. `#getPageDrawContext` uses CSS rules for this.\n    const ctx = tempCanvas.getContext(\"2d\", { alpha: false });\n    ctx.save();\n    ctx.fillStyle = \"rgb(255, 255, 255)\";\n    ctx.fillRect(0, 0, width, height);\n    ctx.restore();\n    return [tempCanvas, tempCanvas.getContext(\"2d\")];\n  }\n\n  static destroyCanvas() {\n    const tempCanvas = this.#tempCanvas;\n    if (tempCanvas) {\n      // Zeroing the width and height causes Firefox to release graphics\n      // resources immediately, which can greatly reduce memory consumption.\n      tempCanvas.width = 0;\n      tempCanvas.height = 0;\n    }\n    this.#tempCanvas = null;\n  }\n}\n\n/**\n * @implements {IRenderableView}\n */\nclass PDFThumbnailView {\n  /**\n   * @param {PDFThumbnailViewOptions} options\n   */\n  constructor({\n    container,\n    eventBus,\n    id,\n    defaultViewport,\n    optionalContentConfigPromise,\n    linkService,\n    renderingQueue,\n    pageColors,\n    enableHWA,\n  }) {\n    this.id = id;\n    this.renderingId = \"thumbnail\" + id;\n    this.pageLabel = null;\n\n    this.pdfPage = null;\n    this.rotation = 0;\n    this.viewport = defaultViewport;\n    this.pdfPageRotate = defaultViewport.rotation;\n    this._optionalContentConfigPromise = optionalContentConfigPromise || null;\n    this.pageColors = pageColors || null;\n    this.enableHWA = enableHWA || false;\n\n    this.eventBus = eventBus;\n    this.linkService = linkService;\n    this.renderingQueue = renderingQueue;\n\n    this.renderTask = null;\n    this.renderingState = RenderingStates.INITIAL;\n    this.resume = null;\n\n    const anchor = document.createElement(\"a\");\n    anchor.href = linkService.getAnchorUrl(\"#page=\" + id);\n    anchor.setAttribute(\"data-l10n-id\", \"pdfjs-thumb-page-title\");\n    anchor.setAttribute(\"data-l10n-args\", this.#pageL10nArgs);\n    anchor.onclick = function () {\n      linkService.goToPage(id);\n      return false;\n    };\n    this.anchor = anchor;\n\n    const div = document.createElement(\"div\");\n    div.className = \"thumbnail\";\n    div.setAttribute(\"data-page-number\", this.id);\n    this.div = div;\n    this.#updateDims();\n\n    const img = document.createElement(\"div\");\n    img.className = \"thumbnailImage\";\n    this._placeholderImg = img;\n\n    div.append(img);\n    anchor.append(div);\n    container.append(anchor);\n  }\n\n  #updateDims() {\n    const { width, height } = this.viewport;\n    const ratio = width / height;\n\n    this.canvasWidth = THUMBNAIL_WIDTH;\n    this.canvasHeight = (this.canvasWidth / ratio) | 0;\n    this.scale = this.canvasWidth / width;\n\n    const { style } = this.div;\n    style.setProperty(\"--thumbnail-width\", `${this.canvasWidth}px`);\n    style.setProperty(\"--thumbnail-height\", `${this.canvasHeight}px`);\n  }\n\n  setPdfPage(pdfPage) {\n    this.pdfPage = pdfPage;\n    this.pdfPageRotate = pdfPage.rotate;\n    const totalRotation = (this.rotation + this.pdfPageRotate) % 360;\n    this.viewport = pdfPage.getViewport({ scale: 1, rotation: totalRotation });\n    this.reset();\n  }\n\n  reset() {\n    this.cancelRendering();\n    this.renderingState = RenderingStates.INITIAL;\n\n    this.div.removeAttribute(\"data-loaded\");\n    this.image?.replaceWith(this._placeholderImg);\n    this.#updateDims();\n\n    if (this.image) {\n      this.image.removeAttribute(\"src\");\n      delete this.image;\n    }\n  }\n\n  update({ rotation = null }) {\n    if (typeof rotation === \"number\") {\n      this.rotation = rotation; // The rotation may be zero.\n    }\n    const totalRotation = (this.rotation + this.pdfPageRotate) % 360;\n    this.viewport = this.viewport.clone({\n      scale: 1,\n      rotation: totalRotation,\n    });\n    this.reset();\n  }\n\n  /**\n   * PLEASE NOTE: Most likely you want to use the `this.reset()` method,\n   *              rather than calling this one directly.\n   */\n  cancelRendering() {\n    if (this.renderTask) {\n      this.renderTask.cancel();\n      this.renderTask = null;\n    }\n    this.resume = null;\n  }\n\n  #getPageDrawContext(upscaleFactor = 1, enableHWA = this.enableHWA) {\n    // Keep the no-thumbnail outline visible, i.e. `data-loaded === false`,\n    // until rendering/image conversion is complete, to avoid display issues.\n    const canvas = document.createElement(\"canvas\");\n    const ctx = canvas.getContext(\"2d\", {\n      alpha: false,\n      willReadFrequently: !enableHWA,\n    });\n    const outputScale = new OutputScale();\n\n    canvas.width = (upscaleFactor * this.canvasWidth * outputScale.sx) | 0;\n    canvas.height = (upscaleFactor * this.canvasHeight * outputScale.sy) | 0;\n\n    const transform = outputScale.scaled\n      ? [outputScale.sx, 0, 0, outputScale.sy, 0, 0]\n      : null;\n\n    return { ctx, canvas, transform };\n  }\n\n  #convertCanvasToImage(canvas) {\n    if (this.renderingState !== RenderingStates.FINISHED) {\n      throw new Error(\"#convertCanvasToImage: Rendering has not finished.\");\n    }\n    const reducedCanvas = this.#reduceImage(canvas);\n\n    const image = document.createElement(\"img\");\n    image.className = \"thumbnailImage\";\n    image.setAttribute(\"data-l10n-id\", \"pdfjs-thumb-page-canvas\");\n    image.setAttribute(\"data-l10n-args\", this.#pageL10nArgs);\n    image.src = reducedCanvas.toDataURL();\n    this.image = image;\n\n    this.div.setAttribute(\"data-loaded\", true);\n    this._placeholderImg.replaceWith(image);\n\n    // Zeroing the width and height causes Firefox to release graphics\n    // resources immediately, which can greatly reduce memory consumption.\n    reducedCanvas.width = 0;\n    reducedCanvas.height = 0;\n  }\n\n  async #finishRenderTask(renderTask, canvas, error = null) {\n    // The renderTask may have been replaced by a new one, so only remove\n    // the reference to the renderTask if it matches the one that is\n    // triggering this callback.\n    if (renderTask === this.renderTask) {\n      this.renderTask = null;\n    }\n\n    if (error instanceof RenderingCancelledException) {\n      return;\n    }\n    this.renderingState = RenderingStates.FINISHED;\n    this.#convertCanvasToImage(canvas);\n\n    if (error) {\n      throw error;\n    }\n  }\n\n  async draw() {\n    if (this.renderingState !== RenderingStates.INITIAL) {\n      console.error(\"Must be in new state before drawing\");\n      return undefined;\n    }\n    const { pdfPage } = this;\n\n    if (!pdfPage) {\n      this.renderingState = RenderingStates.FINISHED;\n      throw new Error(\"pdfPage is not loaded\");\n    }\n\n    this.renderingState = RenderingStates.RUNNING;\n\n    // Render the thumbnail at a larger size and downsize the canvas (similar\n    // to `setImage`), to improve consistency between thumbnails created by\n    // the `draw` and `setImage` methods (fixes issue 8233).\n    // NOTE: To primarily avoid increasing memory usage too much, but also to\n    //   reduce downsizing overhead, we purposely limit the up-scaling factor.\n    const { ctx, canvas, transform } =\n      this.#getPageDrawContext(DRAW_UPSCALE_FACTOR);\n    const drawViewport = this.viewport.clone({\n      scale: DRAW_UPSCALE_FACTOR * this.scale,\n    });\n    const renderContinueCallback = cont => {\n      if (!this.renderingQueue.isHighestPriority(this)) {\n        this.renderingState = RenderingStates.PAUSED;\n        this.resume = () => {\n          this.renderingState = RenderingStates.RUNNING;\n          cont();\n        };\n        return;\n      }\n      cont();\n    };\n\n    const renderContext = {\n      canvasContext: ctx,\n      transform,\n      viewport: drawViewport,\n      optionalContentConfigPromise: this._optionalContentConfigPromise,\n      pageColors: this.pageColors,\n    };\n    const renderTask = (this.renderTask = pdfPage.render(renderContext));\n    renderTask.onContinue = renderContinueCallback;\n\n    const resultPromise = renderTask.promise.then(\n      () => this.#finishRenderTask(renderTask, canvas),\n      error => this.#finishRenderTask(renderTask, canvas, error)\n    );\n    resultPromise.finally(() => {\n      // Zeroing the width and height causes Firefox to release graphics\n      // resources immediately, which can greatly reduce memory consumption.\n      canvas.width = 0;\n      canvas.height = 0;\n\n      this.eventBus.dispatch(\"thumbnailrendered\", {\n        source: this,\n        pageNumber: this.id,\n        pdfPage: this.pdfPage,\n      });\n    });\n\n    return resultPromise;\n  }\n\n  setImage(pageView) {\n    if (this.renderingState !== RenderingStates.INITIAL) {\n      return;\n    }\n    const { thumbnailCanvas: canvas, pdfPage, scale } = pageView;\n    if (!canvas) {\n      return;\n    }\n    if (!this.pdfPage) {\n      this.setPdfPage(pdfPage);\n    }\n    if (scale < this.scale) {\n      // Avoid upscaling the image, since that makes the thumbnail look blurry.\n      return;\n    }\n    this.renderingState = RenderingStates.FINISHED;\n    this.#convertCanvasToImage(canvas);\n  }\n\n  #reduceImage(img) {\n    const { ctx, canvas } = this.#getPageDrawContext(1, true);\n\n    if (img.width <= 2 * canvas.width) {\n      ctx.drawImage(\n        img,\n        0,\n        0,\n        img.width,\n        img.height,\n        0,\n        0,\n        canvas.width,\n        canvas.height\n      );\n      return canvas;\n    }\n    // drawImage does an awful job of rescaling the image, doing it gradually.\n    let reducedWidth = canvas.width << MAX_NUM_SCALING_STEPS;\n    let reducedHeight = canvas.height << MAX_NUM_SCALING_STEPS;\n    const [reducedImage, reducedImageCtx] = TempImageFactory.getCanvas(\n      reducedWidth,\n      reducedHeight\n    );\n\n    while (reducedWidth > img.width || reducedHeight > img.height) {\n      reducedWidth >>= 1;\n      reducedHeight >>= 1;\n    }\n    reducedImageCtx.drawImage(\n      img,\n      0,\n      0,\n      img.width,\n      img.height,\n      0,\n      0,\n      reducedWidth,\n      reducedHeight\n    );\n    while (reducedWidth > 2 * canvas.width) {\n      reducedImageCtx.drawImage(\n        reducedImage,\n        0,\n        0,\n        reducedWidth,\n        reducedHeight,\n        0,\n        0,\n        reducedWidth >> 1,\n        reducedHeight >> 1\n      );\n      reducedWidth >>= 1;\n      reducedHeight >>= 1;\n    }\n    ctx.drawImage(\n      reducedImage,\n      0,\n      0,\n      reducedWidth,\n      reducedHeight,\n      0,\n      0,\n      canvas.width,\n      canvas.height\n    );\n    return canvas;\n  }\n\n  get #pageL10nArgs() {\n    return JSON.stringify({ page: this.pageLabel ?? this.id });\n  }\n\n  /**\n   * @param {string|null} label\n   */\n  setPageLabel(label) {\n    this.pageLabel = typeof label === \"string\" ? label : null;\n\n    this.anchor.setAttribute(\"data-l10n-args\", this.#pageL10nArgs);\n\n    if (this.renderingState !== RenderingStates.FINISHED) {\n      return;\n    }\n    this.image?.setAttribute(\"data-l10n-args\", this.#pageL10nArgs);\n  }\n}\n\nexport { PDFThumbnailView, TempImageFactory };\n","/* Copyright 2012 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/** @typedef {import(\"../src/display/api\").PDFDocumentProxy} PDFDocumentProxy */\n/** @typedef {import(\"../src/display/api\").PDFPageProxy} PDFPageProxy */\n/** @typedef {import(\"./event_utils\").EventBus} EventBus */\n/** @typedef {import(\"./interfaces\").IPDFLinkService} IPDFLinkService */\n// eslint-disable-next-line max-len\n/** @typedef {import(\"./pdf_rendering_queue\").PDFRenderingQueue} PDFRenderingQueue */\n\nimport {\n  getVisibleElements,\n  isValidRotation,\n  RenderingStates,\n  scrollIntoView,\n  watchScroll,\n} from \"./ui_utils.js\";\nimport { PDFThumbnailView, TempImageFactory } from \"./pdf_thumbnail_view.js\";\n\nconst THUMBNAIL_SCROLL_MARGIN = -19;\nconst THUMBNAIL_SELECTED_CLASS = \"selected\";\n\n/**\n * @typedef {Object} PDFThumbnailViewerOptions\n * @property {HTMLDivElement} container - The container for the thumbnail\n *   elements.\n * @property {EventBus} eventBus - The application event bus.\n * @property {IPDFLinkService} linkService - The navigation/linking service.\n * @property {PDFRenderingQueue} renderingQueue - The rendering queue object.\n * @property {Object} [pageColors] - Overwrites background and foreground colors\n *   with user defined ones in order to improve readability in high contrast\n *   mode.\n * @property {AbortSignal} [abortSignal] - The AbortSignal for the window\n *   events.\n * @property {boolean} [enableHWA] - Enables hardware acceleration for\n *   rendering. The default value is `false`.\n */\n\n/**\n * Viewer control to display thumbnails for pages in a PDF document.\n */\nclass PDFThumbnailViewer {\n  /**\n   * @param {PDFThumbnailViewerOptions} options\n   */\n  constructor({\n    container,\n    eventBus,\n    linkService,\n    renderingQueue,\n    pageColors,\n    abortSignal,\n    enableHWA,\n  }) {\n    this.container = container;\n    this.eventBus = eventBus;\n    this.linkService = linkService;\n    this.renderingQueue = renderingQueue;\n    this.pageColors = pageColors || null;\n    this.enableHWA = enableHWA || false;\n\n    this.scroll = watchScroll(\n      this.container,\n      this.#scrollUpdated.bind(this),\n      abortSignal\n    );\n    this.#resetView();\n  }\n\n  #scrollUpdated() {\n    this.renderingQueue.renderHighestPriority();\n  }\n\n  getThumbnail(index) {\n    return this._thumbnails[index];\n  }\n\n  #getVisibleThumbs() {\n    return getVisibleElements({\n      scrollEl: this.container,\n      views: this._thumbnails,\n    });\n  }\n\n  scrollThumbnailIntoView(pageNumber) {\n    if (!this.pdfDocument) {\n      return;\n    }\n    const thumbnailView = this._thumbnails[pageNumber - 1];\n\n    if (!thumbnailView) {\n      console.error('scrollThumbnailIntoView: Invalid \"pageNumber\" parameter.');\n      return;\n    }\n\n    if (pageNumber !== this._currentPageNumber) {\n      const prevThumbnailView = this._thumbnails[this._currentPageNumber - 1];\n      // Remove the highlight from the previous thumbnail...\n      prevThumbnailView.div.classList.remove(THUMBNAIL_SELECTED_CLASS);\n      // ... and add the highlight to the new thumbnail.\n      thumbnailView.div.classList.add(THUMBNAIL_SELECTED_CLASS);\n    }\n    const { first, last, views } = this.#getVisibleThumbs();\n\n    // If the thumbnail isn't currently visible, scroll it into view.\n    if (views.length > 0) {\n      let shouldScroll = false;\n      if (pageNumber <= first.id || pageNumber >= last.id) {\n        shouldScroll = true;\n      } else {\n        for (const { id, percent } of views) {\n          if (id !== pageNumber) {\n            continue;\n          }\n          shouldScroll = percent < 100;\n          break;\n        }\n      }\n      if (shouldScroll) {\n        scrollIntoView(thumbnailView.div, { top: THUMBNAIL_SCROLL_MARGIN });\n      }\n    }\n\n    this._currentPageNumber = pageNumber;\n  }\n\n  get pagesRotation() {\n    return this._pagesRotation;\n  }\n\n  set pagesRotation(rotation) {\n    if (!isValidRotation(rotation)) {\n      throw new Error(\"Invalid thumbnails rotation angle.\");\n    }\n    if (!this.pdfDocument) {\n      return;\n    }\n    if (this._pagesRotation === rotation) {\n      return; // The rotation didn't change.\n    }\n    this._pagesRotation = rotation;\n\n    const updateArgs = { rotation };\n    for (const thumbnail of this._thumbnails) {\n      thumbnail.update(updateArgs);\n    }\n  }\n\n  cleanup() {\n    for (const thumbnail of this._thumbnails) {\n      if (thumbnail.renderingState !== RenderingStates.FINISHED) {\n        thumbnail.reset();\n      }\n    }\n    TempImageFactory.destroyCanvas();\n  }\n\n  #resetView() {\n    this._thumbnails = [];\n    this._currentPageNumber = 1;\n    this._pageLabels = null;\n    this._pagesRotation = 0;\n\n    // Remove the thumbnails from the DOM.\n    this.container.textContent = \"\";\n  }\n\n  /**\n   * @param {PDFDocumentProxy} pdfDocument\n   */\n  setDocument(pdfDocument) {\n    if (this.pdfDocument) {\n      this.#cancelRendering();\n      this.#resetView();\n    }\n\n    this.pdfDocument = pdfDocument;\n    if (!pdfDocument) {\n      return;\n    }\n    const firstPagePromise = pdfDocument.getPage(1);\n    const optionalContentConfigPromise = pdfDocument.getOptionalContentConfig({\n      intent: \"display\",\n    });\n\n    firstPagePromise\n      .then(firstPdfPage => {\n        const pagesCount = pdfDocument.numPages;\n        const viewport = firstPdfPage.getViewport({ scale: 1 });\n\n        for (let pageNum = 1; pageNum <= pagesCount; ++pageNum) {\n          const thumbnail = new PDFThumbnailView({\n            container: this.container,\n            eventBus: this.eventBus,\n            id: pageNum,\n            defaultViewport: viewport.clone(),\n            optionalContentConfigPromise,\n            linkService: this.linkService,\n            renderingQueue: this.renderingQueue,\n            pageColors: this.pageColors,\n            enableHWA: this.enableHWA,\n          });\n          this._thumbnails.push(thumbnail);\n        }\n        // Set the first `pdfPage` immediately, since it's already loaded,\n        // rather than having to repeat the `PDFDocumentProxy.getPage` call in\n        // the `this.#ensurePdfPageLoaded` method before rendering can start.\n        this._thumbnails[0]?.setPdfPage(firstPdfPage);\n\n        // Ensure that the current thumbnail is always highlighted on load.\n        const thumbnailView = this._thumbnails[this._currentPageNumber - 1];\n        thumbnailView.div.classList.add(THUMBNAIL_SELECTED_CLASS);\n      })\n      .catch(reason => {\n        console.error(\"Unable to initialize thumbnail viewer\", reason);\n      });\n  }\n\n  #cancelRendering() {\n    for (const thumbnail of this._thumbnails) {\n      thumbnail.cancelRendering();\n    }\n  }\n\n  /**\n   * @param {Array|null} labels\n   */\n  setPageLabels(labels) {\n    if (!this.pdfDocument) {\n      return;\n    }\n    if (!labels) {\n      this._pageLabels = null;\n    } else if (\n      !(Array.isArray(labels) && this.pdfDocument.numPages === labels.length)\n    ) {\n      this._pageLabels = null;\n      console.error(\"PDFThumbnailViewer_setPageLabels: Invalid page labels.\");\n    } else {\n      this._pageLabels = labels;\n    }\n    // Update all the `PDFThumbnailView` instances.\n    for (let i = 0, ii = this._thumbnails.length; i < ii; i++) {\n      this._thumbnails[i].setPageLabel(this._pageLabels?.[i] ?? null);\n    }\n  }\n\n  /**\n   * @param {PDFThumbnailView} thumbView\n   * @returns {Promise<PDFPageProxy | null>}\n   */\n  async #ensurePdfPageLoaded(thumbView) {\n    if (thumbView.pdfPage) {\n      return thumbView.pdfPage;\n    }\n    try {\n      const pdfPage = await this.pdfDocument.getPage(thumbView.id);\n      if (!thumbView.pdfPage) {\n        thumbView.setPdfPage(pdfPage);\n      }\n      return pdfPage;\n    } catch (reason) {\n      console.error(\"Unable to get page for thumb view\", reason);\n      return null; // Page error -- there is nothing that can be done.\n    }\n  }\n\n  #getScrollAhead(visible) {\n    if (visible.first?.id === 1) {\n      return true;\n    } else if (visible.last?.id === this._thumbnails.length) {\n      return false;\n    }\n    return this.scroll.down;\n  }\n\n  forceRendering() {\n    const visibleThumbs = this.#getVisibleThumbs();\n    const scrollAhead = this.#getScrollAhead(visibleThumbs);\n    const thumbView = this.renderingQueue.getHighestPriority(\n      visibleThumbs,\n      this._thumbnails,\n      scrollAhead\n    );\n    if (thumbView) {\n      this.#ensurePdfPageLoaded(thumbView).then(() => {\n        this.renderingQueue.renderView(thumbView);\n      });\n      return true;\n    }\n    return false;\n  }\n}\n\nexport { PDFThumbnailViewer };\n","/* Copyright 2022 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/** @typedef {import(\"../src/display/api\").PDFPageProxy} PDFPageProxy */\n// eslint-disable-next-line max-len\n/** @typedef {import(\"../src/display/display_utils\").PageViewport} PageViewport */\n// eslint-disable-next-line max-len\n/** @typedef {import(\"../src/display/editor/tools.js\").AnnotationEditorUIManager} AnnotationEditorUIManager */\n// eslint-disable-next-line max-len\n/** @typedef {import(\"./text_accessibility.js\").TextAccessibilityManager} TextAccessibilityManager */\n/** @typedef {import(\"./interfaces\").IL10n} IL10n */\n// eslint-disable-next-line max-len\n/** @typedef {import(\"../src/display/annotation_layer.js\").AnnotationLayer} AnnotationLayer */\n// eslint-disable-next-line max-len\n/** @typedef {import(\"../src/display/struct_tree_layer_builder.js\").StructTreeLayerBuilder} StructTreeLayerBuilder */\n\nimport { AnnotationEditorLayer } from \"pdfjs-lib\";\nimport { GenericL10n } from \"web-null_l10n\";\n\n/**\n * @typedef {Object} AnnotationEditorLayerBuilderOptions\n * @property {AnnotationEditorUIManager} [uiManager]\n * @property {PDFPageProxy} pdfPage\n * @property {IL10n} [l10n]\n * @property {StructTreeLayerBuilder} [structTreeLayer]\n * @property {TextAccessibilityManager} [accessibilityManager]\n * @property {AnnotationLayer} [annotationLayer]\n * @property {TextLayer} [textLayer]\n * @property {DrawLayer} [drawLayer]\n * @property {function} [onAppend]\n */\n\nclass AnnotationEditorLayerBuilder {\n  #annotationLayer = null;\n\n  #drawLayer = null;\n\n  #onAppend = null;\n\n  #structTreeLayer = null;\n\n  #textLayer = null;\n\n  #uiManager;\n\n  /**\n   * @param {AnnotationEditorLayerBuilderOptions} options\n   */\n  constructor(options) {\n    this.pdfPage = options.pdfPage;\n    this.accessibilityManager = options.accessibilityManager;\n    this.l10n = options.l10n;\n    if (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"GENERIC\")) {\n      this.l10n ||= new GenericL10n();\n    }\n    this.annotationEditorLayer = null;\n    this.div = null;\n    this._cancelled = false;\n    this.#uiManager = options.uiManager;\n    this.#annotationLayer = options.annotationLayer || null;\n    this.#textLayer = options.textLayer || null;\n    this.#drawLayer = options.drawLayer || null;\n    this.#onAppend = options.onAppend || null;\n    this.#structTreeLayer = options.structTreeLayer || null;\n  }\n\n  /**\n   * @param {PageViewport} viewport\n   * @param {string} intent (default value is 'display')\n   */\n  async render(viewport, intent = \"display\") {\n    if (intent !== \"display\") {\n      return;\n    }\n\n    if (this._cancelled) {\n      return;\n    }\n\n    const clonedViewport = viewport.clone({ dontFlip: true });\n    if (this.div) {\n      this.annotationEditorLayer.update({ viewport: clonedViewport });\n      this.show();\n      return;\n    }\n\n    // Create an AnnotationEditor layer div\n    const div = (this.div = document.createElement(\"div\"));\n    div.className = \"annotationEditorLayer\";\n    div.hidden = true;\n    div.dir = this.#uiManager.direction;\n    this.#onAppend?.(div);\n\n    this.annotationEditorLayer = new AnnotationEditorLayer({\n      uiManager: this.#uiManager,\n      div,\n      structTreeLayer: this.#structTreeLayer,\n      accessibilityManager: this.accessibilityManager,\n      pageIndex: this.pdfPage.pageNumber - 1,\n      l10n: this.l10n,\n      viewport: clonedViewport,\n      annotationLayer: this.#annotationLayer,\n      textLayer: this.#textLayer,\n      drawLayer: this.#drawLayer,\n    });\n\n    const parameters = {\n      viewport: clonedViewport,\n      div,\n      annotations: null,\n      intent,\n    };\n\n    this.annotationEditorLayer.render(parameters);\n    this.show();\n  }\n\n  cancel() {\n    this._cancelled = true;\n\n    if (!this.div) {\n      return;\n    }\n    this.annotationEditorLayer.destroy();\n  }\n\n  hide() {\n    if (!this.div) {\n      return;\n    }\n    this.div.hidden = true;\n  }\n\n  show() {\n    if (!this.div || this.annotationEditorLayer.isInvisible) {\n      return;\n    }\n    this.div.hidden = false;\n  }\n}\n\nexport { AnnotationEditorLayerBuilder };\n","/* Copyright 2014 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/** @typedef {import(\"../src/display/api\").PDFPageProxy} PDFPageProxy */\n// eslint-disable-next-line max-len\n/** @typedef {import(\"../src/display/display_utils\").PageViewport} PageViewport */\n// eslint-disable-next-line max-len\n/** @typedef {import(\"../src/display/annotation_storage\").AnnotationStorage} AnnotationStorage */\n/** @typedef {import(\"./interfaces\").IDownloadManager} IDownloadManager */\n/** @typedef {import(\"./interfaces\").IPDFLinkService} IPDFLinkService */\n// eslint-disable-next-line max-len\n/** @typedef {import(\"./text_accessibility.js\").TextAccessibilityManager} TextAccessibilityManager */\n// eslint-disable-next-line max-len\n/** @typedef {import(\"../src/display/editor/tools.js\").AnnotationEditorUIManager} AnnotationEditorUIManager */\n\nimport { AnnotationLayer } from \"pdfjs-lib\";\nimport { PresentationModeState } from \"./ui_utils.js\";\n\n/**\n * @typedef {Object} AnnotationLayerBuilderOptions\n * @property {PDFPageProxy} pdfPage\n * @property {AnnotationStorage} [annotationStorage]\n * @property {string} [imageResourcesPath] - Path for image resources, mainly\n *   for annotation icons. Include trailing slash.\n * @property {boolean} renderForms\n * @property {IPDFLinkService} linkService\n * @property {IDownloadManager} [downloadManager]\n * @property {boolean} [enableScripting]\n * @property {Promise<boolean>} [hasJSActionsPromise]\n * @property {Promise<Object<string, Array<Object>> | null>}\n *   [fieldObjectsPromise]\n * @property {Map<string, HTMLCanvasElement>} [annotationCanvasMap]\n * @property {TextAccessibilityManager} [accessibilityManager]\n * @property {AnnotationEditorUIManager} [annotationEditorUIManager]\n * @property {function} [onAppend]\n */\n\nclass AnnotationLayerBuilder {\n  #onAppend = null;\n\n  #eventAbortController = null;\n\n  /**\n   * @param {AnnotationLayerBuilderOptions} options\n   */\n  constructor({\n    pdfPage,\n    linkService,\n    downloadManager,\n    annotationStorage = null,\n    imageResourcesPath = \"\",\n    renderForms = true,\n    enableScripting = false,\n    hasJSActionsPromise = null,\n    fieldObjectsPromise = null,\n    annotationCanvasMap = null,\n    accessibilityManager = null,\n    annotationEditorUIManager = null,\n    onAppend = null,\n  }) {\n    this.pdfPage = pdfPage;\n    this.linkService = linkService;\n    this.downloadManager = downloadManager;\n    this.imageResourcesPath = imageResourcesPath;\n    this.renderForms = renderForms;\n    this.annotationStorage = annotationStorage;\n    this.enableScripting = enableScripting;\n    this._hasJSActionsPromise = hasJSActionsPromise || Promise.resolve(false);\n    this._fieldObjectsPromise = fieldObjectsPromise || Promise.resolve(null);\n    this._annotationCanvasMap = annotationCanvasMap;\n    this._accessibilityManager = accessibilityManager;\n    this._annotationEditorUIManager = annotationEditorUIManager;\n    this.#onAppend = onAppend;\n\n    this.annotationLayer = null;\n    this.div = null;\n    this._cancelled = false;\n    this._eventBus = linkService.eventBus;\n  }\n\n  /**\n   * @param {PageViewport} viewport\n   * @param {Object} options\n   * @param {string} intent (default value is 'display')\n   * @returns {Promise<void>} A promise that is resolved when rendering of the\n   *   annotations is complete.\n   */\n  async render(viewport, options, intent = \"display\") {\n    if (this.div) {\n      if (this._cancelled || !this.annotationLayer) {\n        return;\n      }\n      // If an annotationLayer already exists, refresh its children's\n      // transformation matrices.\n      this.annotationLayer.update({\n        viewport: viewport.clone({ dontFlip: true }),\n      });\n      return;\n    }\n\n    const [annotations, hasJSActions, fieldObjects] = await Promise.all([\n      this.pdfPage.getAnnotations({ intent }),\n      this._hasJSActionsPromise,\n      this._fieldObjectsPromise,\n    ]);\n    if (this._cancelled) {\n      return;\n    }\n\n    // Create an annotation layer div and render the annotations\n    // if there is at least one annotation.\n    const div = (this.div = document.createElement(\"div\"));\n    div.className = \"annotationLayer\";\n    this.#onAppend?.(div);\n\n    if (annotations.length === 0) {\n      this.hide();\n      return;\n    }\n\n    this.annotationLayer = new AnnotationLayer({\n      div,\n      accessibilityManager: this._accessibilityManager,\n      annotationCanvasMap: this._annotationCanvasMap,\n      annotationEditorUIManager: this._annotationEditorUIManager,\n      page: this.pdfPage,\n      viewport: viewport.clone({ dontFlip: true }),\n      structTreeLayer: options?.structTreeLayer || null,\n    });\n\n    await this.annotationLayer.render({\n      annotations,\n      imageResourcesPath: this.imageResourcesPath,\n      renderForms: this.renderForms,\n      linkService: this.linkService,\n      downloadManager: this.downloadManager,\n      annotationStorage: this.annotationStorage,\n      enableScripting: this.enableScripting,\n      hasJSActions,\n      fieldObjects,\n    });\n\n    // Ensure that interactive form elements in the annotationLayer are\n    // disabled while PresentationMode is active (see issue 12232).\n    if (this.linkService.isInPresentationMode) {\n      this.#updatePresentationModeState(PresentationModeState.FULLSCREEN);\n    }\n    if (!this.#eventAbortController) {\n      this.#eventAbortController = new AbortController();\n\n      this._eventBus?._on(\n        \"presentationmodechanged\",\n        evt => {\n          this.#updatePresentationModeState(evt.state);\n        },\n        { signal: this.#eventAbortController.signal }\n      );\n    }\n  }\n\n  cancel() {\n    this._cancelled = true;\n\n    this.#eventAbortController?.abort();\n    this.#eventAbortController = null;\n  }\n\n  hide() {\n    if (!this.div) {\n      return;\n    }\n    this.div.hidden = true;\n  }\n\n  hasEditableAnnotations() {\n    return !!this.annotationLayer?.hasEditableAnnotations();\n  }\n\n  #updatePresentationModeState(state) {\n    if (!this.div) {\n      return;\n    }\n    let disableFormElements = false;\n\n    switch (state) {\n      case PresentationModeState.FULLSCREEN:\n        disableFormElements = true;\n        break;\n      case PresentationModeState.NORMAL:\n        break;\n      default:\n        return;\n    }\n    for (const section of this.div.childNodes) {\n      if (section.hasAttribute(\"data-internal-link\")) {\n        continue;\n      }\n      section.inert = disableFormElements;\n    }\n  }\n}\n\nexport { AnnotationLayerBuilder };\n","/* Copyright 2022 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { DrawLayer } from \"pdfjs-lib\";\n\n/**\n * @typedef {Object} DrawLayerBuilderOptions\n * @property {number} pageIndex\n */\n\nclass DrawLayerBuilder {\n  #drawLayer = null;\n\n  /**\n   * @param {DrawLayerBuilderOptions} options\n   */\n  constructor(options) {\n    this.pageIndex = options.pageIndex;\n  }\n\n  /**\n   * @param {string} intent (default value is 'display')\n   */\n  async render(intent = \"display\") {\n    if (intent !== \"display\" || this.#drawLayer || this._cancelled) {\n      return;\n    }\n    this.#drawLayer = new DrawLayer({\n      pageIndex: this.pageIndex,\n    });\n  }\n\n  cancel() {\n    this._cancelled = true;\n\n    if (!this.#drawLayer) {\n      return;\n    }\n    this.#drawLayer.destroy();\n    this.#drawLayer = null;\n  }\n\n  setParent(parent) {\n    this.#drawLayer?.setParent(parent);\n  }\n\n  getDrawLayer() {\n    return this.#drawLayer;\n  }\n}\n\nexport { DrawLayerBuilder };\n","/* Copyright 2021 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { removeNullCharacters } from \"./ui_utils.js\";\n\nconst PDF_ROLE_TO_HTML_ROLE = {\n  // Document level structure types\n  Document: null, // There's a \"document\" role, but it doesn't make sense here.\n  DocumentFragment: null,\n  // Grouping level structure types\n  Part: \"group\",\n  Sect: \"group\", // XXX: There's a \"section\" role, but it's abstract.\n  Div: \"group\",\n  Aside: \"note\",\n  NonStruct: \"none\",\n  // Block level structure types\n  P: null,\n  // H<n>,\n  H: \"heading\",\n  Title: null,\n  FENote: \"note\",\n  // Sub-block level structure type\n  Sub: \"group\",\n  // General inline level structure types\n  Lbl: null,\n  Span: null,\n  Em: null,\n  Strong: null,\n  Link: \"link\",\n  Annot: \"note\",\n  Form: \"form\",\n  // Ruby and Warichu structure types\n  Ruby: null,\n  RB: null,\n  RT: null,\n  RP: null,\n  Warichu: null,\n  WT: null,\n  WP: null,\n  // List standard structure types\n  L: \"list\",\n  LI: \"listitem\",\n  LBody: null,\n  // Table standard structure types\n  Table: \"table\",\n  TR: \"row\",\n  TH: \"columnheader\",\n  TD: \"cell\",\n  THead: \"columnheader\",\n  TBody: null,\n  TFoot: null,\n  // Standard structure type Caption\n  Caption: null,\n  // Standard structure type Figure\n  Figure: \"figure\",\n  // Standard structure type Formula\n  Formula: null,\n  // standard structure type Artifact\n  Artifact: null,\n};\n\nconst HEADING_PATTERN = /^H(\\d+)$/;\n\nclass StructTreeLayerBuilder {\n  #promise;\n\n  #treeDom = null;\n\n  #treePromise;\n\n  #elementAttributes = new Map();\n\n  #rawDims;\n\n  #elementsToAddToTextLayer = null;\n\n  constructor(pdfPage, rawDims) {\n    this.#promise = pdfPage.getStructTree();\n    this.#rawDims = rawDims;\n  }\n\n  async render() {\n    if (this.#treePromise) {\n      return this.#treePromise;\n    }\n    const { promise, resolve, reject } = Promise.withResolvers();\n    this.#treePromise = promise;\n\n    try {\n      this.#treeDom = this.#walk(await this.#promise);\n    } catch (ex) {\n      reject(ex);\n    }\n    this.#promise = null;\n\n    this.#treeDom?.classList.add(\"structTree\");\n    resolve(this.#treeDom);\n\n    return promise;\n  }\n\n  async getAriaAttributes(annotationId) {\n    try {\n      await this.render();\n      return this.#elementAttributes.get(annotationId);\n    } catch {\n      // If the structTree cannot be fetched, parsed, and/or rendered,\n      // ensure that e.g. the AnnotationLayer won't break completely.\n    }\n    return null;\n  }\n\n  hide() {\n    if (this.#treeDom && !this.#treeDom.hidden) {\n      this.#treeDom.hidden = true;\n    }\n  }\n\n  show() {\n    if (this.#treeDom?.hidden) {\n      this.#treeDom.hidden = false;\n    }\n  }\n\n  #setAttributes(structElement, htmlElement) {\n    const { alt, id, lang } = structElement;\n    if (alt !== undefined) {\n      // Don't add the label in the struct tree layer but on the annotation\n      // in the annotation layer.\n      let added = false;\n      const label = removeNullCharacters(alt);\n      for (const child of structElement.children) {\n        if (child.type === \"annotation\") {\n          let attrs = this.#elementAttributes.get(child.id);\n          if (!attrs) {\n            attrs = new Map();\n            this.#elementAttributes.set(child.id, attrs);\n          }\n          attrs.set(\"aria-label\", label);\n          added = true;\n        }\n      }\n      if (!added) {\n        htmlElement.setAttribute(\"aria-label\", label);\n      }\n    }\n    if (id !== undefined) {\n      htmlElement.setAttribute(\"aria-owns\", id);\n    }\n    if (lang !== undefined) {\n      htmlElement.setAttribute(\n        \"lang\",\n        removeNullCharacters(lang, /* replaceInvisible = */ true)\n      );\n    }\n  }\n\n  #addImageInTextLayer(node, element) {\n    const { alt, bbox, children } = node;\n    const child = children?.[0];\n    if (!this.#rawDims || !alt || !bbox || child?.type !== \"content\") {\n      return false;\n    }\n\n    const { id } = child;\n    if (!id) {\n      return false;\n    }\n\n    // We cannot add the created element to the text layer immediately, as the\n    // text layer might not be ready yet. Instead, we store the element and add\n    // it later in `addElementsToTextLayer`.\n\n    element.setAttribute(\"aria-owns\", id);\n    const img = document.createElement(\"span\");\n    (this.#elementsToAddToTextLayer ||= new Map()).set(id, img);\n    img.setAttribute(\"role\", \"img\");\n    img.setAttribute(\"aria-label\", removeNullCharacters(alt));\n\n    const { pageHeight, pageX, pageY } = this.#rawDims;\n    const calc = \"calc(var(--scale-factor)*\";\n    const { style } = img;\n    style.width = `${calc}${bbox[2] - bbox[0]}px)`;\n    style.height = `${calc}${bbox[3] - bbox[1]}px)`;\n    style.left = `${calc}${bbox[0] - pageX}px)`;\n    style.top = `${calc}${pageHeight - bbox[3] + pageY}px)`;\n\n    return true;\n  }\n\n  addElementsToTextLayer() {\n    if (!this.#elementsToAddToTextLayer) {\n      return;\n    }\n    for (const [id, img] of this.#elementsToAddToTextLayer) {\n      document.getElementById(id)?.append(img);\n    }\n    this.#elementsToAddToTextLayer.clear();\n    this.#elementsToAddToTextLayer = null;\n  }\n\n  #walk(node) {\n    if (!node) {\n      return null;\n    }\n\n    const element = document.createElement(\"span\");\n    if (\"role\" in node) {\n      const { role } = node;\n      const match = role.match(HEADING_PATTERN);\n      if (match) {\n        element.setAttribute(\"role\", \"heading\");\n        element.setAttribute(\"aria-level\", match[1]);\n      } else if (PDF_ROLE_TO_HTML_ROLE[role]) {\n        element.setAttribute(\"role\", PDF_ROLE_TO_HTML_ROLE[role]);\n      }\n      if (role === \"Figure\" && this.#addImageInTextLayer(node, element)) {\n        return element;\n      }\n    }\n\n    this.#setAttributes(node, element);\n\n    if (node.children) {\n      if (node.children.length === 1 && \"id\" in node.children[0]) {\n        // Often there is only one content node so just set the values on the\n        // parent node to avoid creating an extra span.\n        this.#setAttributes(node.children[0], element);\n      } else {\n        for (const kid of node.children) {\n          element.append(this.#walk(kid));\n        }\n      }\n    }\n    return element;\n  }\n}\n\nexport { StructTreeLayerBuilder };\n","/* Copyright 2022 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { binarySearchFirstItem } from \"./ui_utils.js\";\n\n/**\n * This class aims to provide some methods:\n *  - to reorder elements in the DOM with respect to the visual order;\n *  - to create a link, using aria-owns, between spans in the textLayer and\n *    annotations in the annotationLayer. The goal is to help to know\n *    where the annotations are in the text flow.\n */\nclass TextAccessibilityManager {\n  #enabled = false;\n\n  #textChildren = null;\n\n  #textNodes = new Map();\n\n  #waitingElements = new Map();\n\n  setTextMapping(textDivs) {\n    this.#textChildren = textDivs;\n  }\n\n  /**\n   * Compare the positions of two elements, it must correspond to\n   * the visual ordering.\n   *\n   * @param {HTMLElement} e1\n   * @param {HTMLElement} e2\n   * @returns {number}\n   */\n  static #compareElementPositions(e1, e2) {\n    const rect1 = e1.getBoundingClientRect();\n    const rect2 = e2.getBoundingClientRect();\n\n    if (rect1.width === 0 && rect1.height === 0) {\n      return +1;\n    }\n\n    if (rect2.width === 0 && rect2.height === 0) {\n      return -1;\n    }\n\n    const top1 = rect1.y;\n    const bot1 = rect1.y + rect1.height;\n    const mid1 = rect1.y + rect1.height / 2;\n\n    const top2 = rect2.y;\n    const bot2 = rect2.y + rect2.height;\n    const mid2 = rect2.y + rect2.height / 2;\n\n    if (mid1 <= top2 && mid2 >= bot1) {\n      return -1;\n    }\n\n    if (mid2 <= top1 && mid1 >= bot2) {\n      return +1;\n    }\n\n    const centerX1 = rect1.x + rect1.width / 2;\n    const centerX2 = rect2.x + rect2.width / 2;\n\n    return centerX1 - centerX2;\n  }\n\n  /**\n   * Function called when the text layer has finished rendering.\n   */\n  enable() {\n    if (this.#enabled) {\n      throw new Error(\"TextAccessibilityManager is already enabled.\");\n    }\n    if (!this.#textChildren) {\n      throw new Error(\"Text divs and strings have not been set.\");\n    }\n\n    this.#enabled = true;\n    this.#textChildren = this.#textChildren.slice();\n    this.#textChildren.sort(TextAccessibilityManager.#compareElementPositions);\n\n    if (this.#textNodes.size > 0) {\n      // Some links have been made before this manager has been disabled, hence\n      // we restore them.\n      const textChildren = this.#textChildren;\n      for (const [id, nodeIndex] of this.#textNodes) {\n        const element = document.getElementById(id);\n        if (!element) {\n          // If the page was *fully* reset the element no longer exists, and it\n          // will be re-inserted later (i.e. when the annotationLayer renders).\n          this.#textNodes.delete(id);\n          continue;\n        }\n        this.#addIdToAriaOwns(id, textChildren[nodeIndex]);\n      }\n    }\n\n    for (const [element, isRemovable] of this.#waitingElements) {\n      this.addPointerInTextLayer(element, isRemovable);\n    }\n    this.#waitingElements.clear();\n  }\n\n  disable() {\n    if (!this.#enabled) {\n      return;\n    }\n\n    // Don't clear this.#textNodes which is used to rebuild the aria-owns\n    // in case it's re-enabled at some point.\n\n    this.#waitingElements.clear();\n    this.#textChildren = null;\n    this.#enabled = false;\n  }\n\n  /**\n   * Remove an aria-owns id from a node in the text layer.\n   * @param {HTMLElement} element\n   */\n  removePointerInTextLayer(element) {\n    if (!this.#enabled) {\n      this.#waitingElements.delete(element);\n      return;\n    }\n\n    const children = this.#textChildren;\n    if (!children || children.length === 0) {\n      return;\n    }\n\n    const { id } = element;\n    const nodeIndex = this.#textNodes.get(id);\n    if (nodeIndex === undefined) {\n      return;\n    }\n\n    const node = children[nodeIndex];\n\n    this.#textNodes.delete(id);\n    let owns = node.getAttribute(\"aria-owns\");\n    if (owns?.includes(id)) {\n      owns = owns\n        .split(\" \")\n        .filter(x => x !== id)\n        .join(\" \");\n      if (owns) {\n        node.setAttribute(\"aria-owns\", owns);\n      } else {\n        node.removeAttribute(\"aria-owns\");\n        node.setAttribute(\"role\", \"presentation\");\n      }\n    }\n  }\n\n  #addIdToAriaOwns(id, node) {\n    const owns = node.getAttribute(\"aria-owns\");\n    if (!owns?.includes(id)) {\n      node.setAttribute(\"aria-owns\", owns ? `${owns} ${id}` : id);\n    }\n    node.removeAttribute(\"role\");\n  }\n\n  /**\n   * Find the text node which is the nearest and add an aria-owns attribute\n   * in order to correctly position this editor in the text flow.\n   * @param {HTMLElement} element\n   * @param {boolean} isRemovable\n   * @returns {string|null} The id in the struct tree if any.\n   */\n  addPointerInTextLayer(element, isRemovable) {\n    const { id } = element;\n    if (!id) {\n      return null;\n    }\n\n    if (!this.#enabled) {\n      // The text layer needs to be there, so we postpone the association.\n      this.#waitingElements.set(element, isRemovable);\n      return null;\n    }\n\n    if (isRemovable) {\n      this.removePointerInTextLayer(element);\n    }\n\n    const children = this.#textChildren;\n    if (!children || children.length === 0) {\n      return null;\n    }\n\n    const index = binarySearchFirstItem(\n      children,\n      node =>\n        TextAccessibilityManager.#compareElementPositions(element, node) < 0\n    );\n\n    const nodeIndex = Math.max(0, index - 1);\n    const child = children[nodeIndex];\n    this.#addIdToAriaOwns(id, child);\n    this.#textNodes.set(id, nodeIndex);\n\n    const parent = child.parentNode;\n    return parent?.classList.contains(\"markedContent\") ? parent.id : null;\n  }\n\n  /**\n   * Move a div in the DOM in order to respect the visual order.\n   * @param {HTMLDivElement} element\n   * @returns {string|null} The id in the struct tree if any.\n   */\n  moveElementInDOM(container, element, contentElement, isRemovable) {\n    const id = this.addPointerInTextLayer(contentElement, isRemovable);\n\n    if (!container.hasChildNodes()) {\n      container.append(element);\n      return id;\n    }\n\n    const children = Array.from(container.childNodes).filter(\n      node => node !== element\n    );\n\n    if (children.length === 0) {\n      return id;\n    }\n\n    const elementToCompare = contentElement || element;\n    const index = binarySearchFirstItem(\n      children,\n      node =>\n        TextAccessibilityManager.#compareElementPositions(\n          elementToCompare,\n          node\n        ) < 0\n    );\n\n    if (index === 0) {\n      children[0].before(element);\n    } else {\n      children[index - 1].after(element);\n    }\n\n    return id;\n  }\n}\n\nexport { TextAccessibilityManager };\n","/* Copyright 2021 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/** @typedef {import(\"./event_utils\").EventBus} EventBus */\n// eslint-disable-next-line max-len\n/** @typedef {import(\"./pdf_find_controller\").PDFFindController} PDFFindController */\n\n/**\n * @typedef {Object} TextHighlighterOptions\n * @property {PDFFindController} findController\n * @property {EventBus} eventBus - The application event bus.\n * @property {number} pageIndex - The page index.\n */\n\n/**\n * TextHighlighter handles highlighting matches from the FindController in\n * either the text layer or XFA layer depending on the type of document.\n */\nclass TextHighlighter {\n  #eventAbortController = null;\n\n  /**\n   * @param {TextHighlighterOptions} options\n   */\n  constructor({ findController, eventBus, pageIndex }) {\n    this.findController = findController;\n    this.matches = [];\n    this.eventBus = eventBus;\n    this.pageIdx = pageIndex;\n    this.textDivs = null;\n    this.textContentItemsStr = null;\n    this.enabled = false;\n  }\n\n  /**\n   * Store two arrays that will map DOM nodes to text they should contain.\n   * The arrays should be of equal length and the array element at each index\n   * should correspond to the other. e.g.\n   * `items[0] = \"<span>Item 0</span>\" and texts[0] = \"Item 0\";\n   *\n   * @param {Array<Node>} divs\n   * @param {Array<string>} texts\n   */\n  setTextMapping(divs, texts) {\n    this.textDivs = divs;\n    this.textContentItemsStr = texts;\n  }\n\n  /**\n   * Start listening for events to update the highlighter and check if there are\n   * any current matches that need be highlighted.\n   */\n  enable() {\n    if (!this.textDivs || !this.textContentItemsStr) {\n      throw new Error(\"Text divs and strings have not been set.\");\n    }\n    if (this.enabled) {\n      throw new Error(\"TextHighlighter is already enabled.\");\n    }\n    this.enabled = true;\n\n    if (!this.#eventAbortController) {\n      this.#eventAbortController = new AbortController();\n\n      this.eventBus._on(\n        \"updatetextlayermatches\",\n        evt => {\n          if (evt.pageIndex === this.pageIdx || evt.pageIndex === -1) {\n            this._updateMatches();\n          }\n        },\n        { signal: this.#eventAbortController.signal }\n      );\n    }\n    this._updateMatches();\n  }\n\n  disable() {\n    if (!this.enabled) {\n      return;\n    }\n    this.enabled = false;\n\n    this.#eventAbortController?.abort();\n    this.#eventAbortController = null;\n\n    this._updateMatches(/* reset = */ true);\n  }\n\n  _convertMatches(matches, matchesLength) {\n    // Early exit if there is nothing to convert.\n    if (!matches) {\n      return [];\n    }\n    const { textContentItemsStr } = this;\n\n    let i = 0,\n      iIndex = 0;\n    const end = textContentItemsStr.length - 1;\n    const result = [];\n\n    for (let m = 0, mm = matches.length; m < mm; m++) {\n      // Calculate the start position.\n      let matchIdx = matches[m];\n\n      // Loop over the divIdxs.\n      while (i !== end && matchIdx >= iIndex + textContentItemsStr[i].length) {\n        iIndex += textContentItemsStr[i].length;\n        i++;\n      }\n\n      if (i === textContentItemsStr.length) {\n        console.error(\"Could not find a matching mapping\");\n      }\n\n      const match = {\n        begin: {\n          divIdx: i,\n          offset: matchIdx - iIndex,\n        },\n      };\n\n      // Calculate the end position.\n      matchIdx += matchesLength[m];\n\n      // Somewhat the same array as above, but use > instead of >= to get\n      // the end position right.\n      while (i !== end && matchIdx > iIndex + textContentItemsStr[i].length) {\n        iIndex += textContentItemsStr[i].length;\n        i++;\n      }\n\n      match.end = {\n        divIdx: i,\n        offset: matchIdx - iIndex,\n      };\n      result.push(match);\n    }\n    return result;\n  }\n\n  _renderMatches(matches) {\n    // Early exit if there is nothing to render.\n    if (matches.length === 0) {\n      return;\n    }\n    const { findController, pageIdx } = this;\n    const { textContentItemsStr, textDivs } = this;\n\n    const isSelectedPage = pageIdx === findController.selected.pageIdx;\n    const selectedMatchIdx = findController.selected.matchIdx;\n    const highlightAll = findController.state.highlightAll;\n    let prevEnd = null;\n    const infinity = {\n      divIdx: -1,\n      offset: undefined,\n    };\n\n    function beginText(begin, className) {\n      const divIdx = begin.divIdx;\n      textDivs[divIdx].textContent = \"\";\n      return appendTextToDiv(divIdx, 0, begin.offset, className);\n    }\n\n    function appendTextToDiv(divIdx, fromOffset, toOffset, className) {\n      let div = textDivs[divIdx];\n      if (div.nodeType === Node.TEXT_NODE) {\n        const span = document.createElement(\"span\");\n        div.before(span);\n        span.append(div);\n        textDivs[divIdx] = span;\n        div = span;\n      }\n      const content = textContentItemsStr[divIdx].substring(\n        fromOffset,\n        toOffset\n      );\n      const node = document.createTextNode(content);\n      if (className) {\n        const span = document.createElement(\"span\");\n        span.className = `${className} appended`;\n        span.append(node);\n        div.append(span);\n        return className.includes(\"selected\") ? span.offsetLeft : 0;\n      }\n      div.append(node);\n      return 0;\n    }\n\n    let i0 = selectedMatchIdx,\n      i1 = i0 + 1;\n    if (highlightAll) {\n      i0 = 0;\n      i1 = matches.length;\n    } else if (!isSelectedPage) {\n      // Not highlighting all and this isn't the selected page, so do nothing.\n      return;\n    }\n\n    let lastDivIdx = -1;\n    let lastOffset = -1;\n    for (let i = i0; i < i1; i++) {\n      const match = matches[i];\n      const begin = match.begin;\n      if (begin.divIdx === lastDivIdx && begin.offset === lastOffset) {\n        // It's possible to be in this situation if we searched for a 'f' and we\n        // have a ligature 'ff' in the text. The 'ff' has to be highlighted two\n        // times.\n        continue;\n      }\n      lastDivIdx = begin.divIdx;\n      lastOffset = begin.offset;\n\n      const end = match.end;\n      const isSelected = isSelectedPage && i === selectedMatchIdx;\n      const highlightSuffix = isSelected ? \" selected\" : \"\";\n      let selectedLeft = 0;\n\n      // Match inside new div.\n      if (!prevEnd || begin.divIdx !== prevEnd.divIdx) {\n        // If there was a previous div, then add the text at the end.\n        if (prevEnd !== null) {\n          appendTextToDiv(prevEnd.divIdx, prevEnd.offset, infinity.offset);\n        }\n        // Clear the divs and set the content until the starting point.\n        beginText(begin);\n      } else {\n        appendTextToDiv(prevEnd.divIdx, prevEnd.offset, begin.offset);\n      }\n\n      if (begin.divIdx === end.divIdx) {\n        selectedLeft = appendTextToDiv(\n          begin.divIdx,\n          begin.offset,\n          end.offset,\n          \"highlight\" + highlightSuffix\n        );\n      } else {\n        selectedLeft = appendTextToDiv(\n          begin.divIdx,\n          begin.offset,\n          infinity.offset,\n          \"highlight begin\" + highlightSuffix\n        );\n        for (let n0 = begin.divIdx + 1, n1 = end.divIdx; n0 < n1; n0++) {\n          textDivs[n0].className = \"highlight middle\" + highlightSuffix;\n        }\n        beginText(end, \"highlight end\" + highlightSuffix);\n      }\n      prevEnd = end;\n\n      if (isSelected) {\n        // Attempt to scroll the selected match into view.\n        findController.scrollMatchIntoView({\n          element: textDivs[begin.divIdx],\n          selectedLeft,\n          pageIndex: pageIdx,\n          matchIndex: selectedMatchIdx,\n        });\n      }\n    }\n\n    if (prevEnd) {\n      appendTextToDiv(prevEnd.divIdx, prevEnd.offset, infinity.offset);\n    }\n  }\n\n  _updateMatches(reset = false) {\n    if (!this.enabled && !reset) {\n      return;\n    }\n    const { findController, matches, pageIdx } = this;\n    const { textContentItemsStr, textDivs } = this;\n    let clearedUntilDivIdx = -1;\n\n    // Clear all current matches.\n    for (const match of matches) {\n      const begin = Math.max(clearedUntilDivIdx, match.begin.divIdx);\n      for (let n = begin, end = match.end.divIdx; n <= end; n++) {\n        const div = textDivs[n];\n        div.textContent = textContentItemsStr[n];\n        div.className = \"\";\n      }\n      clearedUntilDivIdx = match.end.divIdx + 1;\n    }\n\n    if (!findController?.highlightMatches || reset) {\n      return;\n    }\n    // Convert the matches on the `findController` into the match format\n    // used for the textLayer.\n    const pageMatches = findController.pageMatches[pageIdx] || null;\n    const pageMatchesLength = findController.pageMatchesLength[pageIdx] || null;\n\n    this.matches = this._convertMatches(pageMatches, pageMatchesLength);\n    this._renderMatches(this.matches);\n  }\n}\n\nexport { TextHighlighter };\n","/* Copyright 2012 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/** @typedef {import(\"../src/display/api\").PDFPageProxy} PDFPageProxy */\n// eslint-disable-next-line max-len\n/** @typedef {import(\"../src/display/display_utils\").PageViewport} PageViewport */\n/** @typedef {import(\"./text_highlighter\").TextHighlighter} TextHighlighter */\n// eslint-disable-next-line max-len\n/** @typedef {import(\"./text_accessibility.js\").TextAccessibilityManager} TextAccessibilityManager */\n\nimport { normalizeUnicode, TextLayer } from \"pdfjs-lib\";\nimport { removeNullCharacters } from \"./ui_utils.js\";\n\n/**\n * @typedef {Object} TextLayerBuilderOptions\n * @property {PDFPageProxy} pdfPage\n * @property {TextHighlighter} [highlighter] - Optional object that will handle\n *   highlighting text from the find controller.\n * @property {TextAccessibilityManager} [accessibilityManager]\n * @property {function} [onAppend]\n */\n\n/**\n * The text layer builder provides text selection functionality for the PDF.\n * It does this by creating overlay divs over the PDF's text. These divs\n * contain text that matches the PDF text they are overlaying.\n */\nclass TextLayerBuilder {\n  #enablePermissions = false;\n\n  #onAppend = null;\n\n  #renderingDone = false;\n\n  #textLayer = null;\n\n  static #textLayers = new Map();\n\n  static #selectionChangeAbortController = null;\n\n  constructor({\n    pdfPage,\n    highlighter = null,\n    accessibilityManager = null,\n    enablePermissions = false,\n    onAppend = null,\n  }) {\n    this.pdfPage = pdfPage;\n    this.highlighter = highlighter;\n    this.accessibilityManager = accessibilityManager;\n    this.#enablePermissions = enablePermissions === true;\n    this.#onAppend = onAppend;\n\n    this.div = document.createElement(\"div\");\n    this.div.tabIndex = 0;\n    this.div.className = \"textLayer\";\n  }\n\n  /**\n   * Renders the text layer.\n   * @param {PageViewport} viewport\n   * @param {Object} [textContentParams]\n   */\n  async render(viewport, textContentParams = null) {\n    if (this.#renderingDone && this.#textLayer) {\n      this.#textLayer.update({\n        viewport,\n        onBefore: this.hide.bind(this),\n      });\n      this.show();\n      return;\n    }\n\n    this.cancel();\n    this.#textLayer = new TextLayer({\n      textContentSource: this.pdfPage.streamTextContent(\n        textContentParams || {\n          includeMarkedContent: true,\n          disableNormalization: true,\n        }\n      ),\n      container: this.div,\n      viewport,\n    });\n\n    const { textDivs, textContentItemsStr } = this.#textLayer;\n    this.highlighter?.setTextMapping(textDivs, textContentItemsStr);\n    this.accessibilityManager?.setTextMapping(textDivs);\n\n    await this.#textLayer.render();\n    this.#renderingDone = true;\n\n    const endOfContent = document.createElement(\"div\");\n    endOfContent.className = \"endOfContent\";\n    this.div.append(endOfContent);\n\n    this.#bindMouse(endOfContent);\n    // Ensure that the textLayer is appended to the DOM *before* handling\n    // e.g. a pending search operation.\n    this.#onAppend?.(this.div);\n    this.highlighter?.enable();\n    this.accessibilityManager?.enable();\n  }\n\n  hide() {\n    if (!this.div.hidden && this.#renderingDone) {\n      // We turn off the highlighter in order to avoid to scroll into view an\n      // element of the text layer which could be hidden.\n      this.highlighter?.disable();\n      this.div.hidden = true;\n    }\n  }\n\n  show() {\n    if (this.div.hidden && this.#renderingDone) {\n      this.div.hidden = false;\n      this.highlighter?.enable();\n    }\n  }\n\n  /**\n   * Cancel rendering of the text layer.\n   */\n  cancel() {\n    this.#textLayer?.cancel();\n    this.#textLayer = null;\n\n    this.highlighter?.disable();\n    this.accessibilityManager?.disable();\n    TextLayerBuilder.#removeGlobalSelectionListener(this.div);\n  }\n\n  /**\n   * Improves text selection by adding an additional div where the mouse was\n   * clicked. This reduces flickering of the content if the mouse is slowly\n   * dragged up or down.\n   */\n  #bindMouse(end) {\n    const { div } = this;\n\n    div.addEventListener(\"mousedown\", () => {\n      div.classList.add(\"selecting\");\n    });\n\n    div.addEventListener(\"copy\", event => {\n      if (!this.#enablePermissions) {\n        const selection = document.getSelection();\n        event.clipboardData.setData(\n          \"text/plain\",\n          removeNullCharacters(normalizeUnicode(selection.toString()))\n        );\n      }\n      event.preventDefault();\n      event.stopPropagation();\n    });\n\n    TextLayerBuilder.#textLayers.set(div, end);\n    TextLayerBuilder.#enableGlobalSelectionListener();\n  }\n\n  static #removeGlobalSelectionListener(textLayerDiv) {\n    this.#textLayers.delete(textLayerDiv);\n\n    if (this.#textLayers.size === 0) {\n      this.#selectionChangeAbortController?.abort();\n      this.#selectionChangeAbortController = null;\n    }\n  }\n\n  static #enableGlobalSelectionListener() {\n    if (this.#selectionChangeAbortController) {\n      // document-level event listeners already installed\n      return;\n    }\n    this.#selectionChangeAbortController = new AbortController();\n    const { signal } = this.#selectionChangeAbortController;\n\n    const reset = (end, textLayer) => {\n      if (typeof PDFJSDev === \"undefined\" || !PDFJSDev.test(\"MOZCENTRAL\")) {\n        textLayer.append(end);\n        end.style.width = \"\";\n        end.style.height = \"\";\n      }\n      textLayer.classList.remove(\"selecting\");\n    };\n\n    let isPointerDown = false;\n    document.addEventListener(\n      \"pointerdown\",\n      () => {\n        isPointerDown = true;\n      },\n      { signal }\n    );\n    document.addEventListener(\n      \"pointerup\",\n      () => {\n        isPointerDown = false;\n        this.#textLayers.forEach(reset);\n      },\n      { signal }\n    );\n    window.addEventListener(\n      \"blur\",\n      () => {\n        isPointerDown = false;\n        this.#textLayers.forEach(reset);\n      },\n      { signal }\n    );\n    document.addEventListener(\n      \"keyup\",\n      () => {\n        if (!isPointerDown) {\n          this.#textLayers.forEach(reset);\n        }\n      },\n      { signal }\n    );\n\n    if (typeof PDFJSDev === \"undefined\" || !PDFJSDev.test(\"MOZCENTRAL\")) {\n      // eslint-disable-next-line no-var\n      var isFirefox, prevRange;\n    }\n\n    document.addEventListener(\n      \"selectionchange\",\n      () => {\n        const selection = document.getSelection();\n        if (selection.rangeCount === 0) {\n          this.#textLayers.forEach(reset);\n          return;\n        }\n\n        // Even though the spec says that .rangeCount should be 0 or 1, Firefox\n        // creates multiple ranges when selecting across multiple pages.\n        // Make sure to collect all the .textLayer elements where the selection\n        // is happening.\n        const activeTextLayers = new Set();\n        for (let i = 0; i < selection.rangeCount; i++) {\n          const range = selection.getRangeAt(i);\n          for (const textLayerDiv of this.#textLayers.keys()) {\n            if (\n              !activeTextLayers.has(textLayerDiv) &&\n              range.intersectsNode(textLayerDiv)\n            ) {\n              activeTextLayers.add(textLayerDiv);\n            }\n          }\n        }\n\n        for (const [textLayerDiv, endDiv] of this.#textLayers) {\n          if (activeTextLayers.has(textLayerDiv)) {\n            textLayerDiv.classList.add(\"selecting\");\n          } else {\n            reset(endDiv, textLayerDiv);\n          }\n        }\n\n        if (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")) {\n          return;\n        }\n        if (typeof PDFJSDev === \"undefined\" || !PDFJSDev.test(\"CHROME\")) {\n          isFirefox ??=\n            getComputedStyle(\n              this.#textLayers.values().next().value\n            ).getPropertyValue(\"-moz-user-select\") === \"none\";\n\n          if (isFirefox) {\n            return;\n          }\n        }\n        // In non-Firefox browsers, when hovering over an empty space (thus,\n        // on .endOfContent), the selection will expand to cover all the\n        // text between the current selection and .endOfContent. By moving\n        // .endOfContent to right after (or before, depending on which side\n        // of the selection the user is moving), we limit the selection jump\n        // to at most cover the enteirety of the <span> where the selection\n        // is being modified.\n        const range = selection.getRangeAt(0);\n        const modifyStart =\n          prevRange &&\n          (range.compareBoundaryPoints(Range.END_TO_END, prevRange) === 0 ||\n            range.compareBoundaryPoints(Range.START_TO_END, prevRange) === 0);\n        let anchor = modifyStart ? range.startContainer : range.endContainer;\n        if (anchor.nodeType === Node.TEXT_NODE) {\n          anchor = anchor.parentNode;\n        }\n\n        const parentTextLayer = anchor.parentElement?.closest(\".textLayer\");\n        const endDiv = this.#textLayers.get(parentTextLayer);\n        if (endDiv) {\n          endDiv.style.width = parentTextLayer.style.width;\n          endDiv.style.height = parentTextLayer.style.height;\n          anchor.parentElement.insertBefore(\n            endDiv,\n            modifyStart ? anchor : anchor.nextSibling\n          );\n        }\n\n        prevRange = range.cloneRange();\n      },\n      { signal }\n    );\n  }\n}\n\nexport { TextLayerBuilder };\n","/* Copyright 2012 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n// eslint-disable-next-line max-len\n/** @typedef {import(\"../src/display/display_utils\").PageViewport} PageViewport */\n// eslint-disable-next-line max-len\n/** @typedef {import(\"../src/display/optional_content_config\").OptionalContentConfig} OptionalContentConfig */\n/** @typedef {import(\"./event_utils\").EventBus} EventBus */\n/** @typedef {import(\"./interfaces\").IL10n} IL10n */\n/** @typedef {import(\"./interfaces\").IRenderableView} IRenderableView */\n// eslint-disable-next-line max-len\n/** @typedef {import(\"./pdf_rendering_queue\").PDFRenderingQueue} PDFRenderingQueue */\n\nimport {\n  AbortException,\n  AnnotationMode,\n  OutputScale,\n  PixelsPerInch,\n  RenderingCancelledException,\n  setLayerDimensions,\n  shadow,\n} from \"pdfjs-lib\";\nimport {\n  approximateFraction,\n  calcRound,\n  DEFAULT_SCALE,\n  floorToDivide,\n  RenderingStates,\n  TextLayerMode,\n} from \"./ui_utils.js\";\nimport { AnnotationEditorLayerBuilder } from \"./annotation_editor_layer_builder.js\";\nimport { AnnotationLayerBuilder } from \"./annotation_layer_builder.js\";\nimport { AppOptions } from \"./app_options.js\";\nimport { DrawLayerBuilder } from \"./draw_layer_builder.js\";\nimport { GenericL10n } from \"web-null_l10n\";\nimport { SimpleLinkService } from \"./pdf_link_service.js\";\nimport { StructTreeLayerBuilder } from \"./struct_tree_layer_builder.js\";\nimport { TextAccessibilityManager } from \"./text_accessibility.js\";\nimport { TextHighlighter } from \"./text_highlighter.js\";\nimport { TextLayerBuilder } from \"./text_layer_builder.js\";\nimport { XfaLayerBuilder } from \"./xfa_layer_builder.js\";\n\n/**\n * @typedef {Object} PDFPageViewOptions\n * @property {HTMLDivElement} [container] - The viewer element.\n * @property {EventBus} eventBus - The application event bus.\n * @property {number} id - The page unique ID (normally its number).\n * @property {number} [scale] - The page scale display.\n * @property {PageViewport} defaultViewport - The page viewport.\n * @property {Promise<OptionalContentConfig>} [optionalContentConfigPromise] -\n *   A promise that is resolved with an {@link OptionalContentConfig} instance.\n *   The default value is `null`.\n * @property {PDFRenderingQueue} [renderingQueue] - The rendering queue object.\n * @property {number} [textLayerMode] - Controls if the text layer used for\n *   selection and searching is created. The constants from {TextLayerMode}\n *   should be used. The default value is `TextLayerMode.ENABLE`.\n * @property {number} [annotationMode] - Controls if the annotation layer is\n *   created, and if interactive form elements or `AnnotationStorage`-data are\n *   being rendered. The constants from {@link AnnotationMode} should be used;\n *   see also {@link RenderParameters} and {@link GetOperatorListParameters}.\n *   The default value is `AnnotationMode.ENABLE_FORMS`.\n * @property {string} [imageResourcesPath] - Path for image resources, mainly\n *   for annotation icons. Include trailing slash.\n * @property {number} [maxCanvasPixels] - The maximum supported canvas size in\n *   total pixels, i.e. width * height. Use `-1` for no limit, or `0` for\n *   CSS-only zooming. The default value is 4096 * 8192 (32 mega-pixels).\n * @property {Object} [pageColors] - Overwrites background and foreground colors\n *   with user defined ones in order to improve readability in high contrast\n *   mode.\n * @property {IL10n} [l10n] - Localization service.\n * @property {Object} [layerProperties] - The object that is used to lookup\n *   the necessary layer-properties.\n * @property {boolean} [enableHWA] - Enables hardware acceleration for\n *   rendering. The default value is `false`.\n */\n\nconst DEFAULT_LAYER_PROPERTIES =\n  typeof PDFJSDev === \"undefined\" || !PDFJSDev.test(\"COMPONENTS\")\n    ? null\n    : {\n        annotationEditorUIManager: null,\n        annotationStorage: null,\n        downloadManager: null,\n        enableScripting: false,\n        fieldObjectsPromise: null,\n        findController: null,\n        hasJSActionsPromise: null,\n        get linkService() {\n          return new SimpleLinkService();\n        },\n      };\n\nconst LAYERS_ORDER = new Map([\n  [\"canvasWrapper\", 0],\n  [\"textLayer\", 1],\n  [\"annotationLayer\", 2],\n  [\"annotationEditorLayer\", 3],\n  [\"xfaLayer\", 3],\n]);\n\n/**\n * @implements {IRenderableView}\n */\nclass PDFPageView {\n  #annotationMode = AnnotationMode.ENABLE_FORMS;\n\n  #enableHWA = false;\n\n  #hasRestrictedScaling = false;\n\n  #isEditing = false;\n\n  #layerProperties = null;\n\n  #loadingId = null;\n\n  #previousRotation = null;\n\n  #scaleRoundX = 1;\n\n  #scaleRoundY = 1;\n\n  #renderError = null;\n\n  #renderingState = RenderingStates.INITIAL;\n\n  #textLayerMode = TextLayerMode.ENABLE;\n\n  #useThumbnailCanvas = {\n    directDrawing: true,\n    initialOptionalContent: true,\n    regularAnnotations: true,\n  };\n\n  #viewportMap = new WeakMap();\n\n  #layers = [null, null, null, null];\n\n  /**\n   * @param {PDFPageViewOptions} options\n   */\n  constructor(options) {\n    const container = options.container;\n    const defaultViewport = options.defaultViewport;\n\n    this.id = options.id;\n    this.renderingId = \"page\" + this.id;\n    this.#layerProperties = options.layerProperties || DEFAULT_LAYER_PROPERTIES;\n\n    this.pdfPage = null;\n    this.pageLabel = null;\n    this.rotation = 0;\n    this.scale = options.scale || DEFAULT_SCALE;\n    this.viewport = defaultViewport;\n    this.pdfPageRotate = defaultViewport.rotation;\n    this._optionalContentConfigPromise =\n      options.optionalContentConfigPromise || null;\n    this.#textLayerMode = options.textLayerMode ?? TextLayerMode.ENABLE;\n    this.#annotationMode =\n      options.annotationMode ?? AnnotationMode.ENABLE_FORMS;\n    this.imageResourcesPath = options.imageResourcesPath || \"\";\n    this.maxCanvasPixels =\n      options.maxCanvasPixels ?? AppOptions.get(\"maxCanvasPixels\");\n    this.pageColors = options.pageColors || null;\n    this.#enableHWA = options.enableHWA || false;\n\n    this.eventBus = options.eventBus;\n    this.renderingQueue = options.renderingQueue;\n    this.l10n = options.l10n;\n    if (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"GENERIC\")) {\n      this.l10n ||= new GenericL10n();\n    }\n\n    this.renderTask = null;\n    this.resume = null;\n    if (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"GENERIC\")) {\n      this._isStandalone = !this.renderingQueue?.hasViewer();\n      this._container = container;\n    }\n\n    this._annotationCanvasMap = null;\n\n    this.annotationLayer = null;\n    this.annotationEditorLayer = null;\n    this.textLayer = null;\n    this.zoomLayer = null;\n    this.xfaLayer = null;\n    this.structTreeLayer = null;\n    this.drawLayer = null;\n\n    const div = document.createElement(\"div\");\n    div.className = \"page\";\n    div.setAttribute(\"data-page-number\", this.id);\n    div.setAttribute(\"role\", \"region\");\n    div.setAttribute(\"data-l10n-id\", \"pdfjs-page-landmark\");\n    div.setAttribute(\"data-l10n-args\", JSON.stringify({ page: this.id }));\n    this.div = div;\n\n    this.#setDimensions();\n    container?.append(div);\n\n    if (\n      (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"GENERIC\")) &&\n      this._isStandalone\n    ) {\n      // Ensure that the various layers always get the correct initial size,\n      // see issue 15795.\n      container?.style.setProperty(\n        \"--scale-factor\",\n        this.scale * PixelsPerInch.PDF_TO_CSS_UNITS\n      );\n\n      if (this.pageColors?.background) {\n        container?.style.setProperty(\n          \"--page-bg-color\",\n          this.pageColors.background\n        );\n      }\n\n      const { optionalContentConfigPromise } = options;\n      if (optionalContentConfigPromise) {\n        // Ensure that the thumbnails always display the *initial* document\n        // state, for documents with optional content.\n        optionalContentConfigPromise.then(optionalContentConfig => {\n          if (\n            optionalContentConfigPromise !== this._optionalContentConfigPromise\n          ) {\n            return;\n          }\n          this.#useThumbnailCanvas.initialOptionalContent =\n            optionalContentConfig.hasInitialVisibility;\n        });\n      }\n\n      // Ensure that Fluent is connected in e.g. the COMPONENTS build.\n      if (!options.l10n) {\n        this.l10n.translate(this.div);\n      }\n    }\n  }\n\n  #addLayer(div, name) {\n    const pos = LAYERS_ORDER.get(name);\n    const oldDiv = this.#layers[pos];\n    this.#layers[pos] = div;\n    if (oldDiv) {\n      oldDiv.replaceWith(div);\n      return;\n    }\n    for (let i = pos - 1; i >= 0; i--) {\n      const layer = this.#layers[i];\n      if (layer) {\n        layer.after(div);\n        return;\n      }\n    }\n    this.div.prepend(div);\n  }\n\n  get renderingState() {\n    return this.#renderingState;\n  }\n\n  set renderingState(state) {\n    if (state === this.#renderingState) {\n      return;\n    }\n    this.#renderingState = state;\n\n    if (this.#loadingId) {\n      clearTimeout(this.#loadingId);\n      this.#loadingId = null;\n    }\n\n    switch (state) {\n      case RenderingStates.PAUSED:\n        this.div.classList.remove(\"loading\");\n        break;\n      case RenderingStates.RUNNING:\n        this.div.classList.add(\"loadingIcon\");\n        this.#loadingId = setTimeout(() => {\n          // Adding the loading class is slightly postponed in order to not have\n          // it with loadingIcon.\n          // If we don't do that the visibility of the background is changed but\n          // the transition isn't triggered.\n          this.div.classList.add(\"loading\");\n          this.#loadingId = null;\n        }, 0);\n        break;\n      case RenderingStates.INITIAL:\n      case RenderingStates.FINISHED:\n        this.div.classList.remove(\"loadingIcon\", \"loading\");\n        break;\n    }\n  }\n\n  #setDimensions() {\n    const { viewport } = this;\n    if (this.pdfPage) {\n      if (this.#previousRotation === viewport.rotation) {\n        return;\n      }\n      this.#previousRotation = viewport.rotation;\n    }\n\n    setLayerDimensions(\n      this.div,\n      viewport,\n      /* mustFlip = */ true,\n      /* mustRotate = */ false\n    );\n  }\n\n  setPdfPage(pdfPage) {\n    if (\n      (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"GENERIC\")) &&\n      this._isStandalone &&\n      (this.pageColors?.foreground === \"CanvasText\" ||\n        this.pageColors?.background === \"Canvas\")\n    ) {\n      this._container?.style.setProperty(\n        \"--hcm-highlight-filter\",\n        pdfPage.filterFactory.addHighlightHCMFilter(\n          \"highlight\",\n          \"CanvasText\",\n          \"Canvas\",\n          \"HighlightText\",\n          \"Highlight\"\n        )\n      );\n      this._container?.style.setProperty(\n        \"--hcm-highlight-selected-filter\",\n        pdfPage.filterFactory.addHighlightHCMFilter(\n          \"highlight_selected\",\n          \"CanvasText\",\n          \"Canvas\",\n          \"HighlightText\",\n          \"Highlight\"\n        )\n      );\n    }\n    this.pdfPage = pdfPage;\n    this.pdfPageRotate = pdfPage.rotate;\n\n    const totalRotation = (this.rotation + this.pdfPageRotate) % 360;\n    this.viewport = pdfPage.getViewport({\n      scale: this.scale * PixelsPerInch.PDF_TO_CSS_UNITS,\n      rotation: totalRotation,\n    });\n    this.#setDimensions();\n    this.reset();\n  }\n\n  destroy() {\n    this.reset();\n    this.pdfPage?.cleanup();\n  }\n\n  hasEditableAnnotations() {\n    return !!this.annotationLayer?.hasEditableAnnotations();\n  }\n\n  get _textHighlighter() {\n    return shadow(\n      this,\n      \"_textHighlighter\",\n      new TextHighlighter({\n        pageIndex: this.id - 1,\n        eventBus: this.eventBus,\n        findController: this.#layerProperties.findController,\n      })\n    );\n  }\n\n  #dispatchLayerRendered(name, error) {\n    this.eventBus.dispatch(name, {\n      source: this,\n      pageNumber: this.id,\n      error,\n    });\n  }\n\n  async #renderAnnotationLayer() {\n    let error = null;\n    try {\n      await this.annotationLayer.render(\n        this.viewport,\n        { structTreeLayer: this.structTreeLayer },\n        \"display\"\n      );\n    } catch (ex) {\n      console.error(`#renderAnnotationLayer: \"${ex}\".`);\n      error = ex;\n    } finally {\n      this.#dispatchLayerRendered(\"annotationlayerrendered\", error);\n    }\n  }\n\n  async #renderAnnotationEditorLayer() {\n    let error = null;\n    try {\n      await this.annotationEditorLayer.render(this.viewport, \"display\");\n    } catch (ex) {\n      console.error(`#renderAnnotationEditorLayer: \"${ex}\".`);\n      error = ex;\n    } finally {\n      this.#dispatchLayerRendered(\"annotationeditorlayerrendered\", error);\n    }\n  }\n\n  async #renderDrawLayer() {\n    try {\n      await this.drawLayer.render(\"display\");\n    } catch (ex) {\n      console.error(`#renderDrawLayer: \"${ex}\".`);\n    }\n  }\n\n  async #renderXfaLayer() {\n    let error = null;\n    try {\n      const result = await this.xfaLayer.render(this.viewport, \"display\");\n      if (result?.textDivs && this._textHighlighter) {\n        // Given that the following method fetches the text asynchronously we\n        // can invoke it *before* appending the xfaLayer to the DOM (below),\n        // since a pending search-highlight/scroll operation thus won't run\n        // until after the xfaLayer is available in the viewer.\n        this.#buildXfaTextContentItems(result.textDivs);\n      }\n    } catch (ex) {\n      console.error(`#renderXfaLayer: \"${ex}\".`);\n      error = ex;\n    } finally {\n      if (this.xfaLayer?.div) {\n        // Pause translation when inserting the xfaLayer in the DOM.\n        this.l10n.pause();\n        this.#addLayer(this.xfaLayer.div, \"xfaLayer\");\n        this.l10n.resume();\n      }\n      this.#dispatchLayerRendered(\"xfalayerrendered\", error);\n    }\n  }\n\n  async #renderTextLayer() {\n    if (!this.textLayer) {\n      return;\n    }\n\n    let error = null;\n    try {\n      await this.textLayer.render(this.viewport);\n    } catch (ex) {\n      if (ex instanceof AbortException) {\n        return;\n      }\n      console.error(`#renderTextLayer: \"${ex}\".`);\n      error = ex;\n    }\n    this.#dispatchLayerRendered(\"textlayerrendered\", error);\n\n    this.#renderStructTreeLayer();\n  }\n\n  /**\n   * The structure tree is currently only supported when the text layer is\n   * enabled and a canvas is used for rendering.\n   *\n   * The structure tree must be generated after the text layer for the\n   * aria-owns to work.\n   */\n  async #renderStructTreeLayer() {\n    if (!this.textLayer) {\n      return;\n    }\n\n    const treeDom = await this.structTreeLayer?.render();\n    if (treeDom) {\n      this.l10n.pause();\n      this.structTreeLayer?.addElementsToTextLayer();\n      if (this.canvas && treeDom.parentNode !== this.canvas) {\n        // Pause translation when inserting the structTree in the DOM.\n        this.canvas.append(treeDom);\n      }\n      this.l10n.resume();\n    }\n    this.structTreeLayer?.show();\n  }\n\n  async #buildXfaTextContentItems(textDivs) {\n    const text = await this.pdfPage.getTextContent();\n    const items = [];\n    for (const item of text.items) {\n      items.push(item.str);\n    }\n    this._textHighlighter.setTextMapping(textDivs, items);\n    this._textHighlighter.enable();\n  }\n\n  /**\n   * @private\n   */\n  _resetZoomLayer(removeFromDOM = false) {\n    if (!this.zoomLayer) {\n      return;\n    }\n    const zoomLayerCanvas = this.zoomLayer.firstChild;\n    this.#viewportMap.delete(zoomLayerCanvas);\n    // Zeroing the width and height causes Firefox to release graphics\n    // resources immediately, which can greatly reduce memory consumption.\n    zoomLayerCanvas.width = 0;\n    zoomLayerCanvas.height = 0;\n\n    if (removeFromDOM) {\n      // Note: `ChildNode.remove` doesn't throw if the parent node is undefined.\n      this.zoomLayer.remove();\n    }\n    this.zoomLayer = null;\n  }\n\n  reset({\n    keepZoomLayer = false,\n    keepAnnotationLayer = false,\n    keepAnnotationEditorLayer = false,\n    keepXfaLayer = false,\n    keepTextLayer = false,\n  } = {}) {\n    this.cancelRendering({\n      keepAnnotationLayer,\n      keepAnnotationEditorLayer,\n      keepXfaLayer,\n      keepTextLayer,\n    });\n    this.renderingState = RenderingStates.INITIAL;\n\n    const div = this.div;\n\n    const childNodes = div.childNodes,\n      zoomLayerNode = (keepZoomLayer && this.zoomLayer) || null,\n      annotationLayerNode =\n        (keepAnnotationLayer && this.annotationLayer?.div) || null,\n      annotationEditorLayerNode =\n        (keepAnnotationEditorLayer && this.annotationEditorLayer?.div) || null,\n      xfaLayerNode = (keepXfaLayer && this.xfaLayer?.div) || null,\n      textLayerNode = (keepTextLayer && this.textLayer?.div) || null;\n    for (let i = childNodes.length - 1; i >= 0; i--) {\n      const node = childNodes[i];\n      switch (node) {\n        case zoomLayerNode:\n        case annotationLayerNode:\n        case annotationEditorLayerNode:\n        case xfaLayerNode:\n        case textLayerNode:\n          continue;\n      }\n      node.remove();\n      const layerIndex = this.#layers.indexOf(node);\n      if (layerIndex >= 0) {\n        this.#layers[layerIndex] = null;\n      }\n    }\n    div.removeAttribute(\"data-loaded\");\n\n    if (annotationLayerNode) {\n      // Hide the annotation layer until all elements are resized\n      // so they are not displayed on the already resized page.\n      this.annotationLayer.hide();\n    }\n    if (annotationEditorLayerNode) {\n      this.annotationEditorLayer.hide();\n    }\n    if (xfaLayerNode) {\n      // Hide the XFA layer until all elements are resized\n      // so they are not displayed on the already resized page.\n      this.xfaLayer.hide();\n    }\n    if (textLayerNode) {\n      this.textLayer.hide();\n    }\n    this.structTreeLayer?.hide();\n\n    if (!zoomLayerNode) {\n      if (this.canvas) {\n        this.#viewportMap.delete(this.canvas);\n        // Zeroing the width and height causes Firefox to release graphics\n        // resources immediately, which can greatly reduce memory consumption.\n        this.canvas.width = 0;\n        this.canvas.height = 0;\n        delete this.canvas;\n      }\n      this._resetZoomLayer();\n    }\n  }\n\n  toggleEditingMode(isEditing) {\n    if (!this.hasEditableAnnotations()) {\n      return;\n    }\n    this.#isEditing = isEditing;\n    this.reset({\n      keepZoomLayer: true,\n      keepAnnotationLayer: true,\n      keepAnnotationEditorLayer: true,\n      keepXfaLayer: true,\n      keepTextLayer: true,\n    });\n  }\n\n  /**\n   * @typedef {Object} PDFPageViewUpdateParameters\n   * @property {number} [scale] The new scale, if specified.\n   * @property {number} [rotation] The new rotation, if specified.\n   * @property {Promise<OptionalContentConfig>} [optionalContentConfigPromise]\n   *   A promise that is resolved with an {@link OptionalContentConfig}\n   *   instance. The default value is `null`.\n   * @property {number} [drawingDelay]\n   */\n\n  /**\n   * Update e.g. the scale and/or rotation of the page.\n   * @param {PDFPageViewUpdateParameters} params\n   */\n  update({\n    scale = 0,\n    rotation = null,\n    optionalContentConfigPromise = null,\n    drawingDelay = -1,\n  }) {\n    this.scale = scale || this.scale;\n    if (typeof rotation === \"number\") {\n      this.rotation = rotation; // The rotation may be zero.\n    }\n    if (optionalContentConfigPromise instanceof Promise) {\n      this._optionalContentConfigPromise = optionalContentConfigPromise;\n\n      // Ensure that the thumbnails always display the *initial* document state,\n      // for documents with optional content.\n      optionalContentConfigPromise.then(optionalContentConfig => {\n        if (\n          optionalContentConfigPromise !== this._optionalContentConfigPromise\n        ) {\n          return;\n        }\n        this.#useThumbnailCanvas.initialOptionalContent =\n          optionalContentConfig.hasInitialVisibility;\n      });\n    }\n    this.#useThumbnailCanvas.directDrawing = true;\n\n    const totalRotation = (this.rotation + this.pdfPageRotate) % 360;\n    this.viewport = this.viewport.clone({\n      scale: this.scale * PixelsPerInch.PDF_TO_CSS_UNITS,\n      rotation: totalRotation,\n    });\n    this.#setDimensions();\n\n    if (\n      (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"GENERIC\")) &&\n      this._isStandalone\n    ) {\n      this._container?.style.setProperty(\"--scale-factor\", this.viewport.scale);\n    }\n\n    if (this.canvas) {\n      let onlyCssZoom = false;\n      if (this.#hasRestrictedScaling) {\n        if (\n          (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"GENERIC\")) &&\n          this.maxCanvasPixels === 0\n        ) {\n          onlyCssZoom = true;\n        } else if (this.maxCanvasPixels > 0) {\n          const { width, height } = this.viewport;\n          const { sx, sy } = this.outputScale;\n          onlyCssZoom =\n            ((Math.floor(width) * sx) | 0) * ((Math.floor(height) * sy) | 0) >\n            this.maxCanvasPixels;\n        }\n      }\n      const postponeDrawing = drawingDelay >= 0 && drawingDelay < 1000;\n\n      if (postponeDrawing || onlyCssZoom) {\n        if (\n          postponeDrawing &&\n          !onlyCssZoom &&\n          this.renderingState !== RenderingStates.FINISHED\n        ) {\n          this.cancelRendering({\n            keepZoomLayer: true,\n            keepAnnotationLayer: true,\n            keepAnnotationEditorLayer: true,\n            keepXfaLayer: true,\n            keepTextLayer: true,\n            cancelExtraDelay: drawingDelay,\n          });\n          // It isn't really finished, but once we have finished\n          // to postpone, we'll call this.reset(...) which will set\n          // the rendering state to INITIAL, hence the next call to\n          // PDFViewer.update() will trigger a redraw (if it's mandatory).\n          this.renderingState = RenderingStates.FINISHED;\n          // Ensure that the thumbnails won't become partially (or fully) blank,\n          // if the sidebar is opened before the actual rendering is done.\n          this.#useThumbnailCanvas.directDrawing = false;\n        }\n\n        this.cssTransform({\n          target: this.canvas,\n          redrawAnnotationLayer: true,\n          redrawAnnotationEditorLayer: true,\n          redrawXfaLayer: true,\n          redrawTextLayer: !postponeDrawing,\n          hideTextLayer: postponeDrawing,\n        });\n\n        if (postponeDrawing) {\n          // The \"pagerendered\"-event will be dispatched once the actual\n          // rendering is done, hence don't dispatch it here as well.\n          return;\n        }\n        this.eventBus.dispatch(\"pagerendered\", {\n          source: this,\n          pageNumber: this.id,\n          cssTransform: true,\n          timestamp: performance.now(),\n          error: this.#renderError,\n        });\n        return;\n      }\n      if (!this.zoomLayer && !this.canvas.hidden) {\n        this.zoomLayer = this.canvas.parentNode;\n        this.zoomLayer.style.position = \"absolute\";\n      }\n    }\n    if (this.zoomLayer) {\n      this.cssTransform({ target: this.zoomLayer.firstChild });\n    }\n    this.reset({\n      keepZoomLayer: true,\n      keepAnnotationLayer: true,\n      keepAnnotationEditorLayer: true,\n      keepXfaLayer: true,\n      keepTextLayer: true,\n    });\n  }\n\n  /**\n   * PLEASE NOTE: Most likely you want to use the `this.reset()` method,\n   *              rather than calling this one directly.\n   */\n  cancelRendering({\n    keepAnnotationLayer = false,\n    keepAnnotationEditorLayer = false,\n    keepXfaLayer = false,\n    keepTextLayer = false,\n    cancelExtraDelay = 0,\n  } = {}) {\n    if (this.renderTask) {\n      this.renderTask.cancel(cancelExtraDelay);\n      this.renderTask = null;\n    }\n    this.resume = null;\n\n    if (this.textLayer && (!keepTextLayer || !this.textLayer.div)) {\n      this.textLayer.cancel();\n      this.textLayer = null;\n    }\n    if (\n      this.annotationLayer &&\n      (!keepAnnotationLayer || !this.annotationLayer.div)\n    ) {\n      this.annotationLayer.cancel();\n      this.annotationLayer = null;\n      this._annotationCanvasMap = null;\n    }\n    if (this.structTreeLayer && !this.textLayer) {\n      this.structTreeLayer = null;\n    }\n    if (\n      this.annotationEditorLayer &&\n      (!keepAnnotationEditorLayer || !this.annotationEditorLayer.div)\n    ) {\n      if (this.drawLayer) {\n        this.drawLayer.cancel();\n        this.drawLayer = null;\n      }\n      this.annotationEditorLayer.cancel();\n      this.annotationEditorLayer = null;\n    }\n    if (this.xfaLayer && (!keepXfaLayer || !this.xfaLayer.div)) {\n      this.xfaLayer.cancel();\n      this.xfaLayer = null;\n      this._textHighlighter?.disable();\n    }\n  }\n\n  cssTransform({\n    target,\n    redrawAnnotationLayer = false,\n    redrawAnnotationEditorLayer = false,\n    redrawXfaLayer = false,\n    redrawTextLayer = false,\n    hideTextLayer = false,\n  }) {\n    // Scale target (canvas), its wrapper and page container.\n    if (\n      (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"TESTING\")) &&\n      !(target instanceof HTMLCanvasElement)\n    ) {\n      throw new Error(\"Expected `target` to be a canvas.\");\n    }\n    if (!target.hasAttribute(\"zooming\")) {\n      target.setAttribute(\"zooming\", true);\n      const { style } = target;\n      style.width = style.height = \"\";\n    }\n\n    const originalViewport = this.#viewportMap.get(target);\n    if (this.viewport !== originalViewport) {\n      // The canvas may have been originally rotated; rotate relative to that.\n      const relativeRotation =\n        this.viewport.rotation - originalViewport.rotation;\n      const absRotation = Math.abs(relativeRotation);\n      let scaleX = 1,\n        scaleY = 1;\n      if (absRotation === 90 || absRotation === 270) {\n        const { width, height } = this.viewport;\n        // Scale x and y because of the rotation.\n        scaleX = height / width;\n        scaleY = width / height;\n      }\n      target.style.transform = `rotate(${relativeRotation}deg) scale(${scaleX}, ${scaleY})`;\n    }\n\n    if (redrawAnnotationLayer && this.annotationLayer) {\n      this.#renderAnnotationLayer();\n    }\n    if (redrawAnnotationEditorLayer && this.annotationEditorLayer) {\n      if (this.drawLayer) {\n        this.#renderDrawLayer();\n      }\n      this.#renderAnnotationEditorLayer();\n    }\n    if (redrawXfaLayer && this.xfaLayer) {\n      this.#renderXfaLayer();\n    }\n\n    if (this.textLayer) {\n      if (hideTextLayer) {\n        this.textLayer.hide();\n        this.structTreeLayer?.hide();\n      } else if (redrawTextLayer) {\n        this.#renderTextLayer();\n      }\n    }\n  }\n\n  get width() {\n    return this.viewport.width;\n  }\n\n  get height() {\n    return this.viewport.height;\n  }\n\n  getPagePoint(x, y) {\n    return this.viewport.convertToPdfPoint(x, y);\n  }\n\n  async #finishRenderTask(renderTask, error = null) {\n    // The renderTask may have been replaced by a new one, so only remove\n    // the reference to the renderTask if it matches the one that is\n    // triggering this callback.\n    if (renderTask === this.renderTask) {\n      this.renderTask = null;\n    }\n\n    if (error instanceof RenderingCancelledException) {\n      this.#renderError = null;\n      return;\n    }\n    this.#renderError = error;\n\n    this.renderingState = RenderingStates.FINISHED;\n    this._resetZoomLayer(/* removeFromDOM = */ true);\n\n    // Ensure that the thumbnails won't become partially (or fully) blank,\n    // for documents that contain interactive form elements.\n    this.#useThumbnailCanvas.regularAnnotations = !renderTask.separateAnnots;\n\n    this.eventBus.dispatch(\"pagerendered\", {\n      source: this,\n      pageNumber: this.id,\n      cssTransform: false,\n      timestamp: performance.now(),\n      error: this.#renderError,\n    });\n\n    if (error) {\n      throw error;\n    }\n  }\n\n  async draw() {\n    if (this.renderingState !== RenderingStates.INITIAL) {\n      console.error(\"Must be in new state before drawing\");\n      this.reset(); // Ensure that we reset all state to prevent issues.\n    }\n    const { div, l10n, pageColors, pdfPage, viewport } = this;\n\n    if (!pdfPage) {\n      this.renderingState = RenderingStates.FINISHED;\n      throw new Error(\"pdfPage is not loaded\");\n    }\n\n    this.renderingState = RenderingStates.RUNNING;\n\n    // Wrap the canvas so that if it has a CSS transform for high DPI the\n    // overflow will be hidden in Firefox.\n    const canvasWrapper = document.createElement(\"div\");\n    canvasWrapper.classList.add(\"canvasWrapper\");\n    this.#addLayer(canvasWrapper, \"canvasWrapper\");\n\n    if (\n      !this.textLayer &&\n      this.#textLayerMode !== TextLayerMode.DISABLE &&\n      !pdfPage.isPureXfa\n    ) {\n      this._accessibilityManager ||= new TextAccessibilityManager();\n\n      this.textLayer = new TextLayerBuilder({\n        pdfPage,\n        highlighter: this._textHighlighter,\n        accessibilityManager: this._accessibilityManager,\n        enablePermissions:\n          this.#textLayerMode === TextLayerMode.ENABLE_PERMISSIONS,\n        onAppend: textLayerDiv => {\n          // Pause translation when inserting the textLayer in the DOM.\n          this.l10n.pause();\n          this.#addLayer(textLayerDiv, \"textLayer\");\n          this.l10n.resume();\n        },\n      });\n    }\n\n    if (\n      !this.annotationLayer &&\n      this.#annotationMode !== AnnotationMode.DISABLE\n    ) {\n      const {\n        annotationStorage,\n        annotationEditorUIManager,\n        downloadManager,\n        enableScripting,\n        fieldObjectsPromise,\n        hasJSActionsPromise,\n        linkService,\n      } = this.#layerProperties;\n\n      this._annotationCanvasMap ||= new Map();\n      this.annotationLayer = new AnnotationLayerBuilder({\n        pdfPage,\n        annotationStorage,\n        imageResourcesPath: this.imageResourcesPath,\n        renderForms: this.#annotationMode === AnnotationMode.ENABLE_FORMS,\n        linkService,\n        downloadManager,\n        enableScripting,\n        hasJSActionsPromise,\n        fieldObjectsPromise,\n        annotationCanvasMap: this._annotationCanvasMap,\n        accessibilityManager: this._accessibilityManager,\n        annotationEditorUIManager,\n        onAppend: annotationLayerDiv => {\n          this.#addLayer(annotationLayerDiv, \"annotationLayer\");\n        },\n      });\n    }\n\n    const renderContinueCallback = cont => {\n      showCanvas?.(false);\n      if (this.renderingQueue && !this.renderingQueue.isHighestPriority(this)) {\n        this.renderingState = RenderingStates.PAUSED;\n        this.resume = () => {\n          this.renderingState = RenderingStates.RUNNING;\n          cont();\n        };\n        return;\n      }\n      cont();\n    };\n\n    const { width, height } = viewport;\n    const canvas = document.createElement(\"canvas\");\n    canvas.setAttribute(\"role\", \"presentation\");\n\n    // Keep the canvas hidden until the first draw callback, or until drawing\n    // is complete when `!this.renderingQueue`, to prevent black flickering.\n    canvas.hidden = true;\n    const hasHCM = !!(pageColors?.background && pageColors?.foreground);\n\n    let showCanvas = isLastShow => {\n      // In HCM, a final filter is applied on the canvas which means that\n      // before it's applied we've normal colors. Consequently, to avoid to have\n      // a final flash we just display it once all the drawing is done.\n      if (!hasHCM || isLastShow) {\n        canvas.hidden = false;\n        showCanvas = null; // Only invoke the function once.\n      }\n    };\n    canvasWrapper.append(canvas);\n    this.canvas = canvas;\n\n    const ctx = canvas.getContext(\"2d\", {\n      alpha: false,\n      willReadFrequently: !this.#enableHWA,\n    });\n    const outputScale = (this.outputScale = new OutputScale());\n\n    if (\n      (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"GENERIC\")) &&\n      this.maxCanvasPixels === 0\n    ) {\n      const invScale = 1 / this.scale;\n      // Use a scale that makes the canvas have the originally intended size\n      // of the page.\n      outputScale.sx *= invScale;\n      outputScale.sy *= invScale;\n      this.#hasRestrictedScaling = true;\n    } else if (this.maxCanvasPixels > 0) {\n      const pixelsInViewport = width * height;\n      const maxScale = Math.sqrt(this.maxCanvasPixels / pixelsInViewport);\n      if (outputScale.sx > maxScale || outputScale.sy > maxScale) {\n        outputScale.sx = maxScale;\n        outputScale.sy = maxScale;\n        this.#hasRestrictedScaling = true;\n      } else {\n        this.#hasRestrictedScaling = false;\n      }\n    }\n    const sfx = approximateFraction(outputScale.sx);\n    const sfy = approximateFraction(outputScale.sy);\n\n    const canvasWidth = (canvas.width = floorToDivide(\n      calcRound(width * outputScale.sx),\n      sfx[0]\n    ));\n    const canvasHeight = (canvas.height = floorToDivide(\n      calcRound(height * outputScale.sy),\n      sfy[0]\n    ));\n    const pageWidth = floorToDivide(calcRound(width), sfx[1]);\n    const pageHeight = floorToDivide(calcRound(height), sfy[1]);\n    outputScale.sx = canvasWidth / pageWidth;\n    outputScale.sy = canvasHeight / pageHeight;\n\n    if (this.#scaleRoundX !== sfx[1]) {\n      div.style.setProperty(\"--scale-round-x\", `${sfx[1]}px`);\n      this.#scaleRoundX = sfx[1];\n    }\n    if (this.#scaleRoundY !== sfy[1]) {\n      div.style.setProperty(\"--scale-round-y\", `${sfy[1]}px`);\n      this.#scaleRoundY = sfy[1];\n    }\n\n    // Add the viewport so it's known what it was originally drawn with.\n    this.#viewportMap.set(canvas, viewport);\n\n    // Rendering area\n    const transform = outputScale.scaled\n      ? [outputScale.sx, 0, 0, outputScale.sy, 0, 0]\n      : null;\n    const renderContext = {\n      canvasContext: ctx,\n      transform,\n      viewport,\n      annotationMode: this.#annotationMode,\n      optionalContentConfigPromise: this._optionalContentConfigPromise,\n      annotationCanvasMap: this._annotationCanvasMap,\n      pageColors,\n      isEditing: this.#isEditing,\n    };\n    const renderTask = (this.renderTask = pdfPage.render(renderContext));\n    renderTask.onContinue = renderContinueCallback;\n\n    const resultPromise = renderTask.promise.then(\n      async () => {\n        showCanvas?.(true);\n        await this.#finishRenderTask(renderTask);\n\n        this.structTreeLayer ||= new StructTreeLayerBuilder(\n          pdfPage,\n          viewport.rawDims\n        );\n\n        this.#renderTextLayer();\n\n        if (this.annotationLayer) {\n          await this.#renderAnnotationLayer();\n        }\n\n        const { annotationEditorUIManager } = this.#layerProperties;\n\n        if (!annotationEditorUIManager) {\n          return;\n        }\n        this.drawLayer ||= new DrawLayerBuilder({\n          pageIndex: this.id,\n        });\n        await this.#renderDrawLayer();\n        this.drawLayer.setParent(canvasWrapper);\n\n        this.annotationEditorLayer ||= new AnnotationEditorLayerBuilder({\n          uiManager: annotationEditorUIManager,\n          pdfPage,\n          l10n,\n          structTreeLayer: this.structTreeLayer,\n          accessibilityManager: this._accessibilityManager,\n          annotationLayer: this.annotationLayer?.annotationLayer,\n          textLayer: this.textLayer,\n          drawLayer: this.drawLayer.getDrawLayer(),\n          onAppend: annotationEditorLayerDiv => {\n            this.#addLayer(annotationEditorLayerDiv, \"annotationEditorLayer\");\n          },\n        });\n        this.#renderAnnotationEditorLayer();\n      },\n      error => {\n        // When zooming with a `drawingDelay` set, avoid temporarily showing\n        // a black canvas if rendering was cancelled before the `onContinue`-\n        // callback had been invoked at least once.\n        if (!(error instanceof RenderingCancelledException)) {\n          showCanvas?.(true);\n        }\n        return this.#finishRenderTask(renderTask, error);\n      }\n    );\n\n    if (pdfPage.isPureXfa) {\n      if (!this.xfaLayer) {\n        const { annotationStorage, linkService } = this.#layerProperties;\n\n        this.xfaLayer = new XfaLayerBuilder({\n          pdfPage,\n          annotationStorage,\n          linkService,\n        });\n      }\n      this.#renderXfaLayer();\n    }\n\n    div.setAttribute(\"data-loaded\", true);\n\n    this.eventBus.dispatch(\"pagerender\", {\n      source: this,\n      pageNumber: this.id,\n    });\n    return resultPromise;\n  }\n\n  /**\n   * @param {string|null} label\n   */\n  setPageLabel(label) {\n    this.pageLabel = typeof label === \"string\" ? label : null;\n\n    this.div.setAttribute(\n      \"data-l10n-args\",\n      JSON.stringify({ page: this.pageLabel ?? this.id })\n    );\n\n    if (this.pageLabel !== null) {\n      this.div.setAttribute(\"data-page-label\", this.pageLabel);\n    } else {\n      this.div.removeAttribute(\"data-page-label\");\n    }\n  }\n\n  /**\n   * For use by the `PDFThumbnailView.setImage`-method.\n   * @ignore\n   */\n  get thumbnailCanvas() {\n    const { directDrawing, initialOptionalContent, regularAnnotations } =\n      this.#useThumbnailCanvas;\n    return directDrawing && initialOptionalContent && regularAnnotations\n      ? this.canvas\n      : null;\n  }\n}\n\nexport { PDFPageView };\n","/* Copyright 2014 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/** @typedef {import(\"../src/display/api\").PDFDocumentProxy} PDFDocumentProxy */\n/** @typedef {import(\"../src/display/api\").PDFPageProxy} PDFPageProxy */\n// eslint-disable-next-line max-len\n/** @typedef {import(\"../src/display/display_utils\").PageViewport} PageViewport */\n// eslint-disable-next-line max-len\n/** @typedef {import(\"../src/display/optional_content_config\").OptionalContentConfig} OptionalContentConfig */\n/** @typedef {import(\"./event_utils\").EventBus} EventBus */\n/** @typedef {import(\"./interfaces\").IDownloadManager} IDownloadManager */\n/** @typedef {import(\"./interfaces\").IL10n} IL10n */\n/** @typedef {import(\"./interfaces\").IPDFLinkService} IPDFLinkService */\n// eslint-disable-next-line max-len\n/** @typedef {import(\"./pdf_find_controller\").PDFFindController} PDFFindController */\n// eslint-disable-next-line max-len\n/** @typedef {import(\"./pdf_scripting_manager\").PDFScriptingManager} PDFScriptingManager */\n\nimport {\n  AnnotationEditorType,\n  AnnotationEditorUIManager,\n  AnnotationMode,\n  PermissionFlag,\n  PixelsPerInch,\n  shadow,\n  version,\n} from \"pdfjs-lib\";\nimport {\n  DEFAULT_SCALE,\n  DEFAULT_SCALE_DELTA,\n  DEFAULT_SCALE_VALUE,\n  docStyle,\n  getVisibleElements,\n  isPortraitOrientation,\n  isValidRotation,\n  isValidScrollMode,\n  isValidSpreadMode,\n  MAX_AUTO_SCALE,\n  MAX_SCALE,\n  MIN_SCALE,\n  PresentationModeState,\n  removeNullCharacters,\n  RenderingStates,\n  SCROLLBAR_PADDING,\n  scrollIntoView,\n  ScrollMode,\n  SpreadMode,\n  TextLayerMode,\n  UNKNOWN_SCALE,\n  VERTICAL_PADDING,\n  watchScroll,\n} from \"./ui_utils.js\";\nimport { GenericL10n } from \"web-null_l10n\";\nimport { PDFPageView } from \"./pdf_page_view.js\";\nimport { PDFRenderingQueue } from \"./pdf_rendering_queue.js\";\nimport { SimpleLinkService } from \"./pdf_link_service.js\";\n\nconst DEFAULT_CACHE_SIZE = 10;\n\nconst PagesCountLimit = {\n  FORCE_SCROLL_MODE_PAGE: 10000,\n  FORCE_LAZY_PAGE_INIT: 5000,\n  PAUSE_EAGER_PAGE_INIT: 250,\n};\n\nfunction isValidAnnotationEditorMode(mode) {\n  return (\n    Object.values(AnnotationEditorType).includes(mode) &&\n    mode !== AnnotationEditorType.DISABLE\n  );\n}\n\n/**\n * @typedef {Object} PDFViewerOptions\n * @property {HTMLDivElement} container - The container for the viewer element.\n * @property {HTMLDivElement} [viewer] - The viewer element.\n * @property {EventBus} eventBus - The application event bus.\n * @property {IPDFLinkService} [linkService] - The navigation/linking service.\n * @property {IDownloadManager} [downloadManager] - The download manager\n *   component.\n * @property {PDFFindController} [findController] - The find controller\n *   component.\n * @property {PDFScriptingManager} [scriptingManager] - The scripting manager\n *   component.\n * @property {PDFRenderingQueue} [renderingQueue] - The rendering queue object.\n * @property {boolean} [removePageBorders] - Removes the border shadow around\n *   the pages. The default value is `false`.\n * @property {number} [textLayerMode] - Controls if the text layer used for\n *   selection and searching is created. The constants from {TextLayerMode}\n *   should be used. The default value is `TextLayerMode.ENABLE`.\n * @property {number} [annotationMode] - Controls if the annotation layer is\n *   created, and if interactive form elements or `AnnotationStorage`-data are\n *   being rendered. The constants from {@link AnnotationMode} should be used;\n *   see also {@link RenderParameters} and {@link GetOperatorListParameters}.\n *   The default value is `AnnotationMode.ENABLE_FORMS`.\n * @property {number} [annotationEditorMode] - Enables the creation and editing\n *   of new Annotations. The constants from {@link AnnotationEditorType} should\n *   be used. The default value is `AnnotationEditorType.NONE`.\n * @property {string} [annotationEditorHighlightColors] - A comma separated list\n *   of colors to propose to highlight some text in the pdf.\n * @property {string} [imageResourcesPath] - Path for image resources, mainly\n *   mainly for annotation icons. Include trailing slash.\n * @property {boolean} [enablePrintAutoRotate] - Enables automatic rotation of\n *   landscape pages upon printing. The default is `false`.\n * @property {number} [maxCanvasPixels] - The maximum supported canvas size in\n *   total pixels, i.e. width * height. Use `-1` for no limit, or `0` for\n *   CSS-only zooming. The default value is 4096 * 8192 (32 mega-pixels).\n * @property {IL10n} [l10n] - Localization service.\n * @property {boolean} [enablePermissions] - Enables PDF document permissions,\n *   when they exist. The default value is `false`.\n * @property {Object} [pageColors] - Overwrites background and foreground colors\n *   with user defined ones in order to improve readability in high contrast\n *   mode.\n * @property {boolean} [enableHWA] - Enables hardware acceleration for\n *   rendering. The default value is `false`.\n */\n\nclass PDFPageViewBuffer {\n  // Here we rely on the fact that `Set`s preserve the insertion order.\n  #buf = new Set();\n\n  #size = 0;\n\n  constructor(size) {\n    this.#size = size;\n  }\n\n  push(view) {\n    const buf = this.#buf;\n    if (buf.has(view)) {\n      buf.delete(view); // Move the view to the \"end\" of the buffer.\n    }\n    buf.add(view);\n\n    if (buf.size > this.#size) {\n      this.#destroyFirstView();\n    }\n  }\n\n  /**\n   * After calling resize, the size of the buffer will be `newSize`.\n   * The optional parameter `idsToKeep` is, if present, a Set of page-ids to\n   * push to the back of the buffer, delaying their destruction. The size of\n   * `idsToKeep` has no impact on the final size of the buffer; if `idsToKeep`\n   * is larger than `newSize`, some of those pages will be destroyed anyway.\n   */\n  resize(newSize, idsToKeep = null) {\n    this.#size = newSize;\n\n    const buf = this.#buf;\n    if (idsToKeep) {\n      const ii = buf.size;\n      let i = 1;\n      for (const view of buf) {\n        if (idsToKeep.has(view.id)) {\n          buf.delete(view); // Move the view to the \"end\" of the buffer.\n          buf.add(view);\n        }\n        if (++i > ii) {\n          break;\n        }\n      }\n    }\n\n    while (buf.size > this.#size) {\n      this.#destroyFirstView();\n    }\n  }\n\n  has(view) {\n    return this.#buf.has(view);\n  }\n\n  [Symbol.iterator]() {\n    return this.#buf.keys();\n  }\n\n  #destroyFirstView() {\n    const firstView = this.#buf.keys().next().value;\n\n    firstView?.destroy();\n    this.#buf.delete(firstView);\n  }\n}\n\n/**\n * Simple viewer control to display PDF content/pages.\n */\nclass PDFViewer {\n  #buffer = null;\n\n  #altTextManager = null;\n\n  #annotationEditorHighlightColors = null;\n\n  #annotationEditorMode = AnnotationEditorType.NONE;\n\n  #annotationEditorUIManager = null;\n\n  #annotationMode = AnnotationMode.ENABLE_FORMS;\n\n  #containerTopLeft = null;\n\n  #enableHWA = false;\n\n  #enableHighlightFloatingButton = false;\n\n  #enablePermissions = false;\n\n  #enableUpdatedAddImage = false;\n\n  #enableNewAltTextWhenAddingImage = false;\n\n  #eventAbortController = null;\n\n  #mlManager = null;\n\n  #switchAnnotationEditorModeAC = null;\n\n  #switchAnnotationEditorModeTimeoutId = null;\n\n  #getAllTextInProgress = false;\n\n  #hiddenCopyElement = null;\n\n  #interruptCopyCondition = false;\n\n  #previousContainerHeight = 0;\n\n  #resizeObserver = new ResizeObserver(this.#resizeObserverCallback.bind(this));\n\n  #scrollModePageState = null;\n\n  #scaleTimeoutId = null;\n\n  #textLayerMode = TextLayerMode.ENABLE;\n\n  /**\n   * @param {PDFViewerOptions} options\n   */\n  constructor(options) {\n    const viewerVersion =\n      typeof PDFJSDev !== \"undefined\" ? PDFJSDev.eval(\"BUNDLE_VERSION\") : null;\n    if (version !== viewerVersion) {\n      throw new Error(\n        `The API version \"${version}\" does not match the Viewer version \"${viewerVersion}\".`\n      );\n    }\n    this.container = options.container;\n    this.viewer = options.viewer || options.container.firstElementChild;\n\n    if (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"GENERIC\")) {\n      if (this.container?.tagName !== \"DIV\" || this.viewer?.tagName !== \"DIV\") {\n        throw new Error(\"Invalid `container` and/or `viewer` option.\");\n      }\n\n      if (\n        this.container.offsetParent &&\n        getComputedStyle(this.container).position !== \"absolute\"\n      ) {\n        throw new Error(\"The `container` must be absolutely positioned.\");\n      }\n    }\n    this.#resizeObserver.observe(this.container);\n\n    this.eventBus = options.eventBus;\n    this.linkService = options.linkService || new SimpleLinkService();\n    this.downloadManager = options.downloadManager || null;\n    this.findController = options.findController || null;\n    this.#altTextManager = options.altTextManager || null;\n\n    if (this.findController) {\n      this.findController.onIsPageVisible = pageNumber =>\n        this._getVisiblePages().ids.has(pageNumber);\n    }\n    this._scriptingManager = options.scriptingManager || null;\n    this.#textLayerMode = options.textLayerMode ?? TextLayerMode.ENABLE;\n    this.#annotationMode =\n      options.annotationMode ?? AnnotationMode.ENABLE_FORMS;\n    this.#annotationEditorMode =\n      options.annotationEditorMode ?? AnnotationEditorType.NONE;\n    this.#annotationEditorHighlightColors =\n      options.annotationEditorHighlightColors || null;\n    this.#enableHighlightFloatingButton =\n      options.enableHighlightFloatingButton === true;\n    this.#enableUpdatedAddImage = options.enableUpdatedAddImage === true;\n    this.#enableNewAltTextWhenAddingImage =\n      options.enableNewAltTextWhenAddingImage === true;\n    this.imageResourcesPath = options.imageResourcesPath || \"\";\n    this.enablePrintAutoRotate = options.enablePrintAutoRotate || false;\n    if (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"GENERIC\")) {\n      this.removePageBorders = options.removePageBorders || false;\n    }\n    this.maxCanvasPixels = options.maxCanvasPixels;\n    this.l10n = options.l10n;\n    if (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"GENERIC\")) {\n      this.l10n ||= new GenericL10n();\n    }\n    this.#enablePermissions = options.enablePermissions || false;\n    this.pageColors = options.pageColors || null;\n    this.#mlManager = options.mlManager || null;\n    this.#enableHWA = options.enableHWA || false;\n\n    this.defaultRenderingQueue = !options.renderingQueue;\n    if (\n      (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"GENERIC\")) &&\n      this.defaultRenderingQueue\n    ) {\n      // Custom rendering queue is not specified, using default one\n      this.renderingQueue = new PDFRenderingQueue();\n      this.renderingQueue.setViewer(this);\n    } else {\n      this.renderingQueue = options.renderingQueue;\n    }\n\n    const { abortSignal } = options;\n    abortSignal?.addEventListener(\n      \"abort\",\n      () => {\n        this.#resizeObserver.disconnect();\n        this.#resizeObserver = null;\n      },\n      { once: true }\n    );\n\n    this.scroll = watchScroll(\n      this.container,\n      this._scrollUpdate.bind(this),\n      abortSignal\n    );\n    this.presentationModeState = PresentationModeState.UNKNOWN;\n    this._resetView();\n\n    if (\n      (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"GENERIC\")) &&\n      this.removePageBorders\n    ) {\n      this.viewer.classList.add(\"removePageBorders\");\n    }\n\n    this.#updateContainerHeightCss();\n\n    // Trigger API-cleanup, once thumbnail rendering has finished,\n    // if the relevant pageView is *not* cached in the buffer.\n    this.eventBus._on(\"thumbnailrendered\", ({ pageNumber, pdfPage }) => {\n      const pageView = this._pages[pageNumber - 1];\n      if (!this.#buffer.has(pageView)) {\n        pdfPage?.cleanup();\n      }\n    });\n\n    if (\n      (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"GENERIC\")) &&\n      !options.l10n\n    ) {\n      // Ensure that Fluent is connected in e.g. the COMPONENTS build.\n      this.l10n.translate(this.container);\n    }\n  }\n\n  get pagesCount() {\n    return this._pages.length;\n  }\n\n  getPageView(index) {\n    return this._pages[index];\n  }\n\n  getCachedPageViews() {\n    return new Set(this.#buffer);\n  }\n\n  /**\n   * @type {boolean} - True if all {PDFPageView} objects are initialized.\n   */\n  get pageViewsReady() {\n    // Prevent printing errors when 'disableAutoFetch' is set, by ensuring\n    // that *all* pages have in fact been completely loaded.\n    return this._pages.every(pageView => pageView?.pdfPage);\n  }\n\n  /**\n   * @type {boolean}\n   */\n  get renderForms() {\n    return this.#annotationMode === AnnotationMode.ENABLE_FORMS;\n  }\n\n  /**\n   * @type {boolean}\n   */\n  get enableScripting() {\n    return !!this._scriptingManager;\n  }\n\n  /**\n   * @type {number}\n   */\n  get currentPageNumber() {\n    return this._currentPageNumber;\n  }\n\n  /**\n   * @param {number} val - The page number.\n   */\n  set currentPageNumber(val) {\n    if (!Number.isInteger(val)) {\n      throw new Error(\"Invalid page number.\");\n    }\n    if (!this.pdfDocument) {\n      return;\n    }\n    // The intent can be to just reset a scroll position and/or scale.\n    if (!this._setCurrentPageNumber(val, /* resetCurrentPageView = */ true)) {\n      console.error(`currentPageNumber: \"${val}\" is not a valid page.`);\n    }\n  }\n\n  /**\n   * @returns {boolean} Whether the pageNumber is valid (within bounds).\n   * @private\n   */\n  _setCurrentPageNumber(val, resetCurrentPageView = false) {\n    if (this._currentPageNumber === val) {\n      if (resetCurrentPageView) {\n        this.#resetCurrentPageView();\n      }\n      return true;\n    }\n\n    if (!(0 < val && val <= this.pagesCount)) {\n      return false;\n    }\n    const previous = this._currentPageNumber;\n    this._currentPageNumber = val;\n\n    this.eventBus.dispatch(\"pagechanging\", {\n      source: this,\n      pageNumber: val,\n      pageLabel: this._pageLabels?.[val - 1] ?? null,\n      previous,\n    });\n\n    if (resetCurrentPageView) {\n      this.#resetCurrentPageView();\n    }\n    return true;\n  }\n\n  /**\n   * @type {string|null} Returns the current page label, or `null` if no page\n   *   labels exist.\n   */\n  get currentPageLabel() {\n    return this._pageLabels?.[this._currentPageNumber - 1] ?? null;\n  }\n\n  /**\n   * @param {string} val - The page label.\n   */\n  set currentPageLabel(val) {\n    if (!this.pdfDocument) {\n      return;\n    }\n    let page = val | 0; // Fallback page number.\n    if (this._pageLabels) {\n      const i = this._pageLabels.indexOf(val);\n      if (i >= 0) {\n        page = i + 1;\n      }\n    }\n    // The intent can be to just reset a scroll position and/or scale.\n    if (!this._setCurrentPageNumber(page, /* resetCurrentPageView = */ true)) {\n      console.error(`currentPageLabel: \"${val}\" is not a valid page.`);\n    }\n  }\n\n  /**\n   * @type {number}\n   */\n  get currentScale() {\n    return this._currentScale !== UNKNOWN_SCALE\n      ? this._currentScale\n      : DEFAULT_SCALE;\n  }\n\n  /**\n   * @param {number} val - Scale of the pages in percents.\n   */\n  set currentScale(val) {\n    if (isNaN(val)) {\n      throw new Error(\"Invalid numeric scale.\");\n    }\n    if (!this.pdfDocument) {\n      return;\n    }\n    this.#setScale(val, { noScroll: false });\n  }\n\n  /**\n   * @type {string}\n   */\n  get currentScaleValue() {\n    return this._currentScaleValue;\n  }\n\n  /**\n   * @param val - The scale of the pages (in percent or predefined value).\n   */\n  set currentScaleValue(val) {\n    if (!this.pdfDocument) {\n      return;\n    }\n    this.#setScale(val, { noScroll: false });\n  }\n\n  /**\n   * @type {number}\n   */\n  get pagesRotation() {\n    return this._pagesRotation;\n  }\n\n  /**\n   * @param {number} rotation - The rotation of the pages (0, 90, 180, 270).\n   */\n  set pagesRotation(rotation) {\n    if (!isValidRotation(rotation)) {\n      throw new Error(\"Invalid pages rotation angle.\");\n    }\n    if (!this.pdfDocument) {\n      return;\n    }\n    // Normalize the rotation, by clamping it to the [0, 360) range.\n    rotation %= 360;\n    if (rotation < 0) {\n      rotation += 360;\n    }\n    if (this._pagesRotation === rotation) {\n      return; // The rotation didn't change.\n    }\n    this._pagesRotation = rotation;\n\n    const pageNumber = this._currentPageNumber;\n\n    this.refresh(true, { rotation });\n\n    // Prevent errors in case the rotation changes *before* the scale has been\n    // set to a non-default value.\n    if (this._currentScaleValue) {\n      this.#setScale(this._currentScaleValue, { noScroll: true });\n    }\n\n    this.eventBus.dispatch(\"rotationchanging\", {\n      source: this,\n      pagesRotation: rotation,\n      pageNumber,\n    });\n\n    if (this.defaultRenderingQueue) {\n      this.update();\n    }\n  }\n\n  get firstPagePromise() {\n    return this.pdfDocument ? this._firstPageCapability.promise : null;\n  }\n\n  get onePageRendered() {\n    return this.pdfDocument ? this._onePageRenderedCapability.promise : null;\n  }\n\n  get pagesPromise() {\n    return this.pdfDocument ? this._pagesCapability.promise : null;\n  }\n\n  get _layerProperties() {\n    const self = this;\n    return shadow(this, \"_layerProperties\", {\n      get annotationEditorUIManager() {\n        return self.#annotationEditorUIManager;\n      },\n      get annotationStorage() {\n        return self.pdfDocument?.annotationStorage;\n      },\n      get downloadManager() {\n        return self.downloadManager;\n      },\n      get enableScripting() {\n        return !!self._scriptingManager;\n      },\n      get fieldObjectsPromise() {\n        return self.pdfDocument?.getFieldObjects();\n      },\n      get findController() {\n        return self.findController;\n      },\n      get hasJSActionsPromise() {\n        return self.pdfDocument?.hasJSActions();\n      },\n      get linkService() {\n        return self.linkService;\n      },\n    });\n  }\n\n  /**\n   * Currently only *some* permissions are supported.\n   * @returns {Object}\n   */\n  #initializePermissions(permissions) {\n    const params = {\n      annotationEditorMode: this.#annotationEditorMode,\n      annotationMode: this.#annotationMode,\n      textLayerMode: this.#textLayerMode,\n    };\n    if (!permissions) {\n      return params;\n    }\n\n    if (\n      !permissions.includes(PermissionFlag.COPY) &&\n      this.#textLayerMode === TextLayerMode.ENABLE\n    ) {\n      params.textLayerMode = TextLayerMode.ENABLE_PERMISSIONS;\n    }\n\n    if (!permissions.includes(PermissionFlag.MODIFY_CONTENTS)) {\n      params.annotationEditorMode = AnnotationEditorType.DISABLE;\n    }\n\n    if (\n      !permissions.includes(PermissionFlag.MODIFY_ANNOTATIONS) &&\n      !permissions.includes(PermissionFlag.FILL_INTERACTIVE_FORMS) &&\n      this.#annotationMode === AnnotationMode.ENABLE_FORMS\n    ) {\n      params.annotationMode = AnnotationMode.ENABLE;\n    }\n\n    return params;\n  }\n\n  async #onePageRenderedOrForceFetch(signal) {\n    // Unless the viewer *and* its pages are visible, rendering won't start and\n    // `this._onePageRenderedCapability` thus won't be resolved.\n    // To ensure that automatic printing, on document load, still works even in\n    // those cases we force-allow fetching of all pages when:\n    //  - The current window/tab is inactive, which will prevent rendering since\n    //    `requestAnimationFrame` is being used; fixes bug 1746213.\n    //  - The viewer is hidden in the DOM, e.g. in a `display: none` <iframe>\n    //    element; fixes bug 1618621.\n    //  - The viewer is visible, but none of the pages are (e.g. if the\n    //    viewer is very small); fixes bug 1618955.\n    if (\n      document.visibilityState === \"hidden\" ||\n      !this.container.offsetParent ||\n      this._getVisiblePages().views.length === 0\n    ) {\n      return;\n    }\n\n    // Handle the window/tab becoming inactive *after* rendering has started;\n    // fixes (another part of) bug 1746213.\n    const hiddenCapability = Promise.withResolvers(),\n      ac = new AbortController();\n    document.addEventListener(\n      \"visibilitychange\",\n      () => {\n        if (document.visibilityState === \"hidden\") {\n          hiddenCapability.resolve();\n        }\n      },\n      {\n        signal:\n          (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")) ||\n          typeof AbortSignal.any === \"function\"\n            ? AbortSignal.any([signal, ac.signal])\n            : signal,\n      }\n    );\n\n    await Promise.race([\n      this._onePageRenderedCapability.promise,\n      hiddenCapability.promise,\n    ]);\n    ac.abort(); // Remove the \"visibilitychange\" listener immediately.\n  }\n\n  async getAllText() {\n    const texts = [];\n    const buffer = [];\n    for (\n      let pageNum = 1, pagesCount = this.pdfDocument.numPages;\n      pageNum <= pagesCount;\n      ++pageNum\n    ) {\n      if (this.#interruptCopyCondition) {\n        return null;\n      }\n      buffer.length = 0;\n      const page = await this.pdfDocument.getPage(pageNum);\n      // By default getTextContent pass disableNormalization equals to false\n      // which is fine because we want a normalized string.\n      const { items } = await page.getTextContent();\n      for (const item of items) {\n        if (item.str) {\n          buffer.push(item.str);\n        }\n        if (item.hasEOL) {\n          buffer.push(\"\\n\");\n        }\n      }\n      texts.push(removeNullCharacters(buffer.join(\"\")));\n    }\n\n    return texts.join(\"\\n\");\n  }\n\n  #copyCallback(textLayerMode, event) {\n    const selection = document.getSelection();\n    const { focusNode, anchorNode } = selection;\n    if (\n      anchorNode &&\n      focusNode &&\n      selection.containsNode(this.#hiddenCopyElement)\n    ) {\n      // About the condition above:\n      //  - having non-null anchorNode and focusNode are here to guaranty that\n      //    we have at least a kind of selection.\n      //  - this.#hiddenCopyElement is an invisible element which is impossible\n      //    to select manually (its display is none) but ctrl+A will select all\n      //    including this element so having it in the selection means that all\n      //    has been selected.\n\n      if (\n        this.#getAllTextInProgress ||\n        textLayerMode === TextLayerMode.ENABLE_PERMISSIONS\n      ) {\n        event.preventDefault();\n        event.stopPropagation();\n        return;\n      }\n      this.#getAllTextInProgress = true;\n\n      // TODO: if all the pages are rendered we don't need to wait for\n      // getAllText and we could just get text from the Selection object.\n\n      // Select all the document.\n      const { classList } = this.viewer;\n      classList.add(\"copyAll\");\n\n      const ac = new AbortController();\n      window.addEventListener(\n        \"keydown\",\n        ev => (this.#interruptCopyCondition = ev.key === \"Escape\"),\n        { signal: ac.signal }\n      );\n\n      this.getAllText()\n        .then(async text => {\n          if (text !== null) {\n            await navigator.clipboard.writeText(text);\n          }\n        })\n        .catch(reason => {\n          console.warn(\n            `Something goes wrong when extracting the text: ${reason.message}`\n          );\n        })\n        .finally(() => {\n          this.#getAllTextInProgress = false;\n          this.#interruptCopyCondition = false;\n          ac.abort();\n          classList.remove(\"copyAll\");\n        });\n\n      event.preventDefault();\n      event.stopPropagation();\n    }\n  }\n\n  /**\n   * @param {PDFDocumentProxy} pdfDocument\n   */\n  setDocument(pdfDocument) {\n    if (this.pdfDocument) {\n      this.eventBus.dispatch(\"pagesdestroy\", { source: this });\n\n      this._cancelRendering();\n      this._resetView();\n\n      this.findController?.setDocument(null);\n      this._scriptingManager?.setDocument(null);\n\n      this.#annotationEditorUIManager?.destroy();\n      this.#annotationEditorUIManager = null;\n    }\n\n    this.pdfDocument = pdfDocument;\n    if (!pdfDocument) {\n      return;\n    }\n    const pagesCount = pdfDocument.numPages;\n    const firstPagePromise = pdfDocument.getPage(1);\n    // Rendering (potentially) depends on this, hence fetching it immediately.\n    const optionalContentConfigPromise = pdfDocument.getOptionalContentConfig({\n      intent: \"display\",\n    });\n    const permissionsPromise = this.#enablePermissions\n      ? pdfDocument.getPermissions()\n      : Promise.resolve();\n\n    const { eventBus, pageColors, viewer } = this;\n\n    this.#eventAbortController = new AbortController();\n    const { signal } = this.#eventAbortController;\n\n    // Given that browsers don't handle huge amounts of DOM-elements very well,\n    // enforce usage of PAGE-scrolling when loading *very* long/large documents.\n    if (pagesCount > PagesCountLimit.FORCE_SCROLL_MODE_PAGE) {\n      console.warn(\n        \"Forcing PAGE-scrolling for performance reasons, given the length of the document.\"\n      );\n      const mode = (this._scrollMode = ScrollMode.PAGE);\n      eventBus.dispatch(\"scrollmodechanged\", { source: this, mode });\n    }\n\n    this._pagesCapability.promise.then(\n      () => {\n        eventBus.dispatch(\"pagesloaded\", { source: this, pagesCount });\n      },\n      () => {\n        /* Prevent \"Uncaught (in promise)\"-messages in the console. */\n      }\n    );\n\n    const onBeforeDraw = evt => {\n      const pageView = this._pages[evt.pageNumber - 1];\n      if (!pageView) {\n        return;\n      }\n      // Add the page to the buffer at the start of drawing. That way it can be\n      // evicted from the buffer and destroyed even if we pause its rendering.\n      this.#buffer.push(pageView);\n    };\n    eventBus._on(\"pagerender\", onBeforeDraw, { signal });\n\n    const onAfterDraw = evt => {\n      if (evt.cssTransform) {\n        return;\n      }\n      this._onePageRenderedCapability.resolve({ timestamp: evt.timestamp });\n\n      eventBus._off(\"pagerendered\", onAfterDraw); // Remove immediately.\n    };\n    eventBus._on(\"pagerendered\", onAfterDraw, { signal });\n\n    // Fetch a single page so we can get a viewport that will be the default\n    // viewport for all pages\n    Promise.all([firstPagePromise, permissionsPromise])\n      .then(([firstPdfPage, permissions]) => {\n        if (pdfDocument !== this.pdfDocument) {\n          return; // The document was closed while the first page resolved.\n        }\n        this._firstPageCapability.resolve(firstPdfPage);\n        this._optionalContentConfigPromise = optionalContentConfigPromise;\n\n        const { annotationEditorMode, annotationMode, textLayerMode } =\n          this.#initializePermissions(permissions);\n\n        if (textLayerMode !== TextLayerMode.DISABLE) {\n          const element = (this.#hiddenCopyElement =\n            document.createElement(\"div\"));\n          element.id = \"hiddenCopyElement\";\n          viewer.before(element);\n        }\n\n        if (\n          ((typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")) ||\n            typeof AbortSignal.any === \"function\") &&\n          annotationEditorMode !== AnnotationEditorType.DISABLE\n        ) {\n          const mode = annotationEditorMode;\n\n          if (pdfDocument.isPureXfa) {\n            console.warn(\"Warning: XFA-editing is not implemented.\");\n          } else if (isValidAnnotationEditorMode(mode)) {\n            this.#annotationEditorUIManager = new AnnotationEditorUIManager(\n              this.container,\n              viewer,\n              this.#altTextManager,\n              eventBus,\n              pdfDocument,\n              pageColors,\n              this.#annotationEditorHighlightColors,\n              this.#enableHighlightFloatingButton,\n              this.#enableUpdatedAddImage,\n              this.#enableNewAltTextWhenAddingImage,\n              this.#mlManager\n            );\n            eventBus.dispatch(\"annotationeditoruimanager\", {\n              source: this,\n              uiManager: this.#annotationEditorUIManager,\n            });\n            if (mode !== AnnotationEditorType.NONE) {\n              if (mode === AnnotationEditorType.STAMP) {\n                this.#mlManager?.loadModel(\"altText\");\n              }\n              this.#annotationEditorUIManager.updateMode(mode);\n            }\n          } else {\n            console.error(`Invalid AnnotationEditor mode: ${mode}`);\n          }\n        }\n\n        const viewerElement =\n          this._scrollMode === ScrollMode.PAGE ? null : viewer;\n        const scale = this.currentScale;\n        const viewport = firstPdfPage.getViewport({\n          scale: scale * PixelsPerInch.PDF_TO_CSS_UNITS,\n        });\n        // Ensure that the various layers always get the correct initial size,\n        // see issue 15795.\n        viewer.style.setProperty(\"--scale-factor\", viewport.scale);\n\n        if (pageColors?.background) {\n          viewer.style.setProperty(\"--page-bg-color\", pageColors.background);\n        }\n        if (\n          pageColors?.foreground === \"CanvasText\" ||\n          pageColors?.background === \"Canvas\"\n        ) {\n          viewer.style.setProperty(\n            \"--hcm-highlight-filter\",\n            pdfDocument.filterFactory.addHighlightHCMFilter(\n              \"highlight\",\n              \"CanvasText\",\n              \"Canvas\",\n              \"HighlightText\",\n              \"Highlight\"\n            )\n          );\n          viewer.style.setProperty(\n            \"--hcm-highlight-selected-filter\",\n            pdfDocument.filterFactory.addHighlightHCMFilter(\n              \"highlight_selected\",\n              \"CanvasText\",\n              \"Canvas\",\n              \"HighlightText\",\n              \"ButtonText\"\n            )\n          );\n        }\n\n        for (let pageNum = 1; pageNum <= pagesCount; ++pageNum) {\n          const pageView = new PDFPageView({\n            container: viewerElement,\n            eventBus,\n            id: pageNum,\n            scale,\n            defaultViewport: viewport.clone(),\n            optionalContentConfigPromise,\n            renderingQueue: this.renderingQueue,\n            textLayerMode,\n            annotationMode,\n            imageResourcesPath: this.imageResourcesPath,\n            maxCanvasPixels: this.maxCanvasPixels,\n            pageColors,\n            l10n: this.l10n,\n            layerProperties: this._layerProperties,\n            enableHWA: this.#enableHWA,\n          });\n          this._pages.push(pageView);\n        }\n        // Set the first `pdfPage` immediately, since it's already loaded,\n        // rather than having to repeat the `PDFDocumentProxy.getPage` call in\n        // the `this.#ensurePdfPageLoaded` method before rendering can start.\n        this._pages[0]?.setPdfPage(firstPdfPage);\n\n        if (this._scrollMode === ScrollMode.PAGE) {\n          // Ensure that the current page becomes visible on document load.\n          this.#ensurePageViewVisible();\n        } else if (this._spreadMode !== SpreadMode.NONE) {\n          this._updateSpreadMode();\n        }\n\n        // Fetch all the pages since the viewport is needed before printing\n        // starts to create the correct size canvas. Wait until one page is\n        // rendered so we don't tie up too many resources early on.\n        this.#onePageRenderedOrForceFetch(signal).then(async () => {\n          if (pdfDocument !== this.pdfDocument) {\n            return; // The document was closed while the first page rendered.\n          }\n          this.findController?.setDocument(pdfDocument); // Enable searching.\n          this._scriptingManager?.setDocument(pdfDocument); // Enable scripting.\n\n          if (this.#hiddenCopyElement) {\n            document.addEventListener(\n              \"copy\",\n              this.#copyCallback.bind(this, textLayerMode),\n              { signal }\n            );\n          }\n\n          if (this.#annotationEditorUIManager) {\n            // Ensure that the Editor buttons, in the toolbar, are updated.\n            eventBus.dispatch(\"annotationeditormodechanged\", {\n              source: this,\n              mode: this.#annotationEditorMode,\n            });\n          }\n\n          // In addition to 'disableAutoFetch' being set, also attempt to reduce\n          // resource usage when loading *very* long/large documents.\n          if (\n            pdfDocument.loadingParams.disableAutoFetch ||\n            pagesCount > PagesCountLimit.FORCE_LAZY_PAGE_INIT\n          ) {\n            // XXX: Printing is semi-broken with auto fetch disabled.\n            this._pagesCapability.resolve();\n            return;\n          }\n          let getPagesLeft = pagesCount - 1; // The first page was already loaded.\n\n          if (getPagesLeft <= 0) {\n            this._pagesCapability.resolve();\n            return;\n          }\n          for (let pageNum = 2; pageNum <= pagesCount; ++pageNum) {\n            const promise = pdfDocument.getPage(pageNum).then(\n              pdfPage => {\n                const pageView = this._pages[pageNum - 1];\n                if (!pageView.pdfPage) {\n                  pageView.setPdfPage(pdfPage);\n                }\n                if (--getPagesLeft === 0) {\n                  this._pagesCapability.resolve();\n                }\n              },\n              reason => {\n                console.error(\n                  `Unable to get page ${pageNum} to initialize viewer`,\n                  reason\n                );\n                if (--getPagesLeft === 0) {\n                  this._pagesCapability.resolve();\n                }\n              }\n            );\n\n            if (pageNum % PagesCountLimit.PAUSE_EAGER_PAGE_INIT === 0) {\n              await promise;\n            }\n          }\n        });\n\n        eventBus.dispatch(\"pagesinit\", { source: this });\n\n        pdfDocument.getMetadata().then(({ info }) => {\n          if (pdfDocument !== this.pdfDocument) {\n            return; // The document was closed while the metadata resolved.\n          }\n          if (info.Language) {\n            viewer.lang = info.Language;\n          }\n        });\n\n        if (this.defaultRenderingQueue) {\n          this.update();\n        }\n      })\n      .catch(reason => {\n        console.error(\"Unable to initialize viewer\", reason);\n\n        this._pagesCapability.reject(reason);\n      });\n  }\n\n  /**\n   * @param {Array|null} labels\n   */\n  setPageLabels(labels) {\n    if (!this.pdfDocument) {\n      return;\n    }\n    if (!labels) {\n      this._pageLabels = null;\n    } else if (\n      !(Array.isArray(labels) && this.pdfDocument.numPages === labels.length)\n    ) {\n      this._pageLabels = null;\n      console.error(`setPageLabels: Invalid page labels.`);\n    } else {\n      this._pageLabels = labels;\n    }\n    // Update all the `PDFPageView` instances.\n    for (let i = 0, ii = this._pages.length; i < ii; i++) {\n      this._pages[i].setPageLabel(this._pageLabels?.[i] ?? null);\n    }\n  }\n\n  _resetView() {\n    this._pages = [];\n    this._currentPageNumber = 1;\n    this._currentScale = UNKNOWN_SCALE;\n    this._currentScaleValue = null;\n    this._pageLabels = null;\n    this.#buffer = new PDFPageViewBuffer(DEFAULT_CACHE_SIZE);\n    this._location = null;\n    this._pagesRotation = 0;\n    this._optionalContentConfigPromise = null;\n    this._firstPageCapability = Promise.withResolvers();\n    this._onePageRenderedCapability = Promise.withResolvers();\n    this._pagesCapability = Promise.withResolvers();\n    this._scrollMode = ScrollMode.VERTICAL;\n    this._previousScrollMode = ScrollMode.UNKNOWN;\n    this._spreadMode = SpreadMode.NONE;\n\n    this.#scrollModePageState = {\n      previousPageNumber: 1,\n      scrollDown: true,\n      pages: [],\n    };\n\n    this.#eventAbortController?.abort();\n    this.#eventAbortController = null;\n\n    // Remove the pages from the DOM...\n    this.viewer.textContent = \"\";\n    // ... and reset the Scroll mode CSS class(es) afterwards.\n    this._updateScrollMode();\n\n    this.viewer.removeAttribute(\"lang\");\n\n    this.#hiddenCopyElement?.remove();\n    this.#hiddenCopyElement = null;\n\n    this.#cleanupSwitchAnnotationEditorMode();\n  }\n\n  #ensurePageViewVisible() {\n    if (this._scrollMode !== ScrollMode.PAGE) {\n      throw new Error(\"#ensurePageViewVisible: Invalid scrollMode value.\");\n    }\n    const pageNumber = this._currentPageNumber,\n      state = this.#scrollModePageState,\n      viewer = this.viewer;\n\n    // Temporarily remove all the pages from the DOM...\n    viewer.textContent = \"\";\n    // ... and clear out the active ones.\n    state.pages.length = 0;\n\n    if (this._spreadMode === SpreadMode.NONE && !this.isInPresentationMode) {\n      // Finally, append the new page to the viewer.\n      const pageView = this._pages[pageNumber - 1];\n      viewer.append(pageView.div);\n\n      state.pages.push(pageView);\n    } else {\n      const pageIndexSet = new Set(),\n        parity = this._spreadMode - 1;\n\n      // Determine the pageIndices in the new spread.\n      if (parity === -1) {\n        // PresentationMode is active, with `SpreadMode.NONE` set.\n        pageIndexSet.add(pageNumber - 1);\n      } else if (pageNumber % 2 !== parity) {\n        // Left-hand side page.\n        pageIndexSet.add(pageNumber - 1);\n        pageIndexSet.add(pageNumber);\n      } else {\n        // Right-hand side page.\n        pageIndexSet.add(pageNumber - 2);\n        pageIndexSet.add(pageNumber - 1);\n      }\n\n      // Finally, append the new pages to the viewer and apply the spreadMode.\n      const spread = document.createElement(\"div\");\n      spread.className = \"spread\";\n\n      if (this.isInPresentationMode) {\n        const dummyPage = document.createElement(\"div\");\n        dummyPage.className = \"dummyPage\";\n        spread.append(dummyPage);\n      }\n\n      for (const i of pageIndexSet) {\n        const pageView = this._pages[i];\n        if (!pageView) {\n          continue;\n        }\n        spread.append(pageView.div);\n\n        state.pages.push(pageView);\n      }\n      viewer.append(spread);\n    }\n\n    state.scrollDown = pageNumber >= state.previousPageNumber;\n    state.previousPageNumber = pageNumber;\n  }\n\n  _scrollUpdate() {\n    if (this.pagesCount === 0) {\n      return;\n    }\n    this.update();\n  }\n\n  #scrollIntoView(pageView, pageSpot = null) {\n    const { div, id } = pageView;\n\n    // Ensure that `this._currentPageNumber` is correct, when `#scrollIntoView`\n    // is called directly (and not from `#resetCurrentPageView`).\n    if (this._currentPageNumber !== id) {\n      this._setCurrentPageNumber(id);\n    }\n    if (this._scrollMode === ScrollMode.PAGE) {\n      this.#ensurePageViewVisible();\n      // Ensure that rendering always occurs, to avoid showing a blank page,\n      // even if the current position doesn't change when the page is scrolled.\n      this.update();\n    }\n\n    if (!pageSpot && !this.isInPresentationMode) {\n      const left = div.offsetLeft + div.clientLeft,\n        right = left + div.clientWidth;\n      const { scrollLeft, clientWidth } = this.container;\n      if (\n        this._scrollMode === ScrollMode.HORIZONTAL ||\n        left < scrollLeft ||\n        right > scrollLeft + clientWidth\n      ) {\n        pageSpot = { left: 0, top: 0 };\n      }\n    }\n    scrollIntoView(div, pageSpot);\n\n    // Ensure that the correct *initial* document position is set, when any\n    // OpenParameters are used, for documents with non-default Scroll/Spread\n    // modes (fixes issue 15695). This is necessary since the scroll-handler\n    // invokes the `update`-method asynchronously, and `this._location` could\n    // thus be wrong when the initial zooming occurs in the default viewer.\n    if (!this._currentScaleValue && this._location) {\n      this._location = null;\n    }\n  }\n\n  /**\n   * Prevent unnecessary re-rendering of all pages when the scale changes\n   * only because of limited numerical precision.\n   */\n  #isSameScale(newScale) {\n    return (\n      newScale === this._currentScale ||\n      Math.abs(newScale - this._currentScale) < 1e-15\n    );\n  }\n\n  #setScaleUpdatePages(\n    newScale,\n    newValue,\n    { noScroll = false, preset = false, drawingDelay = -1, origin = null }\n  ) {\n    this._currentScaleValue = newValue.toString();\n\n    if (this.#isSameScale(newScale)) {\n      if (preset) {\n        this.eventBus.dispatch(\"scalechanging\", {\n          source: this,\n          scale: newScale,\n          presetValue: newValue,\n        });\n      }\n      return;\n    }\n\n    this.viewer.style.setProperty(\n      \"--scale-factor\",\n      newScale * PixelsPerInch.PDF_TO_CSS_UNITS\n    );\n\n    const postponeDrawing = drawingDelay >= 0 && drawingDelay < 1000;\n    this.refresh(true, {\n      scale: newScale,\n      drawingDelay: postponeDrawing ? drawingDelay : -1,\n    });\n\n    if (postponeDrawing) {\n      this.#scaleTimeoutId = setTimeout(() => {\n        this.#scaleTimeoutId = null;\n        this.refresh();\n      }, drawingDelay);\n    }\n\n    const previousScale = this._currentScale;\n    this._currentScale = newScale;\n\n    if (!noScroll) {\n      let page = this._currentPageNumber,\n        dest;\n      if (\n        this._location &&\n        !(this.isInPresentationMode || this.isChangingPresentationMode)\n      ) {\n        page = this._location.pageNumber;\n        dest = [\n          null,\n          { name: \"XYZ\" },\n          this._location.left,\n          this._location.top,\n          null,\n        ];\n      }\n      this.scrollPageIntoView({\n        pageNumber: page,\n        destArray: dest,\n        allowNegativeOffset: true,\n      });\n      if (Array.isArray(origin)) {\n        // If the origin of the scaling transform is specified, preserve its\n        // location on screen. If not specified, scaling will fix the top-left\n        // corner of the visible PDF area.\n        const scaleDiff = newScale / previousScale - 1;\n        const [top, left] = this.containerTopLeft;\n        this.container.scrollLeft += (origin[0] - left) * scaleDiff;\n        this.container.scrollTop += (origin[1] - top) * scaleDiff;\n      }\n    }\n\n    this.eventBus.dispatch(\"scalechanging\", {\n      source: this,\n      scale: newScale,\n      presetValue: preset ? newValue : undefined,\n    });\n\n    if (this.defaultRenderingQueue) {\n      this.update();\n    }\n  }\n\n  get #pageWidthScaleFactor() {\n    if (\n      this._spreadMode !== SpreadMode.NONE &&\n      this._scrollMode !== ScrollMode.HORIZONTAL\n    ) {\n      return 2;\n    }\n    return 1;\n  }\n\n  #setScale(value, options) {\n    let scale = parseFloat(value);\n\n    if (scale > 0) {\n      options.preset = false;\n      this.#setScaleUpdatePages(scale, value, options);\n    } else {\n      const currentPage = this._pages[this._currentPageNumber - 1];\n      if (!currentPage) {\n        return;\n      }\n      let hPadding = SCROLLBAR_PADDING,\n        vPadding = VERTICAL_PADDING;\n\n      if (this.isInPresentationMode) {\n        // Pages have a 2px (transparent) border in PresentationMode, see\n        // the `web/pdf_viewer.css` file.\n        hPadding = vPadding = 4; // 2 * 2px\n        if (this._spreadMode !== SpreadMode.NONE) {\n          // Account for two pages being visible in PresentationMode, thus\n          // \"doubling\" the total border width.\n          hPadding *= 2;\n        }\n      } else if (\n        (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"GENERIC\")) &&\n        this.removePageBorders\n      ) {\n        hPadding = vPadding = 0;\n      } else if (this._scrollMode === ScrollMode.HORIZONTAL) {\n        [hPadding, vPadding] = [vPadding, hPadding]; // Swap the padding values.\n      }\n      const pageWidthScale =\n        (((this.container.clientWidth - hPadding) / currentPage.width) *\n          currentPage.scale) /\n        this.#pageWidthScaleFactor;\n      const pageHeightScale =\n        ((this.container.clientHeight - vPadding) / currentPage.height) *\n        currentPage.scale;\n      switch (value) {\n        case \"page-actual\":\n          scale = 1;\n          break;\n        case \"page-width\":\n          scale = pageWidthScale;\n          break;\n        case \"page-height\":\n          scale = pageHeightScale;\n          break;\n        case \"page-fit\":\n          scale = Math.min(pageWidthScale, pageHeightScale);\n          break;\n        case \"auto\":\n          // For pages in landscape mode, fit the page height to the viewer\n          // *unless* the page would thus become too wide to fit horizontally.\n          const horizontalScale = isPortraitOrientation(currentPage)\n            ? pageWidthScale\n            : Math.min(pageHeightScale, pageWidthScale);\n          scale = Math.min(MAX_AUTO_SCALE, horizontalScale);\n          break;\n        default:\n          console.error(`#setScale: \"${value}\" is an unknown zoom value.`);\n          return;\n      }\n      options.preset = true;\n      this.#setScaleUpdatePages(scale, value, options);\n    }\n  }\n\n  /**\n   * Refreshes page view: scrolls to the current page and updates the scale.\n   */\n  #resetCurrentPageView() {\n    const pageView = this._pages[this._currentPageNumber - 1];\n\n    if (this.isInPresentationMode) {\n      // Fixes the case when PDF has different page sizes.\n      this.#setScale(this._currentScaleValue, { noScroll: true });\n    }\n    this.#scrollIntoView(pageView);\n  }\n\n  /**\n   * @param {string} label - The page label.\n   * @returns {number|null} The page number corresponding to the page label,\n   *   or `null` when no page labels exist and/or the input is invalid.\n   */\n  pageLabelToPageNumber(label) {\n    if (!this._pageLabels) {\n      return null;\n    }\n    const i = this._pageLabels.indexOf(label);\n    if (i < 0) {\n      return null;\n    }\n    return i + 1;\n  }\n\n  /**\n   * @typedef {Object} ScrollPageIntoViewParameters\n   * @property {number} pageNumber - The page number.\n   * @property {Array} [destArray] - The original PDF destination array, in the\n   *   format: <page-ref> </XYZ|/FitXXX> <args..>\n   * @property {boolean} [allowNegativeOffset] - Allow negative page offsets.\n   *   The default value is `false`.\n   * @property {boolean} [ignoreDestinationZoom] - Ignore the zoom argument in\n   *   the destination array. The default value is `false`.\n   */\n\n  /**\n   * Scrolls page into view.\n   * @param {ScrollPageIntoViewParameters} params\n   */\n  scrollPageIntoView({\n    pageNumber,\n    destArray = null,\n    allowNegativeOffset = false,\n    ignoreDestinationZoom = false,\n  }) {\n    if (!this.pdfDocument) {\n      return;\n    }\n    const pageView =\n      Number.isInteger(pageNumber) && this._pages[pageNumber - 1];\n    if (!pageView) {\n      console.error(\n        `scrollPageIntoView: \"${pageNumber}\" is not a valid pageNumber parameter.`\n      );\n      return;\n    }\n\n    if (this.isInPresentationMode || !destArray) {\n      this._setCurrentPageNumber(pageNumber, /* resetCurrentPageView = */ true);\n      return;\n    }\n    let x = 0,\n      y = 0;\n    let width = 0,\n      height = 0,\n      widthScale,\n      heightScale;\n    const changeOrientation = pageView.rotation % 180 !== 0;\n    const pageWidth =\n      (changeOrientation ? pageView.height : pageView.width) /\n      pageView.scale /\n      PixelsPerInch.PDF_TO_CSS_UNITS;\n    const pageHeight =\n      (changeOrientation ? pageView.width : pageView.height) /\n      pageView.scale /\n      PixelsPerInch.PDF_TO_CSS_UNITS;\n    let scale = 0;\n    switch (destArray[1].name) {\n      case \"XYZ\":\n        x = destArray[2];\n        y = destArray[3];\n        scale = destArray[4];\n        // If x and/or y coordinates are not supplied, default to\n        // _top_ left of the page (not the obvious bottom left,\n        // since aligning the bottom of the intended page with the\n        // top of the window is rarely helpful).\n        x = x !== null ? x : 0;\n        y = y !== null ? y : pageHeight;\n        break;\n      case \"Fit\":\n      case \"FitB\":\n        scale = \"page-fit\";\n        break;\n      case \"FitH\":\n      case \"FitBH\":\n        y = destArray[2];\n        scale = \"page-width\";\n        // According to the PDF spec, section 12.3.2.2, a `null` value in the\n        // parameter should maintain the position relative to the new page.\n        if (y === null && this._location) {\n          x = this._location.left;\n          y = this._location.top;\n        } else if (typeof y !== \"number\" || y < 0) {\n          // The \"top\" value isn't optional, according to the spec, however some\n          // bad PDF generators will pretend that it is (fixes bug 1663390).\n          y = pageHeight;\n        }\n        break;\n      case \"FitV\":\n      case \"FitBV\":\n        x = destArray[2];\n        width = pageWidth;\n        height = pageHeight;\n        scale = \"page-height\";\n        break;\n      case \"FitR\":\n        x = destArray[2];\n        y = destArray[3];\n        width = destArray[4] - x;\n        height = destArray[5] - y;\n        let hPadding = SCROLLBAR_PADDING,\n          vPadding = VERTICAL_PADDING;\n\n        if (\n          (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"GENERIC\")) &&\n          this.removePageBorders\n        ) {\n          hPadding = vPadding = 0;\n        }\n        widthScale =\n          (this.container.clientWidth - hPadding) /\n          width /\n          PixelsPerInch.PDF_TO_CSS_UNITS;\n        heightScale =\n          (this.container.clientHeight - vPadding) /\n          height /\n          PixelsPerInch.PDF_TO_CSS_UNITS;\n        scale = Math.min(Math.abs(widthScale), Math.abs(heightScale));\n        break;\n      default:\n        console.error(\n          `scrollPageIntoView: \"${destArray[1].name}\" is not a valid destination type.`\n        );\n        return;\n    }\n\n    if (!ignoreDestinationZoom) {\n      if (scale && scale !== this._currentScale) {\n        this.currentScaleValue = scale;\n      } else if (this._currentScale === UNKNOWN_SCALE) {\n        this.currentScaleValue = DEFAULT_SCALE_VALUE;\n      }\n    }\n\n    if (scale === \"page-fit\" && !destArray[4]) {\n      this.#scrollIntoView(pageView);\n      return;\n    }\n\n    const boundingRect = [\n      pageView.viewport.convertToViewportPoint(x, y),\n      pageView.viewport.convertToViewportPoint(x + width, y + height),\n    ];\n    let left = Math.min(boundingRect[0][0], boundingRect[1][0]);\n    let top = Math.min(boundingRect[0][1], boundingRect[1][1]);\n\n    if (!allowNegativeOffset) {\n      // Some bad PDF generators will create destinations with e.g. top values\n      // that exceeds the page height. Ensure that offsets are not negative,\n      // to prevent a previous page from becoming visible (fixes bug 874482).\n      left = Math.max(left, 0);\n      top = Math.max(top, 0);\n    }\n    this.#scrollIntoView(pageView, /* pageSpot = */ { left, top });\n  }\n\n  _updateLocation(firstPage) {\n    const currentScale = this._currentScale;\n    const currentScaleValue = this._currentScaleValue;\n    const normalizedScaleValue =\n      parseFloat(currentScaleValue) === currentScale\n        ? Math.round(currentScale * 10000) / 100\n        : currentScaleValue;\n\n    const pageNumber = firstPage.id;\n    const currentPageView = this._pages[pageNumber - 1];\n    const container = this.container;\n    const topLeft = currentPageView.getPagePoint(\n      container.scrollLeft - firstPage.x,\n      container.scrollTop - firstPage.y\n    );\n    const intLeft = Math.round(topLeft[0]);\n    const intTop = Math.round(topLeft[1]);\n\n    let pdfOpenParams = `#page=${pageNumber}`;\n    if (!this.isInPresentationMode) {\n      pdfOpenParams += `&zoom=${normalizedScaleValue},${intLeft},${intTop}`;\n    }\n\n    this._location = {\n      pageNumber,\n      scale: normalizedScaleValue,\n      top: intTop,\n      left: intLeft,\n      rotation: this._pagesRotation,\n      pdfOpenParams,\n    };\n  }\n\n  update() {\n    const visible = this._getVisiblePages();\n    const visiblePages = visible.views,\n      numVisiblePages = visiblePages.length;\n\n    if (numVisiblePages === 0) {\n      return;\n    }\n    const newCacheSize = Math.max(DEFAULT_CACHE_SIZE, 2 * numVisiblePages + 1);\n    this.#buffer.resize(newCacheSize, visible.ids);\n\n    this.renderingQueue.renderHighestPriority(visible);\n\n    const isSimpleLayout =\n      this._spreadMode === SpreadMode.NONE &&\n      (this._scrollMode === ScrollMode.PAGE ||\n        this._scrollMode === ScrollMode.VERTICAL);\n    const currentId = this._currentPageNumber;\n    let stillFullyVisible = false;\n\n    for (const page of visiblePages) {\n      if (page.percent < 100) {\n        break;\n      }\n      if (page.id === currentId && isSimpleLayout) {\n        stillFullyVisible = true;\n        break;\n      }\n    }\n    this._setCurrentPageNumber(\n      stillFullyVisible ? currentId : visiblePages[0].id\n    );\n\n    this._updateLocation(visible.first);\n    this.eventBus.dispatch(\"updateviewarea\", {\n      source: this,\n      location: this._location,\n    });\n  }\n\n  #switchToEditAnnotationMode() {\n    const visible = this._getVisiblePages();\n    const pagesToRefresh = [];\n    const { ids, views } = visible;\n    for (const page of views) {\n      const { view } = page;\n      if (!view.hasEditableAnnotations()) {\n        ids.delete(view.id);\n        continue;\n      }\n      pagesToRefresh.push(page);\n    }\n\n    if (pagesToRefresh.length === 0) {\n      return null;\n    }\n    this.renderingQueue.renderHighestPriority({\n      first: pagesToRefresh[0],\n      last: pagesToRefresh.at(-1),\n      views: pagesToRefresh,\n      ids,\n    });\n\n    return ids;\n  }\n\n  containsElement(element) {\n    return this.container.contains(element);\n  }\n\n  focus() {\n    this.container.focus();\n  }\n\n  get _isContainerRtl() {\n    return getComputedStyle(this.container).direction === \"rtl\";\n  }\n\n  get isInPresentationMode() {\n    return this.presentationModeState === PresentationModeState.FULLSCREEN;\n  }\n\n  get isChangingPresentationMode() {\n    return this.presentationModeState === PresentationModeState.CHANGING;\n  }\n\n  get isHorizontalScrollbarEnabled() {\n    return this.isInPresentationMode\n      ? false\n      : this.container.scrollWidth > this.container.clientWidth;\n  }\n\n  get isVerticalScrollbarEnabled() {\n    return this.isInPresentationMode\n      ? false\n      : this.container.scrollHeight > this.container.clientHeight;\n  }\n\n  _getVisiblePages() {\n    const views =\n        this._scrollMode === ScrollMode.PAGE\n          ? this.#scrollModePageState.pages\n          : this._pages,\n      horizontal = this._scrollMode === ScrollMode.HORIZONTAL,\n      rtl = horizontal && this._isContainerRtl;\n\n    return getVisibleElements({\n      scrollEl: this.container,\n      views,\n      sortByVisibility: true,\n      horizontal,\n      rtl,\n    });\n  }\n\n  cleanup() {\n    for (const pageView of this._pages) {\n      if (pageView.renderingState !== RenderingStates.FINISHED) {\n        pageView.reset();\n      }\n    }\n  }\n\n  /**\n   * @private\n   */\n  _cancelRendering() {\n    for (const pageView of this._pages) {\n      pageView.cancelRendering();\n    }\n  }\n\n  /**\n   * @param {PDFPageView} pageView\n   * @returns {Promise<PDFPageProxy | null>}\n   */\n  async #ensurePdfPageLoaded(pageView) {\n    if (pageView.pdfPage) {\n      return pageView.pdfPage;\n    }\n    try {\n      const pdfPage = await this.pdfDocument.getPage(pageView.id);\n      if (!pageView.pdfPage) {\n        pageView.setPdfPage(pdfPage);\n      }\n      return pdfPage;\n    } catch (reason) {\n      console.error(\"Unable to get page for page view\", reason);\n      return null; // Page error -- there is nothing that can be done.\n    }\n  }\n\n  #getScrollAhead(visible) {\n    if (visible.first?.id === 1) {\n      return true;\n    } else if (visible.last?.id === this.pagesCount) {\n      return false;\n    }\n    switch (this._scrollMode) {\n      case ScrollMode.PAGE:\n        return this.#scrollModePageState.scrollDown;\n      case ScrollMode.HORIZONTAL:\n        return this.scroll.right;\n    }\n    return this.scroll.down;\n  }\n\n  forceRendering(currentlyVisiblePages) {\n    const visiblePages = currentlyVisiblePages || this._getVisiblePages();\n    const scrollAhead = this.#getScrollAhead(visiblePages);\n    const preRenderExtra =\n      this._spreadMode !== SpreadMode.NONE &&\n      this._scrollMode !== ScrollMode.HORIZONTAL;\n\n    const pageView = this.renderingQueue.getHighestPriority(\n      visiblePages,\n      this._pages,\n      scrollAhead,\n      preRenderExtra\n    );\n\n    if (pageView) {\n      this.#ensurePdfPageLoaded(pageView).then(() => {\n        this.renderingQueue.renderView(pageView);\n      });\n      return true;\n    }\n    return false;\n  }\n\n  /**\n   * @type {boolean} Whether all pages of the PDF document have identical\n   *   widths and heights.\n   */\n  get hasEqualPageSizes() {\n    const firstPageView = this._pages[0];\n    for (let i = 1, ii = this._pages.length; i < ii; ++i) {\n      const pageView = this._pages[i];\n      if (\n        pageView.width !== firstPageView.width ||\n        pageView.height !== firstPageView.height\n      ) {\n        return false;\n      }\n    }\n    return true;\n  }\n\n  /**\n   * Returns sizes of the pages.\n   * @returns {Array} Array of objects with width/height/rotation fields.\n   */\n  getPagesOverview() {\n    let initialOrientation;\n    return this._pages.map(pageView => {\n      const viewport = pageView.pdfPage.getViewport({ scale: 1 });\n      const orientation = isPortraitOrientation(viewport);\n      if (initialOrientation === undefined) {\n        initialOrientation = orientation;\n      } else if (\n        this.enablePrintAutoRotate &&\n        orientation !== initialOrientation\n      ) {\n        // Rotate to fit the initial orientation.\n        return {\n          width: viewport.height,\n          height: viewport.width,\n          rotation: (viewport.rotation - 90) % 360,\n        };\n      }\n      return {\n        width: viewport.width,\n        height: viewport.height,\n        rotation: viewport.rotation,\n      };\n    });\n  }\n\n  /**\n   * @type {Promise<OptionalContentConfig | null>}\n   */\n  get optionalContentConfigPromise() {\n    if (!this.pdfDocument) {\n      return Promise.resolve(null);\n    }\n    if (!this._optionalContentConfigPromise) {\n      console.error(\"optionalContentConfigPromise: Not initialized yet.\");\n      // Prevent issues if the getter is accessed *before* the `onePageRendered`\n      // promise has resolved; won't (normally) happen in the default viewer.\n      return this.pdfDocument.getOptionalContentConfig({ intent: \"display\" });\n    }\n    return this._optionalContentConfigPromise;\n  }\n\n  /**\n   * @param {Promise<OptionalContentConfig>} promise - A promise that is\n   *   resolved with an {@link OptionalContentConfig} instance.\n   */\n  set optionalContentConfigPromise(promise) {\n    if (!(promise instanceof Promise)) {\n      throw new Error(`Invalid optionalContentConfigPromise: ${promise}`);\n    }\n    if (!this.pdfDocument) {\n      return;\n    }\n    if (!this._optionalContentConfigPromise) {\n      // Ignore the setter *before* the `onePageRendered` promise has resolved,\n      // since it'll be overwritten anyway; won't happen in the default viewer.\n      return;\n    }\n    this._optionalContentConfigPromise = promise;\n\n    this.refresh(false, { optionalContentConfigPromise: promise });\n\n    this.eventBus.dispatch(\"optionalcontentconfigchanged\", {\n      source: this,\n      promise,\n    });\n  }\n\n  /**\n   * @type {number} One of the values in {ScrollMode}.\n   */\n  get scrollMode() {\n    return this._scrollMode;\n  }\n\n  /**\n   * @param {number} mode - The direction in which the document pages should be\n   *   laid out within the scrolling container.\n   *   The constants from {ScrollMode} should be used.\n   */\n  set scrollMode(mode) {\n    if (\n      typeof PDFJSDev === \"undefined\"\n        ? window.isGECKOVIEW\n        : PDFJSDev.test(\"GECKOVIEW\")\n    ) {\n      // NOTE: Always ignore the pageLayout in GeckoView since there's\n      // no UI available to change Scroll/Spread modes for the user.\n      return;\n    }\n    if (this._scrollMode === mode) {\n      return; // The Scroll mode didn't change.\n    }\n    if (!isValidScrollMode(mode)) {\n      throw new Error(`Invalid scroll mode: ${mode}`);\n    }\n    if (this.pagesCount > PagesCountLimit.FORCE_SCROLL_MODE_PAGE) {\n      return; // Disabled for performance reasons.\n    }\n    this._previousScrollMode = this._scrollMode;\n\n    this._scrollMode = mode;\n    this.eventBus.dispatch(\"scrollmodechanged\", { source: this, mode });\n\n    this._updateScrollMode(/* pageNumber = */ this._currentPageNumber);\n  }\n\n  _updateScrollMode(pageNumber = null) {\n    const scrollMode = this._scrollMode,\n      viewer = this.viewer;\n\n    viewer.classList.toggle(\n      \"scrollHorizontal\",\n      scrollMode === ScrollMode.HORIZONTAL\n    );\n    viewer.classList.toggle(\"scrollWrapped\", scrollMode === ScrollMode.WRAPPED);\n\n    if (!this.pdfDocument || !pageNumber) {\n      return;\n    }\n\n    if (scrollMode === ScrollMode.PAGE) {\n      this.#ensurePageViewVisible();\n    } else if (this._previousScrollMode === ScrollMode.PAGE) {\n      // Ensure that the current spreadMode is still applied correctly when\n      // the *previous* scrollMode was `ScrollMode.PAGE`.\n      this._updateSpreadMode();\n    }\n    // Non-numeric scale values can be sensitive to the scroll orientation.\n    // Call this before re-scrolling to the current page, to ensure that any\n    // changes in scale don't move the current page.\n    if (this._currentScaleValue && isNaN(this._currentScaleValue)) {\n      this.#setScale(this._currentScaleValue, { noScroll: true });\n    }\n    this._setCurrentPageNumber(pageNumber, /* resetCurrentPageView = */ true);\n    this.update();\n  }\n\n  /**\n   * @type {number} One of the values in {SpreadMode}.\n   */\n  get spreadMode() {\n    return this._spreadMode;\n  }\n\n  /**\n   * @param {number} mode - Group the pages in spreads, starting with odd- or\n   *   even-number pages (unless `SpreadMode.NONE` is used).\n   *   The constants from {SpreadMode} should be used.\n   */\n  set spreadMode(mode) {\n    if (\n      typeof PDFJSDev === \"undefined\"\n        ? window.isGECKOVIEW\n        : PDFJSDev.test(\"GECKOVIEW\")\n    ) {\n      // NOTE: Always ignore the pageLayout in GeckoView since there's\n      // no UI available to change Scroll/Spread modes for the user.\n      return;\n    }\n    if (this._spreadMode === mode) {\n      return; // The Spread mode didn't change.\n    }\n    if (!isValidSpreadMode(mode)) {\n      throw new Error(`Invalid spread mode: ${mode}`);\n    }\n    this._spreadMode = mode;\n    this.eventBus.dispatch(\"spreadmodechanged\", { source: this, mode });\n\n    this._updateSpreadMode(/* pageNumber = */ this._currentPageNumber);\n  }\n\n  _updateSpreadMode(pageNumber = null) {\n    if (!this.pdfDocument) {\n      return;\n    }\n    const viewer = this.viewer,\n      pages = this._pages;\n\n    if (this._scrollMode === ScrollMode.PAGE) {\n      this.#ensurePageViewVisible();\n    } else {\n      // Temporarily remove all the pages from the DOM.\n      viewer.textContent = \"\";\n\n      if (this._spreadMode === SpreadMode.NONE) {\n        for (const pageView of this._pages) {\n          viewer.append(pageView.div);\n        }\n      } else {\n        const parity = this._spreadMode - 1;\n        let spread = null;\n        for (let i = 0, ii = pages.length; i < ii; ++i) {\n          if (spread === null) {\n            spread = document.createElement(\"div\");\n            spread.className = \"spread\";\n            viewer.append(spread);\n          } else if (i % 2 === parity) {\n            spread = spread.cloneNode(false);\n            viewer.append(spread);\n          }\n          spread.append(pages[i].div);\n        }\n      }\n    }\n\n    if (!pageNumber) {\n      return;\n    }\n    // Non-numeric scale values can be sensitive to the scroll orientation.\n    // Call this before re-scrolling to the current page, to ensure that any\n    // changes in scale don't move the current page.\n    if (this._currentScaleValue && isNaN(this._currentScaleValue)) {\n      this.#setScale(this._currentScaleValue, { noScroll: true });\n    }\n    this._setCurrentPageNumber(pageNumber, /* resetCurrentPageView = */ true);\n    this.update();\n  }\n\n  /**\n   * @private\n   */\n  _getPageAdvance(currentPageNumber, previous = false) {\n    switch (this._scrollMode) {\n      case ScrollMode.WRAPPED: {\n        const { views } = this._getVisiblePages(),\n          pageLayout = new Map();\n\n        // Determine the current (visible) page layout.\n        for (const { id, y, percent, widthPercent } of views) {\n          if (percent === 0 || widthPercent < 100) {\n            continue;\n          }\n          let yArray = pageLayout.get(y);\n          if (!yArray) {\n            pageLayout.set(y, (yArray ||= []));\n          }\n          yArray.push(id);\n        }\n        // Find the row of the current page.\n        for (const yArray of pageLayout.values()) {\n          const currentIndex = yArray.indexOf(currentPageNumber);\n          if (currentIndex === -1) {\n            continue;\n          }\n          const numPages = yArray.length;\n          if (numPages === 1) {\n            break;\n          }\n          // Handle documents with varying page sizes.\n          if (previous) {\n            for (let i = currentIndex - 1, ii = 0; i >= ii; i--) {\n              const currentId = yArray[i],\n                expectedId = yArray[i + 1] - 1;\n              if (currentId < expectedId) {\n                return currentPageNumber - expectedId;\n              }\n            }\n          } else {\n            for (let i = currentIndex + 1, ii = numPages; i < ii; i++) {\n              const currentId = yArray[i],\n                expectedId = yArray[i - 1] + 1;\n              if (currentId > expectedId) {\n                return expectedId - currentPageNumber;\n              }\n            }\n          }\n          // The current row is \"complete\", advance to the previous/next one.\n          if (previous) {\n            const firstId = yArray[0];\n            if (firstId < currentPageNumber) {\n              return currentPageNumber - firstId + 1;\n            }\n          } else {\n            const lastId = yArray[numPages - 1];\n            if (lastId > currentPageNumber) {\n              return lastId - currentPageNumber + 1;\n            }\n          }\n          break;\n        }\n        break;\n      }\n      case ScrollMode.HORIZONTAL: {\n        break;\n      }\n      case ScrollMode.PAGE:\n      case ScrollMode.VERTICAL: {\n        if (this._spreadMode === SpreadMode.NONE) {\n          break; // Normal vertical scrolling.\n        }\n        const parity = this._spreadMode - 1;\n\n        if (previous && currentPageNumber % 2 !== parity) {\n          break; // Left-hand side page.\n        } else if (!previous && currentPageNumber % 2 === parity) {\n          break; // Right-hand side page.\n        }\n        const { views } = this._getVisiblePages(),\n          expectedId = previous ? currentPageNumber - 1 : currentPageNumber + 1;\n\n        for (const { id, percent, widthPercent } of views) {\n          if (id !== expectedId) {\n            continue;\n          }\n          if (percent > 0 && widthPercent === 100) {\n            return 2;\n          }\n          break;\n        }\n        break;\n      }\n    }\n    return 1;\n  }\n\n  /**\n   * Go to the next page, taking scroll/spread-modes into account.\n   * @returns {boolean} Whether navigation occurred.\n   */\n  nextPage() {\n    const currentPageNumber = this._currentPageNumber,\n      pagesCount = this.pagesCount;\n\n    if (currentPageNumber >= pagesCount) {\n      return false;\n    }\n    const advance =\n      this._getPageAdvance(currentPageNumber, /* previous = */ false) || 1;\n\n    this.currentPageNumber = Math.min(currentPageNumber + advance, pagesCount);\n    return true;\n  }\n\n  /**\n   * Go to the previous page, taking scroll/spread-modes into account.\n   * @returns {boolean} Whether navigation occurred.\n   */\n  previousPage() {\n    const currentPageNumber = this._currentPageNumber;\n\n    if (currentPageNumber <= 1) {\n      return false;\n    }\n    const advance =\n      this._getPageAdvance(currentPageNumber, /* previous = */ true) || 1;\n\n    this.currentPageNumber = Math.max(currentPageNumber - advance, 1);\n    return true;\n  }\n\n  /**\n   * @typedef {Object} ChangeScaleOptions\n   * @property {number} [drawingDelay]\n   * @property {number} [scaleFactor]\n   * @property {number} [steps]\n   * @property {Array} [origin] x and y coordinates of the scale\n   *                            transformation origin.\n   */\n\n  /**\n   * Changes the current zoom level by the specified amount.\n   * @param {ChangeScaleOptions} [options]\n   */\n  updateScale({ drawingDelay, scaleFactor = null, steps = null, origin }) {\n    if (steps === null && scaleFactor === null) {\n      throw new Error(\n        \"Invalid updateScale options: either `steps` or `scaleFactor` must be provided.\"\n      );\n    }\n    if (!this.pdfDocument) {\n      return;\n    }\n    let newScale = this._currentScale;\n    if (scaleFactor > 0 && scaleFactor !== 1) {\n      newScale = Math.round(newScale * scaleFactor * 100) / 100;\n    } else if (steps) {\n      const delta = steps > 0 ? DEFAULT_SCALE_DELTA : 1 / DEFAULT_SCALE_DELTA;\n      const round = steps > 0 ? Math.ceil : Math.floor;\n      steps = Math.abs(steps);\n      do {\n        newScale = round((newScale * delta).toFixed(2) * 10) / 10;\n      } while (--steps > 0);\n    }\n    newScale = Math.max(MIN_SCALE, Math.min(MAX_SCALE, newScale));\n    this.#setScale(newScale, { noScroll: false, drawingDelay, origin });\n  }\n\n  /**\n   * Increase the current zoom level one, or more, times.\n   * @param {ChangeScaleOptions} [options]\n   */\n  increaseScale(options = {}) {\n    this.updateScale({ ...options, steps: options.steps ?? 1 });\n  }\n\n  /**\n   * Decrease the current zoom level one, or more, times.\n   * @param {ChangeScaleOptions} [options]\n   */\n  decreaseScale(options = {}) {\n    this.updateScale({ ...options, steps: -(options.steps ?? 1) });\n  }\n\n  #updateContainerHeightCss(height = this.container.clientHeight) {\n    if (height !== this.#previousContainerHeight) {\n      this.#previousContainerHeight = height;\n      docStyle.setProperty(\"--viewer-container-height\", `${height}px`);\n    }\n  }\n\n  #resizeObserverCallback(entries) {\n    for (const entry of entries) {\n      if (entry.target === this.container) {\n        this.#updateContainerHeightCss(\n          Math.floor(entry.borderBoxSize[0].blockSize)\n        );\n        this.#containerTopLeft = null;\n        break;\n      }\n    }\n  }\n\n  get containerTopLeft() {\n    return (this.#containerTopLeft ||= [\n      this.container.offsetTop,\n      this.container.offsetLeft,\n    ]);\n  }\n\n  #cleanupSwitchAnnotationEditorMode() {\n    this.#switchAnnotationEditorModeAC?.abort();\n    this.#switchAnnotationEditorModeAC = null;\n\n    if (this.#switchAnnotationEditorModeTimeoutId !== null) {\n      clearTimeout(this.#switchAnnotationEditorModeTimeoutId);\n      this.#switchAnnotationEditorModeTimeoutId = null;\n    }\n  }\n\n  get annotationEditorMode() {\n    return this.#annotationEditorUIManager\n      ? this.#annotationEditorMode\n      : AnnotationEditorType.DISABLE;\n  }\n\n  /**\n   * @typedef {Object} AnnotationEditorModeOptions\n   * @property {number} mode - The editor mode (none, FreeText, ink, ...).\n   * @property {string|null} [editId] - ID of the existing annotation to edit.\n   * @property {boolean} [isFromKeyboard] - True if the mode change is due to a\n   *   keyboard action.\n   */\n\n  /**\n   * @param {AnnotationEditorModeOptions} options\n   */\n  set annotationEditorMode({ mode, editId = null, isFromKeyboard = false }) {\n    if (!this.#annotationEditorUIManager) {\n      throw new Error(`The AnnotationEditor is not enabled.`);\n    }\n    if (this.#annotationEditorMode === mode) {\n      return; // The AnnotationEditor mode didn't change.\n    }\n    if (!isValidAnnotationEditorMode(mode)) {\n      throw new Error(`Invalid AnnotationEditor mode: ${mode}`);\n    }\n    if (!this.pdfDocument) {\n      return;\n    }\n    if (mode === AnnotationEditorType.STAMP) {\n      this.#mlManager?.loadModel(\"altText\");\n    }\n\n    const { eventBus } = this;\n    const updater = () => {\n      this.#cleanupSwitchAnnotationEditorMode();\n      this.#annotationEditorMode = mode;\n      this.#annotationEditorUIManager.updateMode(mode, editId, isFromKeyboard);\n      eventBus.dispatch(\"annotationeditormodechanged\", {\n        source: this,\n        mode,\n      });\n    };\n\n    if (\n      mode === AnnotationEditorType.NONE ||\n      this.#annotationEditorMode === AnnotationEditorType.NONE\n    ) {\n      const isEditing = mode !== AnnotationEditorType.NONE;\n      if (!isEditing) {\n        this.pdfDocument.annotationStorage.resetModifiedIds();\n      }\n      for (const pageView of this._pages) {\n        pageView.toggleEditingMode(isEditing);\n      }\n      // We must call #switchToEditAnnotationMode unconditionally to ensure that\n      // page is rendered if it's useful or not.\n      const idsToRefresh = this.#switchToEditAnnotationMode();\n      if (isEditing && idsToRefresh) {\n        // We're editing so we must switch to editing mode when the rendering is\n        // done.\n        this.#cleanupSwitchAnnotationEditorMode();\n        this.#switchAnnotationEditorModeAC = new AbortController();\n        const signal = AbortSignal.any([\n          this.#eventAbortController.signal,\n          this.#switchAnnotationEditorModeAC.signal,\n        ]);\n\n        eventBus._on(\n          \"pagerendered\",\n          ({ pageNumber }) => {\n            idsToRefresh.delete(pageNumber);\n            if (idsToRefresh.size === 0) {\n              this.#switchAnnotationEditorModeTimeoutId = setTimeout(\n                updater,\n                0\n              );\n            }\n          },\n          { signal }\n        );\n        return;\n      }\n    }\n    updater();\n  }\n\n  refresh(noUpdate = false, updateArgs = Object.create(null)) {\n    if (!this.pdfDocument) {\n      return;\n    }\n    for (const pageView of this._pages) {\n      pageView.update(updateArgs);\n    }\n    if (this.#scaleTimeoutId !== null) {\n      clearTimeout(this.#scaleTimeoutId);\n      this.#scaleTimeoutId = null;\n    }\n    if (!noUpdate) {\n      this.update();\n    }\n  }\n}\n\nexport { PagesCountLimit, PDFPageViewBuffer, PDFViewer };\n","/* Copyright 2012 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/** @typedef {import(\"./event_utils.js\").EventBus} EventBus */\n\nimport {\n  CursorTool,\n  ScrollMode,\n  SpreadMode,\n  toggleCheckedBtn,\n  toggleExpandedBtn,\n} from \"./ui_utils.js\";\nimport { PagesCountLimit } from \"./pdf_viewer.js\";\n\n/**\n * @typedef {Object} SecondaryToolbarOptions\n * @property {HTMLDivElement} toolbar - Container for the secondary toolbar.\n * @property {HTMLButtonElement} toggleButton - Button to toggle the visibility\n *   of the secondary toolbar.\n * @property {HTMLButtonElement} presentationModeButton - Button for entering\n *   presentation mode.\n * @property {HTMLButtonElement} openFileButton - Button to open a file.\n * @property {HTMLButtonElement} printButton - Button to print the document.\n * @property {HTMLButtonElement} downloadButton - Button to download the\n *   document.\n * @property {HTMLAnchorElement} viewBookmarkButton - Button to obtain a\n *   bookmark link to the current location in the document.\n * @property {HTMLButtonElement} firstPageButton - Button to go to the first\n *   page in the document.\n * @property {HTMLButtonElement} lastPageButton - Button to go to the last page\n *   in the document.\n * @property {HTMLButtonElement} pageRotateCwButton - Button to rotate the pages\n *   clockwise.\n * @property {HTMLButtonElement} pageRotateCcwButton - Button to rotate the\n *   pages counterclockwise.\n * @property {HTMLButtonElement} cursorSelectToolButton - Button to enable the\n *   select tool.\n * @property {HTMLButtonElement} cursorHandToolButton - Button to enable the\n *   hand tool.\n * @property {HTMLButtonElement} imageAltTextSettingsButton - Button for opening\n *   the image alt-text settings dialog.\n * @property {HTMLButtonElement} documentPropertiesButton - Button for opening\n *   the document properties dialog.\n */\n\nclass SecondaryToolbar {\n  #opts;\n\n  /**\n   * @param {SecondaryToolbarOptions} options\n   * @param {EventBus} eventBus\n   */\n  constructor(options, eventBus) {\n    this.#opts = options;\n    const buttons = [\n      {\n        element: options.presentationModeButton,\n        eventName: \"presentationmode\",\n        close: true,\n      },\n      { element: options.printButton, eventName: \"print\", close: true },\n      { element: options.downloadButton, eventName: \"download\", close: true },\n      { element: options.viewBookmarkButton, eventName: null, close: true },\n      { element: options.firstPageButton, eventName: \"firstpage\", close: true },\n      { element: options.lastPageButton, eventName: \"lastpage\", close: true },\n      {\n        element: options.pageRotateCwButton,\n        eventName: \"rotatecw\",\n        close: false,\n      },\n      {\n        element: options.pageRotateCcwButton,\n        eventName: \"rotateccw\",\n        close: false,\n      },\n      {\n        element: options.cursorSelectToolButton,\n        eventName: \"switchcursortool\",\n        eventDetails: { tool: CursorTool.SELECT },\n        close: true,\n      },\n      {\n        element: options.cursorHandToolButton,\n        eventName: \"switchcursortool\",\n        eventDetails: { tool: CursorTool.HAND },\n        close: true,\n      },\n      {\n        element: options.scrollPageButton,\n        eventName: \"switchscrollmode\",\n        eventDetails: { mode: ScrollMode.PAGE },\n        close: true,\n      },\n      {\n        element: options.scrollVerticalButton,\n        eventName: \"switchscrollmode\",\n        eventDetails: { mode: ScrollMode.VERTICAL },\n        close: true,\n      },\n      {\n        element: options.scrollHorizontalButton,\n        eventName: \"switchscrollmode\",\n        eventDetails: { mode: ScrollMode.HORIZONTAL },\n        close: true,\n      },\n      {\n        element: options.scrollWrappedButton,\n        eventName: \"switchscrollmode\",\n        eventDetails: { mode: ScrollMode.WRAPPED },\n        close: true,\n      },\n      {\n        element: options.spreadNoneButton,\n        eventName: \"switchspreadmode\",\n        eventDetails: { mode: SpreadMode.NONE },\n        close: true,\n      },\n      {\n        element: options.spreadOddButton,\n        eventName: \"switchspreadmode\",\n        eventDetails: { mode: SpreadMode.ODD },\n        close: true,\n      },\n      {\n        element: options.spreadEvenButton,\n        eventName: \"switchspreadmode\",\n        eventDetails: { mode: SpreadMode.EVEN },\n        close: true,\n      },\n      {\n        element: options.imageAltTextSettingsButton,\n        eventName: \"imagealttextsettings\",\n        close: true,\n      },\n      {\n        element: options.documentPropertiesButton,\n        eventName: \"documentproperties\",\n        close: true,\n      },\n    ];\n    if (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"GENERIC\")) {\n      buttons.push({\n        element: options.openFileButton,\n        eventName: \"openfile\",\n        close: true,\n      });\n    }\n\n    this.eventBus = eventBus;\n    this.opened = false;\n\n    // Bind the event listeners for click, cursor tool, and scroll/spread mode\n    // actions.\n    this.#bindListeners(buttons);\n\n    this.reset();\n  }\n\n  /**\n   * @type {boolean}\n   */\n  get isOpen() {\n    return this.opened;\n  }\n\n  setPageNumber(pageNumber) {\n    this.pageNumber = pageNumber;\n    this.#updateUIState();\n  }\n\n  setPagesCount(pagesCount) {\n    this.pagesCount = pagesCount;\n    this.#updateUIState();\n  }\n\n  reset() {\n    this.pageNumber = 0;\n    this.pagesCount = 0;\n    this.#updateUIState();\n\n    // Reset the Scroll/Spread buttons too, since they're document specific.\n    this.eventBus.dispatch(\"switchcursortool\", { source: this, reset: true });\n    this.#scrollModeChanged({ mode: ScrollMode.VERTICAL });\n    this.#spreadModeChanged({ mode: SpreadMode.NONE });\n  }\n\n  #updateUIState() {\n    const {\n      firstPageButton,\n      lastPageButton,\n      pageRotateCwButton,\n      pageRotateCcwButton,\n    } = this.#opts;\n\n    firstPageButton.disabled = this.pageNumber <= 1;\n    lastPageButton.disabled = this.pageNumber >= this.pagesCount;\n    pageRotateCwButton.disabled = this.pagesCount === 0;\n    pageRotateCcwButton.disabled = this.pagesCount === 0;\n  }\n\n  #bindListeners(buttons) {\n    const { eventBus } = this;\n    const { toggleButton } = this.#opts;\n    // Button to toggle the visibility of the secondary toolbar.\n    toggleButton.addEventListener(\"click\", this.toggle.bind(this));\n\n    // All items within the secondary toolbar.\n    for (const { element, eventName, close, eventDetails } of buttons) {\n      element.addEventListener(\"click\", evt => {\n        if (eventName !== null) {\n          eventBus.dispatch(eventName, { source: this, ...eventDetails });\n        }\n        if (close) {\n          this.close();\n        }\n        eventBus.dispatch(\"reporttelemetry\", {\n          source: this,\n          details: {\n            type: \"buttons\",\n            data: { id: element.id },\n          },\n        });\n      });\n    }\n\n    eventBus._on(\"cursortoolchanged\", this.#cursorToolChanged.bind(this));\n    eventBus._on(\"scrollmodechanged\", this.#scrollModeChanged.bind(this));\n    eventBus._on(\"spreadmodechanged\", this.#spreadModeChanged.bind(this));\n  }\n\n  #cursorToolChanged({ tool, disabled }) {\n    const { cursorSelectToolButton, cursorHandToolButton } = this.#opts;\n\n    toggleCheckedBtn(cursorSelectToolButton, tool === CursorTool.SELECT);\n    toggleCheckedBtn(cursorHandToolButton, tool === CursorTool.HAND);\n\n    cursorSelectToolButton.disabled = disabled;\n    cursorHandToolButton.disabled = disabled;\n  }\n\n  #scrollModeChanged({ mode }) {\n    const {\n      scrollPageButton,\n      scrollVerticalButton,\n      scrollHorizontalButton,\n      scrollWrappedButton,\n      spreadNoneButton,\n      spreadOddButton,\n      spreadEvenButton,\n    } = this.#opts;\n\n    toggleCheckedBtn(scrollPageButton, mode === ScrollMode.PAGE);\n    toggleCheckedBtn(scrollVerticalButton, mode === ScrollMode.VERTICAL);\n    toggleCheckedBtn(scrollHorizontalButton, mode === ScrollMode.HORIZONTAL);\n    toggleCheckedBtn(scrollWrappedButton, mode === ScrollMode.WRAPPED);\n\n    // Permanently *disable* the Scroll buttons when PAGE-scrolling is being\n    // enforced for *very* long/large documents; please see the `BaseViewer`.\n    const forceScrollModePage =\n      this.pagesCount > PagesCountLimit.FORCE_SCROLL_MODE_PAGE;\n    scrollPageButton.disabled = forceScrollModePage;\n    scrollVerticalButton.disabled = forceScrollModePage;\n    scrollHorizontalButton.disabled = forceScrollModePage;\n    scrollWrappedButton.disabled = forceScrollModePage;\n\n    // Temporarily *disable* the Spread buttons when horizontal scrolling is\n    // enabled, since the non-default Spread modes doesn't affect the layout.\n    const isHorizontal = mode === ScrollMode.HORIZONTAL;\n    spreadNoneButton.disabled = isHorizontal;\n    spreadOddButton.disabled = isHorizontal;\n    spreadEvenButton.disabled = isHorizontal;\n  }\n\n  #spreadModeChanged({ mode }) {\n    const { spreadNoneButton, spreadOddButton, spreadEvenButton } = this.#opts;\n\n    toggleCheckedBtn(spreadNoneButton, mode === SpreadMode.NONE);\n    toggleCheckedBtn(spreadOddButton, mode === SpreadMode.ODD);\n    toggleCheckedBtn(spreadEvenButton, mode === SpreadMode.EVEN);\n  }\n\n  open() {\n    if (this.opened) {\n      return;\n    }\n    this.opened = true;\n\n    const { toggleButton, toolbar } = this.#opts;\n    toggleExpandedBtn(toggleButton, true, toolbar);\n  }\n\n  close() {\n    if (!this.opened) {\n      return;\n    }\n    this.opened = false;\n\n    const { toggleButton, toolbar } = this.#opts;\n    toggleExpandedBtn(toggleButton, false, toolbar);\n  }\n\n  toggle() {\n    if (this.opened) {\n      this.close();\n    } else {\n      this.open();\n    }\n  }\n}\n\nexport { SecondaryToolbar };\n","/* Copyright 2016 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/** @typedef {import(\"./event_utils.js\").EventBus} EventBus */\n\nimport { AnnotationEditorType, ColorPicker, noContextMenu } from \"pdfjs-lib\";\nimport {\n  DEFAULT_SCALE,\n  DEFAULT_SCALE_VALUE,\n  MAX_SCALE,\n  MIN_SCALE,\n  toggleExpandedBtn,\n} from \"./ui_utils.js\";\n\n/**\n * @typedef {Object} ToolbarOptions\n * @property {HTMLDivElement} container - Container for the secondary toolbar.\n * @property {HTMLSpanElement} numPages - Label that contains number of pages.\n * @property {HTMLInputElement} pageNumber - Control for display and user input\n *   of the current page number.\n * @property {HTMLSelectElement} scaleSelect - Scale selection control.\n *   Its width is adjusted, when necessary, on UI localization.\n * @property {HTMLOptionElement} customScaleOption - The item used to display\n *   a non-predefined scale.\n * @property {HTMLButtonElement} previous - Button to go to the previous page.\n * @property {HTMLButtonElement} next - Button to go to the next page.\n * @property {HTMLButtonElement} zoomIn - Button to zoom in the pages.\n * @property {HTMLButtonElement} zoomOut - Button to zoom out the pages.\n * @property {HTMLButtonElement} editorFreeTextButton - Button to switch to\n *   FreeText editing.\n * @property {HTMLButtonElement} download - Button to download the document.\n */\n\nclass Toolbar {\n  #opts;\n\n  /**\n   * @param {ToolbarOptions} options\n   * @param {EventBus} eventBus\n   * @param {number} toolbarDensity - The toolbar density value.\n   *   The possible values are:\n   *    - 0 (default) - The regular toolbar size.\n   *    - 1 (compact) - The small toolbar size.\n   *    - 2 (touch) - The large toolbar size.\n   */\n  constructor(options, eventBus, toolbarDensity = 0) {\n    this.#opts = options;\n    this.eventBus = eventBus;\n    const buttons = [\n      { element: options.previous, eventName: \"previouspage\" },\n      { element: options.next, eventName: \"nextpage\" },\n      { element: options.zoomIn, eventName: \"zoomin\" },\n      { element: options.zoomOut, eventName: \"zoomout\" },\n      { element: options.print, eventName: \"print\" },\n      { element: options.download, eventName: \"download\" },\n      {\n        element: options.editorFreeTextButton,\n        eventName: \"switchannotationeditormode\",\n        eventDetails: {\n          get mode() {\n            const { classList } = options.editorFreeTextButton;\n            return classList.contains(\"toggled\")\n              ? AnnotationEditorType.NONE\n              : AnnotationEditorType.FREETEXT;\n          },\n        },\n      },\n      {\n        element: options.editorHighlightButton,\n        eventName: \"switchannotationeditormode\",\n        eventDetails: {\n          get mode() {\n            const { classList } = options.editorHighlightButton;\n            return classList.contains(\"toggled\")\n              ? AnnotationEditorType.NONE\n              : AnnotationEditorType.HIGHLIGHT;\n          },\n        },\n      },\n      {\n        element: options.editorInkButton,\n        eventName: \"switchannotationeditormode\",\n        eventDetails: {\n          get mode() {\n            const { classList } = options.editorInkButton;\n            return classList.contains(\"toggled\")\n              ? AnnotationEditorType.NONE\n              : AnnotationEditorType.INK;\n          },\n        },\n      },\n      {\n        element: options.editorStampButton,\n        eventName: \"switchannotationeditormode\",\n        eventDetails: {\n          get mode() {\n            const { classList } = options.editorStampButton;\n            return classList.contains(\"toggled\")\n              ? AnnotationEditorType.NONE\n              : AnnotationEditorType.STAMP;\n          },\n        },\n        telemetry: {\n          type: \"editing\",\n          data: { action: \"pdfjs.image.icon_click\" },\n        },\n      },\n    ];\n\n    // Bind the event listeners for click and various other actions.\n    this.#bindListeners(buttons);\n\n    this.#updateToolbarDensity({ value: toolbarDensity });\n    this.reset();\n  }\n\n  #updateToolbarDensity({ value }) {\n    let name = \"normal\";\n    switch (value) {\n      case 1:\n        name = \"compact\";\n        break;\n      case 2:\n        name = \"touch\";\n        break;\n    }\n    document.documentElement.setAttribute(\"data-toolbar-density\", name);\n  }\n\n  #setAnnotationEditorUIManager(uiManager, parentContainer) {\n    const colorPicker = new ColorPicker({ uiManager });\n    uiManager.setMainHighlightColorPicker(colorPicker);\n    parentContainer.append(colorPicker.renderMainDropdown());\n  }\n\n  setPageNumber(pageNumber, pageLabel) {\n    this.pageNumber = pageNumber;\n    this.pageLabel = pageLabel;\n    this.#updateUIState(false);\n  }\n\n  setPagesCount(pagesCount, hasPageLabels) {\n    this.pagesCount = pagesCount;\n    this.hasPageLabels = hasPageLabels;\n    this.#updateUIState(true);\n  }\n\n  setPageScale(pageScaleValue, pageScale) {\n    this.pageScaleValue = (pageScaleValue || pageScale).toString();\n    this.pageScale = pageScale;\n    this.#updateUIState(false);\n  }\n\n  reset() {\n    this.pageNumber = 0;\n    this.pageLabel = null;\n    this.hasPageLabels = false;\n    this.pagesCount = 0;\n    this.pageScaleValue = DEFAULT_SCALE_VALUE;\n    this.pageScale = DEFAULT_SCALE;\n    this.#updateUIState(true);\n    this.updateLoadingIndicatorState();\n\n    // Reset the Editor buttons too, since they're document specific.\n    this.#editorModeChanged({ mode: AnnotationEditorType.DISABLE });\n  }\n\n  #bindListeners(buttons) {\n    const { eventBus } = this;\n    const {\n      editorHighlightColorPicker,\n      editorHighlightButton,\n      pageNumber,\n      scaleSelect,\n    } = this.#opts;\n    const self = this;\n\n    // The buttons within the toolbar.\n    for (const { element, eventName, eventDetails, telemetry } of buttons) {\n      element.addEventListener(\"click\", evt => {\n        if (eventName !== null) {\n          eventBus.dispatch(eventName, {\n            source: this,\n            ...eventDetails,\n            // evt.detail is the number of clicks.\n            isFromKeyboard: evt.detail === 0,\n          });\n        }\n        if (telemetry) {\n          eventBus.dispatch(\"reporttelemetry\", {\n            source: this,\n            details: telemetry,\n          });\n        }\n      });\n    }\n    // The non-button elements within the toolbar.\n    pageNumber.addEventListener(\"click\", function () {\n      this.select();\n    });\n    pageNumber.addEventListener(\"change\", function () {\n      eventBus.dispatch(\"pagenumberchanged\", {\n        source: self,\n        value: this.value,\n      });\n    });\n\n    scaleSelect.addEventListener(\"change\", function () {\n      if (this.value === \"custom\") {\n        return;\n      }\n      eventBus.dispatch(\"scalechanged\", {\n        source: self,\n        value: this.value,\n      });\n    });\n    // Here we depend on browsers dispatching the \"click\" event *after* the\n    // \"change\" event, when the <select>-element changes.\n    scaleSelect.addEventListener(\"click\", function ({ target }) {\n      // Remove focus when an <option>-element was *clicked*, to improve the UX\n      // for mouse users (fixes bug 1300525 and issue 4923).\n      if (\n        this.value === self.pageScaleValue &&\n        target.tagName.toUpperCase() === \"OPTION\"\n      ) {\n        this.blur();\n      }\n    });\n    // Suppress context menus for some controls.\n    scaleSelect.oncontextmenu = noContextMenu;\n\n    eventBus._on(\n      \"annotationeditormodechanged\",\n      this.#editorModeChanged.bind(this)\n    );\n    eventBus._on(\"showannotationeditorui\", ({ mode }) => {\n      switch (mode) {\n        case AnnotationEditorType.HIGHLIGHT:\n          editorHighlightButton.click();\n          break;\n      }\n    });\n    eventBus._on(\"toolbardensity\", this.#updateToolbarDensity.bind(this));\n\n    if (editorHighlightColorPicker) {\n      eventBus._on(\n        \"annotationeditoruimanager\",\n        ({ uiManager }) => {\n          this.#setAnnotationEditorUIManager(\n            uiManager,\n            editorHighlightColorPicker\n          );\n        },\n        // Once the color picker has been added, we don't want to add it again.\n        { once: true }\n      );\n    }\n  }\n\n  #editorModeChanged({ mode }) {\n    const {\n      editorFreeTextButton,\n      editorFreeTextParamsToolbar,\n      editorHighlightButton,\n      editorHighlightParamsToolbar,\n      editorInkButton,\n      editorInkParamsToolbar,\n      editorStampButton,\n      editorStampParamsToolbar,\n    } = this.#opts;\n\n    toggleExpandedBtn(\n      editorFreeTextButton,\n      mode === AnnotationEditorType.FREETEXT,\n      editorFreeTextParamsToolbar\n    );\n    toggleExpandedBtn(\n      editorHighlightButton,\n      mode === AnnotationEditorType.HIGHLIGHT,\n      editorHighlightParamsToolbar\n    );\n    toggleExpandedBtn(\n      editorInkButton,\n      mode === AnnotationEditorType.INK,\n      editorInkParamsToolbar\n    );\n    toggleExpandedBtn(\n      editorStampButton,\n      mode === AnnotationEditorType.STAMP,\n      editorStampParamsToolbar\n    );\n\n    const isDisable = mode === AnnotationEditorType.DISABLE;\n    editorFreeTextButton.disabled = isDisable;\n    editorHighlightButton.disabled = isDisable;\n    editorInkButton.disabled = isDisable;\n    editorStampButton.disabled = isDisable;\n  }\n\n  #updateUIState(resetNumPages = false) {\n    const { pageNumber, pagesCount, pageScaleValue, pageScale } = this;\n    const opts = this.#opts;\n\n    if (resetNumPages) {\n      if (this.hasPageLabels) {\n        opts.pageNumber.type = \"text\";\n\n        opts.numPages.setAttribute(\"data-l10n-id\", \"pdfjs-page-of-pages\");\n      } else {\n        opts.pageNumber.type = \"number\";\n\n        opts.numPages.setAttribute(\"data-l10n-id\", \"pdfjs-of-pages\");\n        opts.numPages.setAttribute(\n          \"data-l10n-args\",\n          JSON.stringify({ pagesCount })\n        );\n      }\n      opts.pageNumber.max = pagesCount;\n    }\n\n    if (this.hasPageLabels) {\n      opts.pageNumber.value = this.pageLabel;\n\n      opts.numPages.setAttribute(\n        \"data-l10n-args\",\n        JSON.stringify({ pageNumber, pagesCount })\n      );\n    } else {\n      opts.pageNumber.value = pageNumber;\n    }\n\n    opts.previous.disabled = pageNumber <= 1;\n    opts.next.disabled = pageNumber >= pagesCount;\n\n    opts.zoomOut.disabled = pageScale <= MIN_SCALE;\n    opts.zoomIn.disabled = pageScale >= MAX_SCALE;\n\n    let predefinedValueFound = false;\n    for (const option of opts.scaleSelect.options) {\n      if (option.value !== pageScaleValue) {\n        option.selected = false;\n        continue;\n      }\n      option.selected = true;\n      predefinedValueFound = true;\n    }\n    if (!predefinedValueFound) {\n      opts.customScaleOption.selected = true;\n      opts.customScaleOption.setAttribute(\n        \"data-l10n-args\",\n        JSON.stringify({\n          scale: Math.round(pageScale * 10000) / 100,\n        })\n      );\n    }\n  }\n\n  updateLoadingIndicatorState(loading = false) {\n    const { pageNumber } = this.#opts;\n    pageNumber.classList.toggle(\"loading\", loading);\n  }\n}\n\nexport { Toolbar };\n","/* Copyright 2012 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nconst DEFAULT_VIEW_HISTORY_CACHE_SIZE = 20;\n\n/**\n * View History - This is a utility for saving various view parameters for\n *                recently opened files.\n *\n * The way that the view parameters are stored depends on how PDF.js is built,\n * for 'gulp <flag>' the following cases exist:\n *  - MOZCENTRAL        - uses sessionStorage.\n *  - GENERIC or CHROME - uses localStorage, if it is available.\n */\nclass ViewHistory {\n  constructor(fingerprint, cacheSize = DEFAULT_VIEW_HISTORY_CACHE_SIZE) {\n    this.fingerprint = fingerprint;\n    this.cacheSize = cacheSize;\n\n    this._initializedPromise = this._readFromStorage().then(databaseStr => {\n      const database = JSON.parse(databaseStr || \"{}\");\n      let index = -1;\n      if (!Array.isArray(database.files)) {\n        database.files = [];\n      } else {\n        while (database.files.length >= this.cacheSize) {\n          database.files.shift();\n        }\n\n        for (let i = 0, ii = database.files.length; i < ii; i++) {\n          const branch = database.files[i];\n          if (branch.fingerprint === this.fingerprint) {\n            index = i;\n            break;\n          }\n        }\n      }\n      if (index === -1) {\n        index = database.files.push({ fingerprint: this.fingerprint }) - 1;\n      }\n      this.file = database.files[index];\n      this.database = database;\n    });\n  }\n\n  async _writeToStorage() {\n    const databaseStr = JSON.stringify(this.database);\n\n    if (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")) {\n      sessionStorage.setItem(\"pdfjs.history\", databaseStr);\n      return;\n    }\n    localStorage.setItem(\"pdfjs.history\", databaseStr);\n  }\n\n  async _readFromStorage() {\n    if (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")) {\n      return sessionStorage.getItem(\"pdfjs.history\");\n    }\n    return localStorage.getItem(\"pdfjs.history\");\n  }\n\n  async set(name, val) {\n    await this._initializedPromise;\n    this.file[name] = val;\n    return this._writeToStorage();\n  }\n\n  async setMultiple(properties) {\n    await this._initializedPromise;\n    for (const name in properties) {\n      this.file[name] = properties[name];\n    }\n    return this._writeToStorage();\n  }\n\n  async get(name, defaultValue) {\n    await this._initializedPromise;\n    const val = this.file[name];\n    return val !== undefined ? val : defaultValue;\n  }\n\n  async getMultiple(properties) {\n    await this._initializedPromise;\n    const values = Object.create(null);\n\n    for (const name in properties) {\n      const val = this.file[name];\n      values[name] = val !== undefined ? val : properties[name];\n    }\n    return values;\n  }\n}\n\nexport { ViewHistory };\n","/* Copyright 2012 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/** @typedef {import(\"./interfaces.js\").IL10n} IL10n */\n// eslint-disable-next-line max-len\n/** @typedef {import(\"../src/display/api.js\").PDFDocumentProxy} PDFDocumentProxy */\n// eslint-disable-next-line max-len\n/** @typedef {import(\"../src/display/api.js\").PDFDocumentLoadingTask} PDFDocumentLoadingTask */\n\nimport {\n  animationStarted,\n  apiPageLayoutToViewerModes,\n  apiPageModeToSidebarView,\n  AutoPrintRegExp,\n  CursorTool,\n  DEFAULT_SCALE_VALUE,\n  getActiveOrFocusedElement,\n  isValidRotation,\n  isValidScrollMode,\n  isValidSpreadMode,\n  normalizeWheelEventDirection,\n  parseQueryString,\n  ProgressBar,\n  RenderingStates,\n  ScrollMode,\n  SidebarView,\n  SpreadMode,\n  TextLayerMode,\n} from \"./ui_utils.js\";\nimport {\n  AnnotationEditorType,\n  build,\n  FeatureTest,\n  getDocument,\n  getFilenameFromUrl,\n  getPdfFilenameFromUrl,\n  GlobalWorkerOptions,\n  InvalidPDFException,\n  isDataScheme,\n  isPdfFile,\n  MissingPDFException,\n  PDFWorker,\n  shadow,\n  UnexpectedResponseException,\n  version,\n} from \"pdfjs-lib\";\nimport { AppOptions, OptionKind } from \"./app_options.js\";\nimport { EventBus, FirefoxEventBus } from \"./event_utils.js\";\nimport { ExternalServices, initCom, MLManager } from \"web-external_services\";\nimport {\n  ImageAltTextSettings,\n  NewAltTextManager,\n} from \"web-new_alt_text_manager\";\nimport { LinkTarget, PDFLinkService } from \"./pdf_link_service.js\";\nimport { AltTextManager } from \"web-alt_text_manager\";\nimport { AnnotationEditorParams } from \"web-annotation_editor_params\";\nimport { CaretBrowsingMode } from \"./caret_browsing.js\";\nimport { DownloadManager } from \"web-download_manager\";\nimport { OverlayManager } from \"./overlay_manager.js\";\nimport { PasswordPrompt } from \"./password_prompt.js\";\nimport { PDFAttachmentViewer } from \"web-pdf_attachment_viewer\";\nimport { PDFCursorTools } from \"web-pdf_cursor_tools\";\nimport { PDFDocumentProperties } from \"web-pdf_document_properties\";\nimport { PDFFindBar } from \"web-pdf_find_bar\";\nimport { PDFFindController } from \"./pdf_find_controller.js\";\nimport { PDFHistory } from \"./pdf_history.js\";\nimport { PDFLayerViewer } from \"web-pdf_layer_viewer\";\nimport { PDFOutlineViewer } from \"web-pdf_outline_viewer\";\nimport { PDFPresentationMode } from \"web-pdf_presentation_mode\";\nimport { PDFPrintServiceFactory } from \"web-print_service\";\nimport { PDFRenderingQueue } from \"./pdf_rendering_queue.js\";\nimport { PDFScriptingManager } from \"./pdf_scripting_manager.js\";\nimport { PDFSidebar } from \"web-pdf_sidebar\";\nimport { PDFThumbnailViewer } from \"web-pdf_thumbnail_viewer\";\nimport { PDFViewer } from \"./pdf_viewer.js\";\nimport { Preferences } from \"web-preferences\";\nimport { SecondaryToolbar } from \"web-secondary_toolbar\";\nimport { Toolbar } from \"web-toolbar\";\nimport { ViewHistory } from \"./view_history.js\";\n\nconst FORCE_PAGES_LOADED_TIMEOUT = 10000; // ms\n\nconst ViewOnLoad = {\n  UNKNOWN: -1,\n  PREVIOUS: 0, // Default value.\n  INITIAL: 1,\n};\n\nconst PDFViewerApplication = {\n  initialBookmark: document.location.hash.substring(1),\n  _initializedCapability: {\n    ...Promise.withResolvers(),\n    settled: false,\n  },\n  appConfig: null,\n  /** @type {PDFDocumentProxy} */\n  pdfDocument: null,\n  /** @type {PDFDocumentLoadingTask} */\n  pdfLoadingTask: null,\n  printService: null,\n  /** @type {PDFViewer} */\n  pdfViewer: null,\n  /** @type {PDFThumbnailViewer} */\n  pdfThumbnailViewer: null,\n  /** @type {PDFRenderingQueue} */\n  pdfRenderingQueue: null,\n  /** @type {PDFPresentationMode} */\n  pdfPresentationMode: null,\n  /** @type {PDFDocumentProperties} */\n  pdfDocumentProperties: null,\n  /** @type {PDFLinkService} */\n  pdfLinkService: null,\n  /** @type {PDFHistory} */\n  pdfHistory: null,\n  /** @type {PDFSidebar} */\n  pdfSidebar: null,\n  /** @type {PDFOutlineViewer} */\n  pdfOutlineViewer: null,\n  /** @type {PDFAttachmentViewer} */\n  pdfAttachmentViewer: null,\n  /** @type {PDFLayerViewer} */\n  pdfLayerViewer: null,\n  /** @type {PDFCursorTools} */\n  pdfCursorTools: null,\n  /** @type {PDFScriptingManager} */\n  pdfScriptingManager: null,\n  /** @type {ViewHistory} */\n  store: null,\n  /** @type {DownloadManager} */\n  downloadManager: null,\n  /** @type {OverlayManager} */\n  overlayManager: null,\n  /** @type {Preferences} */\n  preferences: new Preferences(),\n  /** @type {Toolbar} */\n  toolbar: null,\n  /** @type {SecondaryToolbar} */\n  secondaryToolbar: null,\n  /** @type {EventBus} */\n  eventBus: null,\n  /** @type {IL10n} */\n  l10n: null,\n  /** @type {AnnotationEditorParams} */\n  annotationEditorParams: null,\n  /** @type {ImageAltTextSettings} */\n  imageAltTextSettings: null,\n  isInitialViewSet: false,\n  isViewerEmbedded: window.parent !== window,\n  url: \"\",\n  baseUrl: \"\",\n  mlManager: null,\n  _downloadUrl: \"\",\n  _eventBusAbortController: null,\n  _windowAbortController: null,\n  _globalAbortController: new AbortController(),\n  documentInfo: null,\n  metadata: null,\n  _contentDispositionFilename: null,\n  _contentLength: null,\n  _saveInProgress: false,\n  _wheelUnusedTicks: 0,\n  _wheelUnusedFactor: 1,\n  _touchUnusedTicks: 0,\n  _touchUnusedFactor: 1,\n  _PDFBug: null,\n  _hasAnnotationEditors: false,\n  _title: document.title,\n  _printAnnotationStoragePromise: null,\n  _touchInfo: null,\n  _isCtrlKeyDown: false,\n  _caretBrowsing: null,\n  _isScrolling: false,\n\n  // Called once when the document is loaded.\n  async initialize(appConfig) {\n    this.appConfig = appConfig;\n\n    // Ensure that `Preferences`, and indirectly `AppOptions`, have initialized\n    // before creating e.g. the various viewer components.\n    try {\n      await this.preferences.initializedPromise;\n    } catch (ex) {\n      console.error(`initialize: \"${ex.message}\".`);\n    }\n    if (AppOptions.get(\"pdfBugEnabled\")) {\n      await this._parseHashParams();\n    }\n\n    if (typeof PDFJSDev === \"undefined\" || !PDFJSDev.test(\"MOZCENTRAL\")) {\n      let mode;\n      switch (AppOptions.get(\"viewerCssTheme\")) {\n        case 1:\n          mode = \"is-light\";\n          break;\n        case 2:\n          mode = \"is-dark\";\n          break;\n      }\n      if (mode) {\n        document.documentElement.classList.add(mode);\n      }\n      if (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"TESTING\")) {\n        if (AppOptions.get(\"enableFakeMLManager\")) {\n          this.mlManager =\n            MLManager.getFakeMLManager?.({\n              enableGuessAltText: AppOptions.get(\"enableGuessAltText\"),\n              enableAltTextModelDownload: AppOptions.get(\n                \"enableAltTextModelDownload\"\n              ),\n            }) || null;\n        }\n      }\n    } else if (AppOptions.get(\"enableAltText\")) {\n      // We want to load the image-to-text AI engine as soon as possible.\n      this.mlManager = new MLManager({\n        enableGuessAltText: AppOptions.get(\"enableGuessAltText\"),\n        enableAltTextModelDownload: AppOptions.get(\n          \"enableAltTextModelDownload\"\n        ),\n        altTextLearnMoreUrl: AppOptions.get(\"altTextLearnMoreUrl\"),\n      });\n    }\n\n    // Ensure that the `L10n`-instance has been initialized before creating\n    // e.g. the various viewer components.\n    this.l10n = await this.externalServices.createL10n();\n    document.getElementsByTagName(\"html\")[0].dir = this.l10n.getDirection();\n    // Connect Fluent, when necessary, and translate what we already have.\n    if (typeof PDFJSDev === \"undefined\" || !PDFJSDev.test(\"MOZCENTRAL\")) {\n      this.l10n.translate(appConfig.appContainer || document.documentElement);\n    }\n\n    if (\n      this.isViewerEmbedded &&\n      AppOptions.get(\"externalLinkTarget\") === LinkTarget.NONE\n    ) {\n      // Prevent external links from \"replacing\" the viewer,\n      // when it's embedded in e.g. an <iframe> or an <object>.\n      AppOptions.set(\"externalLinkTarget\", LinkTarget.TOP);\n    }\n    await this._initializeViewerComponents();\n\n    // Bind the various event handlers *after* the viewer has been\n    // initialized, to prevent errors if an event arrives too soon.\n    this.bindEvents();\n    this.bindWindowEvents();\n\n    this._initializedCapability.settled = true;\n    this._initializedCapability.resolve();\n  },\n\n  /**\n   * Potentially parse special debugging flags in the hash section of the URL.\n   * @private\n   */\n  async _parseHashParams() {\n    const hash = document.location.hash.substring(1);\n    if (!hash) {\n      return;\n    }\n    const { mainContainer, viewerContainer } = this.appConfig,\n      params = parseQueryString(hash);\n\n    const loadPDFBug = async () => {\n      if (this._PDFBug) {\n        return;\n      }\n      const { PDFBug } =\n        typeof PDFJSDev === \"undefined\"\n          ? await import(AppOptions.get(\"debuggerSrc\")) // eslint-disable-line no-unsanitized/method\n          : await __non_webpack_import__(AppOptions.get(\"debuggerSrc\"));\n\n      this._PDFBug = PDFBug;\n    };\n\n    // Parameters that need to be handled manually.\n    if (params.get(\"disableworker\") === \"true\") {\n      try {\n        GlobalWorkerOptions.workerSrc ||= AppOptions.get(\"workerSrc\");\n\n        if (typeof PDFJSDev === \"undefined\") {\n          globalThis.pdfjsWorker = await import(\"pdfjs/pdf.worker.js\");\n        } else {\n          await __non_webpack_import__(PDFWorker.workerSrc);\n        }\n      } catch (ex) {\n        console.error(`_parseHashParams: \"${ex.message}\".`);\n      }\n    }\n    if (params.has(\"textlayer\")) {\n      switch (params.get(\"textlayer\")) {\n        case \"off\":\n          AppOptions.set(\"textLayerMode\", TextLayerMode.DISABLE);\n          break;\n        case \"visible\":\n        case \"shadow\":\n        case \"hover\":\n          viewerContainer.classList.add(`textLayer-${params.get(\"textlayer\")}`);\n          try {\n            await loadPDFBug();\n            this._PDFBug.loadCSS();\n          } catch (ex) {\n            console.error(`_parseHashParams: \"${ex.message}\".`);\n          }\n          break;\n      }\n    }\n    if (params.has(\"pdfbug\")) {\n      AppOptions.setAll({ pdfBug: true, fontExtraProperties: true });\n\n      const enabled = params.get(\"pdfbug\").split(\",\");\n      try {\n        await loadPDFBug();\n        this._PDFBug.init(mainContainer, enabled);\n      } catch (ex) {\n        console.error(`_parseHashParams: \"${ex.message}\".`);\n      }\n    }\n    // It is not possible to change locale for the (various) extension builds.\n    if (\n      (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"GENERIC\")) &&\n      params.has(\"locale\")\n    ) {\n      AppOptions.set(\"localeProperties\", { lang: params.get(\"locale\") });\n    }\n\n    // Parameters that can be handled automatically.\n    const opts = {\n      disableAutoFetch: x => x === \"true\",\n      disableFontFace: x => x === \"true\",\n      disableHistory: x => x === \"true\",\n      disableRange: x => x === \"true\",\n      disableStream: x => x === \"true\",\n      verbosity: x => x | 0,\n    };\n\n    // Set some specific preferences for tests.\n    if (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"TESTING\")) {\n      Object.assign(opts, {\n        enableAltText: x => x === \"true\",\n        enableFakeMLManager: x => x === \"true\",\n        enableGuessAltText: x => x === \"true\",\n        enableUpdatedAddImage: x => x === \"true\",\n        highlightEditorColors: x => x,\n        maxCanvasPixels: x => parseInt(x),\n        spreadModeOnLoad: x => parseInt(x),\n        supportsCaretBrowsingMode: x => x === \"true\",\n      });\n    }\n\n    for (const name in opts) {\n      const check = opts[name],\n        key = name.toLowerCase();\n\n      if (params.has(key)) {\n        AppOptions.set(name, check(params.get(key)));\n      }\n    }\n  },\n\n  /**\n   * @private\n   */\n  async _initializeViewerComponents() {\n    const { appConfig, externalServices, l10n } = this;\n\n    const eventBus =\n      typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")\n        ? new FirefoxEventBus(\n            AppOptions.get(\"allowedGlobalEvents\"),\n            externalServices,\n            AppOptions.get(\"isInAutomation\")\n          )\n        : new EventBus();\n    this.eventBus = AppOptions.eventBus = eventBus;\n    this.mlManager?.setEventBus(eventBus, this._globalAbortController.signal);\n\n    this.overlayManager = new OverlayManager();\n\n    const pdfRenderingQueue = new PDFRenderingQueue();\n    pdfRenderingQueue.onIdle = this._cleanup.bind(this);\n    this.pdfRenderingQueue = pdfRenderingQueue;\n\n    const pdfLinkService = new PDFLinkService({\n      eventBus,\n      externalLinkTarget: AppOptions.get(\"externalLinkTarget\"),\n      externalLinkRel: AppOptions.get(\"externalLinkRel\"),\n      ignoreDestinationZoom: AppOptions.get(\"ignoreDestinationZoom\"),\n    });\n    this.pdfLinkService = pdfLinkService;\n\n    const downloadManager = (this.downloadManager = new DownloadManager());\n\n    const findController = new PDFFindController({\n      linkService: pdfLinkService,\n      eventBus,\n      updateMatchesCountOnProgress:\n        typeof PDFJSDev === \"undefined\"\n          ? !window.isGECKOVIEW\n          : !PDFJSDev.test(\"GECKOVIEW\"),\n    });\n    this.findController = findController;\n\n    const pdfScriptingManager = new PDFScriptingManager({\n      eventBus,\n      externalServices,\n      docProperties: this._scriptingDocProperties.bind(this),\n    });\n    this.pdfScriptingManager = pdfScriptingManager;\n\n    const container = appConfig.mainContainer,\n      viewer = appConfig.viewerContainer;\n    const annotationEditorMode = AppOptions.get(\"annotationEditorMode\");\n    const pageColors =\n      AppOptions.get(\"forcePageColors\") ||\n      window.matchMedia(\"(forced-colors: active)\").matches\n        ? {\n            background: AppOptions.get(\"pageColorsBackground\"),\n            foreground: AppOptions.get(\"pageColorsForeground\"),\n          }\n        : null;\n    let altTextManager;\n    if (AppOptions.get(\"enableUpdatedAddImage\")) {\n      altTextManager = appConfig.newAltTextDialog\n        ? new NewAltTextManager(\n            appConfig.newAltTextDialog,\n            this.overlayManager,\n            eventBus\n          )\n        : null;\n    } else {\n      altTextManager = appConfig.altTextDialog\n        ? new AltTextManager(\n            appConfig.altTextDialog,\n            container,\n            this.overlayManager,\n            eventBus\n          )\n        : null;\n    }\n\n    const enableHWA = AppOptions.get(\"enableHWA\");\n    const pdfViewer = new PDFViewer({\n      container,\n      viewer,\n      eventBus,\n      renderingQueue: pdfRenderingQueue,\n      linkService: pdfLinkService,\n      downloadManager,\n      altTextManager,\n      findController,\n      scriptingManager:\n        AppOptions.get(\"enableScripting\") && pdfScriptingManager,\n      l10n,\n      textLayerMode: AppOptions.get(\"textLayerMode\"),\n      annotationMode: AppOptions.get(\"annotationMode\"),\n      annotationEditorMode,\n      annotationEditorHighlightColors: AppOptions.get(\"highlightEditorColors\"),\n      enableHighlightFloatingButton: AppOptions.get(\n        \"enableHighlightFloatingButton\"\n      ),\n      enableUpdatedAddImage: AppOptions.get(\"enableUpdatedAddImage\"),\n      enableNewAltTextWhenAddingImage: AppOptions.get(\n        \"enableNewAltTextWhenAddingImage\"\n      ),\n      imageResourcesPath: AppOptions.get(\"imageResourcesPath\"),\n      enablePrintAutoRotate: AppOptions.get(\"enablePrintAutoRotate\"),\n      maxCanvasPixels: AppOptions.get(\"maxCanvasPixels\"),\n      enablePermissions: AppOptions.get(\"enablePermissions\"),\n      pageColors,\n      mlManager: this.mlManager,\n      abortSignal: this._globalAbortController.signal,\n      enableHWA,\n    });\n    this.pdfViewer = pdfViewer;\n\n    pdfRenderingQueue.setViewer(pdfViewer);\n    pdfLinkService.setViewer(pdfViewer);\n    pdfScriptingManager.setViewer(pdfViewer);\n\n    if (appConfig.sidebar?.thumbnailView) {\n      this.pdfThumbnailViewer = new PDFThumbnailViewer({\n        container: appConfig.sidebar.thumbnailView,\n        eventBus,\n        renderingQueue: pdfRenderingQueue,\n        linkService: pdfLinkService,\n        pageColors,\n        abortSignal: this._globalAbortController.signal,\n        enableHWA,\n      });\n      pdfRenderingQueue.setThumbnailViewer(this.pdfThumbnailViewer);\n    }\n\n    // The browsing history is only enabled when the viewer is standalone,\n    // i.e. not when it is embedded in a web page.\n    if (!this.isViewerEmbedded && !AppOptions.get(\"disableHistory\")) {\n      this.pdfHistory = new PDFHistory({\n        linkService: pdfLinkService,\n        eventBus,\n      });\n      pdfLinkService.setHistory(this.pdfHistory);\n    }\n\n    if (!this.supportsIntegratedFind && appConfig.findBar) {\n      this.findBar = new PDFFindBar(\n        appConfig.findBar,\n        appConfig.principalContainer,\n        eventBus\n      );\n    }\n\n    if (appConfig.annotationEditorParams) {\n      if (\n        ((typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")) ||\n          typeof AbortSignal.any === \"function\") &&\n        annotationEditorMode !== AnnotationEditorType.DISABLE\n      ) {\n        this.annotationEditorParams = new AnnotationEditorParams(\n          appConfig.annotationEditorParams,\n          eventBus\n        );\n      } else {\n        for (const id of [\"editorModeButtons\", \"editorModeSeparator\"]) {\n          document.getElementById(id)?.classList.add(\"hidden\");\n        }\n      }\n    }\n\n    if (\n      this.mlManager &&\n      appConfig.secondaryToolbar?.imageAltTextSettingsButton\n    ) {\n      this.imageAltTextSettings = new ImageAltTextSettings(\n        appConfig.altTextSettingsDialog,\n        this.overlayManager,\n        eventBus,\n        this.mlManager\n      );\n    }\n\n    if (appConfig.documentProperties) {\n      this.pdfDocumentProperties = new PDFDocumentProperties(\n        appConfig.documentProperties,\n        this.overlayManager,\n        eventBus,\n        l10n,\n        /* fileNameLookup = */ () => this._docFilename\n      );\n    }\n\n    // NOTE: The cursor-tools are unlikely to be helpful/useful in GeckoView,\n    // in particular the `HandTool` which basically simulates touch scrolling.\n    if (appConfig.secondaryToolbar?.cursorHandToolButton) {\n      this.pdfCursorTools = new PDFCursorTools({\n        container,\n        eventBus,\n        cursorToolOnLoad: AppOptions.get(\"cursorToolOnLoad\"),\n      });\n    }\n\n    if (appConfig.toolbar) {\n      if (\n        typeof PDFJSDev === \"undefined\"\n          ? window.isGECKOVIEW\n          : PDFJSDev.test(\"GECKOVIEW\")\n      ) {\n        const nimbusData = JSON.parse(\n          AppOptions.get(\"nimbusDataStr\") || \"null\"\n        );\n        this.toolbar = new Toolbar(appConfig.toolbar, eventBus, nimbusData);\n      } else {\n        this.toolbar = new Toolbar(\n          appConfig.toolbar,\n          eventBus,\n          AppOptions.get(\"toolbarDensity\")\n        );\n      }\n    }\n\n    if (appConfig.secondaryToolbar) {\n      if (AppOptions.get(\"enableAltText\")) {\n        appConfig.secondaryToolbar.imageAltTextSettingsButton?.classList.remove(\n          \"hidden\"\n        );\n        appConfig.secondaryToolbar.imageAltTextSettingsSeparator?.classList.remove(\n          \"hidden\"\n        );\n      }\n\n      this.secondaryToolbar = new SecondaryToolbar(\n        appConfig.secondaryToolbar,\n        eventBus\n      );\n    }\n\n    if (\n      this.supportsFullscreen &&\n      appConfig.secondaryToolbar?.presentationModeButton\n    ) {\n      this.pdfPresentationMode = new PDFPresentationMode({\n        container,\n        pdfViewer,\n        eventBus,\n      });\n    }\n\n    if (appConfig.passwordOverlay) {\n      this.passwordPrompt = new PasswordPrompt(\n        appConfig.passwordOverlay,\n        this.overlayManager,\n        this.isViewerEmbedded\n      );\n    }\n\n    if (appConfig.sidebar?.outlineView) {\n      this.pdfOutlineViewer = new PDFOutlineViewer({\n        container: appConfig.sidebar.outlineView,\n        eventBus,\n        l10n,\n        linkService: pdfLinkService,\n        downloadManager,\n      });\n    }\n\n    if (appConfig.sidebar?.attachmentsView) {\n      this.pdfAttachmentViewer = new PDFAttachmentViewer({\n        container: appConfig.sidebar.attachmentsView,\n        eventBus,\n        l10n,\n        downloadManager,\n      });\n    }\n\n    if (appConfig.sidebar?.layersView) {\n      this.pdfLayerViewer = new PDFLayerViewer({\n        container: appConfig.sidebar.layersView,\n        eventBus,\n        l10n,\n      });\n    }\n\n    if (appConfig.sidebar) {\n      this.pdfSidebar = new PDFSidebar({\n        elements: appConfig.sidebar,\n        eventBus,\n        l10n,\n      });\n      this.pdfSidebar.onToggled = this.forceRendering.bind(this);\n      this.pdfSidebar.onUpdateThumbnails = () => {\n        // Use the rendered pages to set the corresponding thumbnail images.\n        for (const pageView of pdfViewer.getCachedPageViews()) {\n          if (pageView.renderingState === RenderingStates.FINISHED) {\n            this.pdfThumbnailViewer\n              .getThumbnail(pageView.id - 1)\n              ?.setImage(pageView);\n          }\n        }\n        this.pdfThumbnailViewer.scrollThumbnailIntoView(\n          pdfViewer.currentPageNumber\n        );\n      };\n    }\n  },\n\n  async run(config) {\n    await this.initialize(config);\n\n    const { appConfig, eventBus } = this;\n    let file;\n    if (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"GENERIC\")) {\n      const queryString = document.location.search.substring(1);\n      const params = parseQueryString(queryString);\n      file = params.get(\"file\") ?? AppOptions.get(\"defaultUrl\");\n      validateFileURL(file);\n    } else if (PDFJSDev.test(\"MOZCENTRAL\")) {\n      file = window.location.href;\n    } else if (PDFJSDev.test(\"CHROME\")) {\n      file = AppOptions.get(\"defaultUrl\");\n    }\n\n    if (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"GENERIC\")) {\n      const fileInput = (this._openFileInput = document.createElement(\"input\"));\n      fileInput.id = \"fileInput\";\n      fileInput.hidden = true;\n      fileInput.type = \"file\";\n      fileInput.value = null;\n      document.body.append(fileInput);\n\n      fileInput.addEventListener(\"change\", function (evt) {\n        const { files } = evt.target;\n        if (!files || files.length === 0) {\n          return;\n        }\n        eventBus.dispatch(\"fileinputchange\", {\n          source: this,\n          fileInput: evt.target,\n        });\n      });\n\n      // Enable dragging-and-dropping a new PDF file onto the viewerContainer.\n      appConfig.mainContainer.addEventListener(\"dragover\", function (evt) {\n        for (const item of evt.dataTransfer.items) {\n          if (item.type === \"application/pdf\") {\n            evt.dataTransfer.dropEffect =\n              evt.dataTransfer.effectAllowed === \"copy\" ? \"copy\" : \"move\";\n            evt.preventDefault();\n            evt.stopPropagation();\n            return;\n          }\n        }\n      });\n      appConfig.mainContainer.addEventListener(\"drop\", function (evt) {\n        if (evt.dataTransfer.files?.[0].type !== \"application/pdf\") {\n          return;\n        }\n        evt.preventDefault();\n        evt.stopPropagation();\n        eventBus.dispatch(\"fileinputchange\", {\n          source: this,\n          fileInput: evt.dataTransfer,\n        });\n      });\n    }\n\n    if (!AppOptions.get(\"supportsDocumentFonts\")) {\n      AppOptions.set(\"disableFontFace\", true);\n      this.l10n.get(\"pdfjs-web-fonts-disabled\").then(msg => {\n        console.warn(msg);\n      });\n    }\n\n    if (!this.supportsPrinting) {\n      appConfig.toolbar?.print?.classList.add(\"hidden\");\n      appConfig.secondaryToolbar?.printButton.classList.add(\"hidden\");\n    }\n\n    if (!this.supportsFullscreen) {\n      appConfig.secondaryToolbar?.presentationModeButton.classList.add(\n        \"hidden\"\n      );\n    }\n\n    if (this.supportsIntegratedFind) {\n      appConfig.findBar?.toggleButton?.classList.add(\"hidden\");\n    }\n\n    if (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"GENERIC\")) {\n      if (file) {\n        this.open({ url: file });\n      } else {\n        this._hideViewBookmark();\n      }\n    } else if (PDFJSDev.test(\"MOZCENTRAL || CHROME\")) {\n      this.setTitleUsingUrl(file, /* downloadUrl = */ file);\n\n      this.externalServices.initPassiveLoading();\n    } else {\n      throw new Error(\"Not implemented: run\");\n    }\n  },\n\n  get externalServices() {\n    return shadow(this, \"externalServices\", new ExternalServices());\n  },\n\n  get initialized() {\n    return this._initializedCapability.settled;\n  },\n\n  get initializedPromise() {\n    return this._initializedCapability.promise;\n  },\n\n  updateZoom(steps, scaleFactor, origin) {\n    if (this.pdfViewer.isInPresentationMode) {\n      return;\n    }\n    this.pdfViewer.updateScale({\n      drawingDelay: AppOptions.get(\"defaultZoomDelay\"),\n      steps,\n      scaleFactor,\n      origin,\n    });\n  },\n\n  zoomIn() {\n    this.updateZoom(1);\n  },\n\n  zoomOut() {\n    this.updateZoom(-1);\n  },\n\n  zoomReset() {\n    if (this.pdfViewer.isInPresentationMode) {\n      return;\n    }\n    this.pdfViewer.currentScaleValue = DEFAULT_SCALE_VALUE;\n  },\n\n  get pagesCount() {\n    return this.pdfDocument ? this.pdfDocument.numPages : 0;\n  },\n\n  get page() {\n    return this.pdfViewer.currentPageNumber;\n  },\n\n  set page(val) {\n    this.pdfViewer.currentPageNumber = val;\n  },\n\n  get supportsPrinting() {\n    return PDFPrintServiceFactory.supportsPrinting;\n  },\n\n  get supportsFullscreen() {\n    return shadow(this, \"supportsFullscreen\", document.fullscreenEnabled);\n  },\n\n  get supportsPinchToZoom() {\n    return shadow(\n      this,\n      \"supportsPinchToZoom\",\n      AppOptions.get(\"supportsPinchToZoom\")\n    );\n  },\n\n  get supportsIntegratedFind() {\n    return shadow(\n      this,\n      \"supportsIntegratedFind\",\n      AppOptions.get(\"supportsIntegratedFind\")\n    );\n  },\n\n  get loadingBar() {\n    const barElement = document.getElementById(\"loadingBar\");\n    const bar = barElement ? new ProgressBar(barElement) : null;\n    return shadow(this, \"loadingBar\", bar);\n  },\n\n  get supportsMouseWheelZoomCtrlKey() {\n    return shadow(\n      this,\n      \"supportsMouseWheelZoomCtrlKey\",\n      AppOptions.get(\"supportsMouseWheelZoomCtrlKey\")\n    );\n  },\n\n  get supportsMouseWheelZoomMetaKey() {\n    return shadow(\n      this,\n      \"supportsMouseWheelZoomMetaKey\",\n      AppOptions.get(\"supportsMouseWheelZoomMetaKey\")\n    );\n  },\n\n  get supportsCaretBrowsingMode() {\n    return AppOptions.get(\"supportsCaretBrowsingMode\");\n  },\n\n  moveCaret(isUp, select) {\n    this._caretBrowsing ||= new CaretBrowsingMode(\n      this._globalAbortController.signal,\n      this.appConfig.mainContainer,\n      this.appConfig.viewerContainer,\n      this.appConfig.toolbar?.container\n    );\n    this._caretBrowsing.moveCaret(isUp, select);\n  },\n\n  setTitleUsingUrl(url = \"\", downloadUrl = null) {\n    this.url = url;\n    this.baseUrl = url.split(\"#\", 1)[0];\n    if (downloadUrl) {\n      this._downloadUrl =\n        downloadUrl === url ? this.baseUrl : downloadUrl.split(\"#\", 1)[0];\n    }\n    if (isDataScheme(url)) {\n      this._hideViewBookmark();\n    } else if (\n      typeof PDFJSDev !== \"undefined\" &&\n      PDFJSDev.test(\"MOZCENTRAL || CHROME\")\n    ) {\n      AppOptions.set(\"docBaseUrl\", this.baseUrl);\n    }\n\n    let title = getPdfFilenameFromUrl(url, \"\");\n    if (!title) {\n      try {\n        title = decodeURIComponent(getFilenameFromUrl(url));\n      } catch {\n        // decodeURIComponent may throw URIError.\n      }\n    }\n    this.setTitle(title || url); // Always fallback to the raw URL.\n  },\n\n  setTitle(title = this._title) {\n    this._title = title;\n\n    if (this.isViewerEmbedded) {\n      // Embedded PDF viewers should not be changing their parent page's title.\n      return;\n    }\n    const editorIndicator =\n      this._hasAnnotationEditors && !this.pdfRenderingQueue.printing;\n    document.title = `${editorIndicator ? \"* \" : \"\"}${title}`;\n  },\n\n  get _docFilename() {\n    // Use `this.url` instead of `this.baseUrl` to perform filename detection\n    // based on the reference fragment as ultimate fallback if needed.\n    return this._contentDispositionFilename || getPdfFilenameFromUrl(this.url);\n  },\n\n  /**\n   * @private\n   */\n  _hideViewBookmark() {\n    const { secondaryToolbar } = this.appConfig;\n    // URL does not reflect proper document location - hiding some buttons.\n    secondaryToolbar?.viewBookmarkButton.classList.add(\"hidden\");\n\n    // Avoid displaying multiple consecutive separators in the secondaryToolbar.\n    if (secondaryToolbar?.presentationModeButton.classList.contains(\"hidden\")) {\n      document.getElementById(\"viewBookmarkSeparator\")?.classList.add(\"hidden\");\n    }\n  },\n\n  /**\n   * Closes opened PDF document.\n   * @returns {Promise} - Returns the promise, which is resolved when all\n   *                      destruction is completed.\n   */\n  async close() {\n    this._unblockDocumentLoadEvent();\n    this._hideViewBookmark();\n\n    if (!this.pdfLoadingTask) {\n      return;\n    }\n    if (\n      (typeof PDFJSDev === \"undefined\" ||\n        PDFJSDev.test(\"GENERIC && !TESTING\")) &&\n      this.pdfDocument?.annotationStorage.size > 0 &&\n      this._annotationStorageModified\n    ) {\n      try {\n        // Trigger saving, to prevent data loss in forms; see issue 12257.\n        await this.save();\n      } catch {\n        // Ignoring errors, to ensure that document closing won't break.\n      }\n    }\n    const promises = [];\n\n    promises.push(this.pdfLoadingTask.destroy());\n    this.pdfLoadingTask = null;\n\n    if (this.pdfDocument) {\n      this.pdfDocument = null;\n\n      this.pdfThumbnailViewer?.setDocument(null);\n      this.pdfViewer.setDocument(null);\n      this.pdfLinkService.setDocument(null);\n      this.pdfDocumentProperties?.setDocument(null);\n    }\n    this.pdfLinkService.externalLinkEnabled = true;\n    this.store = null;\n    this.isInitialViewSet = false;\n    this.url = \"\";\n    this.baseUrl = \"\";\n    this._downloadUrl = \"\";\n    this.documentInfo = null;\n    this.metadata = null;\n    this._contentDispositionFilename = null;\n    this._contentLength = null;\n    this._saveInProgress = false;\n    this._hasAnnotationEditors = false;\n\n    promises.push(\n      this.pdfScriptingManager.destroyPromise,\n      this.passwordPrompt.close()\n    );\n\n    this.setTitle();\n    this.pdfSidebar?.reset();\n    this.pdfOutlineViewer?.reset();\n    this.pdfAttachmentViewer?.reset();\n    this.pdfLayerViewer?.reset();\n\n    this.pdfHistory?.reset();\n    this.findBar?.reset();\n    this.toolbar?.reset();\n    this.secondaryToolbar?.reset();\n    this._PDFBug?.cleanup();\n\n    await Promise.all(promises);\n  },\n\n  /**\n   * Opens a new PDF document.\n   * @param {Object} args - Accepts any/all of the properties from\n   *   {@link DocumentInitParameters}, and also a `originalUrl` string.\n   * @returns {Promise} - Promise that is resolved when the document is opened.\n   */\n  async open(args) {\n    if (this.pdfLoadingTask) {\n      // We need to destroy already opened document.\n      await this.close();\n    }\n    // Set the necessary global worker parameters, using the available options.\n    const workerParams = AppOptions.getAll(OptionKind.WORKER);\n    Object.assign(GlobalWorkerOptions, workerParams);\n\n    if (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")) {\n      if (args.data && isPdfFile(args.filename)) {\n        this._contentDispositionFilename = args.filename;\n      }\n    } else if (args.url) {\n      // The Firefox built-in viewer always calls `setTitleUsingUrl`, before\n      // `initPassiveLoading`, and it never provides an `originalUrl` here.\n      this.setTitleUsingUrl(\n        args.originalUrl || args.url,\n        /* downloadUrl = */ args.url\n      );\n    }\n\n    // Set the necessary API parameters, using all the available options.\n    const apiParams = AppOptions.getAll(OptionKind.API);\n    const loadingTask = getDocument({\n      ...apiParams,\n      ...args,\n    });\n    this.pdfLoadingTask = loadingTask;\n\n    loadingTask.onPassword = (updateCallback, reason) => {\n      if (this.isViewerEmbedded) {\n        // The load event can't be triggered until the password is entered, so\n        // if the viewer is in an iframe and its visibility depends on the\n        // onload callback then the viewer never shows (bug 1801341).\n        this._unblockDocumentLoadEvent();\n      }\n\n      this.pdfLinkService.externalLinkEnabled = false;\n      this.passwordPrompt.setUpdateCallback(updateCallback, reason);\n      this.passwordPrompt.open();\n    };\n\n    loadingTask.onProgress = ({ loaded, total }) => {\n      this.progress(loaded / total);\n    };\n\n    return loadingTask.promise.then(\n      pdfDocument => {\n        this.load(pdfDocument);\n      },\n      reason => {\n        if (loadingTask !== this.pdfLoadingTask) {\n          return undefined; // Ignore errors for previously opened PDF files.\n        }\n\n        let key = \"pdfjs-loading-error\";\n        if (reason instanceof InvalidPDFException) {\n          key = \"pdfjs-invalid-file-error\";\n        } else if (reason instanceof MissingPDFException) {\n          key = \"pdfjs-missing-file-error\";\n        } else if (reason instanceof UnexpectedResponseException) {\n          key = \"pdfjs-unexpected-response-error\";\n        }\n        return this._documentError(key, { message: reason.message }).then(\n          () => {\n            throw reason;\n          }\n        );\n      }\n    );\n  },\n\n  async download() {\n    let data;\n    try {\n      data = await this.pdfDocument.getData();\n    } catch {\n      // When the PDF document isn't ready, simply download using the URL.\n    }\n    this.downloadManager.download(data, this._downloadUrl, this._docFilename);\n  },\n\n  async save() {\n    if (this._saveInProgress) {\n      return;\n    }\n    this._saveInProgress = true;\n    await this.pdfScriptingManager.dispatchWillSave();\n\n    try {\n      const data = await this.pdfDocument.saveDocument();\n      this.downloadManager.download(data, this._downloadUrl, this._docFilename);\n    } catch (reason) {\n      // When the PDF document isn't ready, fallback to a \"regular\" download.\n      console.error(`Error when saving the document: ${reason.message}`);\n      await this.download();\n    } finally {\n      await this.pdfScriptingManager.dispatchDidSave();\n      this._saveInProgress = false;\n    }\n\n    if (this._hasAnnotationEditors) {\n      this.externalServices.reportTelemetry({\n        type: \"editing\",\n        data: {\n          type: \"save\",\n          stats: this.pdfDocument?.annotationStorage.editorStats,\n        },\n      });\n    }\n  },\n\n  async downloadOrSave() {\n    // In the Firefox case, this method MUST always trigger a download.\n    // When the user is closing a modified and unsaved document, we display a\n    // prompt asking for saving or not. In case they save, we must wait for\n    // saving to complete before closing the tab.\n    // So in case this function does not trigger a download, we must trigger a\n    // a message and change PdfjsChild.sys.mjs to take it into account.\n    const { classList } = this.appConfig.appContainer;\n    classList.add(\"wait\");\n    await (this.pdfDocument?.annotationStorage.size > 0\n      ? this.save()\n      : this.download());\n    classList.remove(\"wait\");\n  },\n\n  /**\n   * Report the error; used for errors affecting loading and/or parsing of\n   * the entire PDF document.\n   */\n  async _documentError(key, moreInfo = null) {\n    this._unblockDocumentLoadEvent();\n\n    const message = await this._otherError(\n      key || \"pdfjs-loading-error\",\n      moreInfo\n    );\n\n    this.eventBus.dispatch(\"documenterror\", {\n      source: this,\n      message,\n      reason: moreInfo?.message ?? null,\n    });\n  },\n\n  /**\n   * Report the error; used for errors affecting e.g. only a single page.\n   * @param {string} key - The localization key for the error.\n   * @param {Object} [moreInfo] - Further information about the error that is\n   *                              more technical. Should have a 'message' and\n   *                              optionally a 'stack' property.\n   * @returns {string} A (localized) error message that is human readable.\n   */\n  async _otherError(key, moreInfo = null) {\n    const message = await this.l10n.get(key);\n\n    const moreInfoText = [`PDF.js v${version || \"?\"} (build: ${build || \"?\"})`];\n    if (moreInfo) {\n      moreInfoText.push(`Message: ${moreInfo.message}`);\n\n      if (moreInfo.stack) {\n        moreInfoText.push(`Stack: ${moreInfo.stack}`);\n      } else {\n        if (moreInfo.filename) {\n          moreInfoText.push(`File: ${moreInfo.filename}`);\n        }\n        if (moreInfo.lineNumber) {\n          moreInfoText.push(`Line: ${moreInfo.lineNumber}`);\n        }\n      }\n    }\n\n    console.error(`${message}\\n\\n${moreInfoText.join(\"\\n\")}`);\n    return message;\n  },\n\n  progress(level) {\n    const percent = Math.round(level * 100);\n    // When we transition from full request to range requests, it's possible\n    // that we discard some of the loaded data. This can cause the loading\n    // bar to move backwards. So prevent this by only updating the bar if it\n    // increases.\n    if (!this.loadingBar || percent <= this.loadingBar.percent) {\n      return;\n    }\n    this.loadingBar.percent = percent;\n\n    // When disableAutoFetch is enabled, it's not uncommon for the entire file\n    // to never be fetched (depends on e.g. the file structure). In this case\n    // the loading bar will not be completely filled, nor will it be hidden.\n    // To prevent displaying a partially filled loading bar permanently, we\n    // hide it when no data has been loaded during a certain amount of time.\n    if (\n      this.pdfDocument?.loadingParams.disableAutoFetch ??\n      AppOptions.get(\"disableAutoFetch\")\n    ) {\n      this.loadingBar.setDisableAutoFetch();\n    }\n  },\n\n  load(pdfDocument) {\n    this.pdfDocument = pdfDocument;\n\n    pdfDocument.getDownloadInfo().then(({ length }) => {\n      this._contentLength = length; // Ensure that the correct length is used.\n      this.loadingBar?.hide();\n\n      firstPagePromise.then(() => {\n        this.eventBus.dispatch(\"documentloaded\", { source: this });\n      });\n    });\n\n    // Since the `setInitialView` call below depends on this being resolved,\n    // fetch it early to avoid delaying initial rendering of the PDF document.\n    const pageLayoutPromise = pdfDocument.getPageLayout().catch(() => {\n      /* Avoid breaking initial rendering; ignoring errors. */\n    });\n    const pageModePromise = pdfDocument.getPageMode().catch(() => {\n      /* Avoid breaking initial rendering; ignoring errors. */\n    });\n    const openActionPromise = pdfDocument.getOpenAction().catch(() => {\n      /* Avoid breaking initial rendering; ignoring errors. */\n    });\n\n    this.toolbar?.setPagesCount(pdfDocument.numPages, false);\n    this.secondaryToolbar?.setPagesCount(pdfDocument.numPages);\n\n    if (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"CHROME\")) {\n      const baseUrl = location.href.split(\"#\", 1)[0];\n      // Ignore \"data:\"-URLs for performance reasons, even though it may cause\n      // internal links to not work perfectly in all cases (see bug 1803050).\n      this.pdfLinkService.setDocument(\n        pdfDocument,\n        isDataScheme(baseUrl) ? null : baseUrl\n      );\n    } else {\n      this.pdfLinkService.setDocument(pdfDocument);\n    }\n    this.pdfDocumentProperties?.setDocument(pdfDocument);\n\n    const pdfViewer = this.pdfViewer;\n    pdfViewer.setDocument(pdfDocument);\n    const { firstPagePromise, onePageRendered, pagesPromise } = pdfViewer;\n\n    this.pdfThumbnailViewer?.setDocument(pdfDocument);\n\n    const storedPromise = (this.store = new ViewHistory(\n      pdfDocument.fingerprints[0]\n    ))\n      .getMultiple({\n        page: null,\n        zoom: DEFAULT_SCALE_VALUE,\n        scrollLeft: \"0\",\n        scrollTop: \"0\",\n        rotation: null,\n        sidebarView: SidebarView.UNKNOWN,\n        scrollMode: ScrollMode.UNKNOWN,\n        spreadMode: SpreadMode.UNKNOWN,\n      })\n      .catch(() => {\n        /* Unable to read from storage; ignoring errors. */\n      });\n\n    firstPagePromise.then(pdfPage => {\n      this.loadingBar?.setWidth(this.appConfig.viewerContainer);\n      this._initializeAnnotationStorageCallbacks(pdfDocument);\n\n      Promise.all([\n        animationStarted,\n        storedPromise,\n        pageLayoutPromise,\n        pageModePromise,\n        openActionPromise,\n      ])\n        .then(async ([timeStamp, stored, pageLayout, pageMode, openAction]) => {\n          const viewOnLoad = AppOptions.get(\"viewOnLoad\");\n\n          this._initializePdfHistory({\n            fingerprint: pdfDocument.fingerprints[0],\n            viewOnLoad,\n            initialDest: openAction?.dest,\n          });\n          const initialBookmark = this.initialBookmark;\n\n          // Initialize the default values, from user preferences.\n          const zoom = AppOptions.get(\"defaultZoomValue\");\n          let hash = zoom ? `zoom=${zoom}` : null;\n\n          let rotation = null;\n          let sidebarView = AppOptions.get(\"sidebarViewOnLoad\");\n          let scrollMode = AppOptions.get(\"scrollModeOnLoad\");\n          let spreadMode = AppOptions.get(\"spreadModeOnLoad\");\n\n          if (stored?.page && viewOnLoad !== ViewOnLoad.INITIAL) {\n            hash =\n              `page=${stored.page}&zoom=${zoom || stored.zoom},` +\n              `${stored.scrollLeft},${stored.scrollTop}`;\n\n            rotation = parseInt(stored.rotation, 10);\n            // Always let user preference take precedence over the view history.\n            if (sidebarView === SidebarView.UNKNOWN) {\n              sidebarView = stored.sidebarView | 0;\n            }\n            if (scrollMode === ScrollMode.UNKNOWN) {\n              scrollMode = stored.scrollMode | 0;\n            }\n            if (spreadMode === SpreadMode.UNKNOWN) {\n              spreadMode = stored.spreadMode | 0;\n            }\n          }\n          // Always let the user preference/view history take precedence.\n          if (pageMode && sidebarView === SidebarView.UNKNOWN) {\n            sidebarView = apiPageModeToSidebarView(pageMode);\n          }\n          if (\n            pageLayout &&\n            scrollMode === ScrollMode.UNKNOWN &&\n            spreadMode === SpreadMode.UNKNOWN\n          ) {\n            const modes = apiPageLayoutToViewerModes(pageLayout);\n            // TODO: Try to improve page-switching when using the mouse-wheel\n            // and/or arrow-keys before allowing the document to control this.\n            // scrollMode = modes.scrollMode;\n            spreadMode = modes.spreadMode;\n          }\n\n          this.setInitialView(hash, {\n            rotation,\n            sidebarView,\n            scrollMode,\n            spreadMode,\n          });\n          this.eventBus.dispatch(\"documentinit\", { source: this });\n          // Make all navigation keys work on document load,\n          // unless the viewer is embedded in a web page.\n          if (!this.isViewerEmbedded) {\n            pdfViewer.focus();\n          }\n\n          // For documents with different page sizes, once all pages are\n          // resolved, ensure that the correct location becomes visible on load.\n          // (To reduce the risk, in very large and/or slow loading documents,\n          //  that the location changes *after* the user has started interacting\n          //  with the viewer, wait for either `pagesPromise` or a timeout.)\n          await Promise.race([\n            pagesPromise,\n            new Promise(resolve => {\n              setTimeout(resolve, FORCE_PAGES_LOADED_TIMEOUT);\n            }),\n          ]);\n          if (!initialBookmark && !hash) {\n            return;\n          }\n          if (pdfViewer.hasEqualPageSizes) {\n            return;\n          }\n          this.initialBookmark = initialBookmark;\n\n          // eslint-disable-next-line no-self-assign\n          pdfViewer.currentScaleValue = pdfViewer.currentScaleValue;\n          // Re-apply the initial document location.\n          this.setInitialView(hash);\n        })\n        .catch(() => {\n          // Ensure that the document is always completely initialized,\n          // even if there are any errors thrown above.\n          this.setInitialView();\n        })\n        .then(function () {\n          // At this point, rendering of the initial page(s) should always have\n          // started (and may even have completed).\n          // To prevent any future issues, e.g. the document being completely\n          // blank on load, always trigger rendering here.\n          pdfViewer.update();\n        });\n    });\n\n    pagesPromise.then(\n      () => {\n        this._unblockDocumentLoadEvent();\n\n        this._initializeAutoPrint(pdfDocument, openActionPromise);\n      },\n      reason => {\n        this._documentError(\"pdfjs-loading-error\", { message: reason.message });\n      }\n    );\n\n    onePageRendered.then(data => {\n      this.externalServices.reportTelemetry({\n        type: \"pageInfo\",\n        timestamp: data.timestamp,\n      });\n\n      if (this.pdfOutlineViewer) {\n        pdfDocument.getOutline().then(outline => {\n          if (pdfDocument !== this.pdfDocument) {\n            return; // The document was closed while the outline resolved.\n          }\n          this.pdfOutlineViewer.render({ outline, pdfDocument });\n        });\n      }\n      if (this.pdfAttachmentViewer) {\n        pdfDocument.getAttachments().then(attachments => {\n          if (pdfDocument !== this.pdfDocument) {\n            return; // The document was closed while the attachments resolved.\n          }\n          this.pdfAttachmentViewer.render({ attachments });\n        });\n      }\n      if (this.pdfLayerViewer) {\n        // Ensure that the layers accurately reflects the current state in the\n        // viewer itself, rather than the default state provided by the API.\n        pdfViewer.optionalContentConfigPromise.then(optionalContentConfig => {\n          if (pdfDocument !== this.pdfDocument) {\n            return; // The document was closed while the layers resolved.\n          }\n          this.pdfLayerViewer.render({ optionalContentConfig, pdfDocument });\n        });\n      }\n    });\n\n    this._initializePageLabels(pdfDocument);\n    this._initializeMetadata(pdfDocument);\n  },\n\n  /**\n   * @private\n   */\n  async _scriptingDocProperties(pdfDocument) {\n    if (!this.documentInfo) {\n      // It should be *extremely* rare for metadata to not have been resolved\n      // when this code runs, but ensure that we handle that case here.\n      await new Promise(resolve => {\n        this.eventBus._on(\"metadataloaded\", resolve, { once: true });\n      });\n      if (pdfDocument !== this.pdfDocument) {\n        return null; // The document was closed while the metadata resolved.\n      }\n    }\n    if (!this._contentLength) {\n      // Always waiting for the entire PDF document to be loaded will, most\n      // likely, delay sandbox-creation too much in the general case for all\n      // PDF documents which are not provided as binary data to the API.\n      // Hence we'll simply have to trust that the `contentLength` (as provided\n      // by the server), when it exists, is accurate enough here.\n      await new Promise(resolve => {\n        this.eventBus._on(\"documentloaded\", resolve, { once: true });\n      });\n      if (pdfDocument !== this.pdfDocument) {\n        return null; // The document was closed while the downloadInfo resolved.\n      }\n    }\n\n    return {\n      ...this.documentInfo,\n      baseURL: this.baseUrl,\n      filesize: this._contentLength,\n      filename: this._docFilename,\n      metadata: this.metadata?.getRaw(),\n      authors: this.metadata?.get(\"dc:creator\"),\n      numPages: this.pagesCount,\n      URL: this.url,\n    };\n  },\n\n  /**\n   * @private\n   */\n  async _initializeAutoPrint(pdfDocument, openActionPromise) {\n    const [openAction, jsActions] = await Promise.all([\n      openActionPromise,\n      this.pdfViewer.enableScripting ? null : pdfDocument.getJSActions(),\n    ]);\n\n    if (pdfDocument !== this.pdfDocument) {\n      return; // The document was closed while the auto print data resolved.\n    }\n    let triggerAutoPrint = openAction?.action === \"Print\";\n\n    if (jsActions) {\n      console.warn(\"Warning: JavaScript support is not enabled\");\n\n      // Hack to support auto printing.\n      for (const name in jsActions) {\n        if (triggerAutoPrint) {\n          break;\n        }\n        switch (name) {\n          case \"WillClose\":\n          case \"WillSave\":\n          case \"DidSave\":\n          case \"WillPrint\":\n          case \"DidPrint\":\n            continue;\n        }\n        triggerAutoPrint = jsActions[name].some(js => AutoPrintRegExp.test(js));\n      }\n    }\n\n    if (triggerAutoPrint) {\n      this.triggerPrinting();\n    }\n  },\n\n  /**\n   * @private\n   */\n  async _initializeMetadata(pdfDocument) {\n    const { info, metadata, contentDispositionFilename, contentLength } =\n      await pdfDocument.getMetadata();\n\n    if (pdfDocument !== this.pdfDocument) {\n      return; // The document was closed while the metadata resolved.\n    }\n    this.documentInfo = info;\n    this.metadata = metadata;\n    this._contentDispositionFilename ??= contentDispositionFilename;\n    this._contentLength ??= contentLength; // See `getDownloadInfo`-call above.\n\n    // Provides some basic debug information\n    console.log(\n      `PDF ${pdfDocument.fingerprints[0]} [${info.PDFFormatVersion} ` +\n        `${(info.Producer || \"-\").trim()} / ${(info.Creator || \"-\").trim()}] ` +\n        `(PDF.js: ${version || \"?\"} [${build || \"?\"}])`\n    );\n    let pdfTitle = info.Title;\n\n    const metadataTitle = metadata?.get(\"dc:title\");\n    if (metadataTitle) {\n      // Ghostscript can produce invalid 'dc:title' Metadata entries:\n      //  - The title may be \"Untitled\" (fixes bug 1031612).\n      //  - The title may contain incorrectly encoded characters, which thus\n      //    looks broken, hence we ignore the Metadata entry when it contains\n      //    characters from the Specials Unicode block (fixes bug 1605526).\n      if (\n        metadataTitle !== \"Untitled\" &&\n        !/[\\uFFF0-\\uFFFF]/g.test(metadataTitle)\n      ) {\n        pdfTitle = metadataTitle;\n      }\n    }\n    if (pdfTitle) {\n      this.setTitle(\n        `${pdfTitle} - ${this._contentDispositionFilename || this._title}`\n      );\n    } else if (this._contentDispositionFilename) {\n      this.setTitle(this._contentDispositionFilename);\n    }\n\n    if (\n      info.IsXFAPresent &&\n      !info.IsAcroFormPresent &&\n      !pdfDocument.isPureXfa\n    ) {\n      if (pdfDocument.loadingParams.enableXfa) {\n        console.warn(\"Warning: XFA Foreground documents are not supported\");\n      } else {\n        console.warn(\"Warning: XFA support is not enabled\");\n      }\n    } else if (\n      (info.IsAcroFormPresent || info.IsXFAPresent) &&\n      !this.pdfViewer.renderForms\n    ) {\n      console.warn(\"Warning: Interactive form support is not enabled\");\n    }\n\n    if (info.IsSignaturesPresent) {\n      console.warn(\"Warning: Digital signatures validation is not supported\");\n    }\n\n    this.eventBus.dispatch(\"metadataloaded\", { source: this });\n  },\n\n  /**\n   * @private\n   */\n  async _initializePageLabels(pdfDocument) {\n    if (\n      typeof PDFJSDev === \"undefined\"\n        ? window.isGECKOVIEW\n        : PDFJSDev.test(\"GECKOVIEW\")\n    ) {\n      return;\n    }\n    const labels = await pdfDocument.getPageLabels();\n\n    if (pdfDocument !== this.pdfDocument) {\n      return; // The document was closed while the page labels resolved.\n    }\n    if (!labels || AppOptions.get(\"disablePageLabels\")) {\n      return;\n    }\n    const numLabels = labels.length;\n    // Ignore page labels that correspond to standard page numbering,\n    // or page labels that are all empty.\n    let standardLabels = 0,\n      emptyLabels = 0;\n    for (let i = 0; i < numLabels; i++) {\n      const label = labels[i];\n      if (label === (i + 1).toString()) {\n        standardLabels++;\n      } else if (label === \"\") {\n        emptyLabels++;\n      } else {\n        break;\n      }\n    }\n    if (standardLabels >= numLabels || emptyLabels >= numLabels) {\n      return;\n    }\n    const { pdfViewer, pdfThumbnailViewer, toolbar } = this;\n\n    pdfViewer.setPageLabels(labels);\n    pdfThumbnailViewer?.setPageLabels(labels);\n\n    // Changing toolbar page display to use labels and we need to set\n    // the label of the current page.\n    toolbar?.setPagesCount(numLabels, true);\n    toolbar?.setPageNumber(\n      pdfViewer.currentPageNumber,\n      pdfViewer.currentPageLabel\n    );\n  },\n\n  /**\n   * @private\n   */\n  _initializePdfHistory({ fingerprint, viewOnLoad, initialDest = null }) {\n    if (!this.pdfHistory) {\n      return;\n    }\n    this.pdfHistory.initialize({\n      fingerprint,\n      resetHistory: viewOnLoad === ViewOnLoad.INITIAL,\n      updateUrl: AppOptions.get(\"historyUpdateUrl\"),\n    });\n\n    if (this.pdfHistory.initialBookmark) {\n      this.initialBookmark = this.pdfHistory.initialBookmark;\n\n      this.initialRotation = this.pdfHistory.initialRotation;\n    }\n\n    // Always let the browser history/document hash take precedence.\n    if (\n      initialDest &&\n      !this.initialBookmark &&\n      viewOnLoad === ViewOnLoad.UNKNOWN\n    ) {\n      this.initialBookmark = JSON.stringify(initialDest);\n      // TODO: Re-factor the `PDFHistory` initialization to remove this hack\n      // that's currently necessary to prevent weird initial history state.\n      this.pdfHistory.push({ explicitDest: initialDest, pageNumber: null });\n    }\n  },\n\n  /**\n   * @private\n   */\n  _initializeAnnotationStorageCallbacks(pdfDocument) {\n    if (pdfDocument !== this.pdfDocument) {\n      return;\n    }\n    const { annotationStorage } = pdfDocument;\n\n    annotationStorage.onSetModified = () => {\n      window.addEventListener(\"beforeunload\", beforeUnload);\n\n      if (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"GENERIC\")) {\n        this._annotationStorageModified = true;\n      }\n    };\n    annotationStorage.onResetModified = () => {\n      window.removeEventListener(\"beforeunload\", beforeUnload);\n\n      if (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"GENERIC\")) {\n        delete this._annotationStorageModified;\n      }\n    };\n    annotationStorage.onAnnotationEditor = typeStr => {\n      this._hasAnnotationEditors = !!typeStr;\n      this.setTitle();\n    };\n  },\n\n  setInitialView(\n    storedHash,\n    { rotation, sidebarView, scrollMode, spreadMode } = {}\n  ) {\n    const setRotation = angle => {\n      if (isValidRotation(angle)) {\n        this.pdfViewer.pagesRotation = angle;\n      }\n    };\n    const setViewerModes = (scroll, spread) => {\n      if (isValidScrollMode(scroll)) {\n        this.pdfViewer.scrollMode = scroll;\n      }\n      if (isValidSpreadMode(spread)) {\n        this.pdfViewer.spreadMode = spread;\n      }\n    };\n    this.isInitialViewSet = true;\n    this.pdfSidebar?.setInitialView(sidebarView);\n\n    setViewerModes(scrollMode, spreadMode);\n\n    if (this.initialBookmark) {\n      setRotation(this.initialRotation);\n      delete this.initialRotation;\n\n      this.pdfLinkService.setHash(this.initialBookmark);\n      this.initialBookmark = null;\n    } else if (storedHash) {\n      setRotation(rotation);\n\n      this.pdfLinkService.setHash(storedHash);\n    }\n\n    // Ensure that the correct page number is displayed in the UI,\n    // even if the active page didn't change during document load.\n    this.toolbar?.setPageNumber(\n      this.pdfViewer.currentPageNumber,\n      this.pdfViewer.currentPageLabel\n    );\n    this.secondaryToolbar?.setPageNumber(this.pdfViewer.currentPageNumber);\n\n    if (!this.pdfViewer.currentScaleValue) {\n      // Scale was not initialized: invalid bookmark or scale was not specified.\n      // Setting the default one.\n      this.pdfViewer.currentScaleValue = DEFAULT_SCALE_VALUE;\n    }\n  },\n\n  /**\n   * @private\n   */\n  _cleanup() {\n    if (!this.pdfDocument) {\n      return; // run cleanup when document is loaded\n    }\n    this.pdfViewer.cleanup();\n    this.pdfThumbnailViewer?.cleanup();\n\n    this.pdfDocument.cleanup(\n      /* keepLoadedFonts = */ AppOptions.get(\"fontExtraProperties\")\n    );\n  },\n\n  forceRendering() {\n    this.pdfRenderingQueue.printing = !!this.printService;\n    this.pdfRenderingQueue.isThumbnailViewEnabled =\n      this.pdfSidebar?.visibleView === SidebarView.THUMBS;\n    this.pdfRenderingQueue.renderHighestPriority();\n  },\n\n  beforePrint() {\n    this._printAnnotationStoragePromise = this.pdfScriptingManager\n      .dispatchWillPrint()\n      .catch(() => {\n        /* Avoid breaking printing; ignoring errors. */\n      })\n      .then(() => this.pdfDocument?.annotationStorage.print);\n\n    if (this.printService) {\n      // There is no way to suppress beforePrint/afterPrint events,\n      // but PDFPrintService may generate double events -- this will ignore\n      // the second event that will be coming from native window.print().\n      return;\n    }\n\n    if (!this.supportsPrinting) {\n      this._otherError(\"pdfjs-printing-not-supported\");\n      return;\n    }\n\n    // The beforePrint is a sync method and we need to know layout before\n    // returning from this method. Ensure that we can get sizes of the pages.\n    if (!this.pdfViewer.pageViewsReady) {\n      this.l10n.get(\"pdfjs-printing-not-ready\").then(msg => {\n        // eslint-disable-next-line no-alert\n        window.alert(msg);\n      });\n      return;\n    }\n\n    this.printService = PDFPrintServiceFactory.createPrintService({\n      pdfDocument: this.pdfDocument,\n      pagesOverview: this.pdfViewer.getPagesOverview(),\n      printContainer: this.appConfig.printContainer,\n      printResolution: AppOptions.get(\"printResolution\"),\n      printAnnotationStoragePromise: this._printAnnotationStoragePromise,\n    });\n    this.forceRendering();\n    // Disable the editor-indicator during printing (fixes bug 1790552).\n    this.setTitle();\n\n    this.printService.layout();\n\n    if (this._hasAnnotationEditors) {\n      this.externalServices.reportTelemetry({\n        type: \"editing\",\n        data: {\n          type: \"print\",\n          stats: this.pdfDocument?.annotationStorage.editorStats,\n        },\n      });\n    }\n  },\n\n  afterPrint() {\n    if (this._printAnnotationStoragePromise) {\n      this._printAnnotationStoragePromise.then(() => {\n        this.pdfScriptingManager.dispatchDidPrint();\n      });\n      this._printAnnotationStoragePromise = null;\n    }\n\n    if (this.printService) {\n      this.printService.destroy();\n      this.printService = null;\n\n      this.pdfDocument?.annotationStorage.resetModified();\n    }\n    this.forceRendering();\n    // Re-enable the editor-indicator after printing (fixes bug 1790552).\n    this.setTitle();\n  },\n\n  rotatePages(delta) {\n    this.pdfViewer.pagesRotation += delta;\n    // Note that the thumbnail viewer is updated, and rendering is triggered,\n    // in the 'rotationchanging' event handler.\n  },\n\n  requestPresentationMode() {\n    this.pdfPresentationMode?.request();\n  },\n\n  triggerPrinting() {\n    if (this.supportsPrinting) {\n      window.print();\n    }\n  },\n\n  bindEvents() {\n    if (this._eventBusAbortController) {\n      return;\n    }\n    const ac = (this._eventBusAbortController = new AbortController());\n    const opts = { signal: ac.signal };\n\n    const {\n      eventBus,\n      externalServices,\n      pdfDocumentProperties,\n      pdfViewer,\n      preferences,\n    } = this;\n\n    eventBus._on(\"resize\", onResize.bind(this), opts);\n    eventBus._on(\"hashchange\", onHashchange.bind(this), opts);\n    eventBus._on(\"beforeprint\", this.beforePrint.bind(this), opts);\n    eventBus._on(\"afterprint\", this.afterPrint.bind(this), opts);\n    eventBus._on(\"pagerender\", onPageRender.bind(this), opts);\n    eventBus._on(\"pagerendered\", onPageRendered.bind(this), opts);\n    eventBus._on(\"updateviewarea\", onUpdateViewarea.bind(this), opts);\n    eventBus._on(\"pagechanging\", onPageChanging.bind(this), opts);\n    eventBus._on(\"scalechanging\", onScaleChanging.bind(this), opts);\n    eventBus._on(\"rotationchanging\", onRotationChanging.bind(this), opts);\n    eventBus._on(\"sidebarviewchanged\", onSidebarViewChanged.bind(this), opts);\n    eventBus._on(\"pagemode\", onPageMode.bind(this), opts);\n    eventBus._on(\"namedaction\", onNamedAction.bind(this), opts);\n    eventBus._on(\n      \"presentationmodechanged\",\n      evt => (pdfViewer.presentationModeState = evt.state),\n      opts\n    );\n    eventBus._on(\n      \"presentationmode\",\n      this.requestPresentationMode.bind(this),\n      opts\n    );\n    eventBus._on(\n      \"switchannotationeditormode\",\n      evt => (pdfViewer.annotationEditorMode = evt),\n      opts\n    );\n    eventBus._on(\"print\", this.triggerPrinting.bind(this), opts);\n    eventBus._on(\"download\", this.downloadOrSave.bind(this), opts);\n    eventBus._on(\"firstpage\", () => (this.page = 1), opts);\n    eventBus._on(\"lastpage\", () => (this.page = this.pagesCount), opts);\n    eventBus._on(\"nextpage\", () => pdfViewer.nextPage(), opts);\n    eventBus._on(\"previouspage\", () => pdfViewer.previousPage(), opts);\n    eventBus._on(\"zoomin\", this.zoomIn.bind(this), opts);\n    eventBus._on(\"zoomout\", this.zoomOut.bind(this), opts);\n    eventBus._on(\"zoomreset\", this.zoomReset.bind(this), opts);\n    eventBus._on(\"pagenumberchanged\", onPageNumberChanged.bind(this), opts);\n    eventBus._on(\n      \"scalechanged\",\n      evt => (pdfViewer.currentScaleValue = evt.value),\n      opts\n    );\n    eventBus._on(\"rotatecw\", this.rotatePages.bind(this, 90), opts);\n    eventBus._on(\"rotateccw\", this.rotatePages.bind(this, -90), opts);\n    eventBus._on(\n      \"optionalcontentconfig\",\n      evt => (pdfViewer.optionalContentConfigPromise = evt.promise),\n      opts\n    );\n    eventBus._on(\n      \"switchscrollmode\",\n      evt => (pdfViewer.scrollMode = evt.mode),\n      opts\n    );\n    eventBus._on(\n      \"scrollmodechanged\",\n      onViewerModesChanged.bind(this, \"scrollMode\"),\n      opts\n    );\n    eventBus._on(\n      \"switchspreadmode\",\n      evt => (pdfViewer.spreadMode = evt.mode),\n      opts\n    );\n    eventBus._on(\n      \"spreadmodechanged\",\n      onViewerModesChanged.bind(this, \"spreadMode\"),\n      opts\n    );\n    eventBus._on(\n      \"imagealttextsettings\",\n      onImageAltTextSettings.bind(this),\n      opts\n    );\n    eventBus._on(\n      \"documentproperties\",\n      () => pdfDocumentProperties?.open(),\n      opts\n    );\n    eventBus._on(\"findfromurlhash\", onFindFromUrlHash.bind(this), opts);\n    eventBus._on(\n      \"updatefindmatchescount\",\n      onUpdateFindMatchesCount.bind(this),\n      opts\n    );\n    eventBus._on(\n      \"updatefindcontrolstate\",\n      onUpdateFindControlState.bind(this),\n      opts\n    );\n\n    if (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"GENERIC\")) {\n      eventBus._on(\"fileinputchange\", onFileInputChange.bind(this), opts);\n      eventBus._on(\"openfile\", onOpenFile.bind(this), opts);\n    }\n    if (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")) {\n      eventBus._on(\n        \"annotationeditorstateschanged\",\n        evt => externalServices.updateEditorStates(evt),\n        opts\n      );\n      eventBus._on(\n        \"reporttelemetry\",\n        evt => externalServices.reportTelemetry(evt.details),\n        opts\n      );\n    }\n    if (\n      typeof PDFJSDev === \"undefined\" ||\n      PDFJSDev.test(\"TESTING || MOZCENTRAL\")\n    ) {\n      eventBus._on(\n        \"setpreference\",\n        evt => preferences.set(evt.name, evt.value),\n        opts\n      );\n    }\n  },\n\n  bindWindowEvents() {\n    if (this._windowAbortController) {\n      return;\n    }\n    this._windowAbortController = new AbortController();\n\n    const {\n      eventBus,\n      appConfig: { mainContainer },\n      pdfViewer,\n      _windowAbortController: { signal },\n    } = this;\n\n    function addWindowResolutionChange(evt = null) {\n      if (evt) {\n        pdfViewer.refresh();\n      }\n      const mediaQueryList = window.matchMedia(\n        `(resolution: ${window.devicePixelRatio || 1}dppx)`\n      );\n      mediaQueryList.addEventListener(\"change\", addWindowResolutionChange, {\n        once: true,\n        signal,\n      });\n    }\n    addWindowResolutionChange();\n\n    window.addEventListener(\"wheel\", onWheel.bind(this), {\n      passive: false,\n      signal,\n    });\n    window.addEventListener(\"touchstart\", onTouchStart.bind(this), {\n      passive: false,\n      signal,\n    });\n    window.addEventListener(\"touchmove\", onTouchMove.bind(this), {\n      passive: false,\n      signal,\n    });\n    window.addEventListener(\"touchend\", onTouchEnd.bind(this), {\n      passive: false,\n      signal,\n    });\n    window.addEventListener(\"click\", onClick.bind(this), { signal });\n    window.addEventListener(\"keydown\", onKeyDown.bind(this), { signal });\n    window.addEventListener(\"keyup\", onKeyUp.bind(this), { signal });\n    window.addEventListener(\n      \"resize\",\n      () => eventBus.dispatch(\"resize\", { source: window }),\n      { signal }\n    );\n    window.addEventListener(\n      \"hashchange\",\n      () => {\n        eventBus.dispatch(\"hashchange\", {\n          source: window,\n          hash: document.location.hash.substring(1),\n        });\n      },\n      { signal }\n    );\n    window.addEventListener(\n      \"beforeprint\",\n      () => eventBus.dispatch(\"beforeprint\", { source: window }),\n      { signal }\n    );\n    window.addEventListener(\n      \"afterprint\",\n      () => eventBus.dispatch(\"afterprint\", { source: window }),\n      { signal }\n    );\n    window.addEventListener(\n      \"updatefromsandbox\",\n      evt => {\n        eventBus.dispatch(\"updatefromsandbox\", {\n          source: window,\n          detail: evt.detail,\n        });\n      },\n      { signal }\n    );\n\n    if (\n      (typeof PDFJSDev === \"undefined\" || !PDFJSDev.test(\"MOZCENTRAL\")) &&\n      !(\"onscrollend\" in document.documentElement)\n    ) {\n      return;\n    }\n    if (typeof PDFJSDev === \"undefined\" || !PDFJSDev.test(\"MOZCENTRAL\")) {\n      // Using the values lastScrollTop and lastScrollLeft is a workaround to\n      // https://bugzilla.mozilla.org/show_bug.cgi?id=1881974.\n      // TODO: remove them once the bug is fixed.\n      ({ scrollTop: this._lastScrollTop, scrollLeft: this._lastScrollLeft } =\n        mainContainer);\n    }\n\n    const scrollend = () => {\n      if (typeof PDFJSDev === \"undefined\" || !PDFJSDev.test(\"MOZCENTRAL\")) {\n        ({ scrollTop: this._lastScrollTop, scrollLeft: this._lastScrollLeft } =\n          mainContainer);\n      }\n\n      this._isScrolling = false;\n      mainContainer.addEventListener(\"scroll\", scroll, {\n        passive: true,\n        signal,\n      });\n      mainContainer.removeEventListener(\"scrollend\", scrollend);\n      mainContainer.removeEventListener(\"blur\", scrollend);\n    };\n    const scroll = () => {\n      if (this._isCtrlKeyDown) {\n        return;\n      }\n      if (\n        (typeof PDFJSDev === \"undefined\" || !PDFJSDev.test(\"MOZCENTRAL\")) &&\n        this._lastScrollTop === mainContainer.scrollTop &&\n        this._lastScrollLeft === mainContainer.scrollLeft\n      ) {\n        return;\n      }\n\n      mainContainer.removeEventListener(\"scroll\", scroll);\n      this._isScrolling = true;\n      mainContainer.addEventListener(\"scrollend\", scrollend, { signal });\n      mainContainer.addEventListener(\"blur\", scrollend, { signal });\n    };\n    mainContainer.addEventListener(\"scroll\", scroll, {\n      passive: true,\n      signal,\n    });\n  },\n\n  unbindEvents() {\n    this._eventBusAbortController?.abort();\n    this._eventBusAbortController = null;\n  },\n\n  unbindWindowEvents() {\n    this._windowAbortController?.abort();\n    this._windowAbortController = null;\n  },\n\n  /**\n   * @ignore\n   */\n  async testingClose() {\n    this.unbindEvents();\n    this.unbindWindowEvents();\n\n    this._globalAbortController?.abort();\n    this._globalAbortController = null;\n\n    this.findBar?.close();\n\n    await Promise.all([this.l10n?.destroy(), this.close()]);\n  },\n\n  _accumulateTicks(ticks, prop) {\n    // If the direction changed, reset the accumulated ticks.\n    if ((this[prop] > 0 && ticks < 0) || (this[prop] < 0 && ticks > 0)) {\n      this[prop] = 0;\n    }\n    this[prop] += ticks;\n    const wholeTicks = Math.trunc(this[prop]);\n    this[prop] -= wholeTicks;\n    return wholeTicks;\n  },\n\n  _accumulateFactor(previousScale, factor, prop) {\n    if (factor === 1) {\n      return 1;\n    }\n    // If the direction changed, reset the accumulated factor.\n    if ((this[prop] > 1 && factor < 1) || (this[prop] < 1 && factor > 1)) {\n      this[prop] = 1;\n    }\n\n    const newFactor =\n      Math.floor(previousScale * factor * this[prop] * 100) /\n      (100 * previousScale);\n    this[prop] = factor / newFactor;\n\n    return newFactor;\n  },\n\n  /**\n   * Should be called *after* all pages have loaded, or if an error occurred,\n   * to unblock the \"load\" event; see https://bugzilla.mozilla.org/show_bug.cgi?id=1618553\n   * @private\n   */\n  _unblockDocumentLoadEvent() {\n    document.blockUnblockOnload?.(false);\n\n    // Ensure that this method is only ever run once.\n    this._unblockDocumentLoadEvent = () => {};\n  },\n\n  /**\n   * Used together with the integration-tests, to enable awaiting full\n   * initialization of the scripting/sandbox.\n   */\n  get scriptingReady() {\n    return this.pdfScriptingManager.ready;\n  },\n};\n\ninitCom(PDFViewerApplication);\n\nif (typeof PDFJSDev === \"undefined\" || !PDFJSDev.test(\"MOZCENTRAL\")) {\n  PDFPrintServiceFactory.initGlobals(PDFViewerApplication);\n}\n\nif (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"GENERIC\")) {\n  const HOSTED_VIEWER_ORIGINS = [\n    \"null\",\n    \"http://mozilla.github.io\",\n    \"https://mozilla.github.io\",\n  ];\n  // eslint-disable-next-line no-var\n  var validateFileURL = function (file) {\n    if (!file) {\n      return;\n    }\n    try {\n      const viewerOrigin = new URL(window.location.href).origin || \"null\";\n      if (HOSTED_VIEWER_ORIGINS.includes(viewerOrigin)) {\n        // Hosted or local viewer, allow for any file locations\n        return;\n      }\n      const fileOrigin = new URL(file, window.location.href).origin;\n      // Removing of the following line will not guarantee that the viewer will\n      // start accepting URLs from foreign origin -- CORS headers on the remote\n      // server must be properly configured.\n      if (fileOrigin !== viewerOrigin) {\n        throw new Error(\"file origin does not match viewer's\");\n      }\n    } catch (ex) {\n      PDFViewerApplication._documentError(\"pdfjs-loading-error\", {\n        message: ex.message,\n      });\n      throw ex;\n    }\n  };\n\n  // eslint-disable-next-line no-var\n  var onFileInputChange = function (evt) {\n    if (this.pdfViewer?.isInPresentationMode) {\n      return; // Opening a new PDF file isn't supported in Presentation Mode.\n    }\n    const file = evt.fileInput.files[0];\n\n    this.open({\n      url: URL.createObjectURL(file),\n      originalUrl: file.name,\n    });\n  };\n\n  // eslint-disable-next-line no-var\n  var onOpenFile = function (evt) {\n    this._openFileInput?.click();\n  };\n}\n\nfunction onPageRender({ pageNumber }) {\n  // If the page is (the most) visible when it starts rendering,\n  // ensure that the page number input loading indicator is displayed.\n  if (pageNumber === this.page) {\n    this.toolbar?.updateLoadingIndicatorState(true);\n  }\n}\n\nfunction onPageRendered({ pageNumber, error }) {\n  // If the page is still visible when it has finished rendering,\n  // ensure that the page number input loading indicator is hidden.\n  if (pageNumber === this.page) {\n    this.toolbar?.updateLoadingIndicatorState(false);\n  }\n\n  // Use the rendered page to set the corresponding thumbnail image.\n  if (this.pdfSidebar?.visibleView === SidebarView.THUMBS) {\n    const pageView = this.pdfViewer.getPageView(/* index = */ pageNumber - 1);\n    const thumbnailView = this.pdfThumbnailViewer?.getThumbnail(\n      /* index = */ pageNumber - 1\n    );\n    if (pageView) {\n      thumbnailView?.setImage(pageView);\n    }\n  }\n\n  if (error) {\n    this._otherError(\"pdfjs-rendering-error\", error);\n  }\n}\n\nfunction onPageMode({ mode }) {\n  // Handle the 'pagemode' hash parameter, see also `PDFLinkService_setHash`.\n  let view;\n  switch (mode) {\n    case \"thumbs\":\n      view = SidebarView.THUMBS;\n      break;\n    case \"bookmarks\":\n    case \"outline\": // non-standard\n      view = SidebarView.OUTLINE;\n      break;\n    case \"attachments\": // non-standard\n      view = SidebarView.ATTACHMENTS;\n      break;\n    case \"layers\": // non-standard\n      view = SidebarView.LAYERS;\n      break;\n    case \"none\":\n      view = SidebarView.NONE;\n      break;\n    default:\n      console.error('Invalid \"pagemode\" hash parameter: ' + mode);\n      return;\n  }\n  this.pdfSidebar?.switchView(view, /* forceOpen = */ true);\n}\n\nfunction onNamedAction(evt) {\n  // Processing a couple of named actions that might be useful, see also\n  // `PDFLinkService.executeNamedAction`.\n  switch (evt.action) {\n    case \"GoToPage\":\n      this.appConfig.toolbar?.pageNumber.select();\n      break;\n\n    case \"Find\":\n      if (!this.supportsIntegratedFind) {\n        this.findBar?.toggle();\n      }\n      break;\n\n    case \"Print\":\n      this.triggerPrinting();\n      break;\n\n    case \"SaveAs\":\n      this.downloadOrSave();\n      break;\n  }\n}\n\nfunction onSidebarViewChanged({ view }) {\n  this.pdfRenderingQueue.isThumbnailViewEnabled = view === SidebarView.THUMBS;\n\n  if (this.isInitialViewSet) {\n    // Only update the storage when the document has been loaded *and* rendered.\n    this.store?.set(\"sidebarView\", view).catch(() => {\n      // Unable to write to storage.\n    });\n  }\n}\n\nfunction onUpdateViewarea({ location }) {\n  if (this.isInitialViewSet) {\n    // Only update the storage when the document has been loaded *and* rendered.\n    this.store\n      ?.setMultiple({\n        page: location.pageNumber,\n        zoom: location.scale,\n        scrollLeft: location.left,\n        scrollTop: location.top,\n        rotation: location.rotation,\n      })\n      .catch(() => {\n        // Unable to write to storage.\n      });\n  }\n  if (this.appConfig.secondaryToolbar) {\n    this.appConfig.secondaryToolbar.viewBookmarkButton.href =\n      this.pdfLinkService.getAnchorUrl(location.pdfOpenParams);\n  }\n}\n\nfunction onViewerModesChanged(name, evt) {\n  if (this.isInitialViewSet && !this.pdfViewer.isInPresentationMode) {\n    // Only update the storage when the document has been loaded *and* rendered.\n    this.store?.set(name, evt.mode).catch(() => {\n      // Unable to write to storage.\n    });\n  }\n}\n\nfunction onResize() {\n  const { pdfDocument, pdfViewer, pdfRenderingQueue } = this;\n\n  if (pdfRenderingQueue.printing && window.matchMedia(\"print\").matches) {\n    // Work-around issue 15324 by ignoring \"resize\" events during printing.\n    return;\n  }\n\n  if (!pdfDocument) {\n    return;\n  }\n  const currentScaleValue = pdfViewer.currentScaleValue;\n  if (\n    currentScaleValue === \"auto\" ||\n    currentScaleValue === \"page-fit\" ||\n    currentScaleValue === \"page-width\"\n  ) {\n    // Note: the scale is constant for 'page-actual'.\n    pdfViewer.currentScaleValue = currentScaleValue;\n  }\n  pdfViewer.update();\n}\n\nfunction onHashchange(evt) {\n  const hash = evt.hash;\n  if (!hash) {\n    return;\n  }\n  if (!this.isInitialViewSet) {\n    this.initialBookmark = hash;\n  } else if (!this.pdfHistory?.popStateInProgress) {\n    this.pdfLinkService.setHash(hash);\n  }\n}\n\nfunction onPageNumberChanged(evt) {\n  const { pdfViewer } = this;\n  // Note that for `<input type=\"number\">` HTML elements, an empty string will\n  // be returned for non-number inputs; hence we simply do nothing in that case.\n  if (evt.value !== \"\") {\n    this.pdfLinkService.goToPage(evt.value);\n  }\n\n  // Ensure that the page number input displays the correct value, even if the\n  // value entered by the user was invalid (e.g. a floating point number).\n  if (\n    evt.value !== pdfViewer.currentPageNumber.toString() &&\n    evt.value !== pdfViewer.currentPageLabel\n  ) {\n    this.toolbar?.setPageNumber(\n      pdfViewer.currentPageNumber,\n      pdfViewer.currentPageLabel\n    );\n  }\n}\n\nfunction onImageAltTextSettings() {\n  this.imageAltTextSettings?.open({\n    enableGuessAltText: AppOptions.get(\"enableGuessAltText\"),\n    enableNewAltTextWhenAddingImage: AppOptions.get(\n      \"enableNewAltTextWhenAddingImage\"\n    ),\n  });\n}\n\nfunction onFindFromUrlHash(evt) {\n  this.eventBus.dispatch(\"find\", {\n    source: evt.source,\n    type: \"\",\n    query: evt.query,\n    caseSensitive: false,\n    entireWord: false,\n    highlightAll: true,\n    findPrevious: false,\n    matchDiacritics: true,\n  });\n}\n\nfunction onUpdateFindMatchesCount({ matchesCount }) {\n  if (this.supportsIntegratedFind) {\n    this.externalServices.updateFindMatchesCount(matchesCount);\n  } else {\n    this.findBar?.updateResultsCount(matchesCount);\n  }\n}\n\nfunction onUpdateFindControlState({\n  state,\n  previous,\n  entireWord,\n  matchesCount,\n  rawQuery,\n}) {\n  if (this.supportsIntegratedFind) {\n    this.externalServices.updateFindControlState({\n      result: state,\n      findPrevious: previous,\n      entireWord,\n      matchesCount,\n      rawQuery,\n    });\n  } else {\n    this.findBar?.updateUIState(state, previous, matchesCount);\n  }\n}\n\nfunction onScaleChanging(evt) {\n  this.toolbar?.setPageScale(evt.presetValue, evt.scale);\n\n  this.pdfViewer.update();\n}\n\nfunction onRotationChanging(evt) {\n  if (this.pdfThumbnailViewer) {\n    this.pdfThumbnailViewer.pagesRotation = evt.pagesRotation;\n  }\n\n  this.forceRendering();\n  // Ensure that the active page doesn't change during rotation.\n  this.pdfViewer.currentPageNumber = evt.pageNumber;\n}\n\nfunction onPageChanging({ pageNumber, pageLabel }) {\n  this.toolbar?.setPageNumber(pageNumber, pageLabel);\n  this.secondaryToolbar?.setPageNumber(pageNumber);\n\n  if (this.pdfSidebar?.visibleView === SidebarView.THUMBS) {\n    this.pdfThumbnailViewer?.scrollThumbnailIntoView(pageNumber);\n  }\n\n  // Show/hide the loading indicator in the page number input element.\n  const currentPage = this.pdfViewer.getPageView(/* index = */ pageNumber - 1);\n  this.toolbar?.updateLoadingIndicatorState(\n    currentPage?.renderingState === RenderingStates.RUNNING\n  );\n}\n\nfunction onWheel(evt) {\n  const {\n    pdfViewer,\n    supportsMouseWheelZoomCtrlKey,\n    supportsMouseWheelZoomMetaKey,\n    supportsPinchToZoom,\n  } = this;\n\n  if (pdfViewer.isInPresentationMode) {\n    return;\n  }\n\n  // Pinch-to-zoom on a trackpad maps to a wheel event with ctrlKey set to true\n  // https://developer.mozilla.org/en-US/docs/Web/API/WheelEvent#browser_compatibility\n  // Hence if ctrlKey is true but ctrl key hasn't been pressed then we can\n  // infer that we have a pinch-to-zoom.\n  // But the ctrlKey could have been pressed outside of the browser window,\n  // hence we try to do some magic to guess if the scaleFactor is likely coming\n  // from a pinch-to-zoom or not.\n\n  // It is important that we query deltaMode before delta{X,Y}, so that\n  // Firefox doesn't switch to DOM_DELTA_PIXEL mode for compat with other\n  // browsers, see https://bugzilla.mozilla.org/show_bug.cgi?id=1392460.\n  const deltaMode = evt.deltaMode;\n\n  // The following formula is a bit strange but it comes from:\n  // https://searchfox.org/mozilla-central/rev/d62c4c4d5547064487006a1506287da394b64724/widget/InputData.cpp#618-626\n  let scaleFactor = Math.exp(-evt.deltaY / 100);\n\n  const isBuiltInMac =\n    typeof PDFJSDev !== \"undefined\" &&\n    PDFJSDev.test(\"MOZCENTRAL\") &&\n    FeatureTest.platform.isMac;\n  const isPinchToZoom =\n    evt.ctrlKey &&\n    !this._isCtrlKeyDown &&\n    deltaMode === WheelEvent.DOM_DELTA_PIXEL &&\n    evt.deltaX === 0 &&\n    (Math.abs(scaleFactor - 1) < 0.05 || isBuiltInMac) &&\n    evt.deltaZ === 0;\n  const origin = [evt.clientX, evt.clientY];\n\n  if (\n    isPinchToZoom ||\n    (evt.ctrlKey && supportsMouseWheelZoomCtrlKey) ||\n    (evt.metaKey && supportsMouseWheelZoomMetaKey)\n  ) {\n    // Only zoom the pages, not the entire viewer.\n    evt.preventDefault();\n    // NOTE: this check must be placed *after* preventDefault.\n    if (\n      this._isScrolling ||\n      document.visibilityState === \"hidden\" ||\n      this.overlayManager.active\n    ) {\n      return;\n    }\n\n    if (isPinchToZoom && supportsPinchToZoom) {\n      scaleFactor = this._accumulateFactor(\n        pdfViewer.currentScale,\n        scaleFactor,\n        \"_wheelUnusedFactor\"\n      );\n      this.updateZoom(null, scaleFactor, origin);\n    } else {\n      const delta = normalizeWheelEventDirection(evt);\n\n      let ticks = 0;\n      if (\n        deltaMode === WheelEvent.DOM_DELTA_LINE ||\n        deltaMode === WheelEvent.DOM_DELTA_PAGE\n      ) {\n        // For line-based devices, use one tick per event, because different\n        // OSs have different defaults for the number lines. But we generally\n        // want one \"clicky\" roll of the wheel (which produces one event) to\n        // adjust the zoom by one step.\n        //\n        // If we're getting fractional lines (I can't think of a scenario\n        // this might actually happen), be safe and use the accumulator.\n        ticks =\n          Math.abs(delta) >= 1\n            ? Math.sign(delta)\n            : this._accumulateTicks(delta, \"_wheelUnusedTicks\");\n      } else {\n        // pixel-based devices\n        const PIXELS_PER_LINE_SCALE = 30;\n        ticks = this._accumulateTicks(\n          delta / PIXELS_PER_LINE_SCALE,\n          \"_wheelUnusedTicks\"\n        );\n      }\n\n      this.updateZoom(ticks, null, origin);\n    }\n  }\n}\n\nfunction onTouchStart(evt) {\n  if (this.pdfViewer.isInPresentationMode || evt.touches.length < 2) {\n    return;\n  }\n  evt.preventDefault();\n\n  if (evt.touches.length !== 2 || this.overlayManager.active) {\n    this._touchInfo = null;\n    return;\n  }\n\n  let [touch0, touch1] = evt.touches;\n  if (touch0.identifier > touch1.identifier) {\n    [touch0, touch1] = [touch1, touch0];\n  }\n  this._touchInfo = {\n    touch0X: touch0.pageX,\n    touch0Y: touch0.pageY,\n    touch1X: touch1.pageX,\n    touch1Y: touch1.pageY,\n  };\n}\n\nfunction onTouchMove(evt) {\n  if (!this._touchInfo || evt.touches.length !== 2) {\n    return;\n  }\n\n  const { pdfViewer, _touchInfo, supportsPinchToZoom } = this;\n  let [touch0, touch1] = evt.touches;\n  if (touch0.identifier > touch1.identifier) {\n    [touch0, touch1] = [touch1, touch0];\n  }\n  const { pageX: page0X, pageY: page0Y } = touch0;\n  const { pageX: page1X, pageY: page1Y } = touch1;\n  const {\n    touch0X: pTouch0X,\n    touch0Y: pTouch0Y,\n    touch1X: pTouch1X,\n    touch1Y: pTouch1Y,\n  } = _touchInfo;\n\n  if (\n    Math.abs(pTouch0X - page0X) <= 1 &&\n    Math.abs(pTouch0Y - page0Y) <= 1 &&\n    Math.abs(pTouch1X - page1X) <= 1 &&\n    Math.abs(pTouch1Y - page1Y) <= 1\n  ) {\n    // Touches are really too close and it's hard do some basic\n    // geometry in order to guess something.\n    return;\n  }\n\n  _touchInfo.touch0X = page0X;\n  _touchInfo.touch0Y = page0Y;\n  _touchInfo.touch1X = page1X;\n  _touchInfo.touch1Y = page1Y;\n\n  if (pTouch0X === page0X && pTouch0Y === page0Y) {\n    // First touch is fixed, if the vectors are collinear then we've a pinch.\n    const v1X = pTouch1X - page0X;\n    const v1Y = pTouch1Y - page0Y;\n    const v2X = page1X - page0X;\n    const v2Y = page1Y - page0Y;\n    const det = v1X * v2Y - v1Y * v2X;\n    // 0.02 is approximatively sin(0.15deg).\n    if (Math.abs(det) > 0.02 * Math.hypot(v1X, v1Y) * Math.hypot(v2X, v2Y)) {\n      return;\n    }\n  } else if (pTouch1X === page1X && pTouch1Y === page1Y) {\n    // Second touch is fixed, if the vectors are collinear then we've a pinch.\n    const v1X = pTouch0X - page1X;\n    const v1Y = pTouch0Y - page1Y;\n    const v2X = page0X - page1X;\n    const v2Y = page0Y - page1Y;\n    const det = v1X * v2Y - v1Y * v2X;\n    if (Math.abs(det) > 0.02 * Math.hypot(v1X, v1Y) * Math.hypot(v2X, v2Y)) {\n      return;\n    }\n  } else {\n    const diff0X = page0X - pTouch0X;\n    const diff1X = page1X - pTouch1X;\n    const diff0Y = page0Y - pTouch0Y;\n    const diff1Y = page1Y - pTouch1Y;\n    const dotProduct = diff0X * diff1X + diff0Y * diff1Y;\n    if (dotProduct >= 0) {\n      // The two touches go in almost the same direction.\n      return;\n    }\n  }\n\n  evt.preventDefault();\n\n  const origin = [(page0X + page1X) / 2, (page0Y + page1Y) / 2];\n  const distance = Math.hypot(page0X - page1X, page0Y - page1Y) || 1;\n  const pDistance = Math.hypot(pTouch0X - pTouch1X, pTouch0Y - pTouch1Y) || 1;\n  if (supportsPinchToZoom) {\n    const newScaleFactor = this._accumulateFactor(\n      pdfViewer.currentScale,\n      distance / pDistance,\n      \"_touchUnusedFactor\"\n    );\n    this.updateZoom(null, newScaleFactor, origin);\n  } else {\n    const PIXELS_PER_LINE_SCALE = 30;\n    const ticks = this._accumulateTicks(\n      (distance - pDistance) / PIXELS_PER_LINE_SCALE,\n      \"_touchUnusedTicks\"\n    );\n    this.updateZoom(ticks, null, origin);\n  }\n}\n\nfunction onTouchEnd(evt) {\n  if (!this._touchInfo) {\n    return;\n  }\n\n  evt.preventDefault();\n  this._touchInfo = null;\n  this._touchUnusedTicks = 0;\n  this._touchUnusedFactor = 1;\n}\n\nfunction onClick(evt) {\n  if (!this.secondaryToolbar?.isOpen) {\n    return;\n  }\n  const appConfig = this.appConfig;\n  if (\n    this.pdfViewer.containsElement(evt.target) ||\n    (appConfig.toolbar?.container.contains(evt.target) &&\n      // TODO: change the `contains` for an equality check when the bug:\n      //  https://bugzilla.mozilla.org/show_bug.cgi?id=1921984\n      // is fixed.\n      !appConfig.secondaryToolbar?.toggleButton.contains(evt.target))\n  ) {\n    this.secondaryToolbar.close();\n  }\n}\n\nfunction onKeyUp(evt) {\n  // evt.ctrlKey is false hence we use evt.key.\n  if (evt.key === \"Control\") {\n    this._isCtrlKeyDown = false;\n  }\n}\n\nfunction onKeyDown(evt) {\n  this._isCtrlKeyDown = evt.key === \"Control\";\n\n  if (this.overlayManager.active) {\n    return;\n  }\n  const { eventBus, pdfViewer } = this;\n  const isViewerInPresentationMode = pdfViewer.isInPresentationMode;\n\n  let handled = false,\n    ensureViewerFocused = false;\n  const cmd =\n    (evt.ctrlKey ? 1 : 0) |\n    (evt.altKey ? 2 : 0) |\n    (evt.shiftKey ? 4 : 0) |\n    (evt.metaKey ? 8 : 0);\n\n  // First, handle the key bindings that are independent whether an input\n  // control is selected or not.\n  if (cmd === 1 || cmd === 8 || cmd === 5 || cmd === 12) {\n    // either CTRL or META key with optional SHIFT.\n    switch (evt.keyCode) {\n      case 70: // f\n        if (!this.supportsIntegratedFind && !evt.shiftKey) {\n          this.findBar?.open();\n          handled = true;\n        }\n        break;\n      case 71: // g\n        if (!this.supportsIntegratedFind) {\n          const { state } = this.findController;\n          if (state) {\n            const newState = {\n              source: window,\n              type: \"again\",\n              findPrevious: cmd === 5 || cmd === 12,\n            };\n            eventBus.dispatch(\"find\", { ...state, ...newState });\n          }\n          handled = true;\n        }\n        break;\n      case 61: // FF/Mac '='\n      case 107: // FF '+' and '='\n      case 187: // Chrome '+'\n      case 171: // FF with German keyboard\n        this.zoomIn();\n        handled = true;\n        break;\n      case 173: // FF/Mac '-'\n      case 109: // FF '-'\n      case 189: // Chrome '-'\n        this.zoomOut();\n        handled = true;\n        break;\n      case 48: // '0'\n      case 96: // '0' on Numpad of Swedish keyboard\n        if (!isViewerInPresentationMode) {\n          // keeping it unhandled (to restore page zoom to 100%)\n          setTimeout(() => {\n            // ... and resetting the scale after browser adjusts its scale\n            this.zoomReset();\n          });\n          handled = false;\n        }\n        break;\n\n      case 38: // up arrow\n        if (isViewerInPresentationMode || this.page > 1) {\n          this.page = 1;\n          handled = true;\n          ensureViewerFocused = true;\n        }\n        break;\n      case 40: // down arrow\n        if (isViewerInPresentationMode || this.page < this.pagesCount) {\n          this.page = this.pagesCount;\n          handled = true;\n          ensureViewerFocused = true;\n        }\n        break;\n    }\n  }\n\n  if (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"GENERIC || CHROME\")) {\n    // CTRL or META without shift\n    if (cmd === 1 || cmd === 8) {\n      switch (evt.keyCode) {\n        case 83: // s\n          eventBus.dispatch(\"download\", { source: window });\n          handled = true;\n          break;\n\n        case 79: // o\n          if (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"GENERIC\")) {\n            eventBus.dispatch(\"openfile\", { source: window });\n            handled = true;\n          }\n          break;\n      }\n    }\n  }\n\n  // CTRL+ALT or Option+Command\n  if (cmd === 3 || cmd === 10) {\n    switch (evt.keyCode) {\n      case 80: // p\n        this.requestPresentationMode();\n        handled = true;\n        this.externalServices.reportTelemetry({\n          type: \"buttons\",\n          data: { id: \"presentationModeKeyboard\" },\n        });\n        break;\n      case 71: // g\n        // focuses input#pageNumber field\n        if (this.appConfig.toolbar) {\n          this.appConfig.toolbar.pageNumber.select();\n          handled = true;\n        }\n        break;\n    }\n  }\n\n  if (handled) {\n    if (ensureViewerFocused && !isViewerInPresentationMode) {\n      pdfViewer.focus();\n    }\n    evt.preventDefault();\n    return;\n  }\n\n  // Some shortcuts should not get handled if a control/input element\n  // is selected.\n  const curElement = getActiveOrFocusedElement();\n  const curElementTagName = curElement?.tagName.toUpperCase();\n  if (\n    curElementTagName === \"INPUT\" ||\n    curElementTagName === \"TEXTAREA\" ||\n    curElementTagName === \"SELECT\" ||\n    (curElementTagName === \"BUTTON\" &&\n      (evt.keyCode === /* Enter = */ 13 || evt.keyCode === /* Space = */ 32)) ||\n    curElement?.isContentEditable\n  ) {\n    // Make sure that the secondary toolbar is closed when Escape is pressed.\n    if (evt.keyCode !== /* Esc = */ 27) {\n      return;\n    }\n  }\n\n  // No control key pressed at all.\n  if (cmd === 0) {\n    let turnPage = 0,\n      turnOnlyIfPageFit = false;\n    switch (evt.keyCode) {\n      case 38: // up arrow\n        if (this.supportsCaretBrowsingMode) {\n          this.moveCaret(/* isUp = */ true, /* select = */ false);\n          handled = true;\n          break;\n        }\n      /* falls through */\n      case 33: // pg up\n        // vertical scrolling using arrow/pg keys\n        if (pdfViewer.isVerticalScrollbarEnabled) {\n          turnOnlyIfPageFit = true;\n        }\n        turnPage = -1;\n        break;\n      case 8: // backspace\n        if (!isViewerInPresentationMode) {\n          turnOnlyIfPageFit = true;\n        }\n        turnPage = -1;\n        break;\n      case 37: // left arrow\n        if (this.supportsCaretBrowsingMode) {\n          return;\n        }\n        // horizontal scrolling using arrow keys\n        if (pdfViewer.isHorizontalScrollbarEnabled) {\n          turnOnlyIfPageFit = true;\n        }\n      /* falls through */\n      case 75: // 'k'\n      case 80: // 'p'\n        turnPage = -1;\n        break;\n      case 27: // esc key\n        if (this.secondaryToolbar?.isOpen) {\n          this.secondaryToolbar.close();\n          handled = true;\n        }\n        if (!this.supportsIntegratedFind && this.findBar?.opened) {\n          this.findBar.close();\n          handled = true;\n        }\n        break;\n      case 40: // down arrow\n        if (this.supportsCaretBrowsingMode) {\n          this.moveCaret(/* isUp = */ false, /* select = */ false);\n          handled = true;\n          break;\n        }\n      /* falls through */\n      case 34: // pg down\n        // vertical scrolling using arrow/pg keys\n        if (pdfViewer.isVerticalScrollbarEnabled) {\n          turnOnlyIfPageFit = true;\n        }\n        turnPage = 1;\n        break;\n      case 13: // enter key\n      case 32: // spacebar\n        if (!isViewerInPresentationMode) {\n          turnOnlyIfPageFit = true;\n        }\n        turnPage = 1;\n        break;\n      case 39: // right arrow\n        if (this.supportsCaretBrowsingMode) {\n          return;\n        }\n        // horizontal scrolling using arrow keys\n        if (pdfViewer.isHorizontalScrollbarEnabled) {\n          turnOnlyIfPageFit = true;\n        }\n      /* falls through */\n      case 74: // 'j'\n      case 78: // 'n'\n        turnPage = 1;\n        break;\n\n      case 36: // home\n        if (isViewerInPresentationMode || this.page > 1) {\n          this.page = 1;\n          handled = true;\n          ensureViewerFocused = true;\n        }\n        break;\n      case 35: // end\n        if (isViewerInPresentationMode || this.page < this.pagesCount) {\n          this.page = this.pagesCount;\n          handled = true;\n          ensureViewerFocused = true;\n        }\n        break;\n\n      case 83: // 's'\n        this.pdfCursorTools?.switchTool(CursorTool.SELECT);\n        break;\n      case 72: // 'h'\n        this.pdfCursorTools?.switchTool(CursorTool.HAND);\n        break;\n\n      case 82: // 'r'\n        this.rotatePages(90);\n        break;\n\n      case 115: // F4\n        this.pdfSidebar?.toggle();\n        break;\n    }\n\n    if (\n      turnPage !== 0 &&\n      (!turnOnlyIfPageFit || pdfViewer.currentScaleValue === \"page-fit\")\n    ) {\n      if (turnPage > 0) {\n        pdfViewer.nextPage();\n      } else {\n        pdfViewer.previousPage();\n      }\n      handled = true;\n    }\n  }\n\n  // shift-key\n  if (cmd === 4) {\n    switch (evt.keyCode) {\n      case 13: // enter key\n      case 32: // spacebar\n        if (\n          !isViewerInPresentationMode &&\n          pdfViewer.currentScaleValue !== \"page-fit\"\n        ) {\n          break;\n        }\n        pdfViewer.previousPage();\n\n        handled = true;\n        break;\n\n      case 38: // up arrow\n        this.moveCaret(/* isUp = */ true, /* select = */ true);\n        handled = true;\n        break;\n      case 40: // down arrow\n        this.moveCaret(/* isUp = */ false, /* select = */ true);\n        handled = true;\n        break;\n      case 82: // 'r'\n        this.rotatePages(-90);\n        break;\n    }\n  }\n\n  if (!handled && !isViewerInPresentationMode) {\n    // 33=Page Up  34=Page Down  35=End    36=Home\n    // 37=Left     38=Up         39=Right  40=Down\n    // 32=Spacebar\n    if (\n      (evt.keyCode >= 33 && evt.keyCode <= 40) ||\n      (evt.keyCode === 32 && curElementTagName !== \"BUTTON\")\n    ) {\n      ensureViewerFocused = true;\n    }\n  }\n\n  if (ensureViewerFocused && !pdfViewer.containsElement(curElement)) {\n    // The page container is not focused, but a page navigation key has been\n    // pressed. Change the focus to the viewer container to make sure that\n    // navigation by keyboard works as expected.\n    pdfViewer.focus();\n  }\n\n  if (handled) {\n    evt.preventDefault();\n  }\n}\n\nfunction beforeUnload(evt) {\n  evt.preventDefault();\n  evt.returnValue = \"\";\n  return false;\n}\n\nexport { PDFViewerApplication };\n","/* Copyright 2016 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { RenderingStates, ScrollMode, SpreadMode } from \"./ui_utils.js\";\nimport { AppOptions } from \"./app_options.js\";\nimport { LinkTarget } from \"./pdf_link_service.js\";\nimport { PDFViewerApplication } from \"./app.js\";\n\n/* eslint-disable-next-line no-unused-vars */\nconst pdfjsVersion =\n  typeof PDFJSDev !== \"undefined\" ? PDFJSDev.eval(\"BUNDLE_VERSION\") : void 0;\n/* eslint-disable-next-line no-unused-vars */\nconst pdfjsBuild =\n  typeof PDFJSDev !== \"undefined\" ? PDFJSDev.eval(\"BUNDLE_BUILD\") : void 0;\n\nconst AppConstants =\n  typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"GENERIC\")\n    ? { LinkTarget, RenderingStates, ScrollMode, SpreadMode }\n    : null;\n\nwindow.PDFViewerApplication = PDFViewerApplication;\nwindow.PDFViewerApplicationConstants = AppConstants;\nwindow.PDFViewerApplicationOptions = AppOptions;\n\nfunction getViewerConfiguration() {\n  return {\n    appContainer: document.body,\n    principalContainer: document.getElementById(\"mainContainer\"),\n    mainContainer: document.getElementById(\"viewerContainer\"),\n    viewerContainer: document.getElementById(\"viewer\"),\n    toolbar: {\n      container: document.getElementById(\"toolbarContainer\"),\n      numPages: document.getElementById(\"numPages\"),\n      pageNumber: document.getElementById(\"pageNumber\"),\n      scaleSelect: document.getElementById(\"scaleSelect\"),\n      customScaleOption: document.getElementById(\"customScaleOption\"),\n      previous: document.getElementById(\"previous\"),\n      next: document.getElementById(\"next\"),\n      zoomIn: document.getElementById(\"zoomInButton\"),\n      zoomOut: document.getElementById(\"zoomOutButton\"),\n      print: document.getElementById(\"printButton\"),\n      editorFreeTextButton: document.getElementById(\"editorFreeTextButton\"),\n      editorFreeTextParamsToolbar: document.getElementById(\n        \"editorFreeTextParamsToolbar\"\n      ),\n      editorHighlightButton: document.getElementById(\"editorHighlightButton\"),\n      editorHighlightParamsToolbar: document.getElementById(\n        \"editorHighlightParamsToolbar\"\n      ),\n      editorHighlightColorPicker: document.getElementById(\n        \"editorHighlightColorPicker\"\n      ),\n      editorInkButton: document.getElementById(\"editorInkButton\"),\n      editorInkParamsToolbar: document.getElementById(\"editorInkParamsToolbar\"),\n      editorStampButton: document.getElementById(\"editorStampButton\"),\n      editorStampParamsToolbar: document.getElementById(\n        \"editorStampParamsToolbar\"\n      ),\n      download: document.getElementById(\"downloadButton\"),\n    },\n    secondaryToolbar: {\n      toolbar: document.getElementById(\"secondaryToolbar\"),\n      toggleButton: document.getElementById(\"secondaryToolbarToggleButton\"),\n      presentationModeButton: document.getElementById(\"presentationMode\"),\n      openFileButton:\n        typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"GENERIC\")\n          ? document.getElementById(\"secondaryOpenFile\")\n          : null,\n      printButton: document.getElementById(\"secondaryPrint\"),\n      downloadButton: document.getElementById(\"secondaryDownload\"),\n      viewBookmarkButton: document.getElementById(\"viewBookmark\"),\n      firstPageButton: document.getElementById(\"firstPage\"),\n      lastPageButton: document.getElementById(\"lastPage\"),\n      pageRotateCwButton: document.getElementById(\"pageRotateCw\"),\n      pageRotateCcwButton: document.getElementById(\"pageRotateCcw\"),\n      cursorSelectToolButton: document.getElementById(\"cursorSelectTool\"),\n      cursorHandToolButton: document.getElementById(\"cursorHandTool\"),\n      scrollPageButton: document.getElementById(\"scrollPage\"),\n      scrollVerticalButton: document.getElementById(\"scrollVertical\"),\n      scrollHorizontalButton: document.getElementById(\"scrollHorizontal\"),\n      scrollWrappedButton: document.getElementById(\"scrollWrapped\"),\n      spreadNoneButton: document.getElementById(\"spreadNone\"),\n      spreadOddButton: document.getElementById(\"spreadOdd\"),\n      spreadEvenButton: document.getElementById(\"spreadEven\"),\n      imageAltTextSettingsButton: document.getElementById(\n        \"imageAltTextSettings\"\n      ),\n      imageAltTextSettingsSeparator: document.getElementById(\n        \"imageAltTextSettingsSeparator\"\n      ),\n      documentPropertiesButton: document.getElementById(\"documentProperties\"),\n    },\n    sidebar: {\n      // Divs (and sidebar button)\n      outerContainer: document.getElementById(\"outerContainer\"),\n      sidebarContainer: document.getElementById(\"sidebarContainer\"),\n      toggleButton: document.getElementById(\"sidebarToggleButton\"),\n      resizer: document.getElementById(\"sidebarResizer\"),\n      // Buttons\n      thumbnailButton: document.getElementById(\"viewThumbnail\"),\n      outlineButton: document.getElementById(\"viewOutline\"),\n      attachmentsButton: document.getElementById(\"viewAttachments\"),\n      layersButton: document.getElementById(\"viewLayers\"),\n      // Views\n      thumbnailView: document.getElementById(\"thumbnailView\"),\n      outlineView: document.getElementById(\"outlineView\"),\n      attachmentsView: document.getElementById(\"attachmentsView\"),\n      layersView: document.getElementById(\"layersView\"),\n      // View-specific options\n      currentOutlineItemButton: document.getElementById(\"currentOutlineItem\"),\n    },\n    findBar: {\n      bar: document.getElementById(\"findbar\"),\n      toggleButton: document.getElementById(\"viewFindButton\"),\n      findField: document.getElementById(\"findInput\"),\n      highlightAllCheckbox: document.getElementById(\"findHighlightAll\"),\n      caseSensitiveCheckbox: document.getElementById(\"findMatchCase\"),\n      matchDiacriticsCheckbox: document.getElementById(\"findMatchDiacritics\"),\n      entireWordCheckbox: document.getElementById(\"findEntireWord\"),\n      findMsg: document.getElementById(\"findMsg\"),\n      findResultsCount: document.getElementById(\"findResultsCount\"),\n      findPreviousButton: document.getElementById(\"findPreviousButton\"),\n      findNextButton: document.getElementById(\"findNextButton\"),\n    },\n    passwordOverlay: {\n      dialog: document.getElementById(\"passwordDialog\"),\n      label: document.getElementById(\"passwordText\"),\n      input: document.getElementById(\"password\"),\n      submitButton: document.getElementById(\"passwordSubmit\"),\n      cancelButton: document.getElementById(\"passwordCancel\"),\n    },\n    documentProperties: {\n      dialog: document.getElementById(\"documentPropertiesDialog\"),\n      closeButton: document.getElementById(\"documentPropertiesClose\"),\n      fields: {\n        fileName: document.getElementById(\"fileNameField\"),\n        fileSize: document.getElementById(\"fileSizeField\"),\n        title: document.getElementById(\"titleField\"),\n        author: document.getElementById(\"authorField\"),\n        subject: document.getElementById(\"subjectField\"),\n        keywords: document.getElementById(\"keywordsField\"),\n        creationDate: document.getElementById(\"creationDateField\"),\n        modificationDate: document.getElementById(\"modificationDateField\"),\n        creator: document.getElementById(\"creatorField\"),\n        producer: document.getElementById(\"producerField\"),\n        version: document.getElementById(\"versionField\"),\n        pageCount: document.getElementById(\"pageCountField\"),\n        pageSize: document.getElementById(\"pageSizeField\"),\n        linearized: document.getElementById(\"linearizedField\"),\n      },\n    },\n    altTextDialog: {\n      dialog: document.getElementById(\"altTextDialog\"),\n      optionDescription: document.getElementById(\"descriptionButton\"),\n      optionDecorative: document.getElementById(\"decorativeButton\"),\n      textarea: document.getElementById(\"descriptionTextarea\"),\n      cancelButton: document.getElementById(\"altTextCancel\"),\n      saveButton: document.getElementById(\"altTextSave\"),\n    },\n    newAltTextDialog: {\n      dialog: document.getElementById(\"newAltTextDialog\"),\n      title: document.getElementById(\"newAltTextTitle\"),\n      descriptionContainer: document.getElementById(\n        \"newAltTextDescriptionContainer\"\n      ),\n      textarea: document.getElementById(\"newAltTextDescriptionTextarea\"),\n      disclaimer: document.getElementById(\"newAltTextDisclaimer\"),\n      learnMore: document.getElementById(\"newAltTextLearnMore\"),\n      imagePreview: document.getElementById(\"newAltTextImagePreview\"),\n      createAutomatically: document.getElementById(\n        \"newAltTextCreateAutomatically\"\n      ),\n      createAutomaticallyButton: document.getElementById(\n        \"newAltTextCreateAutomaticallyButton\"\n      ),\n      downloadModel: document.getElementById(\"newAltTextDownloadModel\"),\n      downloadModelDescription: document.getElementById(\n        \"newAltTextDownloadModelDescription\"\n      ),\n      error: document.getElementById(\"newAltTextError\"),\n      errorCloseButton: document.getElementById(\"newAltTextCloseButton\"),\n      cancelButton: document.getElementById(\"newAltTextCancel\"),\n      notNowButton: document.getElementById(\"newAltTextNotNow\"),\n      saveButton: document.getElementById(\"newAltTextSave\"),\n    },\n    altTextSettingsDialog: {\n      dialog: document.getElementById(\"altTextSettingsDialog\"),\n      createModelButton: document.getElementById(\"createModelButton\"),\n      aiModelSettings: document.getElementById(\"aiModelSettings\"),\n      learnMore: document.getElementById(\"altTextSettingsLearnMore\"),\n      deleteModelButton: document.getElementById(\"deleteModelButton\"),\n      downloadModelButton: document.getElementById(\"downloadModelButton\"),\n      showAltTextDialogButton: document.getElementById(\n        \"showAltTextDialogButton\"\n      ),\n      altTextSettingsCloseButton: document.getElementById(\n        \"altTextSettingsCloseButton\"\n      ),\n      closeButton: document.getElementById(\"altTextSettingsCloseButton\"),\n    },\n    annotationEditorParams: {\n      editorFreeTextFontSize: document.getElementById(\"editorFreeTextFontSize\"),\n      editorFreeTextColor: document.getElementById(\"editorFreeTextColor\"),\n      editorInkColor: document.getElementById(\"editorInkColor\"),\n      editorInkThickness: document.getElementById(\"editorInkThickness\"),\n      editorInkOpacity: document.getElementById(\"editorInkOpacity\"),\n      editorStampAddImage: document.getElementById(\"editorStampAddImage\"),\n      editorFreeHighlightThickness: document.getElementById(\n        \"editorFreeHighlightThickness\"\n      ),\n      editorHighlightShowAll: document.getElementById(\"editorHighlightShowAll\"),\n    },\n    printContainer: document.getElementById(\"printContainer\"),\n  };\n}\n\nfunction webViewerLoad() {\n  const config = getViewerConfiguration();\n\n  if (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"GENERIC\")) {\n    // Give custom implementations of the default viewer a simpler way to\n    // set various `AppOptions`, by dispatching an event once all viewer\n    // files are loaded but *before* the viewer initialization has run.\n    const event = new CustomEvent(\"webviewerloaded\", {\n      bubbles: true,\n      cancelable: true,\n      detail: {\n        source: window,\n      },\n    });\n    try {\n      // Attempt to dispatch the event at the embedding `document`,\n      // in order to support cases where the viewer is embedded in\n      // a *dynamically* created <iframe> element.\n      parent.document.dispatchEvent(event);\n    } catch (ex) {\n      // The viewer could be in e.g. a cross-origin <iframe> element,\n      // fallback to dispatching the event at the current `document`.\n      console.error(`webviewerloaded: ${ex}`);\n      document.dispatchEvent(event);\n    }\n  }\n  PDFViewerApplication.run(config);\n}\n\n// Block the \"load\" event until all pages are loaded, to ensure that printing\n// works in Firefox; see https://bugzilla.mozilla.org/show_bug.cgi?id=1618553\ndocument.blockUnblockOnload?.(true);\n\nif (\n  document.readyState === \"interactive\" ||\n  document.readyState === \"complete\"\n) {\n  webViewerLoad();\n} else {\n  document.addEventListener(\"DOMContentLoaded\", webViewerLoad, true);\n}\n\nexport {\n  AppConstants as PDFViewerApplicationConstants,\n  AppOptions as PDFViewerApplicationOptions,\n  PDFViewerApplication,\n};\n"],"names":["__webpack_require__","exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","DEFAULT_SCALE_VALUE","RenderingStates","INITIAL","RUNNING","PAUSED","FINISHED","PresentationModeState","SidebarView","TextLayerMode","ScrollMode","UNKNOWN","VERTICAL","HORIZONTAL","WRAPPED","PAGE","SpreadMode","NONE","ODD","EVEN","CursorTool","AutoPrintRegExp","scrollIntoView","element","spot","scrollMatches","parent","offsetParent","console","error","offsetY","offsetTop","clientTop","offsetX","offsetLeft","clientLeft","clientHeight","scrollHeight","clientWidth","scrollWidth","classList","contains","getComputedStyle","overflow","undefined","top","left","scrollLeft","scrollTop","watchScroll","viewAreaElement","callback","abortSignal","debounceScroll","evt","rAF","window","requestAnimationFrame","viewAreaElementScrolled","currentX","lastX","state","right","currentY","lastY","down","_eventHandler","addEventListener","useCapture","signal","cancelAnimationFrame","once","parseQueryString","query","params","Map","value","URLSearchParams","set","toLowerCase","InvisibleCharsRegExp","removeNullCharacters","str","replaceInvisible","test","replaceAll","m","binarySearchFirstItem","items","condition","start","minIndex","maxIndex","length","currentIndex","approximateFraction","x","Math","floor","xinv","x_","result","a","b","c","d","p","q","floorToDivide","div","getVisibleElements","scrollEl","views","sortByVisibility","horizontal","rtl","bottom","visible","ids","Set","numViews","firstVisibleElementInd","isElementNextAfterViewHorizontally","view","elementLeft","elementRight","isElementBottomAfterViewTop","backtrackBeforeAllVisibleElements","index","elt","pageTop","i","lastEdge","currentWidth","currentHeight","viewWidth","viewHeight","viewRight","viewBottom","hiddenHeight","max","fractionWidth","percent","push","id","y","widthPercent","add","first","last","at","sort","pc","abs","normalizeWheelEventDirection","delta","hypot","deltaX","deltaY","angle","atan2","PI","isValidRotation","Number","isInteger","isValidScrollMode","mode","values","includes","isValidSpreadMode","isPortraitOrientation","size","width","height","animationStarted","Promise","resolve","docStyle","document","documentElement","style","ProgressBar","constructor","bar","this","val","clamp","v","min","isNaN","remove","setProperty","setWidth","viewer","scrollbarWidth","parentNode","offsetWidth","setDisableAutoFetch","delay","clearTimeout","show","setTimeout","hide","apiPageLayoutToViewerModes","layout","scrollMode","spreadMode","toggleCheckedBtn","button","toggle","setAttribute","toggleExpandedBtn","calcRound","e","createElement","fround","compatParams","userAgent","navigator","platform","maxTouchPoints","isAndroid","OptionKind","Type","BOOLEAN","NUMBER","OBJECT","STRING","UNDEFINED","defaultOptions","allowedGlobalEvents","kind","canvasMaxAreaInBytes","isInAutomation","localeProperties","lang","language","nimbusDataStr","supportsCaretBrowsingMode","supportsDocumentFonts","supportsIntegratedFind","supportsMouseWheelZoomCtrlKey","supportsMouseWheelZoomMetaKey","supportsPinchToZoom","toolbarDensity","altTextLearnMoreUrl","annotationEditorMode","annotationMode","cursorToolOnLoad","debuggerSrc","defaultZoomDelay","defaultZoomValue","disableHistory","disablePageLabels","enableAltText","enableAltTextModelDownload","enableGuessAltText","enableHighlightFloatingButton","enableNewAltTextWhenAddingImage","enablePermissions","enablePrintAutoRotate","enableScripting","enableUpdatedAddImage","externalLinkRel","externalLinkTarget","highlightEditorColors","historyUpdateUrl","ignoreDestinationZoom","imageResourcesPath","maxCanvasPixels","forcePageColors","pageColorsBackground","pageColorsForeground","pdfBugEnabled","printResolution","sidebarViewOnLoad","scrollModeOnLoad","spreadModeOnLoad","textLayerMode","viewOnLoad","cMapPacked","cMapUrl","disableAutoFetch","disableFontFace","disableRange","disableStream","docBaseUrl","enableHWA","enableXfa","fontExtraProperties","isEvalSupported","isOffscreenCanvasSupported","maxImageSize","pdfBug","standardFontDataUrl","useSystemFonts","type","verbosity","workerPort","workerSrc","defaultUrl","sandboxBundleSrc","viewerCssTheme","enableFakeMLManager","disablePreferences","AppOptions","static","name","_hasInvokedSet","_checkDisablePreferences","warn","getAll","defaultOnly","options","create","defaultOpt","setAll","prefs","events","userOpt","toUpperCase","eventBus","dispatch","source","LinkTarget","SELF","BLANK","PARENT","TOP","PDFLinkService","externalLinkEnabled","_ignoreDestinationZoom","baseUrl","pdfDocument","pdfViewer","pdfHistory","setDocument","setViewer","setHistory","pagesCount","numPages","page","currentPageNumber","rotation","pagesRotation","isInPresentationMode","goToDestination","dest","namedDest","explicitDest","pageNumber","getDestination","Array","isArray","destRef","cachedPageNumber","getPageIndex","pushCurrentPosition","scrollPageIntoView","destArray","goToPage","pageLabelToPageNumber","pushPage","addLinkAttributes","link","url","newWindow","Error","target","rel","href","title","onclick","targetStr","getDestinationHash","getAnchorUrl","escape","JSON","stringify","anchor","setHash","hash","has","phrase","match","zoomArgs","split","zoomArg","zoomArgNumber","parseFloat","allowNegativeOffset","unescape","parse","toString","executeNamedAction","action","back","forward","nextPage","previousPage","executeSetOCGState","optionalContentConfig","optionalContentConfigPromise","setOCGState","zoom","args","num","gen","argsLen","allowNull","arg","SimpleLinkService","AbortException","AnnotationEditorLayer","AnnotationEditorParamsType","AnnotationEditorType","AnnotationEditorUIManager","AnnotationLayer","AnnotationMode","build","ColorPicker","createValidAbsoluteUrl","DOMSVGFactory","DrawLayer","FeatureTest","fetchData","getDocument","getFilenameFromUrl","getPdfFilenameFromUrl","getXfaPageViewport","GlobalWorkerOptions","ImageKind","InvalidPDFException","isDataScheme","isPdfFile","MissingPDFException","noContextMenu","normalizeUnicode","OPS","OutputScale","PasswordResponses","PDFDataRangeTransport","PDFDateString","PDFWorker","PermissionFlag","PixelsPerInch","RenderingCancelledException","setLayerDimensions","shadow","TextLayer","UnexpectedResponseException","Util","VerbosityLevel","version","XfaLayer","globalThis","pdfjsLib","WaitOnType","async","waitOnEventOrTimeout","promise","withResolvers","ac","AbortController","handler","abort","timeout","EventBus","bind","on","eventName","listener","_on","external","off","_off","data","eventListeners","externalListeners","slice","rmAbort","AbortSignal","aborted","onAbort","removeEventListener","ii","splice","BaseExternalServices","updateFindControlState","updateFindMatchesCount","initPassiveLoading","reportTelemetry","createL10n","createScripting","updateEditorStates","dispatchGlobalEvent","_event","BasePreferences","freeze","_readFromStorage","then","browserPrefs","_writeToStorage","prefObj","reset","initializedPromise","FluentType","valueOf","FluentNone","super","scope","FluentNumber","opts","memoizeIntlObject","Intl","NumberFormat","format","err","reportError","FluentDateTime","DateTimeFormat","Date","toISOString","MAX_PLACEABLES","FSI","PDI","selector","PluralRules","select","getDefault","variants","star","resolvePattern","RangeError","getArguments","positional","named","resolveExpression","expr","minimumFractionDigits","precision","resolveVariableReference","ReferenceError","getTime","TypeError","resolveMessageReference","attr","message","bundle","_messages","attribute","attributes","resolveTermReference","term","_terms","resolved","resolveFunctionReference","func","_functions","resolveSelectExpression","sel","variant","resolveComplexPattern","ptn","dirty","useIsolating","_useIsolating","elem","placeables","delete","_transform","join","Scope","errors","WeakSet","ctor","cache","_intls","locales","allowed","unwrapped","opt","entries","NUMBER_ALLOWED","DATETIME_ALLOWED","DATETIME","FluentBundle","functions","transform","getMemoizerForLocale","stringLocale","memoizer","hasMessage","getMessage","addResource","res","allowOverrides","body","entry","startsWith","formatPattern","pattern","RE_MESSAGE_START","RE_ATTRIBUTE_START","RE_VARIANT_START","RE_NUMBER_LITERAL","RE_IDENTIFIER","RE_REFERENCE","RE_FUNCTION_NAME","RE_TEXT_RUN","RE_STRING_RUN","RE_STRING_ESCAPE","RE_UNICODE_ESCAPE","RE_LEADING_NEWLINES","RE_TRAILING_SPACES","RE_BLANK_LINES","RE_INDENT","TOKEN_BRACE_OPEN","TOKEN_BRACE_CLOSE","TOKEN_BRACKET_OPEN","TOKEN_BRACKET_CLOSE","TOKEN_PAREN_OPEN","TOKEN_ARROW","TOKEN_COLON","TOKEN_COMMA","TOKEN_BLANK","FluentResource","lastIndex","cursor","next","exec","parseMessage","SyntaxError","re","consumeChar","char","errorClass","consumeToken","match1","parsePattern","parseAttributes","attrs","keys","parsePatternElements","Infinity","indent","parseIndent","trim","elements","commonIndent","parsePlaceable","lastElement","baked","Indent","parseInlineExpression","parseVariants","count","parseVariantKey","sigil","parseArguments","parseArgument","parseLiteral","parseNumberLiteral","parseStringLiteral","parseEscapeSequence","fraction","codepoint4","codepoint6","codepoint","parseInt","String","fromCodePoint","makeIndent","text","replace","blank","reOverlay","TEXT_LEVEL_ELEMENTS","LOCALIZABLE_ATTRIBUTES","global","area","input","menuitem","menu","optgroup","option","track","img","textarea","th","description","label","textbox","translateElement","translation","localName","namespaceURI","textContent","templateElement","ownerDocument","createElementNS","innerHTML","overlayChildNodes","fromFragment","toElement","childNode","childNodes","nodeType","TEXT_NODE","hasAttribute","sanitized","getNodeForNamedElement","replaceChild","isElementAllowed","createSanitizedElement","createTextNodeFromTextContent","appendChild","content","overlayAttributes","fromElement","explicitlyAllowed","getAttribute","map","from","isAttrNameLocalizable","removeAttribute","sourceElement","translatedChild","childName","sourceChild","querySelector","removeChild","shallowPopulateUsing","cloneNode","clone","createTextNode","attrName","elemName","CachedIterable","iterable","Symbol","iterator","CachedAsyncIterable","asyncIterator","cached","cur","touchNext","idx","done","Localization","resourceIds","generateBundles","onChange","addResourceIds","eager","removeResourceIds","filter","r","formatWithFallback","method","translations","hasAtLeastOneBundle","bundles","missingIds","keysFromBundle","locale","formatMessages","messageFromBundle","formatValues","valueFromBundle","formatValue","handleEvent","formatted","attrNames","messageErrors","forEach","L10NID_ATTR_NAME","L10NARGS_ATTR_NAME","L10N_ELEMENT_QUERY","DOMLocalization","roots","pendingrAF","pendingElements","windowElement","mutationObserver","observerConfig","characterData","childList","subtree","attributeFilter","translateRoots","setAttributes","getAttributes","connectRoot","newRoot","root","defaultView","MutationObserver","mutations","translateMutations","observe","disconnectRoot","pauseObserving","clear","resumeObserving","all","translateFragment","takeRecords","disconnect","mutation","addedNode","addedNodes","ELEMENT_NODE","childElementCount","getTranslatables","translateElements","frag","getKeysForElement","applyTranslations","nodes","querySelectorAll","L10n","isRTL","l10n","_setL10n","getLanguage","getDirection","fallback","messages","translate","translateOnce","ex","destroy","pause","resume","langCode","en","es","fy","ga","gu","hi","hy","nb","ne","nn","pa","pt","sv","zh","shortCode","createBundle","resource","GenericL10n","defaultLang","baseLang","baseURL","paths","langs","shortLang","path","URL","GenericScripting","_ready","reject","pdfjsSandbox","QuickJSSandbox","catch","createSandbox","dispatchEventInSandbox","event","sandbox","dispatchEvent","destroySandbox","nukeSandbox","ExternalServices","NewAltTextManager","descriptionContainer","dialog","imagePreview","cancelButton","disclaimer","notNowButton","saveButton","learnMore","errorCloseButton","createAutomaticallyButton","downloadModel","downloadModelDescription","overlayManager","preventDefault","checked","_reportTelemetry","status","setPreference","mlManager","toggleService","register","topic","isInitial","hidden","isEditing","guessedAltText","hasError","altText","mlGuessAltText","detail","finished","total","totalLoaded","ONE_MEGA_BYTES","totalSize","ariaValueMax","round","downloadedSize","ariaValueNow","isEnabledFor","editAltText","uiManager","editor","firstTime","hasAltTextData","altTextFinish","hasAI","isReady","hasProgress","isAltTextEnabledPromise","removeEditListeners","altTextData","canvas","imageData","copyCanvas","append","open","cancel","alt_text_type","flow","alt_text_modal","active","close","firstChild","addEditListeners","setSelected","decorative","guessedWords","words","total_words","words_removed","difference","words_added","ImageAltTextSettings","createModelButton","aiModelSettings","closeButton","deleteModelButton","downloadModelButton","showAltTextDialogButton","details","isFromUI","disabled","span","deleteModel","AltTextManager","optionDescription","optionDecorative","container","onUpdateUIState","svgFactory","svg","defs","mask","rect","clickOpts","onClick","containerX","containerY","containerW","containerH","getBoundingClientRect","innerWidth","windowW","innerHeight","windowH","dialogW","dialogH","getClientDimensions","MARGIN","isLTR","direction","xs","xe","ys","ye","alt_text_keyboard","alt_text_description","alt_text_edit","alt_text_decorative","AnnotationEditorParams","editorFreeTextFontSize","editorFreeTextColor","editorInkColor","editorInkThickness","editorInkOpacity","editorStampAddImage","editorFreeHighlightThickness","editorHighlightShowAll","typeStr","valueAsNumber","FREETEXT_SIZE","FREETEXT_COLOR","INK_COLOR","INK_THICKNESS","INK_OPACITY","HIGHLIGHT_THICKNESS","HIGHLIGHT_FREE","HIGHLIGHT_SHOW_ALL","PRECISION","CaretBrowsingMode","mainContainer","viewerContainer","toolbarContainer","toolbarObserver","ResizeObserver","borderBoxSize","blockSize","rect1","rect2","top1","bot1","mid1","top2","bot2","mid2","isUp","midY","selection","focusNode","focusOffset","range","createRange","setStart","setEnd","caretPositionFromPoint","startContainer","offsetNode","startOffset","offset","caretRangeFromPoint","caretX","extend","setPosition","lastChild","caretPosition","parentElement","elementsAtPoint","elementsFromPoint","savedVisibilities","el","visibility","newLineElement","newLineElementRect","textLayer","closest","walker","createTreeWalker","NodeFilter","SHOW_TEXT","node","moveCaret","getSelection","rangeCount","focusElement","Node","currentNode","focusRect","nodeIterator","previousSibling","nextSibling","lastNode","addRange","caretY","elementRect","download","blobUrl","filename","click","DownloadManager","WeakMap","downloadData","contentType","createObjectURL","Blob","openOrDownloadData","isPdfData","viewerUrl","encodeURIComponent","revokeObjectURL","OverlayManager","canForceClose","showModal","PasswordPrompt","isViewerEmbedded","submitButton","_isViewerEmbedded","keyCode","passwordIncorrect","INCORRECT_PASSWORD","focus","password","setUpdateCallback","updateCallback","reason","TREEITEM_SELECTED_CLASS","BaseTreeViewer","_l10n","_pdfDocument","_lastToggleIsShow","_currentTreeItem","_dispatchEvent","_bindLink","_normalizeTextContent","_addToggleButton","toggler","className","stopPropagation","shiftKey","shouldShowAll","_toggleTreeItem","prepend","_toggleAllTreeItems","_finishRendering","fragment","hasAnyNesting","render","_updateCurrentTreeItem","treeItem","_scrollToCurrentTreeItem","firstElementChild","scrollTo","PDFAttachmentViewer","downloadManager","keepRenderedCapability","_attachments","_renderedCapability","_pendingDispatchEvent","attachmentsCount","attachments","createDocumentFragment","item","renderedPromise","CSS_CLASS_GRAB","GrabToPan","overlay","activate","capture","deactivate","ignoreTarget","matches","originalTarget","tagName","scrollLeftStart","scrollTopStart","clientXStart","clientX","clientYStart","clientY","boundEndPan","mouseOpts","focusedElement","activeElement","blur","buttons","xDiff","yDiff","behavior","PDFCursorTools","switchTool","activeTool","tool","disableActiveTool","_handTool","presentationModeState","enableActive","disableActive","NON_METRIC_LOCALES","US_PAGE_NAMES","METRIC_PAGE_NAMES","getPageName","isPortrait","pageNames","PDFDocumentProperties","fields","fileNameLookup","_fileNameLookup","_currentPageNumber","_pagesRotation","_dataAvailableCapability","info","contentLength","getMetadata","fileName","fileSize","creationDate","modificationDate","pageSize","isLinearized","CreationDate","ModDate","getPage","pdfPage","getPageSizeInches","userUnit","rotate","x1","y1","x2","y2","changeOrientation","IsLinearized","Title","author","Author","subject","Subject","keywords","Keywords","creator","Creator","producer","Producer","PDFFormatVersion","pageCount","linearized","getDownloadInfo","assign","kb","mb","pageSizeInches","nonMetric","sizeInches","sizeMillimeters","nameId","exactMillimeters","intMillimeters","unit","orientation","inputDate","dateObj","toDateObject","CharacterType","getCharacterType","charCode","isAlphabeticalScript","isAscii","isAsciiSpace","isAsciiAlpha","isAsciiDigit","isThai","isHan","isKatakana","isHiragana","isHalfwidthKatakana","NormalizeWithNFKC","FindState","CHARACTERS_TO_NORMALIZE","DIACRITICS_EXCEPTION","DIACRITICS_EXCEPTION_STR","DIACRITICS_REG_EXP","SPECIAL_CHARS_REG_EXP","NOT_DIACRITIC_FROM_END_REG_EXP","NOT_DIACRITIC_FROM_START_REG_EXP","SYLLABLES_REG_EXP","SYLLABLES_LENGTHS","NFKC_CHARS_TO_NORMALIZE","noSyllablesRegExp","withSyllablesRegExp","normalize","syllablePositions","normalizationRegex","len","regexp","getNormalizeWithNFKC","RegExp","rawDiacriticsPositions","normalized","positions","rawDiacriticsIndex","syllableIndex","shift","shiftOrigin","eol","hasDiacritics","p1","p2","p3","p4","p5","p6","p7","p8","p9","replacement","jj","j","charAt","hasTrailingDashEOL","endsWith","newCharLen","PDFFindController","linkService","updateMatchesCountOnProgress","_linkService","_eventBus","onIsPageVisible","highlightMatches","_highlightMatches","pageMatches","_pageMatches","pageMatchesLength","_pageMatchesLength","selected","_selected","_firstPageCapability","_dirtyMatch","findbarClosed","pendingTimeout","_findTimeout","highlightAll","scrollMatchIntoView","selectedLeft","pageIndex","matchIndex","_scrollMatches","matchIdx","pageIdx","_offset","wrapped","_extractTextPromises","_pageContents","_pageDiffs","_hasDiacritics","_matchesCountTotal","_pagesToSearch","_pendingFindMatches","_resumePageIdx","_rawQuery","_normalizedQuery","newQuery","prevQuery","newType","startIdx","charCodeAt","limit","matchDiacritics","isUnicode","trailingSpaces","fromCharCode","pageContent","matcherResult","matchesLength","diffs","matchPos","matchLen","getOriginalIndex","pos","end","oldStart","pageMatchesCount","reverse","isUnicodePart","queryPart","caseSensitive","entireWord","deferred","textOptions","disableNormalization","getTextContent","strBuf","textItem","hasEOL","previous","findPrevious","currentPageIndex","numPageMatches","numMatches","found","current","matchesCount","rawQuery","PDFFindBar","opened","toggleButton","findField","highlightAllCheckbox","caseSensitiveCheckbox","matchDiacriticsCheckbox","entireWordCheckbox","findMsg","findResultsCount","findPreviousButton","findNextButton","updateUIState","findPrev","findMsgId","updateResultsCount","getCurrentHash","location","PDFHistory","_initialized","_fingerprint","_isPagesLoaded","initialize","fingerprint","resetHistory","updateUrl","reInitialized","_updateUrl","history","_popStateInProgress","_blockHashChange","_currentHash","_numPositionUpdates","_uid","_maxUid","_destination","_position","destination","uid","_initialRotation","_initialBookmark","_updateViewareaTimeout","forceReplace","isDestHashesEqual","destHash","pushHash","isDestArraysEqual","firstDest","secondDest","isEntryEqual","second","popStateInProgress","initialBookmark","initialRotation","shouldReplace","newState","newUrl","replaceState","pushState","temporary","position","checkReload","perfEntry","performance","getEntriesByType","removeTemporary","checkNameddest","substring","nameddest","pdfOpenParams","newHash","hashChanged","PDFLayerViewer","_optionalContentConfig","_optionalContentVisibility","layersCount","groupId","setVisibility","_setNestedName","fontStyle","groups","getOrder","queue","levelData","itemsDiv","order","group","getGroup","getOptionalContentConfig","intent","PDFOutlineViewer","_currentOutlineItem","_currentOutlineItemCapability","_sidebarView","_outline","_pageNumberToDestHashCapability","outlineCount","loadingParams","currentOutlineItemPromise","attachment","_setStyles","bold","italic","fontWeight","totalCount","nestedCount","nestedItems","outline","pageNumberToDestHash","_getPageNumberToDestHash","linkElement","pageNumberNesting","nesting","currentNesting","ACTIVE_SELECTOR","CONTROLS_SELECTOR","SWIPE_ANGLE_THRESHOLD","PDFPresentationMode","contextMenuOpen","mouseScrollTimeStamp","mouseScrollDelta","touchSwipeState","request","requestFullscreen","scaleValue","currentScaleValue","pageViewsReady","hasEqualPageSizes","DISABLE","normalizeWheelEventDelta","deltaMode","WheelEvent","DOM_DELTA_PIXEL","MOUSE_PIXELS_PER_LINE","DOM_DELTA_LINE","currentTime","now","storedTime","totalDelta","empty","controlsTimeout","touches","startX","pageX","startY","pageY","endX","endY","dx","dy","absAngle","touchSwipeBind","passive","fullscreenElement","XfaLayerBuilder","annotationStorage","xfaHtml","_cancelled","viewport","parameters","dontFlip","getXfa","textDivs","update","activeService","viewerApp","initialized","PDFPrintService","pagesOverview","printContainer","printAnnotationStoragePromise","_printResolution","_optionalContentConfigPromise","_printAnnotationStoragePromise","currentPage","scratchCanvas","throwIfInactive","every","pageStyleSheet","ensureOverlay","renderPages","isPureXfa","getXfaHtmlForPrinting","allXfaHtml","scale","PDF_TO_CSS_UNITS","xfaPage","children","builder","renderNextPage","renderProgress","renderPage","activeServiceOnEntry","PRINT_UNITS","PDF","ctx","getContext","save","fillStyle","fillRect","restore","printAnnotationStorage","renderContext","canvasContext","getViewport","ENABLE_STORAGE","useRenderedPage","toBlob","blob","src","wrapper","onload","onerror","performPrint","print","eventType","CustomEvent","bubbles","cancelable","getElementById","progress","progressBar","progressPerc","ctrlKey","metaKey","altKey","chrome","opera","stopImmediatePropagation","stopPropagationIfNeeded","overlayPromise","PDFPrintServiceFactory","initGlobals","app","supportsPrinting","createPrintService","PDFRenderingQueue","pdfThumbnailViewer","onIdle","highestPriorityPage","idleTimeout","printing","isThumbnailViewEnabled","setThumbnailViewer","isHighestPriority","renderingId","renderHighestPriority","currentlyVisiblePages","forceRendering","getHighestPriority","scrolledDown","preRenderExtra","visibleViews","numVisible","isViewFinished","firstId","lastId","visibleIds","holeId","holeView","preRenderIndex","preRenderView","renderingState","renderView","draw","finally","PDFScriptingManager","externalServices","docProperties","objects","calculationOrder","docActions","getFieldObjects","getCalculationOrderIds","getJSActions","_pageOpenPending","appInfo","docInfo","actions","dispatchWillSave","dispatchDidSave","dispatchWillPrint","dispatchDidPrint","destroyPromise","ready","_visitedPages","isChangingPresentationMode","siblings","command","modes","pagesPromise","log","increaseScale","decreaseScale","elementId","setValue","visitedPages","pageView","getPageView","actionsPromise","race","SIDEBAR_RESIZING_CLASS","UI_NOTIFICATION_CLASS","PDFSidebar","isOpen","isInitialViewSet","isInitialEventDispatched","onToggled","onUpdateThumbnails","outerContainer","sidebarContainer","resizer","thumbnailButton","outlineButton","attachmentsButton","layersButton","thumbnailView","outlineView","attachmentsView","layersView","_currentOutlineItemButton","currentOutlineItemButton","switchView","visibleView","setInitialView","forceOpen","isViewChanged","onTreeLoaded","enabled","updated","outerContainerWidth","maxWidth","TempImageFactory","getCanvas","tempCanvas","alpha","destroyCanvas","PDFThumbnailView","defaultViewport","renderingQueue","pageColors","pageLabel","pdfPageRotate","renderTask","_placeholderImg","ratio","canvasWidth","canvasHeight","setPdfPage","totalRotation","cancelRendering","image","replaceWith","upscaleFactor","willReadFrequently","outputScale","sx","sy","scaled","reducedCanvas","toDataURL","onContinue","cont","resultPromise","setImage","thumbnailCanvas","drawImage","reducedWidth","reducedHeight","reducedImage","reducedImageCtx","setPageLabel","THUMBNAIL_SELECTED_CLASS","PDFThumbnailViewer","scroll","getThumbnail","_thumbnails","scrollThumbnailIntoView","shouldScroll","updateArgs","thumbnail","cleanup","_pageLabels","firstPagePromise","firstPdfPage","pageNum","setPageLabels","labels","thumbView","visibleThumbs","scrollAhead","AnnotationEditorLayerBuilder","accessibilityManager","annotationEditorLayer","annotationLayer","drawLayer","onAppend","structTreeLayer","clonedViewport","dir","annotations","isInvisible","AnnotationLayerBuilder","renderForms","hasJSActionsPromise","fieldObjectsPromise","annotationCanvasMap","annotationEditorUIManager","_hasJSActionsPromise","_fieldObjectsPromise","_annotationCanvasMap","_accessibilityManager","_annotationEditorUIManager","hasJSActions","fieldObjects","getAnnotations","hasEditableAnnotations","disableFormElements","section","inert","DrawLayerBuilder","setParent","getDrawLayer","PDF_ROLE_TO_HTML_ROLE","Document","DocumentFragment","Part","Sect","Div","Aside","NonStruct","P","H","FENote","Sub","Lbl","Span","Em","Strong","Link","Annot","Form","Ruby","RB","RT","RP","Warichu","WT","WP","L","LI","LBody","Table","TR","TH","TD","THead","TBody","TFoot","Caption","Figure","Formula","Artifact","HEADING_PATTERN","StructTreeLayerBuilder","rawDims","getStructTree","getAriaAttributes","annotationId","structElement","htmlElement","alt","added","child","bbox","pageHeight","calc","addElementsToTextLayer","role","kid","TextAccessibilityManager","setTextMapping","e1","e2","enable","textChildren","nodeIndex","isRemovable","addPointerInTextLayer","disable","removePointerInTextLayer","owns","moveElementInDOM","contentElement","hasChildNodes","elementToCompare","before","after","TextHighlighter","findController","textContentItemsStr","divs","texts","_updateMatches","_convertMatches","iIndex","mm","begin","divIdx","_renderMatches","isSelectedPage","selectedMatchIdx","prevEnd","infinity","beginText","appendTextToDiv","fromOffset","toOffset","i0","i1","lastDivIdx","lastOffset","isSelected","highlightSuffix","n0","n1","clearedUntilDivIdx","n","TextLayerBuilder","highlighter","tabIndex","textContentParams","onBefore","textContentSource","streamTextContent","includeMarkedContent","endOfContent","clipboardData","setData","textLayerDiv","isPointerDown","isFirefox","prevRange","activeTextLayers","getRangeAt","intersectsNode","endDiv","getPropertyValue","modifyStart","compareBoundaryPoints","Range","END_TO_END","START_TO_END","endContainer","parentTextLayer","insertBefore","cloneRange","LAYERS_ORDER","PDFPageView","ENABLE_FORMS","directDrawing","initialOptionalContent","regularAnnotations","layerProperties","_isStandalone","hasViewer","_container","zoomLayer","xfaLayer","background","hasInitialVisibility","oldDiv","layer","foreground","filterFactory","addHighlightHCMFilter","_textHighlighter","treeDom","_resetZoomLayer","removeFromDOM","zoomLayerCanvas","keepZoomLayer","keepAnnotationLayer","keepAnnotationEditorLayer","keepXfaLayer","keepTextLayer","zoomLayerNode","annotationLayerNode","annotationEditorLayerNode","xfaLayerNode","textLayerNode","layerIndex","indexOf","toggleEditingMode","drawingDelay","onlyCssZoom","postponeDrawing","cancelExtraDelay","cssTransform","redrawAnnotationLayer","redrawAnnotationEditorLayer","redrawXfaLayer","redrawTextLayer","hideTextLayer","timestamp","originalViewport","relativeRotation","absRotation","scaleX","scaleY","getPagePoint","convertToPdfPoint","separateAnnots","canvasWrapper","annotationLayerDiv","hasHCM","showCanvas","isLastShow","invScale","pixelsInViewport","maxScale","sqrt","sfx","sfy","pageWidth","annotationEditorLayerDiv","PagesCountLimit","isValidAnnotationEditorMode","PDFPageViewBuffer","buf","resize","newSize","idsToKeep","firstView","PDFViewer","viewerVersion","altTextManager","_getVisiblePages","_scriptingManager","scriptingManager","annotationEditorHighlightColors","removePageBorders","defaultRenderingQueue","_scrollUpdate","_resetView","_pages","getCachedPageViews","_setCurrentPageNumber","resetCurrentPageView","currentPageLabel","currentScale","_currentScale","noScroll","_currentScaleValue","refresh","onePageRendered","_onePageRenderedCapability","_pagesCapability","_layerProperties","self","permissions","COPY","MODIFY_CONTENTS","MODIFY_ANNOTATIONS","FILL_INTERACTIVE_FORMS","ENABLE","visibilityState","hiddenCapability","any","getAllText","buffer","anchorNode","containsNode","ev","clipboard","writeText","_cancelRendering","permissionsPromise","getPermissions","_scrollMode","onAfterDraw","STAMP","loadModel","updateMode","viewerElement","_spreadMode","_updateSpreadMode","getPagesLeft","Language","_location","_previousScrollMode","previousPageNumber","scrollDown","pages","_updateScrollMode","pageIndexSet","parity","spread","dummyPage","pageSpot","newScale","newValue","preset","origin","presetValue","previousScale","scaleDiff","containerTopLeft","hPadding","vPadding","pageWidthScale","pageHeightScale","horizontalScale","widthScale","heightScale","boundingRect","convertToViewportPoint","_updateLocation","firstPage","normalizedScaleValue","currentPageView","topLeft","intLeft","intTop","visiblePages","numVisiblePages","newCacheSize","isSimpleLayout","currentId","stillFullyVisible","pagesToRefresh","containsElement","_isContainerRtl","isHorizontalScrollbarEnabled","isVerticalScrollbarEnabled","firstPageView","getPagesOverview","initialOrientation","_getPageAdvance","pageLayout","yArray","expectedId","advance","updateScale","scaleFactor","steps","ceil","toFixed","editId","isFromKeyboard","updater","resetModifiedIds","idsToRefresh","noUpdate","SecondaryToolbar","presentationModeButton","printButton","downloadButton","viewBookmarkButton","firstPageButton","lastPageButton","pageRotateCwButton","pageRotateCcwButton","cursorSelectToolButton","eventDetails","cursorHandToolButton","scrollPageButton","scrollVerticalButton","scrollHorizontalButton","scrollWrappedButton","spreadNoneButton","spreadOddButton","spreadEvenButton","imageAltTextSettingsButton","documentPropertiesButton","openFileButton","setPageNumber","setPagesCount","forceScrollModePage","isHorizontal","toolbar","Toolbar","zoomIn","zoomOut","editorFreeTextButton","FREETEXT","editorHighlightButton","HIGHLIGHT","editorInkButton","INK","editorStampButton","telemetry","parentContainer","colorPicker","setMainHighlightColorPicker","renderMainDropdown","hasPageLabels","setPageScale","pageScaleValue","pageScale","updateLoadingIndicatorState","editorHighlightColorPicker","scaleSelect","oncontextmenu","editorFreeTextParamsToolbar","editorHighlightParamsToolbar","editorInkParamsToolbar","editorStampParamsToolbar","isDisable","resetNumPages","predefinedValueFound","customScaleOption","loading","ViewHistory","cacheSize","_initializedPromise","databaseStr","database","files","file","localStorage","setItem","getItem","setMultiple","properties","defaultValue","getMultiple","ViewOnLoad","PDFViewerApplication","_initializedCapability","settled","appConfig","pdfLoadingTask","printService","pdfRenderingQueue","pdfPresentationMode","pdfDocumentProperties","pdfLinkService","pdfSidebar","pdfOutlineViewer","pdfAttachmentViewer","pdfLayerViewer","pdfCursorTools","pdfScriptingManager","store","preferences","Preferences","secondaryToolbar","annotationEditorParams","imageAltTextSettings","_downloadUrl","_eventBusAbortController","_windowAbortController","_globalAbortController","documentInfo","metadata","_contentDispositionFilename","_contentLength","_saveInProgress","_wheelUnusedTicks","_wheelUnusedFactor","_touchUnusedTicks","_touchUnusedFactor","_PDFBug","_hasAnnotationEditors","_title","_touchInfo","_isCtrlKeyDown","_caretBrowsing","_isScrolling","_parseHashParams","getElementsByTagName","appContainer","_initializeViewerComponents","bindEvents","bindWindowEvents","loadPDFBug","PDFBug","loadCSS","init","check","setEventBus","_cleanup","_scriptingDocProperties","matchMedia","newAltTextDialog","altTextDialog","sidebar","findBar","principalContainer","altTextSettingsDialog","documentProperties","_docFilename","imageAltTextSettingsSeparator","supportsFullscreen","passwordOverlay","passwordPrompt","run","config","search","validateFileURL","fileInput","_openFileInput","dataTransfer","dropEffect","effectAllowed","msg","_hideViewBookmark","updateZoom","zoomReset","fullscreenEnabled","loadingBar","barElement","setTitleUsingUrl","downloadUrl","decodeURIComponent","setTitle","editorIndicator","_unblockDocumentLoadEvent","_annotationStorageModified","promises","workerParams","originalUrl","apiParams","loadingTask","onPassword","onProgress","loaded","load","_documentError","getData","saveDocument","stats","editorStats","downloadOrSave","moreInfo","_otherError","moreInfoText","stack","lineNumber","level","pageLayoutPromise","getPageLayout","pageModePromise","getPageMode","openActionPromise","getOpenAction","storedPromise","fingerprints","sidebarView","_initializeAnnotationStorageCallbacks","timeStamp","stored","pageMode","openAction","_initializePdfHistory","initialDest","apiPageModeToSidebarView","_initializeAutoPrint","getOutline","getAttachments","_initializePageLabels","_initializeMetadata","filesize","getRaw","authors","jsActions","triggerAutoPrint","some","js","triggerPrinting","contentDispositionFilename","pdfTitle","metadataTitle","IsXFAPresent","IsAcroFormPresent","IsSignaturesPresent","getPageLabels","numLabels","standardLabels","emptyLabels","onSetModified","beforeUnload","onResetModified","onAnnotationEditor","storedHash","setRotation","setViewerModes","beforePrint","alert","afterPrint","resetModified","rotatePages","requestPresentationMode","onResize","onHashchange","onPageRender","onPageRendered","onUpdateViewarea","onPageChanging","onScaleChanging","onRotationChanging","onSidebarViewChanged","onPageMode","onNamedAction","onPageNumberChanged","onViewerModesChanged","onImageAltTextSettings","onFindFromUrlHash","onUpdateFindMatchesCount","onUpdateFindControlState","onFileInputChange","onOpenFile","addWindowResolutionChange","devicePixelRatio","onWheel","onTouchStart","onTouchMove","onTouchEnd","onKeyDown","onKeyUp","_lastScrollTop","_lastScrollLeft","scrollend","unbindEvents","unbindWindowEvents","testingClose","_accumulateTicks","ticks","wholeTicks","trunc","_accumulateFactor","factor","newFactor","blockUnblockOnload","scriptingReady","HOSTED_VIEWER_ORIGINS","viewerOrigin","exp","isPinchToZoom","deltaZ","DOM_DELTA_PAGE","sign","PIXELS_PER_LINE_SCALE","touch0","touch1","identifier","touch0X","touch0Y","touch1X","touch1Y","page0X","page0Y","page1X","page1Y","pTouch0X","pTouch0Y","pTouch1X","pTouch1Y","v1X","v1Y","v2X","v2Y","det","distance","pDistance","newScaleFactor","isViewerInPresentationMode","handled","ensureViewerFocused","cmd","curElement","getActiveOrFocusedElement","curRoot","curActiveOrFocused","shadowRoot","curElementTagName","isContentEditable","turnPage","turnOnlyIfPageFit","returnValue","AppConstants","PDFViewerApplicationConstants","PDFViewerApplicationOptions","webViewerLoad","getViewerConfiguration","createAutomatically","altTextSettingsCloseButton","readyState"],"sourceRoot":""}